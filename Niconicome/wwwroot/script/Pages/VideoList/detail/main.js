var A0=Object.defineProperty;var Fo=(e,t)=>{for(var r in t)A0(e,r,{get:t[r],enumerable:!0})};var Wo={};Fo(Wo,{__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:()=>pm,createPortal:()=>vm,createRoot:()=>ym,default:()=>Dm,findDOMNode:()=>Em,flushSync:()=>Sm,hydrate:()=>Tm,hydrateRoot:()=>bm,render:()=>Lm,unmountComponentAtNode:()=>km,unstable_batchedUpdates:()=>Am,unstable_renderSubtreeIntoContainer:()=>wm,version:()=>Rm});var $o={};Fo($o,{Children:()=>uf,Component:()=>df,Fragment:()=>cf,Profiler:()=>hf,PureComponent:()=>ff,StrictMode:()=>mf,Suspense:()=>gf,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:()=>pf,cloneElement:()=>vf,createContext:()=>en,createElement:()=>yf,createFactory:()=>Ef,createRef:()=>Sf,default:()=>D,forwardRef:()=>Tf,isValidElement:()=>bf,lazy:()=>Lf,memo:()=>kf,startTransition:()=>Af,unstable_act:()=>wf,useCallback:()=>tn,useContext:()=>ke,useDebugValue:()=>Rf,useDeferredValue:()=>Df,useEffect:()=>Qe,useId:()=>If,useImperativeHandle:()=>Cf,useInsertionEffect:()=>_f,useLayoutEffect:()=>xf,useMemo:()=>rn,useReducer:()=>an,useRef:()=>tt,useState:()=>Oe,useSyncExternalStore:()=>Pf,useTransition:()=>Mf,version:()=>Nf});var w0=Object.create,Bo=Object.defineProperty,R0=Object.getOwnPropertyDescriptor,D0=Object.getOwnPropertyNames,I0=Object.getPrototypeOf,C0=Object.prototype.hasOwnProperty,af=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),_0=(e,t)=>{for(var r in t)Bo(e,r,{get:t[r],enumerable:!0})},Uo=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of D0(t))!C0.call(e,n)&&n!==r&&Bo(e,n,{get:()=>t[n],enumerable:!(a=R0(t,n))||a.enumerable});return e},x0=(e,t,r)=>(Uo(e,t,"default"),r&&Uo(r,t,"default")),sf=(e,t,r)=>(r=e!=null?w0(I0(e)):{},Uo(t||!e||!e.__esModule?Bo(r,"default",{value:e,enumerable:!0}):r,e)),P0=af(e=>{"use strict";var t=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),d=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),y=Symbol.iterator;function E(w){return w===null||typeof w!="object"?null:(w=y&&w[y]||w["@@iterator"],typeof w=="function"?w:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,k={};function C(w,V,he){this.props=w,this.context=V,this.refs=k,this.updater=he||S}C.prototype.isReactComponent={},C.prototype.setState=function(w,V){if(typeof w!="object"&&typeof w!="function"&&w!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,w,V,"setState")},C.prototype.forceUpdate=function(w){this.updater.enqueueForceUpdate(this,w,"forceUpdate")};function I(){}I.prototype=C.prototype;function O(w,V,he){this.props=w,this.context=V,this.refs=k,this.updater=he||S}var x=O.prototype=new I;x.constructor=O,T(x,C.prototype),x.isPureReactComponent=!0;var $=Array.isArray,G=Object.prototype.hasOwnProperty,K={current:null},Q={key:!0,ref:!0,__self:!0,__source:!0};function ae(w,V,he){var me,Te={},we=null,Me=null;if(V!=null)for(me in V.ref!==void 0&&(Me=V.ref),V.key!==void 0&&(we=""+V.key),V)G.call(V,me)&&!Q.hasOwnProperty(me)&&(Te[me]=V[me]);var ze=arguments.length-2;if(ze===1)Te.children=he;else if(1<ze){for(var Ce=Array(ze),St=0;St<ze;St++)Ce[St]=arguments[St+2];Te.children=Ce}if(w&&w.defaultProps)for(me in ze=w.defaultProps,ze)Te[me]===void 0&&(Te[me]=ze[me]);return{$$typeof:t,type:w,key:we,ref:Me,props:Te,_owner:K.current}}function W(w,V){return{$$typeof:t,type:w.type,key:V,ref:w.ref,props:w.props,_owner:w._owner}}function ee(w){return typeof w=="object"&&w!==null&&w.$$typeof===t}function ge(w){var V={"=":"=0",":":"=2"};return"$"+w.replace(/[=:]/g,function(he){return V[he]})}var ie=/\/+/g;function se(w,V){return typeof w=="object"&&w!==null&&w.key!=null?ge(""+w.key):V.toString(36)}function de(w,V,he,me,Te){var we=typeof w;(we==="undefined"||we==="boolean")&&(w=null);var Me=!1;if(w===null)Me=!0;else switch(we){case"string":case"number":Me=!0;break;case"object":switch(w.$$typeof){case t:case r:Me=!0}}if(Me)return Me=w,Te=Te(Me),w=me===""?"."+se(Me,0):me,$(Te)?(he="",w!=null&&(he=w.replace(ie,"$&/")+"/"),de(Te,V,he,"",function(St){return St})):Te!=null&&(ee(Te)&&(Te=W(Te,he+(!Te.key||Me&&Me.key===Te.key?"":(""+Te.key).replace(ie,"$&/")+"/")+w)),V.push(Te)),1;if(Me=0,me=me===""?".":me+":",$(w))for(var ze=0;ze<w.length;ze++){we=w[ze];var Ce=me+se(we,ze);Me+=de(we,V,he,Ce,Te)}else if(Ce=E(w),typeof Ce=="function")for(w=Ce.call(w),ze=0;!(we=w.next()).done;)we=we.value,Ce=me+se(we,ze++),Me+=de(we,V,he,Ce,Te);else if(we==="object")throw V=String(w),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(w).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.");return Me}function q(w,V,he){if(w==null)return w;var me=[],Te=0;return de(w,me,"","",function(we){return V.call(he,we,Te++)}),me}function re(w){if(w._status===-1){var V=w._result;V=V(),V.then(function(he){(w._status===0||w._status===-1)&&(w._status=1,w._result=he)},function(he){(w._status===0||w._status===-1)&&(w._status=2,w._result=he)}),w._status===-1&&(w._status=0,w._result=V)}if(w._status===1)return w._result.default;throw w._result}var H={current:null},te={transition:null},Z={ReactCurrentDispatcher:H,ReactCurrentBatchConfig:te,ReactCurrentOwner:K};e.Children={map:q,forEach:function(w,V,he){q(w,function(){V.apply(this,arguments)},he)},count:function(w){var V=0;return q(w,function(){V++}),V},toArray:function(w){return q(w,function(V){return V})||[]},only:function(w){if(!ee(w))throw Error("React.Children.only expected to receive a single React element child.");return w}},e.Component=C,e.Fragment=a,e.Profiler=l,e.PureComponent=O,e.StrictMode=n,e.Suspense=f,e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Z,e.cloneElement=function(w,V,he){if(w==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+w+".");var me=T({},w.props),Te=w.key,we=w.ref,Me=w._owner;if(V!=null){if(V.ref!==void 0&&(we=V.ref,Me=K.current),V.key!==void 0&&(Te=""+V.key),w.type&&w.type.defaultProps)var ze=w.type.defaultProps;for(Ce in V)G.call(V,Ce)&&!Q.hasOwnProperty(Ce)&&(me[Ce]=V[Ce]===void 0&&ze!==void 0?ze[Ce]:V[Ce])}var Ce=arguments.length-2;if(Ce===1)me.children=he;else if(1<Ce){ze=Array(Ce);for(var St=0;St<Ce;St++)ze[St]=arguments[St+2];me.children=ze}return{$$typeof:t,type:w.type,key:Te,ref:we,props:me,_owner:Me}},e.createContext=function(w){return w={$$typeof:d,_currentValue:w,_currentValue2:w,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},w.Provider={$$typeof:u,_context:w},w.Consumer=w},e.createElement=ae,e.createFactory=function(w){var V=ae.bind(null,w);return V.type=w,V},e.createRef=function(){return{current:null}},e.forwardRef=function(w){return{$$typeof:c,render:w}},e.isValidElement=ee,e.lazy=function(w){return{$$typeof:p,_payload:{_status:-1,_result:w},_init:re}},e.memo=function(w,V){return{$$typeof:g,type:w,compare:V===void 0?null:V}},e.startTransition=function(w){var V=te.transition;te.transition={};try{w()}finally{te.transition=V}},e.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},e.useCallback=function(w,V){return H.current.useCallback(w,V)},e.useContext=function(w){return H.current.useContext(w)},e.useDebugValue=function(){},e.useDeferredValue=function(w){return H.current.useDeferredValue(w)},e.useEffect=function(w,V){return H.current.useEffect(w,V)},e.useId=function(){return H.current.useId()},e.useImperativeHandle=function(w,V,he){return H.current.useImperativeHandle(w,V,he)},e.useInsertionEffect=function(w,V){return H.current.useInsertionEffect(w,V)},e.useLayoutEffect=function(w,V){return H.current.useLayoutEffect(w,V)},e.useMemo=function(w,V){return H.current.useMemo(w,V)},e.useReducer=function(w,V,he){return H.current.useReducer(w,V,he)},e.useRef=function(w){return H.current.useRef(w)},e.useState=function(w){return H.current.useState(w)},e.useSyncExternalStore=function(w,V,he){return H.current.useSyncExternalStore(w,V,he)},e.useTransition=function(){return H.current.useTransition()},e.version="18.2.0"}),nf=af((e,t)=>{"use strict";t.exports=P0()}),lf={};_0(lf,{Children:()=>uf,Component:()=>df,Fragment:()=>cf,Profiler:()=>hf,PureComponent:()=>ff,StrictMode:()=>mf,Suspense:()=>gf,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:()=>pf,cloneElement:()=>vf,createContext:()=>en,createElement:()=>yf,createFactory:()=>Ef,createRef:()=>Sf,default:()=>D,forwardRef:()=>Tf,isValidElement:()=>bf,lazy:()=>Lf,memo:()=>kf,startTransition:()=>Af,unstable_act:()=>wf,useCallback:()=>tn,useContext:()=>ke,useDebugValue:()=>Rf,useDeferredValue:()=>Df,useEffect:()=>Qe,useId:()=>If,useImperativeHandle:()=>Cf,useInsertionEffect:()=>_f,useLayoutEffect:()=>xf,useMemo:()=>rn,useReducer:()=>an,useRef:()=>tt,useState:()=>Oe,useSyncExternalStore:()=>Pf,useTransition:()=>Mf,version:()=>Nf});var of=sf(nf());x0(lf,sf(nf()));var{Children:uf,Component:df,Fragment:cf,Profiler:hf,PureComponent:ff,StrictMode:mf,Suspense:gf,__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:pf,cloneElement:vf,createContext:en,createElement:yf,createFactory:Ef,createRef:Sf,forwardRef:Tf,isValidElement:bf,lazy:Lf,memo:kf,startTransition:Af,unstable_act:wf,useCallback:tn,useContext:ke,useDebugValue:Rf,useDeferredValue:Df,useEffect:Qe,useId:If,useImperativeHandle:Cf,useInsertionEffect:_f,useLayoutEffect:xf,useMemo:rn,useReducer:an,useRef:tt,useState:Oe,useSyncExternalStore:Pf,useTransition:Mf,version:Nf}=of,{default:rf,...M0}=of,D=rf!==void 0?rf:M0;var Ho={};Fo(Ho,{default:()=>om,unstable_IdlePriority:()=>Kf,unstable_ImmediatePriority:()=>zf,unstable_LowPriority:()=>Wf,unstable_NormalPriority:()=>jf,unstable_Profiling:()=>Yf,unstable_UserBlockingPriority:()=>qf,unstable_cancelCallback:()=>Xf,unstable_continueExecution:()=>Qf,unstable_forceFrameRate:()=>Jf,unstable_getCurrentPriorityLevel:()=>Zf,unstable_getFirstCallbackNode:()=>em,unstable_next:()=>tm,unstable_now:()=>Hf,unstable_pauseExecution:()=>rm,unstable_requestPaint:()=>im,unstable_runWithPriority:()=>am,unstable_scheduleCallback:()=>sm,unstable_shouldYield:()=>nm,unstable_wrapCallback:()=>lm});var Of=(e,...t)=>setTimeout(e,0,...t),N0=Object.create,Vo=Object.defineProperty,O0=Object.getOwnPropertyDescriptor,F0=Object.getOwnPropertyNames,U0=Object.getPrototypeOf,B0=Object.prototype.hasOwnProperty,Uf=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),$0=(e,t)=>{for(var r in t)Vo(e,r,{get:t[r],enumerable:!0})},Go=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of F0(t))!B0.call(e,n)&&n!==r&&Vo(e,n,{get:()=>t[n],enumerable:!(a=O0(t,n))||a.enumerable});return e},G0=(e,t,r)=>(Go(e,t,"default"),r&&Go(r,t,"default")),Bf=(e,t,r)=>(r=e!=null?N0(U0(e)):{},Go(t||!e||!e.__esModule?Vo(r,"default",{value:e,enumerable:!0}):r,e)),V0=Uf(e=>{"use strict";function t(H,te){var Z=H.length;H.push(te);e:for(;0<Z;){var w=Z-1>>>1,V=H[w];if(0<n(V,te))H[w]=te,H[Z]=V,Z=w;else break e}}function r(H){return H.length===0?null:H[0]}function a(H){if(H.length===0)return null;var te=H[0],Z=H.pop();if(Z!==te){H[0]=Z;e:for(var w=0,V=H.length,he=V>>>1;w<he;){var me=2*(w+1)-1,Te=H[me],we=me+1,Me=H[we];if(0>n(Te,Z))we<V&&0>n(Me,Te)?(H[w]=Me,H[we]=Z,w=we):(H[w]=Te,H[me]=Z,w=me);else if(we<V&&0>n(Me,Z))H[w]=Me,H[we]=Z,w=we;else break e}}return te}function n(H,te){var Z=H.sortIndex-te.sortIndex;return Z!==0?Z:H.id-te.id}typeof performance=="object"&&typeof performance.now=="function"?(l=performance,e.unstable_now=function(){return l.now()}):(u=Date,d=u.now(),e.unstable_now=function(){return u.now()-d});var l,u,d,c=[],f=[],g=1,p=null,y=3,E=!1,S=!1,T=!1,k=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,I=typeof Of<"u"?Of:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function O(H){for(var te=r(f);te!==null;){if(te.callback===null)a(f);else if(te.startTime<=H)a(f),te.sortIndex=te.expirationTime,t(c,te);else break;te=r(f)}}function x(H){if(T=!1,O(H),!S)if(r(c)!==null)S=!0,q($);else{var te=r(f);te!==null&&re(x,te.startTime-H)}}function $(H,te){S=!1,T&&(T=!1,C(Q),Q=-1),E=!0;var Z=y;try{for(O(te),p=r(c);p!==null&&(!(p.expirationTime>te)||H&&!ee());){var w=p.callback;if(typeof w=="function"){p.callback=null,y=p.priorityLevel;var V=w(p.expirationTime<=te);te=e.unstable_now(),typeof V=="function"?p.callback=V:p===r(c)&&a(c),O(te)}else a(c);p=r(c)}if(p!==null)var he=!0;else{var me=r(f);me!==null&&re(x,me.startTime-te),he=!1}return he}finally{p=null,y=Z,E=!1}}var G=!1,K=null,Q=-1,ae=5,W=-1;function ee(){return!(e.unstable_now()-W<ae)}function ge(){if(K!==null){var H=e.unstable_now();W=H;var te=!0;try{te=K(!0,H)}finally{te?ie():(G=!1,K=null)}}else G=!1}var ie;typeof I=="function"?ie=function(){I(ge)}:typeof MessageChannel<"u"?(se=new MessageChannel,de=se.port2,se.port1.onmessage=ge,ie=function(){de.postMessage(null)}):ie=function(){k(ge,0)};var se,de;function q(H){K=H,G||(G=!0,ie())}function re(H,te){Q=k(function(){H(e.unstable_now())},te)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(H){H.callback=null},e.unstable_continueExecution=function(){S||E||(S=!0,q($))},e.unstable_forceFrameRate=function(H){0>H||125<H?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ae=0<H?Math.floor(1e3/H):5},e.unstable_getCurrentPriorityLevel=function(){return y},e.unstable_getFirstCallbackNode=function(){return r(c)},e.unstable_next=function(H){switch(y){case 1:case 2:case 3:var te=3;break;default:te=y}var Z=y;y=te;try{return H()}finally{y=Z}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(H,te){switch(H){case 1:case 2:case 3:case 4:case 5:break;default:H=3}var Z=y;y=H;try{return te()}finally{y=Z}},e.unstable_scheduleCallback=function(H,te,Z){var w=e.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?w+Z:w):Z=w,H){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=Z+V,H={id:g++,callback:te,priorityLevel:H,startTime:Z,expirationTime:V,sortIndex:-1},Z>w?(H.sortIndex=Z,t(f,H),r(c)===null&&H===r(f)&&(T?(C(Q),Q=-1):T=!0,re(x,Z-w))):(H.sortIndex=V,t(c,H),S||E||(S=!0,q($))),H},e.unstable_shouldYield=ee,e.unstable_wrapCallback=function(H){var te=y;return function(){var Z=y;y=te;try{return H.apply(this,arguments)}finally{y=Z}}}}),$f=Uf((e,t)=>{"use strict";t.exports=V0()}),Gf={};$0(Gf,{default:()=>om,unstable_IdlePriority:()=>Kf,unstable_ImmediatePriority:()=>zf,unstable_LowPriority:()=>Wf,unstable_NormalPriority:()=>jf,unstable_Profiling:()=>Yf,unstable_UserBlockingPriority:()=>qf,unstable_cancelCallback:()=>Xf,unstable_continueExecution:()=>Qf,unstable_forceFrameRate:()=>Jf,unstable_getCurrentPriorityLevel:()=>Zf,unstable_getFirstCallbackNode:()=>em,unstable_next:()=>tm,unstable_now:()=>Hf,unstable_pauseExecution:()=>rm,unstable_requestPaint:()=>im,unstable_runWithPriority:()=>am,unstable_scheduleCallback:()=>sm,unstable_shouldYield:()=>nm,unstable_wrapCallback:()=>lm});var Vf=Bf($f());G0(Gf,Bf($f()));var{unstable_now:Hf,unstable_IdlePriority:Kf,unstable_ImmediatePriority:zf,unstable_LowPriority:Wf,unstable_NormalPriority:jf,unstable_Profiling:Yf,unstable_UserBlockingPriority:qf,unstable_cancelCallback:Xf,unstable_continueExecution:Qf,unstable_forceFrameRate:Jf,unstable_getCurrentPriorityLevel:Zf,unstable_getFirstCallbackNode:em,unstable_next:tm,unstable_pauseExecution:rm,unstable_requestPaint:im,unstable_runWithPriority:am,unstable_scheduleCallback:sm,unstable_shouldYield:nm,unstable_wrapCallback:lm}=Vf,{default:Ff,...H0}=Vf,om=Ff!==void 0?Ff:H0;var Mi=e=>{let t=a=>typeof a.default<"u"?a.default:a,r=a=>Object.assign({},a);switch(e){case"react":return t($o);case"scheduler":return t(Ho);default:throw new Error('module "'+e+'" not found')}},K0=Object.create,zo=Object.defineProperty,z0=Object.getOwnPropertyDescriptor,W0=Object.getOwnPropertyNames,j0=Object.getPrototypeOf,Y0=Object.prototype.hasOwnProperty,um=(e=>typeof Mi<"u"?Mi:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof Mi<"u"?Mi:t)[r]}):e)(function(e){if(typeof Mi<"u")return Mi.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),cm=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),q0=(e,t)=>{for(var r in t)zo(e,r,{get:t[r],enumerable:!0})},Ko=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of W0(t))!Y0.call(e,n)&&n!==r&&zo(e,n,{get:()=>t[n],enumerable:!(a=z0(t,n))||a.enumerable});return e},X0=(e,t,r)=>(Ko(e,t,"default"),r&&Ko(r,t,"default")),hm=(e,t,r)=>(r=e!=null?K0(j0(e)):{},Ko(t||!e||!e.__esModule?zo(r,"default",{value:e,enumerable:!0}):r,e)),Q0=cm(e=>{"use strict";var t=um("react"),r=um("scheduler");function a(i){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+i,o=1;o<arguments.length;o++)s+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,l={};function u(i,s){d(i,s),d(i+"Capture",s)}function d(i,s){for(l[i]=s,i=0;i<s.length;i++)n.add(s[i])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),f=Object.prototype.hasOwnProperty,g=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},y={};function E(i){return f.call(y,i)?!0:f.call(p,i)?!1:g.test(i)?y[i]=!0:(p[i]=!0,!1)}function S(i,s,o,h){if(o!==null&&o.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return h?!1:o!==null?!o.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function T(i,s,o,h){if(s===null||typeof s>"u"||S(i,s,o,h))return!0;if(h)return!1;if(o!==null)switch(o.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function k(i,s,o,h,m,v,L){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=h,this.attributeNamespace=m,this.mustUseProperty=o,this.propertyName=i,this.type=s,this.sanitizeURL=v,this.removeEmptyString=L}var C={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){C[i]=new k(i,0,!1,i,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var s=i[0];C[s]=new k(s,1,!1,i[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(i){C[i]=new k(i,2,!1,i.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){C[i]=new k(i,2,!1,i,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){C[i]=new k(i,3,!1,i.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(i){C[i]=new k(i,3,!0,i,null,!1,!1)}),["capture","download"].forEach(function(i){C[i]=new k(i,4,!1,i,null,!1,!1)}),["cols","rows","size","span"].forEach(function(i){C[i]=new k(i,6,!1,i,null,!1,!1)}),["rowSpan","start"].forEach(function(i){C[i]=new k(i,5,!1,i.toLowerCase(),null,!1,!1)});var I=/[\-:]([a-z])/g;function O(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var s=i.replace(I,O);C[s]=new k(s,1,!1,i,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var s=i.replace(I,O);C[s]=new k(s,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(i){var s=i.replace(I,O);C[s]=new k(s,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(i){C[i]=new k(i,1,!1,i.toLowerCase(),null,!1,!1)}),C.xlinkHref=new k("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(i){C[i]=new k(i,1,!1,i.toLowerCase(),null,!0,!0)});function x(i,s,o,h){var m=C.hasOwnProperty(s)?C[s]:null;(m!==null?m.type!==0:h||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(T(s,o,m,h)&&(o=null),h||m===null?E(s)&&(o===null?i.removeAttribute(s):i.setAttribute(s,""+o)):m.mustUseProperty?i[m.propertyName]=o===null?m.type===3?!1:"":o:(s=m.attributeName,h=m.attributeNamespace,o===null?i.removeAttribute(s):(m=m.type,o=m===3||m===4&&o===!0?"":""+o,h?i.setAttributeNS(h,s,o):i.setAttribute(s,o))))}var $=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,G=Symbol.for("react.element"),K=Symbol.for("react.portal"),Q=Symbol.for("react.fragment"),ae=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),ee=Symbol.for("react.provider"),ge=Symbol.for("react.context"),ie=Symbol.for("react.forward_ref"),se=Symbol.for("react.suspense"),de=Symbol.for("react.suspense_list"),q=Symbol.for("react.memo"),re=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var H=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var te=Symbol.iterator;function Z(i){return i===null||typeof i!="object"?null:(i=te&&i[te]||i["@@iterator"],typeof i=="function"?i:null)}var w=Object.assign,V;function he(i){if(V===void 0)try{throw Error()}catch(o){var s=o.stack.trim().match(/\n( *(at )?)/);V=s&&s[1]||""}return`
`+V+i}var me=!1;function Te(i,s){if(!i||me)return"";me=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(F){var h=F}Reflect.construct(i,[],s)}else{try{s.call()}catch(F){h=F}i.call(s.prototype)}else{try{throw Error()}catch(F){h=F}i()}}catch(F){if(F&&h&&typeof F.stack=="string"){for(var m=F.stack.split(`
`),v=h.stack.split(`
`),L=m.length-1,A=v.length-1;1<=L&&0<=A&&m[L]!==v[A];)A--;for(;1<=L&&0<=A;L--,A--)if(m[L]!==v[A]){if(L!==1||A!==1)do if(L--,A--,0>A||m[L]!==v[A]){var R=`
`+m[L].replace(" at new "," at ");return i.displayName&&R.includes("<anonymous>")&&(R=R.replace("<anonymous>",i.displayName)),R}while(1<=L&&0<=A);break}}}finally{me=!1,Error.prepareStackTrace=o}return(i=i?i.displayName||i.name:"")?he(i):""}function we(i){switch(i.tag){case 5:return he(i.type);case 16:return he("Lazy");case 13:return he("Suspense");case 19:return he("SuspenseList");case 0:case 2:case 15:return i=Te(i.type,!1),i;case 11:return i=Te(i.type.render,!1),i;case 1:return i=Te(i.type,!0),i;default:return""}}function Me(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case Q:return"Fragment";case K:return"Portal";case W:return"Profiler";case ae:return"StrictMode";case se:return"Suspense";case de:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case ge:return(i.displayName||"Context")+".Consumer";case ee:return(i._context.displayName||"Context")+".Provider";case ie:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case q:return s=i.displayName||null,s!==null?s:Me(i.type)||"Memo";case re:s=i._payload,i=i._init;try{return Me(i(s))}catch{}}return null}function ze(i){var s=i.type;switch(i.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=s.render,i=i.displayName||i.name||"",s.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Me(s);case 8:return s===ae?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Ce(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function St(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Cv(i){var s=St(i)?"checked":"value",o=Object.getOwnPropertyDescriptor(i.constructor.prototype,s),h=""+i[s];if(!i.hasOwnProperty(s)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var m=o.get,v=o.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return m.call(this)},set:function(L){h=""+L,v.call(this,L)}}),Object.defineProperty(i,s,{enumerable:o.enumerable}),{getValue:function(){return h},setValue:function(L){h=""+L},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function Va(i){i._valueTracker||(i._valueTracker=Cv(i))}function sd(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var o=s.getValue(),h="";return i&&(h=St(i)?i.checked?"true":"false":i.value),i=h,i!==o?(s.setValue(i),!0):!1}function Ha(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Wn(i,s){var o=s.checked;return w({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??i._wrapperState.initialChecked})}function nd(i,s){var o=s.defaultValue==null?"":s.defaultValue,h=s.checked!=null?s.checked:s.defaultChecked;o=Ce(s.value!=null?s.value:o),i._wrapperState={initialChecked:h,initialValue:o,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function ld(i,s){s=s.checked,s!=null&&x(i,"checked",s,!1)}function jn(i,s){ld(i,s);var o=Ce(s.value),h=s.type;if(o!=null)h==="number"?(o===0&&i.value===""||i.value!=o)&&(i.value=""+o):i.value!==""+o&&(i.value=""+o);else if(h==="submit"||h==="reset"){i.removeAttribute("value");return}s.hasOwnProperty("value")?Yn(i,s.type,o):s.hasOwnProperty("defaultValue")&&Yn(i,s.type,Ce(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(i.defaultChecked=!!s.defaultChecked)}function od(i,s,o){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var h=s.type;if(!(h!=="submit"&&h!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+i._wrapperState.initialValue,o||s===i.value||(i.value=s),i.defaultValue=s}o=i.name,o!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,o!==""&&(i.name=o)}function Yn(i,s,o){(s!=="number"||Ha(i.ownerDocument)!==i)&&(o==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+o&&(i.defaultValue=""+o))}var ji=Array.isArray;function oi(i,s,o,h){if(i=i.options,s){s={};for(var m=0;m<o.length;m++)s["$"+o[m]]=!0;for(o=0;o<i.length;o++)m=s.hasOwnProperty("$"+i[o].value),i[o].selected!==m&&(i[o].selected=m),m&&h&&(i[o].defaultSelected=!0)}else{for(o=""+Ce(o),s=null,m=0;m<i.length;m++){if(i[m].value===o){i[m].selected=!0,h&&(i[m].defaultSelected=!0);return}s!==null||i[m].disabled||(s=i[m])}s!==null&&(s.selected=!0)}}function qn(i,s){if(s.dangerouslySetInnerHTML!=null)throw Error(a(91));return w({},s,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function ud(i,s){var o=s.value;if(o==null){if(o=s.children,s=s.defaultValue,o!=null){if(s!=null)throw Error(a(92));if(ji(o)){if(1<o.length)throw Error(a(93));o=o[0]}s=o}s==null&&(s=""),o=s}i._wrapperState={initialValue:Ce(o)}}function dd(i,s){var o=Ce(s.value),h=Ce(s.defaultValue);o!=null&&(o=""+o,o!==i.value&&(i.value=o),s.defaultValue==null&&i.defaultValue!==o&&(i.defaultValue=o)),h!=null&&(i.defaultValue=""+h)}function cd(i){var s=i.textContent;s===i._wrapperState.initialValue&&s!==""&&s!==null&&(i.value=s)}function hd(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Xn(i,s){return i==null||i==="http://www.w3.org/1999/xhtml"?hd(s):i==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Ka,fd=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,o,h,m){MSApp.execUnsafeLocalFunction(function(){return i(s,o,h,m)})}:i}(function(i,s){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=s;else{for(Ka=Ka||document.createElement("div"),Ka.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=Ka.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;s.firstChild;)i.appendChild(s.firstChild)}});function Yi(i,s){if(s){var o=i.firstChild;if(o&&o===i.lastChild&&o.nodeType===3){o.nodeValue=s;return}}i.textContent=s}var qi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},_v=["Webkit","ms","Moz","O"];Object.keys(qi).forEach(function(i){_v.forEach(function(s){s=s+i.charAt(0).toUpperCase()+i.substring(1),qi[s]=qi[i]})});function md(i,s,o){return s==null||typeof s=="boolean"||s===""?"":o||typeof s!="number"||s===0||qi.hasOwnProperty(i)&&qi[i]?(""+s).trim():s+"px"}function gd(i,s){i=i.style;for(var o in s)if(s.hasOwnProperty(o)){var h=o.indexOf("--")===0,m=md(o,s[o],h);o==="float"&&(o="cssFloat"),h?i.setProperty(o,m):i[o]=m}}var xv=w({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Qn(i,s){if(s){if(xv[i]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(a(137,i));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(a(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(a(61))}if(s.style!=null&&typeof s.style!="object")throw Error(a(62))}}function Jn(i,s){if(i.indexOf("-")===-1)return typeof s.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zn=null;function el(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var tl=null,ui=null,di=null;function pd(i){if(i=pa(i)){if(typeof tl!="function")throw Error(a(280));var s=i.stateNode;s&&(s=ps(s),tl(i.stateNode,i.type,s))}}function vd(i){ui?di?di.push(i):di=[i]:ui=i}function yd(){if(ui){var i=ui,s=di;if(di=ui=null,pd(i),s)for(i=0;i<s.length;i++)pd(s[i])}}function Ed(i,s){return i(s)}function Sd(){}var rl=!1;function Td(i,s,o){if(rl)return i(s,o);rl=!0;try{return Ed(i,s,o)}finally{rl=!1,(ui!==null||di!==null)&&(Sd(),yd())}}function Xi(i,s){var o=i.stateNode;if(o===null)return null;var h=ps(o);if(h===null)return null;o=h[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(i=i.type,h=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!h;break e;default:i=!1}if(i)return null;if(o&&typeof o!="function")throw Error(a(231,s,typeof o));return o}var il=!1;if(c)try{ci={},Object.defineProperty(ci,"passive",{get:function(){il=!0}}),window.addEventListener("test",ci,ci),window.removeEventListener("test",ci,ci)}catch{il=!1}var ci;function Pv(i,s,o,h,m,v,L,A,R){var F=Array.prototype.slice.call(arguments,3);try{s.apply(o,F)}catch(Y){this.onError(Y)}}var Qi=!1,za=null,Wa=!1,al=null,Mv={onError:function(i){Qi=!0,za=i}};function Nv(i,s,o,h,m,v,L,A,R){Qi=!1,za=null,Pv.apply(Mv,arguments)}function Ov(i,s,o,h,m,v,L,A,R){if(Nv.apply(this,arguments),Qi){if(Qi){var F=za;Qi=!1,za=null}else throw Error(a(198));Wa||(Wa=!0,al=F)}}function Vr(i){var s=i,o=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,s.flags&4098&&(o=s.return),i=s.return;while(i)}return s.tag===3?o:null}function bd(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function Ld(i){if(Vr(i)!==i)throw Error(a(188))}function Fv(i){var s=i.alternate;if(!s){if(s=Vr(i),s===null)throw Error(a(188));return s!==i?null:i}for(var o=i,h=s;;){var m=o.return;if(m===null)break;var v=m.alternate;if(v===null){if(h=m.return,h!==null){o=h;continue}break}if(m.child===v.child){for(v=m.child;v;){if(v===o)return Ld(m),i;if(v===h)return Ld(m),s;v=v.sibling}throw Error(a(188))}if(o.return!==h.return)o=m,h=v;else{for(var L=!1,A=m.child;A;){if(A===o){L=!0,o=m,h=v;break}if(A===h){L=!0,h=m,o=v;break}A=A.sibling}if(!L){for(A=v.child;A;){if(A===o){L=!0,o=v,h=m;break}if(A===h){L=!0,h=v,o=m;break}A=A.sibling}if(!L)throw Error(a(189))}}if(o.alternate!==h)throw Error(a(190))}if(o.tag!==3)throw Error(a(188));return o.stateNode.current===o?i:s}function kd(i){return i=Fv(i),i!==null?Ad(i):null}function Ad(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var s=Ad(i);if(s!==null)return s;i=i.sibling}return null}var wd=r.unstable_scheduleCallback,Rd=r.unstable_cancelCallback,Uv=r.unstable_shouldYield,Bv=r.unstable_requestPaint,je=r.unstable_now,$v=r.unstable_getCurrentPriorityLevel,sl=r.unstable_ImmediatePriority,Dd=r.unstable_UserBlockingPriority,ja=r.unstable_NormalPriority,Gv=r.unstable_LowPriority,Id=r.unstable_IdlePriority,Ya=null,Jt=null;function Vv(i){if(Jt&&typeof Jt.onCommitFiberRoot=="function")try{Jt.onCommitFiberRoot(Ya,i,void 0,(i.current.flags&128)===128)}catch{}}var Gt=Math.clz32?Math.clz32:zv,Hv=Math.log,Kv=Math.LN2;function zv(i){return i>>>=0,i===0?32:31-(Hv(i)/Kv|0)|0}var qa=64,Xa=4194304;function Ji(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Qa(i,s){var o=i.pendingLanes;if(o===0)return 0;var h=0,m=i.suspendedLanes,v=i.pingedLanes,L=o&268435455;if(L!==0){var A=L&~m;A!==0?h=Ji(A):(v&=L,v!==0&&(h=Ji(v)))}else L=o&~m,L!==0?h=Ji(L):v!==0&&(h=Ji(v));if(h===0)return 0;if(s!==0&&s!==h&&!(s&m)&&(m=h&-h,v=s&-s,m>=v||m===16&&(v&4194240)!==0))return s;if(h&4&&(h|=o&16),s=i.entangledLanes,s!==0)for(i=i.entanglements,s&=h;0<s;)o=31-Gt(s),m=1<<o,h|=i[o],s&=~m;return h}function Wv(i,s){switch(i){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function jv(i,s){for(var o=i.suspendedLanes,h=i.pingedLanes,m=i.expirationTimes,v=i.pendingLanes;0<v;){var L=31-Gt(v),A=1<<L,R=m[L];R===-1?(!(A&o)||A&h)&&(m[L]=Wv(A,s)):R<=s&&(i.expiredLanes|=A),v&=~A}}function nl(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Cd(){var i=qa;return qa<<=1,!(qa&4194240)&&(qa=64),i}function ll(i){for(var s=[],o=0;31>o;o++)s.push(i);return s}function Zi(i,s,o){i.pendingLanes|=s,s!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,s=31-Gt(s),i[s]=o}function Yv(i,s){var o=i.pendingLanes&~s;i.pendingLanes=s,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=s,i.mutableReadLanes&=s,i.entangledLanes&=s,s=i.entanglements;var h=i.eventTimes;for(i=i.expirationTimes;0<o;){var m=31-Gt(o),v=1<<m;s[m]=0,h[m]=-1,i[m]=-1,o&=~v}}function ol(i,s){var o=i.entangledLanes|=s;for(i=i.entanglements;o;){var h=31-Gt(o),m=1<<h;m&s|i[h]&s&&(i[h]|=s),o&=~m}}var xe=0;function _d(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var xd,ul,Pd,Md,Nd,dl=!1,Ja=[],br=null,Lr=null,kr=null,ea=new Map,ta=new Map,Ar=[],qv="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Od(i,s){switch(i){case"focusin":case"focusout":br=null;break;case"dragenter":case"dragleave":Lr=null;break;case"mouseover":case"mouseout":kr=null;break;case"pointerover":case"pointerout":ea.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":ta.delete(s.pointerId)}}function ra(i,s,o,h,m,v){return i===null||i.nativeEvent!==v?(i={blockedOn:s,domEventName:o,eventSystemFlags:h,nativeEvent:v,targetContainers:[m]},s!==null&&(s=pa(s),s!==null&&ul(s)),i):(i.eventSystemFlags|=h,s=i.targetContainers,m!==null&&s.indexOf(m)===-1&&s.push(m),i)}function Xv(i,s,o,h,m){switch(s){case"focusin":return br=ra(br,i,s,o,h,m),!0;case"dragenter":return Lr=ra(Lr,i,s,o,h,m),!0;case"mouseover":return kr=ra(kr,i,s,o,h,m),!0;case"pointerover":var v=m.pointerId;return ea.set(v,ra(ea.get(v)||null,i,s,o,h,m)),!0;case"gotpointercapture":return v=m.pointerId,ta.set(v,ra(ta.get(v)||null,i,s,o,h,m)),!0}return!1}function Fd(i){var s=Hr(i.target);if(s!==null){var o=Vr(s);if(o!==null){if(s=o.tag,s===13){if(s=bd(o),s!==null){i.blockedOn=s,Nd(i.priority,function(){Pd(o)});return}}else if(s===3&&o.stateNode.current.memoizedState.isDehydrated){i.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Za(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var o=hl(i.domEventName,i.eventSystemFlags,s[0],i.nativeEvent);if(o===null){o=i.nativeEvent;var h=new o.constructor(o.type,o);Zn=h,o.target.dispatchEvent(h),Zn=null}else return s=pa(o),s!==null&&ul(s),i.blockedOn=o,!1;s.shift()}return!0}function Ud(i,s,o){Za(i)&&o.delete(s)}function Qv(){dl=!1,br!==null&&Za(br)&&(br=null),Lr!==null&&Za(Lr)&&(Lr=null),kr!==null&&Za(kr)&&(kr=null),ea.forEach(Ud),ta.forEach(Ud)}function ia(i,s){i.blockedOn===s&&(i.blockedOn=null,dl||(dl=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,Qv)))}function aa(i){function s(m){return ia(m,i)}if(0<Ja.length){ia(Ja[0],i);for(var o=1;o<Ja.length;o++){var h=Ja[o];h.blockedOn===i&&(h.blockedOn=null)}}for(br!==null&&ia(br,i),Lr!==null&&ia(Lr,i),kr!==null&&ia(kr,i),ea.forEach(s),ta.forEach(s),o=0;o<Ar.length;o++)h=Ar[o],h.blockedOn===i&&(h.blockedOn=null);for(;0<Ar.length&&(o=Ar[0],o.blockedOn===null);)Fd(o),o.blockedOn===null&&Ar.shift()}var hi=$.ReactCurrentBatchConfig,es=!0;function Jv(i,s,o,h){var m=xe,v=hi.transition;hi.transition=null;try{xe=1,cl(i,s,o,h)}finally{xe=m,hi.transition=v}}function Zv(i,s,o,h){var m=xe,v=hi.transition;hi.transition=null;try{xe=4,cl(i,s,o,h)}finally{xe=m,hi.transition=v}}function cl(i,s,o,h){if(es){var m=hl(i,s,o,h);if(m===null)Rl(i,s,h,ts,o),Od(i,h);else if(Xv(m,i,s,o,h))h.stopPropagation();else if(Od(i,h),s&4&&-1<qv.indexOf(i)){for(;m!==null;){var v=pa(m);if(v!==null&&xd(v),v=hl(i,s,o,h),v===null&&Rl(i,s,h,ts,o),v===m)break;m=v}m!==null&&h.stopPropagation()}else Rl(i,s,h,null,o)}}var ts=null;function hl(i,s,o,h){if(ts=null,i=el(h),i=Hr(i),i!==null)if(s=Vr(i),s===null)i=null;else if(o=s.tag,o===13){if(i=bd(s),i!==null)return i;i=null}else if(o===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null);return ts=i,null}function Bd(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($v()){case sl:return 1;case Dd:return 4;case ja:case Gv:return 16;case Id:return 536870912;default:return 16}default:return 16}}var wr=null,fl=null,rs=null;function $d(){if(rs)return rs;var i,s=fl,o=s.length,h,m="value"in wr?wr.value:wr.textContent,v=m.length;for(i=0;i<o&&s[i]===m[i];i++);var L=o-i;for(h=1;h<=L&&s[o-h]===m[v-h];h++);return rs=m.slice(i,1<h?1-h:void 0)}function is(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function as(){return!0}function Gd(){return!1}function Dt(i){function s(o,h,m,v,L){this._reactName=o,this._targetInst=m,this.type=h,this.nativeEvent=v,this.target=L,this.currentTarget=null;for(var A in i)i.hasOwnProperty(A)&&(o=i[A],this[A]=o?o(v):v[A]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?as:Gd,this.isPropagationStopped=Gd,this}return w(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=as)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=as)},persist:function(){},isPersistent:as}),s}var fi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ml=Dt(fi),sa=w({},fi,{view:0,detail:0}),ey=Dt(sa),gl,pl,na,ss=w({},sa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yl,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==na&&(na&&i.type==="mousemove"?(gl=i.screenX-na.screenX,pl=i.screenY-na.screenY):pl=gl=0,na=i),gl)},movementY:function(i){return"movementY"in i?i.movementY:pl}}),Vd=Dt(ss),ty=w({},ss,{dataTransfer:0}),ry=Dt(ty),iy=w({},sa,{relatedTarget:0}),vl=Dt(iy),ay=w({},fi,{animationName:0,elapsedTime:0,pseudoElement:0}),sy=Dt(ay),ny=w({},fi,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),ly=Dt(ny),oy=w({},fi,{data:0}),Hd=Dt(oy),uy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},dy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hy(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=cy[i])?!!s[i]:!1}function yl(){return hy}var fy=w({},sa,{key:function(i){if(i.key){var s=uy[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=is(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?dy[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yl,charCode:function(i){return i.type==="keypress"?is(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?is(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),my=Dt(fy),gy=w({},ss,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Kd=Dt(gy),py=w({},sa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yl}),vy=Dt(py),yy=w({},fi,{propertyName:0,elapsedTime:0,pseudoElement:0}),Ey=Dt(yy),Sy=w({},ss,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),Ty=Dt(Sy),by=[9,13,27,32],El=c&&"CompositionEvent"in window,la=null;c&&"documentMode"in document&&(la=document.documentMode);var Ly=c&&"TextEvent"in window&&!la,zd=c&&(!El||la&&8<la&&11>=la),Wd=" ",jd=!1;function Yd(i,s){switch(i){case"keyup":return by.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qd(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var mi=!1;function ky(i,s){switch(i){case"compositionend":return qd(s);case"keypress":return s.which!==32?null:(jd=!0,Wd);case"textInput":return i=s.data,i===Wd&&jd?null:i;default:return null}}function Ay(i,s){if(mi)return i==="compositionend"||!El&&Yd(i,s)?(i=$d(),rs=fl=wr=null,mi=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return zd&&s.locale!=="ko"?null:s.data;default:return null}}var wy={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Xd(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!wy[i.type]:s==="textarea"}function Qd(i,s,o,h){vd(h),s=fs(s,"onChange"),0<s.length&&(o=new ml("onChange","change",null,o,h),i.push({event:o,listeners:s}))}var oa=null,ua=null;function Ry(i){pc(i,0)}function ns(i){var s=Ei(i);if(sd(s))return i}function Dy(i,s){if(i==="change")return s}var Jd=!1;c&&(c?(ls="oninput"in document,ls||(Tl=document.createElement("div"),Tl.setAttribute("oninput","return;"),ls=typeof Tl.oninput=="function"),Sl=ls):Sl=!1,Jd=Sl&&(!document.documentMode||9<document.documentMode));var Sl,ls,Tl;function Zd(){oa&&(oa.detachEvent("onpropertychange",ec),ua=oa=null)}function ec(i){if(i.propertyName==="value"&&ns(ua)){var s=[];Qd(s,ua,i,el(i)),Td(Ry,s)}}function Iy(i,s,o){i==="focusin"?(Zd(),oa=s,ua=o,oa.attachEvent("onpropertychange",ec)):i==="focusout"&&Zd()}function Cy(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return ns(ua)}function _y(i,s){if(i==="click")return ns(s)}function xy(i,s){if(i==="input"||i==="change")return ns(s)}function Py(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var Vt=typeof Object.is=="function"?Object.is:Py;function da(i,s){if(Vt(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var o=Object.keys(i),h=Object.keys(s);if(o.length!==h.length)return!1;for(h=0;h<o.length;h++){var m=o[h];if(!f.call(s,m)||!Vt(i[m],s[m]))return!1}return!0}function tc(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function rc(i,s){var o=tc(i);i=0;for(var h;o;){if(o.nodeType===3){if(h=i+o.textContent.length,i<=s&&h>=s)return{node:o,offset:s-i};i=h}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=tc(o)}}function ic(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?ic(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function ac(){for(var i=window,s=Ha();s instanceof i.HTMLIFrameElement;){try{var o=typeof s.contentWindow.location.href=="string"}catch{o=!1}if(o)i=s.contentWindow;else break;s=Ha(i.document)}return s}function bl(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}function My(i){var s=ac(),o=i.focusedElem,h=i.selectionRange;if(s!==o&&o&&o.ownerDocument&&ic(o.ownerDocument.documentElement,o)){if(h!==null&&bl(o)){if(s=h.start,i=h.end,i===void 0&&(i=s),"selectionStart"in o)o.selectionStart=s,o.selectionEnd=Math.min(i,o.value.length);else if(i=(s=o.ownerDocument||document)&&s.defaultView||window,i.getSelection){i=i.getSelection();var m=o.textContent.length,v=Math.min(h.start,m);h=h.end===void 0?v:Math.min(h.end,m),!i.extend&&v>h&&(m=h,h=v,v=m),m=rc(o,v);var L=rc(o,h);m&&L&&(i.rangeCount!==1||i.anchorNode!==m.node||i.anchorOffset!==m.offset||i.focusNode!==L.node||i.focusOffset!==L.offset)&&(s=s.createRange(),s.setStart(m.node,m.offset),i.removeAllRanges(),v>h?(i.addRange(s),i.extend(L.node,L.offset)):(s.setEnd(L.node,L.offset),i.addRange(s)))}}for(s=[],i=o;i=i.parentNode;)i.nodeType===1&&s.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<s.length;o++)i=s[o],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var Ny=c&&"documentMode"in document&&11>=document.documentMode,gi=null,Ll=null,ca=null,kl=!1;function sc(i,s,o){var h=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;kl||gi==null||gi!==Ha(h)||(h=gi,"selectionStart"in h&&bl(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),ca&&da(ca,h)||(ca=h,h=fs(Ll,"onSelect"),0<h.length&&(s=new ml("onSelect","select",null,s,o),i.push({event:s,listeners:h}),s.target=gi)))}function os(i,s){var o={};return o[i.toLowerCase()]=s.toLowerCase(),o["Webkit"+i]="webkit"+s,o["Moz"+i]="moz"+s,o}var pi={animationend:os("Animation","AnimationEnd"),animationiteration:os("Animation","AnimationIteration"),animationstart:os("Animation","AnimationStart"),transitionend:os("Transition","TransitionEnd")},Al={},nc={};c&&(nc=document.createElement("div").style,"AnimationEvent"in window||(delete pi.animationend.animation,delete pi.animationiteration.animation,delete pi.animationstart.animation),"TransitionEvent"in window||delete pi.transitionend.transition);function us(i){if(Al[i])return Al[i];if(!pi[i])return i;var s=pi[i],o;for(o in s)if(s.hasOwnProperty(o)&&o in nc)return Al[i]=s[o];return i}var lc=us("animationend"),oc=us("animationiteration"),uc=us("animationstart"),dc=us("transitionend"),cc=new Map,hc="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Rr(i,s){cc.set(i,s),u(s,[i])}for(cs=0;cs<hc.length;cs++)ds=hc[cs],fc=ds.toLowerCase(),mc=ds[0].toUpperCase()+ds.slice(1),Rr(fc,"on"+mc);var ds,fc,mc,cs;Rr(lc,"onAnimationEnd"),Rr(oc,"onAnimationIteration"),Rr(uc,"onAnimationStart"),Rr("dblclick","onDoubleClick"),Rr("focusin","onFocus"),Rr("focusout","onBlur"),Rr(dc,"onTransitionEnd"),d("onMouseEnter",["mouseout","mouseover"]),d("onMouseLeave",["mouseout","mouseover"]),d("onPointerEnter",["pointerout","pointerover"]),d("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ha="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Oy=new Set("cancel close invalid load scroll toggle".split(" ").concat(ha));function gc(i,s,o){var h=i.type||"unknown-event";i.currentTarget=o,Ov(h,s,void 0,i),i.currentTarget=null}function pc(i,s){s=(s&4)!==0;for(var o=0;o<i.length;o++){var h=i[o],m=h.event;h=h.listeners;e:{var v=void 0;if(s)for(var L=h.length-1;0<=L;L--){var A=h[L],R=A.instance,F=A.currentTarget;if(A=A.listener,R!==v&&m.isPropagationStopped())break e;gc(m,A,F),v=R}else for(L=0;L<h.length;L++){if(A=h[L],R=A.instance,F=A.currentTarget,A=A.listener,R!==v&&m.isPropagationStopped())break e;gc(m,A,F),v=R}}}if(Wa)throw i=al,Wa=!1,al=null,i}function Fe(i,s){var o=s[Pl];o===void 0&&(o=s[Pl]=new Set);var h=i+"__bubble";o.has(h)||(vc(s,i,2,!1),o.add(h))}function wl(i,s,o){var h=0;s&&(h|=4),vc(o,i,h,s)}var hs="_reactListening"+Math.random().toString(36).slice(2);function fa(i){if(!i[hs]){i[hs]=!0,n.forEach(function(o){o!=="selectionchange"&&(Oy.has(o)||wl(o,!1,i),wl(o,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[hs]||(s[hs]=!0,wl("selectionchange",!1,s))}}function vc(i,s,o,h){switch(Bd(s)){case 1:var m=Jv;break;case 4:m=Zv;break;default:m=cl}o=m.bind(null,s,o,i),m=void 0,!il||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(m=!0),h?m!==void 0?i.addEventListener(s,o,{capture:!0,passive:m}):i.addEventListener(s,o,!0):m!==void 0?i.addEventListener(s,o,{passive:m}):i.addEventListener(s,o,!1)}function Rl(i,s,o,h,m){var v=h;if(!(s&1)&&!(s&2)&&h!==null)e:for(;;){if(h===null)return;var L=h.tag;if(L===3||L===4){var A=h.stateNode.containerInfo;if(A===m||A.nodeType===8&&A.parentNode===m)break;if(L===4)for(L=h.return;L!==null;){var R=L.tag;if((R===3||R===4)&&(R=L.stateNode.containerInfo,R===m||R.nodeType===8&&R.parentNode===m))return;L=L.return}for(;A!==null;){if(L=Hr(A),L===null)return;if(R=L.tag,R===5||R===6){h=v=L;continue e}A=A.parentNode}}h=h.return}Td(function(){var F=v,Y=el(o),X=[];e:{var j=cc.get(i);if(j!==void 0){var ne=ml,ue=i;switch(i){case"keypress":if(is(o)===0)break e;case"keydown":case"keyup":ne=my;break;case"focusin":ue="focus",ne=vl;break;case"focusout":ue="blur",ne=vl;break;case"beforeblur":case"afterblur":ne=vl;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ne=Vd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ne=ry;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ne=vy;break;case lc:case oc:case uc:ne=sy;break;case dc:ne=Ey;break;case"scroll":ne=ey;break;case"wheel":ne=Ty;break;case"copy":case"cut":case"paste":ne=ly;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ne=Kd}var ce=(s&4)!==0,Ye=!ce&&i==="scroll",M=ce?j!==null?j+"Capture":null:j;ce=[];for(var _=F,N;_!==null;){N=_;var J=N.stateNode;if(N.tag===5&&J!==null&&(N=J,M!==null&&(J=Xi(_,M),J!=null&&ce.push(ma(_,J,N)))),Ye)break;_=_.return}0<ce.length&&(j=new ne(j,ue,null,o,Y),X.push({event:j,listeners:ce}))}}if(!(s&7)){e:{if(j=i==="mouseover"||i==="pointerover",ne=i==="mouseout"||i==="pointerout",j&&o!==Zn&&(ue=o.relatedTarget||o.fromElement)&&(Hr(ue)||ue[dr]))break e;if((ne||j)&&(j=Y.window===Y?Y:(j=Y.ownerDocument)?j.defaultView||j.parentWindow:window,ne?(ue=o.relatedTarget||o.toElement,ne=F,ue=ue?Hr(ue):null,ue!==null&&(Ye=Vr(ue),ue!==Ye||ue.tag!==5&&ue.tag!==6)&&(ue=null)):(ne=null,ue=F),ne!==ue)){if(ce=Vd,J="onMouseLeave",M="onMouseEnter",_="mouse",(i==="pointerout"||i==="pointerover")&&(ce=Kd,J="onPointerLeave",M="onPointerEnter",_="pointer"),Ye=ne==null?j:Ei(ne),N=ue==null?j:Ei(ue),j=new ce(J,_+"leave",ne,o,Y),j.target=Ye,j.relatedTarget=N,J=null,Hr(Y)===F&&(ce=new ce(M,_+"enter",ue,o,Y),ce.target=N,ce.relatedTarget=Ye,J=ce),Ye=J,ne&&ue)t:{for(ce=ne,M=ue,_=0,N=ce;N;N=vi(N))_++;for(N=0,J=M;J;J=vi(J))N++;for(;0<_-N;)ce=vi(ce),_--;for(;0<N-_;)M=vi(M),N--;for(;_--;){if(ce===M||M!==null&&ce===M.alternate)break t;ce=vi(ce),M=vi(M)}ce=null}else ce=null;ne!==null&&yc(X,j,ne,ce,!1),ue!==null&&Ye!==null&&yc(X,Ye,ue,ce,!0)}}e:{if(j=F?Ei(F):window,ne=j.nodeName&&j.nodeName.toLowerCase(),ne==="select"||ne==="input"&&j.type==="file")var fe=Dy;else if(Xd(j))if(Jd)fe=xy;else{fe=Cy;var pe=Iy}else(ne=j.nodeName)&&ne.toLowerCase()==="input"&&(j.type==="checkbox"||j.type==="radio")&&(fe=_y);if(fe&&(fe=fe(i,F))){Qd(X,fe,o,Y);break e}pe&&pe(i,j,F),i==="focusout"&&(pe=j._wrapperState)&&pe.controlled&&j.type==="number"&&Yn(j,"number",j.value)}switch(pe=F?Ei(F):window,i){case"focusin":(Xd(pe)||pe.contentEditable==="true")&&(gi=pe,Ll=F,ca=null);break;case"focusout":ca=Ll=gi=null;break;case"mousedown":kl=!0;break;case"contextmenu":case"mouseup":case"dragend":kl=!1,sc(X,o,Y);break;case"selectionchange":if(Ny)break;case"keydown":case"keyup":sc(X,o,Y)}var ve;if(El)e:{switch(i){case"compositionstart":var be="onCompositionStart";break e;case"compositionend":be="onCompositionEnd";break e;case"compositionupdate":be="onCompositionUpdate";break e}be=void 0}else mi?Yd(i,o)&&(be="onCompositionEnd"):i==="keydown"&&o.keyCode===229&&(be="onCompositionStart");be&&(zd&&o.locale!=="ko"&&(mi||be!=="onCompositionStart"?be==="onCompositionEnd"&&mi&&(ve=$d()):(wr=Y,fl="value"in wr?wr.value:wr.textContent,mi=!0)),pe=fs(F,be),0<pe.length&&(be=new Hd(be,i,null,o,Y),X.push({event:be,listeners:pe}),ve?be.data=ve:(ve=qd(o),ve!==null&&(be.data=ve)))),(ve=Ly?ky(i,o):Ay(i,o))&&(F=fs(F,"onBeforeInput"),0<F.length&&(Y=new Hd("onBeforeInput","beforeinput",null,o,Y),X.push({event:Y,listeners:F}),Y.data=ve))}pc(X,s)})}function ma(i,s,o){return{instance:i,listener:s,currentTarget:o}}function fs(i,s){for(var o=s+"Capture",h=[];i!==null;){var m=i,v=m.stateNode;m.tag===5&&v!==null&&(m=v,v=Xi(i,o),v!=null&&h.unshift(ma(i,v,m)),v=Xi(i,s),v!=null&&h.push(ma(i,v,m))),i=i.return}return h}function vi(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function yc(i,s,o,h,m){for(var v=s._reactName,L=[];o!==null&&o!==h;){var A=o,R=A.alternate,F=A.stateNode;if(R!==null&&R===h)break;A.tag===5&&F!==null&&(A=F,m?(R=Xi(o,v),R!=null&&L.unshift(ma(o,R,A))):m||(R=Xi(o,v),R!=null&&L.push(ma(o,R,A)))),o=o.return}L.length!==0&&i.push({event:s,listeners:L})}var Fy=/\r\n?/g,Uy=/\u0000|\uFFFD/g;function Ec(i){return(typeof i=="string"?i:""+i).replace(Fy,`
`).replace(Uy,"")}function ms(i,s,o){if(s=Ec(s),Ec(i)!==s&&o)throw Error(a(425))}function gs(){}var Dl=null,Il=null;function Cl(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var _l=typeof setTimeout=="function"?setTimeout:void 0,By=typeof clearTimeout=="function"?clearTimeout:void 0,Sc=typeof Promise=="function"?Promise:void 0,$y=typeof queueMicrotask=="function"?queueMicrotask:typeof Sc<"u"?function(i){return Sc.resolve(null).then(i).catch(Gy)}:_l;function Gy(i){setTimeout(function(){throw i})}function xl(i,s){var o=s,h=0;do{var m=o.nextSibling;if(i.removeChild(o),m&&m.nodeType===8)if(o=m.data,o==="/$"){if(h===0){i.removeChild(m),aa(s);return}h--}else o!=="$"&&o!=="$?"&&o!=="$!"||h++;o=m}while(o);aa(s)}function Dr(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return i}function Tc(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var o=i.data;if(o==="$"||o==="$!"||o==="$?"){if(s===0)return i;s--}else o==="/$"&&s++}i=i.previousSibling}return null}var yi=Math.random().toString(36).slice(2),Zt="__reactFiber$"+yi,ga="__reactProps$"+yi,dr="__reactContainer$"+yi,Pl="__reactEvents$"+yi,Vy="__reactListeners$"+yi,Hy="__reactHandles$"+yi;function Hr(i){var s=i[Zt];if(s)return s;for(var o=i.parentNode;o;){if(s=o[dr]||o[Zt]){if(o=s.alternate,s.child!==null||o!==null&&o.child!==null)for(i=Tc(i);i!==null;){if(o=i[Zt])return o;i=Tc(i)}return s}i=o,o=i.parentNode}return null}function pa(i){return i=i[Zt]||i[dr],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Ei(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(a(33))}function ps(i){return i[ga]||null}var Ml=[],Si=-1;function Ir(i){return{current:i}}function Ue(i){0>Si||(i.current=Ml[Si],Ml[Si]=null,Si--)}function Ne(i,s){Si++,Ml[Si]=i.current,i.current=s}var Cr={},ft=Ir(Cr),Tt=Ir(!1),Kr=Cr;function Ti(i,s){var o=i.type.contextTypes;if(!o)return Cr;var h=i.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===s)return h.__reactInternalMemoizedMaskedChildContext;var m={},v;for(v in o)m[v]=s[v];return h&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=s,i.__reactInternalMemoizedMaskedChildContext=m),m}function bt(i){return i=i.childContextTypes,i!=null}function vs(){Ue(Tt),Ue(ft)}function bc(i,s,o){if(ft.current!==Cr)throw Error(a(168));Ne(ft,s),Ne(Tt,o)}function Lc(i,s,o){var h=i.stateNode;if(s=s.childContextTypes,typeof h.getChildContext!="function")return o;h=h.getChildContext();for(var m in h)if(!(m in s))throw Error(a(108,ze(i)||"Unknown",m));return w({},o,h)}function ys(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Cr,Kr=ft.current,Ne(ft,i),Ne(Tt,Tt.current),!0}function kc(i,s,o){var h=i.stateNode;if(!h)throw Error(a(169));o?(i=Lc(i,s,Kr),h.__reactInternalMemoizedMergedChildContext=i,Ue(Tt),Ue(ft),Ne(ft,i)):Ue(Tt),Ne(Tt,o)}var cr=null,Es=!1,Nl=!1;function Ac(i){cr===null?cr=[i]:cr.push(i)}function Ky(i){Es=!0,Ac(i)}function _r(){if(!Nl&&cr!==null){Nl=!0;var i=0,s=xe;try{var o=cr;for(xe=1;i<o.length;i++){var h=o[i];do h=h(!0);while(h!==null)}cr=null,Es=!1}catch(m){throw cr!==null&&(cr=cr.slice(i+1)),wd(sl,_r),m}finally{xe=s,Nl=!1}}return null}var bi=[],Li=0,Ss=null,Ts=0,xt=[],Pt=0,zr=null,hr=1,fr="";function Wr(i,s){bi[Li++]=Ts,bi[Li++]=Ss,Ss=i,Ts=s}function wc(i,s,o){xt[Pt++]=hr,xt[Pt++]=fr,xt[Pt++]=zr,zr=i;var h=hr;i=fr;var m=32-Gt(h)-1;h&=~(1<<m),o+=1;var v=32-Gt(s)+m;if(30<v){var L=m-m%5;v=(h&(1<<L)-1).toString(32),h>>=L,m-=L,hr=1<<32-Gt(s)+m|o<<m|h,fr=v+i}else hr=1<<v|o<<m|h,fr=i}function Ol(i){i.return!==null&&(Wr(i,1),wc(i,1,0))}function Fl(i){for(;i===Ss;)Ss=bi[--Li],bi[Li]=null,Ts=bi[--Li],bi[Li]=null;for(;i===zr;)zr=xt[--Pt],xt[Pt]=null,fr=xt[--Pt],xt[Pt]=null,hr=xt[--Pt],xt[Pt]=null}var It=null,Ct=null,Be=!1,Ht=null;function Rc(i,s){var o=Ft(5,null,null,0);o.elementType="DELETED",o.stateNode=s,o.return=i,s=i.deletions,s===null?(i.deletions=[o],i.flags|=16):s.push(o)}function Dc(i,s){switch(i.tag){case 5:var o=i.type;return s=s.nodeType!==1||o.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(i.stateNode=s,It=i,Ct=Dr(s.firstChild),!0):!1;case 6:return s=i.pendingProps===""||s.nodeType!==3?null:s,s!==null?(i.stateNode=s,It=i,Ct=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(o=zr!==null?{id:hr,overflow:fr}:null,i.memoizedState={dehydrated:s,treeContext:o,retryLane:1073741824},o=Ft(18,null,null,0),o.stateNode=s,o.return=i,i.child=o,It=i,Ct=null,!0):!1;default:return!1}}function Ul(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Bl(i){if(Be){var s=Ct;if(s){var o=s;if(!Dc(i,s)){if(Ul(i))throw Error(a(418));s=Dr(o.nextSibling);var h=It;s&&Dc(i,s)?Rc(h,o):(i.flags=i.flags&-4097|2,Be=!1,It=i)}}else{if(Ul(i))throw Error(a(418));i.flags=i.flags&-4097|2,Be=!1,It=i}}}function Ic(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;It=i}function bs(i){if(i!==It)return!1;if(!Be)return Ic(i),Be=!0,!1;var s;if((s=i.tag!==3)&&!(s=i.tag!==5)&&(s=i.type,s=s!=="head"&&s!=="body"&&!Cl(i.type,i.memoizedProps)),s&&(s=Ct)){if(Ul(i))throw Cc(),Error(a(418));for(;s;)Rc(i,s),s=Dr(s.nextSibling)}if(Ic(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(a(317));e:{for(i=i.nextSibling,s=0;i;){if(i.nodeType===8){var o=i.data;if(o==="/$"){if(s===0){Ct=Dr(i.nextSibling);break e}s--}else o!=="$"&&o!=="$!"&&o!=="$?"||s++}i=i.nextSibling}Ct=null}}else Ct=It?Dr(i.stateNode.nextSibling):null;return!0}function Cc(){for(var i=Ct;i;)i=Dr(i.nextSibling)}function ki(){Ct=It=null,Be=!1}function $l(i){Ht===null?Ht=[i]:Ht.push(i)}var zy=$.ReactCurrentBatchConfig;function Kt(i,s){if(i&&i.defaultProps){s=w({},s),i=i.defaultProps;for(var o in i)s[o]===void 0&&(s[o]=i[o]);return s}return s}var Ls=Ir(null),ks=null,Ai=null,Gl=null;function Vl(){Gl=Ai=ks=null}function Hl(i){var s=Ls.current;Ue(Ls),i._currentValue=s}function Kl(i,s,o){for(;i!==null;){var h=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,h!==null&&(h.childLanes|=s)):h!==null&&(h.childLanes&s)!==s&&(h.childLanes|=s),i===o)break;i=i.return}}function wi(i,s){ks=i,Gl=Ai=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&s&&(Lt=!0),i.firstContext=null)}function Mt(i){var s=i._currentValue;if(Gl!==i)if(i={context:i,memoizedValue:s,next:null},Ai===null){if(ks===null)throw Error(a(308));Ai=i,ks.dependencies={lanes:0,firstContext:i}}else Ai=Ai.next=i;return s}var jr=null;function zl(i){jr===null?jr=[i]:jr.push(i)}function _c(i,s,o,h){var m=s.interleaved;return m===null?(o.next=o,zl(s)):(o.next=m.next,m.next=o),s.interleaved=o,mr(i,h)}function mr(i,s){i.lanes|=s;var o=i.alternate;for(o!==null&&(o.lanes|=s),o=i,i=i.return;i!==null;)i.childLanes|=s,o=i.alternate,o!==null&&(o.childLanes|=s),o=i,i=i.return;return o.tag===3?o.stateNode:null}var xr=!1;function Wl(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function xc(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function gr(i,s){return{eventTime:i,lane:s,tag:0,payload:null,callback:null,next:null}}function Pr(i,s,o){var h=i.updateQueue;if(h===null)return null;if(h=h.shared,De&2){var m=h.pending;return m===null?s.next=s:(s.next=m.next,m.next=s),h.pending=s,mr(i,o)}return m=h.interleaved,m===null?(s.next=s,zl(h)):(s.next=m.next,m.next=s),h.interleaved=s,mr(i,o)}function As(i,s,o){if(s=s.updateQueue,s!==null&&(s=s.shared,(o&4194240)!==0)){var h=s.lanes;h&=i.pendingLanes,o|=h,s.lanes=o,ol(i,o)}}function Pc(i,s){var o=i.updateQueue,h=i.alternate;if(h!==null&&(h=h.updateQueue,o===h)){var m=null,v=null;if(o=o.firstBaseUpdate,o!==null){do{var L={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};v===null?m=v=L:v=v.next=L,o=o.next}while(o!==null);v===null?m=v=s:v=v.next=s}else m=v=s;o={baseState:h.baseState,firstBaseUpdate:m,lastBaseUpdate:v,shared:h.shared,effects:h.effects},i.updateQueue=o;return}i=o.lastBaseUpdate,i===null?o.firstBaseUpdate=s:i.next=s,o.lastBaseUpdate=s}function ws(i,s,o,h){var m=i.updateQueue;xr=!1;var v=m.firstBaseUpdate,L=m.lastBaseUpdate,A=m.shared.pending;if(A!==null){m.shared.pending=null;var R=A,F=R.next;R.next=null,L===null?v=F:L.next=F,L=R;var Y=i.alternate;Y!==null&&(Y=Y.updateQueue,A=Y.lastBaseUpdate,A!==L&&(A===null?Y.firstBaseUpdate=F:A.next=F,Y.lastBaseUpdate=R))}if(v!==null){var X=m.baseState;L=0,Y=F=R=null,A=v;do{var j=A.lane,ne=A.eventTime;if((h&j)===j){Y!==null&&(Y=Y.next={eventTime:ne,lane:0,tag:A.tag,payload:A.payload,callback:A.callback,next:null});e:{var ue=i,ce=A;switch(j=s,ne=o,ce.tag){case 1:if(ue=ce.payload,typeof ue=="function"){X=ue.call(ne,X,j);break e}X=ue;break e;case 3:ue.flags=ue.flags&-65537|128;case 0:if(ue=ce.payload,j=typeof ue=="function"?ue.call(ne,X,j):ue,j==null)break e;X=w({},X,j);break e;case 2:xr=!0}}A.callback!==null&&A.lane!==0&&(i.flags|=64,j=m.effects,j===null?m.effects=[A]:j.push(A))}else ne={eventTime:ne,lane:j,tag:A.tag,payload:A.payload,callback:A.callback,next:null},Y===null?(F=Y=ne,R=X):Y=Y.next=ne,L|=j;if(A=A.next,A===null){if(A=m.shared.pending,A===null)break;j=A,A=j.next,j.next=null,m.lastBaseUpdate=j,m.shared.pending=null}}while(!0);if(Y===null&&(R=X),m.baseState=R,m.firstBaseUpdate=F,m.lastBaseUpdate=Y,s=m.shared.interleaved,s!==null){m=s;do L|=m.lane,m=m.next;while(m!==s)}else v===null&&(m.shared.lanes=0);Xr|=L,i.lanes=L,i.memoizedState=X}}function Mc(i,s,o){if(i=s.effects,s.effects=null,i!==null)for(s=0;s<i.length;s++){var h=i[s],m=h.callback;if(m!==null){if(h.callback=null,h=o,typeof m!="function")throw Error(a(191,m));m.call(h)}}}var Nc=new t.Component().refs;function jl(i,s,o,h){s=i.memoizedState,o=o(h,s),o=o==null?s:w({},s,o),i.memoizedState=o,i.lanes===0&&(i.updateQueue.baseState=o)}var Rs={isMounted:function(i){return(i=i._reactInternals)?Vr(i)===i:!1},enqueueSetState:function(i,s,o){i=i._reactInternals;var h=Et(),m=Fr(i),v=gr(h,m);v.payload=s,o!=null&&(v.callback=o),s=Pr(i,v,m),s!==null&&(jt(s,i,m,h),As(s,i,m))},enqueueReplaceState:function(i,s,o){i=i._reactInternals;var h=Et(),m=Fr(i),v=gr(h,m);v.tag=1,v.payload=s,o!=null&&(v.callback=o),s=Pr(i,v,m),s!==null&&(jt(s,i,m,h),As(s,i,m))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var o=Et(),h=Fr(i),m=gr(o,h);m.tag=2,s!=null&&(m.callback=s),s=Pr(i,m,h),s!==null&&(jt(s,i,h,o),As(s,i,h))}};function Oc(i,s,o,h,m,v,L){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(h,v,L):s.prototype&&s.prototype.isPureReactComponent?!da(o,h)||!da(m,v):!0}function Fc(i,s,o){var h=!1,m=Cr,v=s.contextType;return typeof v=="object"&&v!==null?v=Mt(v):(m=bt(s)?Kr:ft.current,h=s.contextTypes,v=(h=h!=null)?Ti(i,m):Cr),s=new s(o,v),i.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=Rs,i.stateNode=s,s._reactInternals=i,h&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=m,i.__reactInternalMemoizedMaskedChildContext=v),s}function Uc(i,s,o,h){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(o,h),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(o,h),s.state!==i&&Rs.enqueueReplaceState(s,s.state,null)}function Yl(i,s,o,h){var m=i.stateNode;m.props=o,m.state=i.memoizedState,m.refs=Nc,Wl(i);var v=s.contextType;typeof v=="object"&&v!==null?m.context=Mt(v):(v=bt(s)?Kr:ft.current,m.context=Ti(i,v)),m.state=i.memoizedState,v=s.getDerivedStateFromProps,typeof v=="function"&&(jl(i,s,v,o),m.state=i.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(s=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),s!==m.state&&Rs.enqueueReplaceState(m,m.state,null),ws(i,o,m,h),m.state=i.memoizedState),typeof m.componentDidMount=="function"&&(i.flags|=4194308)}function va(i,s,o){if(i=o.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(a(309));var h=o.stateNode}if(!h)throw Error(a(147,i));var m=h,v=""+i;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===v?s.ref:(s=function(L){var A=m.refs;A===Nc&&(A=m.refs={}),L===null?delete A[v]:A[v]=L},s._stringRef=v,s)}if(typeof i!="string")throw Error(a(284));if(!o._owner)throw Error(a(290,i))}return i}function Ds(i,s){throw i=Object.prototype.toString.call(s),Error(a(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i))}function Bc(i){var s=i._init;return s(i._payload)}function $c(i){function s(M,_){if(i){var N=M.deletions;N===null?(M.deletions=[_],M.flags|=16):N.push(_)}}function o(M,_){if(!i)return null;for(;_!==null;)s(M,_),_=_.sibling;return null}function h(M,_){for(M=new Map;_!==null;)_.key!==null?M.set(_.key,_):M.set(_.index,_),_=_.sibling;return M}function m(M,_){return M=Br(M,_),M.index=0,M.sibling=null,M}function v(M,_,N){return M.index=N,i?(N=M.alternate,N!==null?(N=N.index,N<_?(M.flags|=2,_):N):(M.flags|=2,_)):(M.flags|=1048576,_)}function L(M){return i&&M.alternate===null&&(M.flags|=2),M}function A(M,_,N,J){return _===null||_.tag!==6?(_=_o(N,M.mode,J),_.return=M,_):(_=m(_,N),_.return=M,_)}function R(M,_,N,J){var fe=N.type;return fe===Q?Y(M,_,N.props.children,J,N.key):_!==null&&(_.elementType===fe||typeof fe=="object"&&fe!==null&&fe.$$typeof===re&&Bc(fe)===_.type)?(J=m(_,N.props),J.ref=va(M,_,N),J.return=M,J):(J=js(N.type,N.key,N.props,null,M.mode,J),J.ref=va(M,_,N),J.return=M,J)}function F(M,_,N,J){return _===null||_.tag!==4||_.stateNode.containerInfo!==N.containerInfo||_.stateNode.implementation!==N.implementation?(_=xo(N,M.mode,J),_.return=M,_):(_=m(_,N.children||[]),_.return=M,_)}function Y(M,_,N,J,fe){return _===null||_.tag!==7?(_=ei(N,M.mode,J,fe),_.return=M,_):(_=m(_,N),_.return=M,_)}function X(M,_,N){if(typeof _=="string"&&_!==""||typeof _=="number")return _=_o(""+_,M.mode,N),_.return=M,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case G:return N=js(_.type,_.key,_.props,null,M.mode,N),N.ref=va(M,null,_),N.return=M,N;case K:return _=xo(_,M.mode,N),_.return=M,_;case re:var J=_._init;return X(M,J(_._payload),N)}if(ji(_)||Z(_))return _=ei(_,M.mode,N,null),_.return=M,_;Ds(M,_)}return null}function j(M,_,N,J){var fe=_!==null?_.key:null;if(typeof N=="string"&&N!==""||typeof N=="number")return fe!==null?null:A(M,_,""+N,J);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case G:return N.key===fe?R(M,_,N,J):null;case K:return N.key===fe?F(M,_,N,J):null;case re:return fe=N._init,j(M,_,fe(N._payload),J)}if(ji(N)||Z(N))return fe!==null?null:Y(M,_,N,J,null);Ds(M,N)}return null}function ne(M,_,N,J,fe){if(typeof J=="string"&&J!==""||typeof J=="number")return M=M.get(N)||null,A(_,M,""+J,fe);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case G:return M=M.get(J.key===null?N:J.key)||null,R(_,M,J,fe);case K:return M=M.get(J.key===null?N:J.key)||null,F(_,M,J,fe);case re:var pe=J._init;return ne(M,_,N,pe(J._payload),fe)}if(ji(J)||Z(J))return M=M.get(N)||null,Y(_,M,J,fe,null);Ds(_,J)}return null}function ue(M,_,N,J){for(var fe=null,pe=null,ve=_,be=_=0,st=null;ve!==null&&be<N.length;be++){ve.index>be?(st=ve,ve=null):st=ve.sibling;var Ie=j(M,ve,N[be],J);if(Ie===null){ve===null&&(ve=st);break}i&&ve&&Ie.alternate===null&&s(M,ve),_=v(Ie,_,be),pe===null?fe=Ie:pe.sibling=Ie,pe=Ie,ve=st}if(be===N.length)return o(M,ve),Be&&Wr(M,be),fe;if(ve===null){for(;be<N.length;be++)ve=X(M,N[be],J),ve!==null&&(_=v(ve,_,be),pe===null?fe=ve:pe.sibling=ve,pe=ve);return Be&&Wr(M,be),fe}for(ve=h(M,ve);be<N.length;be++)st=ne(ve,M,be,N[be],J),st!==null&&(i&&st.alternate!==null&&ve.delete(st.key===null?be:st.key),_=v(st,_,be),pe===null?fe=st:pe.sibling=st,pe=st);return i&&ve.forEach(function($r){return s(M,$r)}),Be&&Wr(M,be),fe}function ce(M,_,N,J){var fe=Z(N);if(typeof fe!="function")throw Error(a(150));if(N=fe.call(N),N==null)throw Error(a(151));for(var pe=fe=null,ve=_,be=_=0,st=null,Ie=N.next();ve!==null&&!Ie.done;be++,Ie=N.next()){ve.index>be?(st=ve,ve=null):st=ve.sibling;var $r=j(M,ve,Ie.value,J);if($r===null){ve===null&&(ve=st);break}i&&ve&&$r.alternate===null&&s(M,ve),_=v($r,_,be),pe===null?fe=$r:pe.sibling=$r,pe=$r,ve=st}if(Ie.done)return o(M,ve),Be&&Wr(M,be),fe;if(ve===null){for(;!Ie.done;be++,Ie=N.next())Ie=X(M,Ie.value,J),Ie!==null&&(_=v(Ie,_,be),pe===null?fe=Ie:pe.sibling=Ie,pe=Ie);return Be&&Wr(M,be),fe}for(ve=h(M,ve);!Ie.done;be++,Ie=N.next())Ie=ne(ve,M,be,Ie.value,J),Ie!==null&&(i&&Ie.alternate!==null&&ve.delete(Ie.key===null?be:Ie.key),_=v(Ie,_,be),pe===null?fe=Ie:pe.sibling=Ie,pe=Ie);return i&&ve.forEach(function(k0){return s(M,k0)}),Be&&Wr(M,be),fe}function Ye(M,_,N,J){if(typeof N=="object"&&N!==null&&N.type===Q&&N.key===null&&(N=N.props.children),typeof N=="object"&&N!==null){switch(N.$$typeof){case G:e:{for(var fe=N.key,pe=_;pe!==null;){if(pe.key===fe){if(fe=N.type,fe===Q){if(pe.tag===7){o(M,pe.sibling),_=m(pe,N.props.children),_.return=M,M=_;break e}}else if(pe.elementType===fe||typeof fe=="object"&&fe!==null&&fe.$$typeof===re&&Bc(fe)===pe.type){o(M,pe.sibling),_=m(pe,N.props),_.ref=va(M,pe,N),_.return=M,M=_;break e}o(M,pe);break}else s(M,pe);pe=pe.sibling}N.type===Q?(_=ei(N.props.children,M.mode,J,N.key),_.return=M,M=_):(J=js(N.type,N.key,N.props,null,M.mode,J),J.ref=va(M,_,N),J.return=M,M=J)}return L(M);case K:e:{for(pe=N.key;_!==null;){if(_.key===pe)if(_.tag===4&&_.stateNode.containerInfo===N.containerInfo&&_.stateNode.implementation===N.implementation){o(M,_.sibling),_=m(_,N.children||[]),_.return=M,M=_;break e}else{o(M,_);break}else s(M,_);_=_.sibling}_=xo(N,M.mode,J),_.return=M,M=_}return L(M);case re:return pe=N._init,Ye(M,_,pe(N._payload),J)}if(ji(N))return ue(M,_,N,J);if(Z(N))return ce(M,_,N,J);Ds(M,N)}return typeof N=="string"&&N!==""||typeof N=="number"?(N=""+N,_!==null&&_.tag===6?(o(M,_.sibling),_=m(_,N),_.return=M,M=_):(o(M,_),_=_o(N,M.mode,J),_.return=M,M=_),L(M)):o(M,_)}return Ye}var Ri=$c(!0),Gc=$c(!1),ya={},er=Ir(ya),Ea=Ir(ya),Sa=Ir(ya);function Yr(i){if(i===ya)throw Error(a(174));return i}function ql(i,s){switch(Ne(Sa,s),Ne(Ea,i),Ne(er,ya),i=s.nodeType,i){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:Xn(null,"");break;default:i=i===8?s.parentNode:s,s=i.namespaceURI||null,i=i.tagName,s=Xn(s,i)}Ue(er),Ne(er,s)}function Di(){Ue(er),Ue(Ea),Ue(Sa)}function Vc(i){Yr(Sa.current);var s=Yr(er.current),o=Xn(s,i.type);s!==o&&(Ne(Ea,i),Ne(er,o))}function Xl(i){Ea.current===i&&(Ue(er),Ue(Ea))}var Ve=Ir(0);function Is(i){for(var s=i;s!==null;){if(s.tag===13){var o=s.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Ql=[];function Jl(){for(var i=0;i<Ql.length;i++)Ql[i]._workInProgressVersionPrimary=null;Ql.length=0}var Cs=$.ReactCurrentDispatcher,Zl=$.ReactCurrentBatchConfig,qr=0,He=null,Ze=null,it=null,_s=!1,Ta=!1,ba=0,Wy=0;function mt(){throw Error(a(321))}function eo(i,s){if(s===null)return!1;for(var o=0;o<s.length&&o<i.length;o++)if(!Vt(i[o],s[o]))return!1;return!0}function to(i,s,o,h,m,v){if(qr=v,He=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Cs.current=i===null||i.memoizedState===null?Xy:Qy,i=o(h,m),Ta){v=0;do{if(Ta=!1,ba=0,25<=v)throw Error(a(301));v+=1,it=Ze=null,s.updateQueue=null,Cs.current=Jy,i=o(h,m)}while(Ta)}if(Cs.current=Ms,s=Ze!==null&&Ze.next!==null,qr=0,it=Ze=He=null,_s=!1,s)throw Error(a(300));return i}function ro(){var i=ba!==0;return ba=0,i}function tr(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return it===null?He.memoizedState=it=i:it=it.next=i,it}function Nt(){if(Ze===null){var i=He.alternate;i=i!==null?i.memoizedState:null}else i=Ze.next;var s=it===null?He.memoizedState:it.next;if(s!==null)it=s,Ze=i;else{if(i===null)throw Error(a(310));Ze=i,i={memoizedState:Ze.memoizedState,baseState:Ze.baseState,baseQueue:Ze.baseQueue,queue:Ze.queue,next:null},it===null?He.memoizedState=it=i:it=it.next=i}return it}function La(i,s){return typeof s=="function"?s(i):s}function io(i){var s=Nt(),o=s.queue;if(o===null)throw Error(a(311));o.lastRenderedReducer=i;var h=Ze,m=h.baseQueue,v=o.pending;if(v!==null){if(m!==null){var L=m.next;m.next=v.next,v.next=L}h.baseQueue=m=v,o.pending=null}if(m!==null){v=m.next,h=h.baseState;var A=L=null,R=null,F=v;do{var Y=F.lane;if((qr&Y)===Y)R!==null&&(R=R.next={lane:0,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null}),h=F.hasEagerState?F.eagerState:i(h,F.action);else{var X={lane:Y,action:F.action,hasEagerState:F.hasEagerState,eagerState:F.eagerState,next:null};R===null?(A=R=X,L=h):R=R.next=X,He.lanes|=Y,Xr|=Y}F=F.next}while(F!==null&&F!==v);R===null?L=h:R.next=A,Vt(h,s.memoizedState)||(Lt=!0),s.memoizedState=h,s.baseState=L,s.baseQueue=R,o.lastRenderedState=h}if(i=o.interleaved,i!==null){m=i;do v=m.lane,He.lanes|=v,Xr|=v,m=m.next;while(m!==i)}else m===null&&(o.lanes=0);return[s.memoizedState,o.dispatch]}function ao(i){var s=Nt(),o=s.queue;if(o===null)throw Error(a(311));o.lastRenderedReducer=i;var h=o.dispatch,m=o.pending,v=s.memoizedState;if(m!==null){o.pending=null;var L=m=m.next;do v=i(v,L.action),L=L.next;while(L!==m);Vt(v,s.memoizedState)||(Lt=!0),s.memoizedState=v,s.baseQueue===null&&(s.baseState=v),o.lastRenderedState=v}return[v,h]}function Hc(){}function Kc(i,s){var o=He,h=Nt(),m=s(),v=!Vt(h.memoizedState,m);if(v&&(h.memoizedState=m,Lt=!0),h=h.queue,so(jc.bind(null,o,h,i),[i]),h.getSnapshot!==s||v||it!==null&&it.memoizedState.tag&1){if(o.flags|=2048,ka(9,Wc.bind(null,o,h,m,s),void 0,null),at===null)throw Error(a(349));qr&30||zc(o,s,m)}return m}function zc(i,s,o){i.flags|=16384,i={getSnapshot:s,value:o},s=He.updateQueue,s===null?(s={lastEffect:null,stores:null},He.updateQueue=s,s.stores=[i]):(o=s.stores,o===null?s.stores=[i]:o.push(i))}function Wc(i,s,o,h){s.value=o,s.getSnapshot=h,Yc(s)&&qc(i)}function jc(i,s,o){return o(function(){Yc(s)&&qc(i)})}function Yc(i){var s=i.getSnapshot;i=i.value;try{var o=s();return!Vt(i,o)}catch{return!0}}function qc(i){var s=mr(i,1);s!==null&&jt(s,i,1,-1)}function Xc(i){var s=tr();return typeof i=="function"&&(i=i()),s.memoizedState=s.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:La,lastRenderedState:i},s.queue=i,i=i.dispatch=qy.bind(null,He,i),[s.memoizedState,i]}function ka(i,s,o,h){return i={tag:i,create:s,destroy:o,deps:h,next:null},s=He.updateQueue,s===null?(s={lastEffect:null,stores:null},He.updateQueue=s,s.lastEffect=i.next=i):(o=s.lastEffect,o===null?s.lastEffect=i.next=i:(h=o.next,o.next=i,i.next=h,s.lastEffect=i)),i}function Qc(){return Nt().memoizedState}function xs(i,s,o,h){var m=tr();He.flags|=i,m.memoizedState=ka(1|s,o,void 0,h===void 0?null:h)}function Ps(i,s,o,h){var m=Nt();h=h===void 0?null:h;var v=void 0;if(Ze!==null){var L=Ze.memoizedState;if(v=L.destroy,h!==null&&eo(h,L.deps)){m.memoizedState=ka(s,o,v,h);return}}He.flags|=i,m.memoizedState=ka(1|s,o,v,h)}function Jc(i,s){return xs(8390656,8,i,s)}function so(i,s){return Ps(2048,8,i,s)}function Zc(i,s){return Ps(4,2,i,s)}function eh(i,s){return Ps(4,4,i,s)}function th(i,s){if(typeof s=="function")return i=i(),s(i),function(){s(null)};if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function rh(i,s,o){return o=o!=null?o.concat([i]):null,Ps(4,4,th.bind(null,s,i),o)}function no(){}function ih(i,s){var o=Nt();s=s===void 0?null:s;var h=o.memoizedState;return h!==null&&s!==null&&eo(s,h[1])?h[0]:(o.memoizedState=[i,s],i)}function ah(i,s){var o=Nt();s=s===void 0?null:s;var h=o.memoizedState;return h!==null&&s!==null&&eo(s,h[1])?h[0]:(i=i(),o.memoizedState=[i,s],i)}function sh(i,s,o){return qr&21?(Vt(o,s)||(o=Cd(),He.lanes|=o,Xr|=o,i.baseState=!0),s):(i.baseState&&(i.baseState=!1,Lt=!0),i.memoizedState=o)}function jy(i,s){var o=xe;xe=o!==0&&4>o?o:4,i(!0);var h=Zl.transition;Zl.transition={};try{i(!1),s()}finally{xe=o,Zl.transition=h}}function nh(){return Nt().memoizedState}function Yy(i,s,o){var h=Fr(i);if(o={lane:h,action:o,hasEagerState:!1,eagerState:null,next:null},lh(i))oh(s,o);else if(o=_c(i,s,o,h),o!==null){var m=Et();jt(o,i,h,m),uh(o,s,h)}}function qy(i,s,o){var h=Fr(i),m={lane:h,action:o,hasEagerState:!1,eagerState:null,next:null};if(lh(i))oh(s,m);else{var v=i.alternate;if(i.lanes===0&&(v===null||v.lanes===0)&&(v=s.lastRenderedReducer,v!==null))try{var L=s.lastRenderedState,A=v(L,o);if(m.hasEagerState=!0,m.eagerState=A,Vt(A,L)){var R=s.interleaved;R===null?(m.next=m,zl(s)):(m.next=R.next,R.next=m),s.interleaved=m;return}}catch{}finally{}o=_c(i,s,m,h),o!==null&&(m=Et(),jt(o,i,h,m),uh(o,s,h))}}function lh(i){var s=i.alternate;return i===He||s!==null&&s===He}function oh(i,s){Ta=_s=!0;var o=i.pending;o===null?s.next=s:(s.next=o.next,o.next=s),i.pending=s}function uh(i,s,o){if(o&4194240){var h=s.lanes;h&=i.pendingLanes,o|=h,s.lanes=o,ol(i,o)}}var Ms={readContext:Mt,useCallback:mt,useContext:mt,useEffect:mt,useImperativeHandle:mt,useInsertionEffect:mt,useLayoutEffect:mt,useMemo:mt,useReducer:mt,useRef:mt,useState:mt,useDebugValue:mt,useDeferredValue:mt,useTransition:mt,useMutableSource:mt,useSyncExternalStore:mt,useId:mt,unstable_isNewReconciler:!1},Xy={readContext:Mt,useCallback:function(i,s){return tr().memoizedState=[i,s===void 0?null:s],i},useContext:Mt,useEffect:Jc,useImperativeHandle:function(i,s,o){return o=o!=null?o.concat([i]):null,xs(4194308,4,th.bind(null,s,i),o)},useLayoutEffect:function(i,s){return xs(4194308,4,i,s)},useInsertionEffect:function(i,s){return xs(4,2,i,s)},useMemo:function(i,s){var o=tr();return s=s===void 0?null:s,i=i(),o.memoizedState=[i,s],i},useReducer:function(i,s,o){var h=tr();return s=o!==void 0?o(s):s,h.memoizedState=h.baseState=s,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:s},h.queue=i,i=i.dispatch=Yy.bind(null,He,i),[h.memoizedState,i]},useRef:function(i){var s=tr();return i={current:i},s.memoizedState=i},useState:Xc,useDebugValue:no,useDeferredValue:function(i){return tr().memoizedState=i},useTransition:function(){var i=Xc(!1),s=i[0];return i=jy.bind(null,i[1]),tr().memoizedState=i,[s,i]},useMutableSource:function(){},useSyncExternalStore:function(i,s,o){var h=He,m=tr();if(Be){if(o===void 0)throw Error(a(407));o=o()}else{if(o=s(),at===null)throw Error(a(349));qr&30||zc(h,s,o)}m.memoizedState=o;var v={value:o,getSnapshot:s};return m.queue=v,Jc(jc.bind(null,h,v,i),[i]),h.flags|=2048,ka(9,Wc.bind(null,h,v,o,s),void 0,null),o},useId:function(){var i=tr(),s=at.identifierPrefix;if(Be){var o=fr,h=hr;o=(h&~(1<<32-Gt(h)-1)).toString(32)+o,s=":"+s+"R"+o,o=ba++,0<o&&(s+="H"+o.toString(32)),s+=":"}else o=Wy++,s=":"+s+"r"+o.toString(32)+":";return i.memoizedState=s},unstable_isNewReconciler:!1},Qy={readContext:Mt,useCallback:ih,useContext:Mt,useEffect:so,useImperativeHandle:rh,useInsertionEffect:Zc,useLayoutEffect:eh,useMemo:ah,useReducer:io,useRef:Qc,useState:function(){return io(La)},useDebugValue:no,useDeferredValue:function(i){var s=Nt();return sh(s,Ze.memoizedState,i)},useTransition:function(){var i=io(La)[0],s=Nt().memoizedState;return[i,s]},useMutableSource:Hc,useSyncExternalStore:Kc,useId:nh,unstable_isNewReconciler:!1},Jy={readContext:Mt,useCallback:ih,useContext:Mt,useEffect:so,useImperativeHandle:rh,useInsertionEffect:Zc,useLayoutEffect:eh,useMemo:ah,useReducer:ao,useRef:Qc,useState:function(){return ao(La)},useDebugValue:no,useDeferredValue:function(i){var s=Nt();return Ze===null?s.memoizedState=i:sh(s,Ze.memoizedState,i)},useTransition:function(){var i=ao(La)[0],s=Nt().memoizedState;return[i,s]},useMutableSource:Hc,useSyncExternalStore:Kc,useId:nh,unstable_isNewReconciler:!1};function Ii(i,s){try{var o="",h=s;do o+=we(h),h=h.return;while(h);var m=o}catch(v){m=`
Error generating stack: `+v.message+`
`+v.stack}return{value:i,source:s,stack:m,digest:null}}function lo(i,s,o){return{value:i,source:null,stack:o??null,digest:s??null}}function oo(i,s){try{console.error(s.value)}catch(o){setTimeout(function(){throw o})}}var Zy=typeof WeakMap=="function"?WeakMap:Map;function dh(i,s,o){o=gr(-1,o),o.tag=3,o.payload={element:null};var h=s.value;return o.callback=function(){Gs||(Gs=!0,Lo=h),oo(i,s)},o}function ch(i,s,o){o=gr(-1,o),o.tag=3;var h=i.type.getDerivedStateFromError;if(typeof h=="function"){var m=s.value;o.payload=function(){return h(m)},o.callback=function(){oo(i,s)}}var v=i.stateNode;return v!==null&&typeof v.componentDidCatch=="function"&&(o.callback=function(){oo(i,s),typeof h!="function"&&(Nr===null?Nr=new Set([this]):Nr.add(this));var L=s.stack;this.componentDidCatch(s.value,{componentStack:L!==null?L:""})}),o}function hh(i,s,o){var h=i.pingCache;if(h===null){h=i.pingCache=new Zy;var m=new Set;h.set(s,m)}else m=h.get(s),m===void 0&&(m=new Set,h.set(s,m));m.has(o)||(m.add(o),i=f0.bind(null,i,s,o),s.then(i,i))}function fh(i){do{var s;if((s=i.tag===13)&&(s=i.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return i;i=i.return}while(i!==null);return null}function mh(i,s,o,h,m){return i.mode&1?(i.flags|=65536,i.lanes=m,i):(i===s?i.flags|=65536:(i.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(s=gr(-1,1),s.tag=2,Pr(o,s,1))),o.lanes|=1),i)}var e0=$.ReactCurrentOwner,Lt=!1;function yt(i,s,o,h){s.child=i===null?Gc(s,null,o,h):Ri(s,i.child,o,h)}function gh(i,s,o,h,m){o=o.render;var v=s.ref;return wi(s,m),h=to(i,s,o,h,v,m),o=ro(),i!==null&&!Lt?(s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~m,pr(i,s,m)):(Be&&o&&Ol(s),s.flags|=1,yt(i,s,h,m),s.child)}function ph(i,s,o,h,m){if(i===null){var v=o.type;return typeof v=="function"&&!Co(v)&&v.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(s.tag=15,s.type=v,vh(i,s,v,h,m)):(i=js(o.type,null,h,s,s.mode,m),i.ref=s.ref,i.return=s,s.child=i)}if(v=i.child,!(i.lanes&m)){var L=v.memoizedProps;if(o=o.compare,o=o!==null?o:da,o(L,h)&&i.ref===s.ref)return pr(i,s,m)}return s.flags|=1,i=Br(v,h),i.ref=s.ref,i.return=s,s.child=i}function vh(i,s,o,h,m){if(i!==null){var v=i.memoizedProps;if(da(v,h)&&i.ref===s.ref)if(Lt=!1,s.pendingProps=h=v,(i.lanes&m)!==0)i.flags&131072&&(Lt=!0);else return s.lanes=i.lanes,pr(i,s,m)}return uo(i,s,o,h,m)}function yh(i,s,o){var h=s.pendingProps,m=h.children,v=i!==null?i.memoizedState:null;if(h.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ne(_i,_t),_t|=o;else{if(!(o&1073741824))return i=v!==null?v.baseLanes|o:o,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:i,cachePool:null,transitions:null},s.updateQueue=null,Ne(_i,_t),_t|=i,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=v!==null?v.baseLanes:o,Ne(_i,_t),_t|=h}else v!==null?(h=v.baseLanes|o,s.memoizedState=null):h=o,Ne(_i,_t),_t|=h;return yt(i,s,m,o),s.child}function Eh(i,s){var o=s.ref;(i===null&&o!==null||i!==null&&i.ref!==o)&&(s.flags|=512,s.flags|=2097152)}function uo(i,s,o,h,m){var v=bt(o)?Kr:ft.current;return v=Ti(s,v),wi(s,m),o=to(i,s,o,h,v,m),h=ro(),i!==null&&!Lt?(s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~m,pr(i,s,m)):(Be&&h&&Ol(s),s.flags|=1,yt(i,s,o,m),s.child)}function Sh(i,s,o,h,m){if(bt(o)){var v=!0;ys(s)}else v=!1;if(wi(s,m),s.stateNode===null)Os(i,s),Fc(s,o,h),Yl(s,o,h,m),h=!0;else if(i===null){var L=s.stateNode,A=s.memoizedProps;L.props=A;var R=L.context,F=o.contextType;typeof F=="object"&&F!==null?F=Mt(F):(F=bt(o)?Kr:ft.current,F=Ti(s,F));var Y=o.getDerivedStateFromProps,X=typeof Y=="function"||typeof L.getSnapshotBeforeUpdate=="function";X||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(A!==h||R!==F)&&Uc(s,L,h,F),xr=!1;var j=s.memoizedState;L.state=j,ws(s,h,L,m),R=s.memoizedState,A!==h||j!==R||Tt.current||xr?(typeof Y=="function"&&(jl(s,o,Y,h),R=s.memoizedState),(A=xr||Oc(s,o,A,h,j,R,F))?(X||typeof L.UNSAFE_componentWillMount!="function"&&typeof L.componentWillMount!="function"||(typeof L.componentWillMount=="function"&&L.componentWillMount(),typeof L.UNSAFE_componentWillMount=="function"&&L.UNSAFE_componentWillMount()),typeof L.componentDidMount=="function"&&(s.flags|=4194308)):(typeof L.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=h,s.memoizedState=R),L.props=h,L.state=R,L.context=F,h=A):(typeof L.componentDidMount=="function"&&(s.flags|=4194308),h=!1)}else{L=s.stateNode,xc(i,s),A=s.memoizedProps,F=s.type===s.elementType?A:Kt(s.type,A),L.props=F,X=s.pendingProps,j=L.context,R=o.contextType,typeof R=="object"&&R!==null?R=Mt(R):(R=bt(o)?Kr:ft.current,R=Ti(s,R));var ne=o.getDerivedStateFromProps;(Y=typeof ne=="function"||typeof L.getSnapshotBeforeUpdate=="function")||typeof L.UNSAFE_componentWillReceiveProps!="function"&&typeof L.componentWillReceiveProps!="function"||(A!==X||j!==R)&&Uc(s,L,h,R),xr=!1,j=s.memoizedState,L.state=j,ws(s,h,L,m);var ue=s.memoizedState;A!==X||j!==ue||Tt.current||xr?(typeof ne=="function"&&(jl(s,o,ne,h),ue=s.memoizedState),(F=xr||Oc(s,o,F,h,j,ue,R)||!1)?(Y||typeof L.UNSAFE_componentWillUpdate!="function"&&typeof L.componentWillUpdate!="function"||(typeof L.componentWillUpdate=="function"&&L.componentWillUpdate(h,ue,R),typeof L.UNSAFE_componentWillUpdate=="function"&&L.UNSAFE_componentWillUpdate(h,ue,R)),typeof L.componentDidUpdate=="function"&&(s.flags|=4),typeof L.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof L.componentDidUpdate!="function"||A===i.memoizedProps&&j===i.memoizedState||(s.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||A===i.memoizedProps&&j===i.memoizedState||(s.flags|=1024),s.memoizedProps=h,s.memoizedState=ue),L.props=h,L.state=ue,L.context=R,h=F):(typeof L.componentDidUpdate!="function"||A===i.memoizedProps&&j===i.memoizedState||(s.flags|=4),typeof L.getSnapshotBeforeUpdate!="function"||A===i.memoizedProps&&j===i.memoizedState||(s.flags|=1024),h=!1)}return co(i,s,o,h,v,m)}function co(i,s,o,h,m,v){Eh(i,s);var L=(s.flags&128)!==0;if(!h&&!L)return m&&kc(s,o,!1),pr(i,s,v);h=s.stateNode,e0.current=s;var A=L&&typeof o.getDerivedStateFromError!="function"?null:h.render();return s.flags|=1,i!==null&&L?(s.child=Ri(s,i.child,null,v),s.child=Ri(s,null,A,v)):yt(i,s,A,v),s.memoizedState=h.state,m&&kc(s,o,!0),s.child}function Th(i){var s=i.stateNode;s.pendingContext?bc(i,s.pendingContext,s.pendingContext!==s.context):s.context&&bc(i,s.context,!1),ql(i,s.containerInfo)}function bh(i,s,o,h,m){return ki(),$l(m),s.flags|=256,yt(i,s,o,h),s.child}var ho={dehydrated:null,treeContext:null,retryLane:0};function fo(i){return{baseLanes:i,cachePool:null,transitions:null}}function Lh(i,s,o){var h=s.pendingProps,m=Ve.current,v=!1,L=(s.flags&128)!==0,A;if((A=L)||(A=i!==null&&i.memoizedState===null?!1:(m&2)!==0),A?(v=!0,s.flags&=-129):(i===null||i.memoizedState!==null)&&(m|=1),Ne(Ve,m&1),i===null)return Bl(s),i=s.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(s.mode&1?i.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(L=h.children,i=h.fallback,v?(h=s.mode,v=s.child,L={mode:"hidden",children:L},!(h&1)&&v!==null?(v.childLanes=0,v.pendingProps=L):v=Ys(L,h,0,null),i=ei(i,h,o,null),v.return=s,i.return=s,v.sibling=i,s.child=v,s.child.memoizedState=fo(o),s.memoizedState=ho,i):mo(s,L));if(m=i.memoizedState,m!==null&&(A=m.dehydrated,A!==null))return t0(i,s,L,h,A,m,o);if(v){v=h.fallback,L=s.mode,m=i.child,A=m.sibling;var R={mode:"hidden",children:h.children};return!(L&1)&&s.child!==m?(h=s.child,h.childLanes=0,h.pendingProps=R,s.deletions=null):(h=Br(m,R),h.subtreeFlags=m.subtreeFlags&14680064),A!==null?v=Br(A,v):(v=ei(v,L,o,null),v.flags|=2),v.return=s,h.return=s,h.sibling=v,s.child=h,h=v,v=s.child,L=i.child.memoizedState,L=L===null?fo(o):{baseLanes:L.baseLanes|o,cachePool:null,transitions:L.transitions},v.memoizedState=L,v.childLanes=i.childLanes&~o,s.memoizedState=ho,h}return v=i.child,i=v.sibling,h=Br(v,{mode:"visible",children:h.children}),!(s.mode&1)&&(h.lanes=o),h.return=s,h.sibling=null,i!==null&&(o=s.deletions,o===null?(s.deletions=[i],s.flags|=16):o.push(i)),s.child=h,s.memoizedState=null,h}function mo(i,s){return s=Ys({mode:"visible",children:s},i.mode,0,null),s.return=i,i.child=s}function Ns(i,s,o,h){return h!==null&&$l(h),Ri(s,i.child,null,o),i=mo(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function t0(i,s,o,h,m,v,L){if(o)return s.flags&256?(s.flags&=-257,h=lo(Error(a(422))),Ns(i,s,L,h)):s.memoizedState!==null?(s.child=i.child,s.flags|=128,null):(v=h.fallback,m=s.mode,h=Ys({mode:"visible",children:h.children},m,0,null),v=ei(v,m,L,null),v.flags|=2,h.return=s,v.return=s,h.sibling=v,s.child=h,s.mode&1&&Ri(s,i.child,null,L),s.child.memoizedState=fo(L),s.memoizedState=ho,v);if(!(s.mode&1))return Ns(i,s,L,null);if(m.data==="$!"){if(h=m.nextSibling&&m.nextSibling.dataset,h)var A=h.dgst;return h=A,v=Error(a(419)),h=lo(v,h,void 0),Ns(i,s,L,h)}if(A=(L&i.childLanes)!==0,Lt||A){if(h=at,h!==null){switch(L&-L){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=m&(h.suspendedLanes|L)?0:m,m!==0&&m!==v.retryLane&&(v.retryLane=m,mr(i,m),jt(h,i,m,-1))}return Io(),h=lo(Error(a(421))),Ns(i,s,L,h)}return m.data==="$?"?(s.flags|=128,s.child=i.child,s=m0.bind(null,i),m._reactRetry=s,null):(i=v.treeContext,Ct=Dr(m.nextSibling),It=s,Be=!0,Ht=null,i!==null&&(xt[Pt++]=hr,xt[Pt++]=fr,xt[Pt++]=zr,hr=i.id,fr=i.overflow,zr=s),s=mo(s,h.children),s.flags|=4096,s)}function kh(i,s,o){i.lanes|=s;var h=i.alternate;h!==null&&(h.lanes|=s),Kl(i.return,s,o)}function go(i,s,o,h,m){var v=i.memoizedState;v===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:h,tail:o,tailMode:m}:(v.isBackwards=s,v.rendering=null,v.renderingStartTime=0,v.last=h,v.tail=o,v.tailMode=m)}function Ah(i,s,o){var h=s.pendingProps,m=h.revealOrder,v=h.tail;if(yt(i,s,h.children,o),h=Ve.current,h&2)h=h&1|2,s.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&kh(i,o,s);else if(i.tag===19)kh(i,o,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}h&=1}if(Ne(Ve,h),!(s.mode&1))s.memoizedState=null;else switch(m){case"forwards":for(o=s.child,m=null;o!==null;)i=o.alternate,i!==null&&Is(i)===null&&(m=o),o=o.sibling;o=m,o===null?(m=s.child,s.child=null):(m=o.sibling,o.sibling=null),go(s,!1,m,o,v);break;case"backwards":for(o=null,m=s.child,s.child=null;m!==null;){if(i=m.alternate,i!==null&&Is(i)===null){s.child=m;break}i=m.sibling,m.sibling=o,o=m,m=i}go(s,!0,o,null,v);break;case"together":go(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Os(i,s){!(s.mode&1)&&i!==null&&(i.alternate=null,s.alternate=null,s.flags|=2)}function pr(i,s,o){if(i!==null&&(s.dependencies=i.dependencies),Xr|=s.lanes,!(o&s.childLanes))return null;if(i!==null&&s.child!==i.child)throw Error(a(153));if(s.child!==null){for(i=s.child,o=Br(i,i.pendingProps),s.child=o,o.return=s;i.sibling!==null;)i=i.sibling,o=o.sibling=Br(i,i.pendingProps),o.return=s;o.sibling=null}return s.child}function r0(i,s,o){switch(s.tag){case 3:Th(s),ki();break;case 5:Vc(s);break;case 1:bt(s.type)&&ys(s);break;case 4:ql(s,s.stateNode.containerInfo);break;case 10:var h=s.type._context,m=s.memoizedProps.value;Ne(Ls,h._currentValue),h._currentValue=m;break;case 13:if(h=s.memoizedState,h!==null)return h.dehydrated!==null?(Ne(Ve,Ve.current&1),s.flags|=128,null):o&s.child.childLanes?Lh(i,s,o):(Ne(Ve,Ve.current&1),i=pr(i,s,o),i!==null?i.sibling:null);Ne(Ve,Ve.current&1);break;case 19:if(h=(o&s.childLanes)!==0,i.flags&128){if(h)return Ah(i,s,o);s.flags|=128}if(m=s.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),Ne(Ve,Ve.current),h)break;return null;case 22:case 23:return s.lanes=0,yh(i,s,o)}return pr(i,s,o)}var wh,po,Rh,Dh;wh=function(i,s){for(var o=s.child;o!==null;){if(o.tag===5||o.tag===6)i.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return;o=o.return}o.sibling.return=o.return,o=o.sibling}},po=function(){},Rh=function(i,s,o,h){var m=i.memoizedProps;if(m!==h){i=s.stateNode,Yr(er.current);var v=null;switch(o){case"input":m=Wn(i,m),h=Wn(i,h),v=[];break;case"select":m=w({},m,{value:void 0}),h=w({},h,{value:void 0}),v=[];break;case"textarea":m=qn(i,m),h=qn(i,h),v=[];break;default:typeof m.onClick!="function"&&typeof h.onClick=="function"&&(i.onclick=gs)}Qn(o,h);var L;o=null;for(F in m)if(!h.hasOwnProperty(F)&&m.hasOwnProperty(F)&&m[F]!=null)if(F==="style"){var A=m[F];for(L in A)A.hasOwnProperty(L)&&(o||(o={}),o[L]="")}else F!=="dangerouslySetInnerHTML"&&F!=="children"&&F!=="suppressContentEditableWarning"&&F!=="suppressHydrationWarning"&&F!=="autoFocus"&&(l.hasOwnProperty(F)?v||(v=[]):(v=v||[]).push(F,null));for(F in h){var R=h[F];if(A=m?.[F],h.hasOwnProperty(F)&&R!==A&&(R!=null||A!=null))if(F==="style")if(A){for(L in A)!A.hasOwnProperty(L)||R&&R.hasOwnProperty(L)||(o||(o={}),o[L]="");for(L in R)R.hasOwnProperty(L)&&A[L]!==R[L]&&(o||(o={}),o[L]=R[L])}else o||(v||(v=[]),v.push(F,o)),o=R;else F==="dangerouslySetInnerHTML"?(R=R?R.__html:void 0,A=A?A.__html:void 0,R!=null&&A!==R&&(v=v||[]).push(F,R)):F==="children"?typeof R!="string"&&typeof R!="number"||(v=v||[]).push(F,""+R):F!=="suppressContentEditableWarning"&&F!=="suppressHydrationWarning"&&(l.hasOwnProperty(F)?(R!=null&&F==="onScroll"&&Fe("scroll",i),v||A===R||(v=[])):(v=v||[]).push(F,R))}o&&(v=v||[]).push("style",o);var F=v;(s.updateQueue=F)&&(s.flags|=4)}},Dh=function(i,s,o,h){o!==h&&(s.flags|=4)};function Aa(i,s){if(!Be)switch(i.tailMode){case"hidden":s=i.tail;for(var o=null;s!==null;)s.alternate!==null&&(o=s),s=s.sibling;o===null?i.tail=null:o.sibling=null;break;case"collapsed":o=i.tail;for(var h=null;o!==null;)o.alternate!==null&&(h=o),o=o.sibling;h===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:h.sibling=null}}function gt(i){var s=i.alternate!==null&&i.alternate.child===i.child,o=0,h=0;if(s)for(var m=i.child;m!==null;)o|=m.lanes|m.childLanes,h|=m.subtreeFlags&14680064,h|=m.flags&14680064,m.return=i,m=m.sibling;else for(m=i.child;m!==null;)o|=m.lanes|m.childLanes,h|=m.subtreeFlags,h|=m.flags,m.return=i,m=m.sibling;return i.subtreeFlags|=h,i.childLanes=o,s}function i0(i,s,o){var h=s.pendingProps;switch(Fl(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return gt(s),null;case 1:return bt(s.type)&&vs(),gt(s),null;case 3:return h=s.stateNode,Di(),Ue(Tt),Ue(ft),Jl(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(i===null||i.child===null)&&(bs(s)?s.flags|=4:i===null||i.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,Ht!==null&&(wo(Ht),Ht=null))),po(i,s),gt(s),null;case 5:Xl(s);var m=Yr(Sa.current);if(o=s.type,i!==null&&s.stateNode!=null)Rh(i,s,o,h,m),i.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!h){if(s.stateNode===null)throw Error(a(166));return gt(s),null}if(i=Yr(er.current),bs(s)){h=s.stateNode,o=s.type;var v=s.memoizedProps;switch(h[Zt]=s,h[ga]=v,i=(s.mode&1)!==0,o){case"dialog":Fe("cancel",h),Fe("close",h);break;case"iframe":case"object":case"embed":Fe("load",h);break;case"video":case"audio":for(m=0;m<ha.length;m++)Fe(ha[m],h);break;case"source":Fe("error",h);break;case"img":case"image":case"link":Fe("error",h),Fe("load",h);break;case"details":Fe("toggle",h);break;case"input":nd(h,v),Fe("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!v.multiple},Fe("invalid",h);break;case"textarea":ud(h,v),Fe("invalid",h)}Qn(o,v),m=null;for(var L in v)if(v.hasOwnProperty(L)){var A=v[L];L==="children"?typeof A=="string"?h.textContent!==A&&(v.suppressHydrationWarning!==!0&&ms(h.textContent,A,i),m=["children",A]):typeof A=="number"&&h.textContent!==""+A&&(v.suppressHydrationWarning!==!0&&ms(h.textContent,A,i),m=["children",""+A]):l.hasOwnProperty(L)&&A!=null&&L==="onScroll"&&Fe("scroll",h)}switch(o){case"input":Va(h),od(h,v,!0);break;case"textarea":Va(h),cd(h);break;case"select":case"option":break;default:typeof v.onClick=="function"&&(h.onclick=gs)}h=m,s.updateQueue=h,h!==null&&(s.flags|=4)}else{L=m.nodeType===9?m:m.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=hd(o)),i==="http://www.w3.org/1999/xhtml"?o==="script"?(i=L.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof h.is=="string"?i=L.createElement(o,{is:h.is}):(i=L.createElement(o),o==="select"&&(L=i,h.multiple?L.multiple=!0:h.size&&(L.size=h.size))):i=L.createElementNS(i,o),i[Zt]=s,i[ga]=h,wh(i,s,!1,!1),s.stateNode=i;e:{switch(L=Jn(o,h),o){case"dialog":Fe("cancel",i),Fe("close",i),m=h;break;case"iframe":case"object":case"embed":Fe("load",i),m=h;break;case"video":case"audio":for(m=0;m<ha.length;m++)Fe(ha[m],i);m=h;break;case"source":Fe("error",i),m=h;break;case"img":case"image":case"link":Fe("error",i),Fe("load",i),m=h;break;case"details":Fe("toggle",i),m=h;break;case"input":nd(i,h),m=Wn(i,h),Fe("invalid",i);break;case"option":m=h;break;case"select":i._wrapperState={wasMultiple:!!h.multiple},m=w({},h,{value:void 0}),Fe("invalid",i);break;case"textarea":ud(i,h),m=qn(i,h),Fe("invalid",i);break;default:m=h}Qn(o,m),A=m;for(v in A)if(A.hasOwnProperty(v)){var R=A[v];v==="style"?gd(i,R):v==="dangerouslySetInnerHTML"?(R=R?R.__html:void 0,R!=null&&fd(i,R)):v==="children"?typeof R=="string"?(o!=="textarea"||R!=="")&&Yi(i,R):typeof R=="number"&&Yi(i,""+R):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(l.hasOwnProperty(v)?R!=null&&v==="onScroll"&&Fe("scroll",i):R!=null&&x(i,v,R,L))}switch(o){case"input":Va(i),od(i,h,!1);break;case"textarea":Va(i),cd(i);break;case"option":h.value!=null&&i.setAttribute("value",""+Ce(h.value));break;case"select":i.multiple=!!h.multiple,v=h.value,v!=null?oi(i,!!h.multiple,v,!1):h.defaultValue!=null&&oi(i,!!h.multiple,h.defaultValue,!0);break;default:typeof m.onClick=="function"&&(i.onclick=gs)}switch(o){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return gt(s),null;case 6:if(i&&s.stateNode!=null)Dh(i,s,i.memoizedProps,h);else{if(typeof h!="string"&&s.stateNode===null)throw Error(a(166));if(o=Yr(Sa.current),Yr(er.current),bs(s)){if(h=s.stateNode,o=s.memoizedProps,h[Zt]=s,(v=h.nodeValue!==o)&&(i=It,i!==null))switch(i.tag){case 3:ms(h.nodeValue,o,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&ms(h.nodeValue,o,(i.mode&1)!==0)}v&&(s.flags|=4)}else h=(o.nodeType===9?o:o.ownerDocument).createTextNode(h),h[Zt]=s,s.stateNode=h}return gt(s),null;case 13:if(Ue(Ve),h=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(Be&&Ct!==null&&s.mode&1&&!(s.flags&128))Cc(),ki(),s.flags|=98560,v=!1;else if(v=bs(s),h!==null&&h.dehydrated!==null){if(i===null){if(!v)throw Error(a(318));if(v=s.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(a(317));v[Zt]=s}else ki(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;gt(s),v=!1}else Ht!==null&&(wo(Ht),Ht=null),v=!0;if(!v)return s.flags&65536?s:null}return s.flags&128?(s.lanes=o,s):(h=h!==null,h!==(i!==null&&i.memoizedState!==null)&&h&&(s.child.flags|=8192,s.mode&1&&(i===null||Ve.current&1?et===0&&(et=3):Io())),s.updateQueue!==null&&(s.flags|=4),gt(s),null);case 4:return Di(),po(i,s),i===null&&fa(s.stateNode.containerInfo),gt(s),null;case 10:return Hl(s.type._context),gt(s),null;case 17:return bt(s.type)&&vs(),gt(s),null;case 19:if(Ue(Ve),v=s.memoizedState,v===null)return gt(s),null;if(h=(s.flags&128)!==0,L=v.rendering,L===null)if(h)Aa(v,!1);else{if(et!==0||i!==null&&i.flags&128)for(i=s.child;i!==null;){if(L=Is(i),L!==null){for(s.flags|=128,Aa(v,!1),h=L.updateQueue,h!==null&&(s.updateQueue=h,s.flags|=4),s.subtreeFlags=0,h=o,o=s.child;o!==null;)v=o,i=h,v.flags&=14680066,L=v.alternate,L===null?(v.childLanes=0,v.lanes=i,v.child=null,v.subtreeFlags=0,v.memoizedProps=null,v.memoizedState=null,v.updateQueue=null,v.dependencies=null,v.stateNode=null):(v.childLanes=L.childLanes,v.lanes=L.lanes,v.child=L.child,v.subtreeFlags=0,v.deletions=null,v.memoizedProps=L.memoizedProps,v.memoizedState=L.memoizedState,v.updateQueue=L.updateQueue,v.type=L.type,i=L.dependencies,v.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),o=o.sibling;return Ne(Ve,Ve.current&1|2),s.child}i=i.sibling}v.tail!==null&&je()>xi&&(s.flags|=128,h=!0,Aa(v,!1),s.lanes=4194304)}else{if(!h)if(i=Is(L),i!==null){if(s.flags|=128,h=!0,o=i.updateQueue,o!==null&&(s.updateQueue=o,s.flags|=4),Aa(v,!0),v.tail===null&&v.tailMode==="hidden"&&!L.alternate&&!Be)return gt(s),null}else 2*je()-v.renderingStartTime>xi&&o!==1073741824&&(s.flags|=128,h=!0,Aa(v,!1),s.lanes=4194304);v.isBackwards?(L.sibling=s.child,s.child=L):(o=v.last,o!==null?o.sibling=L:s.child=L,v.last=L)}return v.tail!==null?(s=v.tail,v.rendering=s,v.tail=s.sibling,v.renderingStartTime=je(),s.sibling=null,o=Ve.current,Ne(Ve,h?o&1|2:o&1),s):(gt(s),null);case 22:case 23:return Do(),h=s.memoizedState!==null,i!==null&&i.memoizedState!==null!==h&&(s.flags|=8192),h&&s.mode&1?_t&1073741824&&(gt(s),s.subtreeFlags&6&&(s.flags|=8192)):gt(s),null;case 24:return null;case 25:return null}throw Error(a(156,s.tag))}function a0(i,s){switch(Fl(s),s.tag){case 1:return bt(s.type)&&vs(),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return Di(),Ue(Tt),Ue(ft),Jl(),i=s.flags,i&65536&&!(i&128)?(s.flags=i&-65537|128,s):null;case 5:return Xl(s),null;case 13:if(Ue(Ve),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(a(340));ki()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return Ue(Ve),null;case 4:return Di(),null;case 10:return Hl(s.type._context),null;case 22:case 23:return Do(),null;case 24:return null;default:return null}}var Fs=!1,pt=!1,s0=typeof WeakSet=="function"?WeakSet:Set,le=null;function Ci(i,s){var o=i.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(h){We(i,s,h)}else o.current=null}function Ih(i,s,o){try{o()}catch(h){We(i,s,h)}}var Ch=!1;function n0(i,s){if(Dl=es,i=ac(),bl(i)){if("selectionStart"in i)var o={start:i.selectionStart,end:i.selectionEnd};else e:{o=(o=i.ownerDocument)&&o.defaultView||window;var h=o.getSelection&&o.getSelection();if(h&&h.rangeCount!==0){o=h.anchorNode;var m=h.anchorOffset,v=h.focusNode;h=h.focusOffset;try{o.nodeType,v.nodeType}catch{o=null;break e}var L=0,A=-1,R=-1,F=0,Y=0,X=i,j=null;t:for(;;){for(var ne;X!==o||m!==0&&X.nodeType!==3||(A=L+m),X!==v||h!==0&&X.nodeType!==3||(R=L+h),X.nodeType===3&&(L+=X.nodeValue.length),(ne=X.firstChild)!==null;)j=X,X=ne;for(;;){if(X===i)break t;if(j===o&&++F===m&&(A=L),j===v&&++Y===h&&(R=L),(ne=X.nextSibling)!==null)break;X=j,j=X.parentNode}X=ne}o=A===-1||R===-1?null:{start:A,end:R}}else o=null}o=o||{start:0,end:0}}else o=null;for(Il={focusedElem:i,selectionRange:o},es=!1,le=s;le!==null;)if(s=le,i=s.child,(s.subtreeFlags&1028)!==0&&i!==null)i.return=s,le=i;else for(;le!==null;){s=le;try{var ue=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(ue!==null){var ce=ue.memoizedProps,Ye=ue.memoizedState,M=s.stateNode,_=M.getSnapshotBeforeUpdate(s.elementType===s.type?ce:Kt(s.type,ce),Ye);M.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var N=s.stateNode.containerInfo;N.nodeType===1?N.textContent="":N.nodeType===9&&N.documentElement&&N.removeChild(N.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(J){We(s,s.return,J)}if(i=s.sibling,i!==null){i.return=s.return,le=i;break}le=s.return}return ue=Ch,Ch=!1,ue}function wa(i,s,o){var h=s.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var m=h=h.next;do{if((m.tag&i)===i){var v=m.destroy;m.destroy=void 0,v!==void 0&&Ih(s,o,v)}m=m.next}while(m!==h)}}function Us(i,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var o=s=s.next;do{if((o.tag&i)===i){var h=o.create;o.destroy=h()}o=o.next}while(o!==s)}}function vo(i){var s=i.ref;if(s!==null){var o=i.stateNode;switch(i.tag){case 5:i=o;break;default:i=o}typeof s=="function"?s(i):s.current=i}}function _h(i){var s=i.alternate;s!==null&&(i.alternate=null,_h(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&(delete s[Zt],delete s[ga],delete s[Pl],delete s[Vy],delete s[Hy])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function xh(i){return i.tag===5||i.tag===3||i.tag===4}function Ph(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||xh(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function yo(i,s,o){var h=i.tag;if(h===5||h===6)i=i.stateNode,s?o.nodeType===8?o.parentNode.insertBefore(i,s):o.insertBefore(i,s):(o.nodeType===8?(s=o.parentNode,s.insertBefore(i,o)):(s=o,s.appendChild(i)),o=o._reactRootContainer,o!=null||s.onclick!==null||(s.onclick=gs));else if(h!==4&&(i=i.child,i!==null))for(yo(i,s,o),i=i.sibling;i!==null;)yo(i,s,o),i=i.sibling}function Eo(i,s,o){var h=i.tag;if(h===5||h===6)i=i.stateNode,s?o.insertBefore(i,s):o.appendChild(i);else if(h!==4&&(i=i.child,i!==null))for(Eo(i,s,o),i=i.sibling;i!==null;)Eo(i,s,o),i=i.sibling}var dt=null,zt=!1;function Mr(i,s,o){for(o=o.child;o!==null;)Mh(i,s,o),o=o.sibling}function Mh(i,s,o){if(Jt&&typeof Jt.onCommitFiberUnmount=="function")try{Jt.onCommitFiberUnmount(Ya,o)}catch{}switch(o.tag){case 5:pt||Ci(o,s);case 6:var h=dt,m=zt;dt=null,Mr(i,s,o),dt=h,zt=m,dt!==null&&(zt?(i=dt,o=o.stateNode,i.nodeType===8?i.parentNode.removeChild(o):i.removeChild(o)):dt.removeChild(o.stateNode));break;case 18:dt!==null&&(zt?(i=dt,o=o.stateNode,i.nodeType===8?xl(i.parentNode,o):i.nodeType===1&&xl(i,o),aa(i)):xl(dt,o.stateNode));break;case 4:h=dt,m=zt,dt=o.stateNode.containerInfo,zt=!0,Mr(i,s,o),dt=h,zt=m;break;case 0:case 11:case 14:case 15:if(!pt&&(h=o.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){m=h=h.next;do{var v=m,L=v.destroy;v=v.tag,L!==void 0&&(v&2||v&4)&&Ih(o,s,L),m=m.next}while(m!==h)}Mr(i,s,o);break;case 1:if(!pt&&(Ci(o,s),h=o.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=o.memoizedProps,h.state=o.memoizedState,h.componentWillUnmount()}catch(A){We(o,s,A)}Mr(i,s,o);break;case 21:Mr(i,s,o);break;case 22:o.mode&1?(pt=(h=pt)||o.memoizedState!==null,Mr(i,s,o),pt=h):Mr(i,s,o);break;default:Mr(i,s,o)}}function Nh(i){var s=i.updateQueue;if(s!==null){i.updateQueue=null;var o=i.stateNode;o===null&&(o=i.stateNode=new s0),s.forEach(function(h){var m=g0.bind(null,i,h);o.has(h)||(o.add(h),h.then(m,m))})}}function Wt(i,s){var o=s.deletions;if(o!==null)for(var h=0;h<o.length;h++){var m=o[h];try{var v=i,L=s,A=L;e:for(;A!==null;){switch(A.tag){case 5:dt=A.stateNode,zt=!1;break e;case 3:dt=A.stateNode.containerInfo,zt=!0;break e;case 4:dt=A.stateNode.containerInfo,zt=!0;break e}A=A.return}if(dt===null)throw Error(a(160));Mh(v,L,m),dt=null,zt=!1;var R=m.alternate;R!==null&&(R.return=null),m.return=null}catch(F){We(m,s,F)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)Oh(s,i),s=s.sibling}function Oh(i,s){var o=i.alternate,h=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Wt(s,i),rr(i),h&4){try{wa(3,i,i.return),Us(3,i)}catch(ce){We(i,i.return,ce)}try{wa(5,i,i.return)}catch(ce){We(i,i.return,ce)}}break;case 1:Wt(s,i),rr(i),h&512&&o!==null&&Ci(o,o.return);break;case 5:if(Wt(s,i),rr(i),h&512&&o!==null&&Ci(o,o.return),i.flags&32){var m=i.stateNode;try{Yi(m,"")}catch(ce){We(i,i.return,ce)}}if(h&4&&(m=i.stateNode,m!=null)){var v=i.memoizedProps,L=o!==null?o.memoizedProps:v,A=i.type,R=i.updateQueue;if(i.updateQueue=null,R!==null)try{A==="input"&&v.type==="radio"&&v.name!=null&&ld(m,v),Jn(A,L);var F=Jn(A,v);for(L=0;L<R.length;L+=2){var Y=R[L],X=R[L+1];Y==="style"?gd(m,X):Y==="dangerouslySetInnerHTML"?fd(m,X):Y==="children"?Yi(m,X):x(m,Y,X,F)}switch(A){case"input":jn(m,v);break;case"textarea":dd(m,v);break;case"select":var j=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!v.multiple;var ne=v.value;ne!=null?oi(m,!!v.multiple,ne,!1):j!==!!v.multiple&&(v.defaultValue!=null?oi(m,!!v.multiple,v.defaultValue,!0):oi(m,!!v.multiple,v.multiple?[]:"",!1))}m[ga]=v}catch(ce){We(i,i.return,ce)}}break;case 6:if(Wt(s,i),rr(i),h&4){if(i.stateNode===null)throw Error(a(162));m=i.stateNode,v=i.memoizedProps;try{m.nodeValue=v}catch(ce){We(i,i.return,ce)}}break;case 3:if(Wt(s,i),rr(i),h&4&&o!==null&&o.memoizedState.isDehydrated)try{aa(s.containerInfo)}catch(ce){We(i,i.return,ce)}break;case 4:Wt(s,i),rr(i);break;case 13:Wt(s,i),rr(i),m=i.child,m.flags&8192&&(v=m.memoizedState!==null,m.stateNode.isHidden=v,!v||m.alternate!==null&&m.alternate.memoizedState!==null||(bo=je())),h&4&&Nh(i);break;case 22:if(Y=o!==null&&o.memoizedState!==null,i.mode&1?(pt=(F=pt)||Y,Wt(s,i),pt=F):Wt(s,i),rr(i),h&8192){if(F=i.memoizedState!==null,(i.stateNode.isHidden=F)&&!Y&&i.mode&1)for(le=i,Y=i.child;Y!==null;){for(X=le=Y;le!==null;){switch(j=le,ne=j.child,j.tag){case 0:case 11:case 14:case 15:wa(4,j,j.return);break;case 1:Ci(j,j.return);var ue=j.stateNode;if(typeof ue.componentWillUnmount=="function"){h=j,o=j.return;try{s=h,ue.props=s.memoizedProps,ue.state=s.memoizedState,ue.componentWillUnmount()}catch(ce){We(h,o,ce)}}break;case 5:Ci(j,j.return);break;case 22:if(j.memoizedState!==null){Bh(X);continue}}ne!==null?(ne.return=j,le=ne):Bh(X)}Y=Y.sibling}e:for(Y=null,X=i;;){if(X.tag===5){if(Y===null){Y=X;try{m=X.stateNode,F?(v=m.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none"):(A=X.stateNode,R=X.memoizedProps.style,L=R!=null&&R.hasOwnProperty("display")?R.display:null,A.style.display=md("display",L))}catch(ce){We(i,i.return,ce)}}}else if(X.tag===6){if(Y===null)try{X.stateNode.nodeValue=F?"":X.memoizedProps}catch(ce){We(i,i.return,ce)}}else if((X.tag!==22&&X.tag!==23||X.memoizedState===null||X===i)&&X.child!==null){X.child.return=X,X=X.child;continue}if(X===i)break e;for(;X.sibling===null;){if(X.return===null||X.return===i)break e;Y===X&&(Y=null),X=X.return}Y===X&&(Y=null),X.sibling.return=X.return,X=X.sibling}}break;case 19:Wt(s,i),rr(i),h&4&&Nh(i);break;case 21:break;default:Wt(s,i),rr(i)}}function rr(i){var s=i.flags;if(s&2){try{e:{for(var o=i.return;o!==null;){if(xh(o)){var h=o;break e}o=o.return}throw Error(a(160))}switch(h.tag){case 5:var m=h.stateNode;h.flags&32&&(Yi(m,""),h.flags&=-33);var v=Ph(i);Eo(i,v,m);break;case 3:case 4:var L=h.stateNode.containerInfo,A=Ph(i);yo(i,A,L);break;default:throw Error(a(161))}}catch(R){We(i,i.return,R)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function l0(i,s,o){le=i,Fh(i,s,o)}function Fh(i,s,o){for(var h=(i.mode&1)!==0;le!==null;){var m=le,v=m.child;if(m.tag===22&&h){var L=m.memoizedState!==null||Fs;if(!L){var A=m.alternate,R=A!==null&&A.memoizedState!==null||pt;A=Fs;var F=pt;if(Fs=L,(pt=R)&&!F)for(le=m;le!==null;)L=le,R=L.child,L.tag===22&&L.memoizedState!==null?$h(m):R!==null?(R.return=L,le=R):$h(m);for(;v!==null;)le=v,Fh(v,s,o),v=v.sibling;le=m,Fs=A,pt=F}Uh(i,s,o)}else m.subtreeFlags&8772&&v!==null?(v.return=m,le=v):Uh(i,s,o)}}function Uh(i){for(;le!==null;){var s=le;if(s.flags&8772){var o=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:pt||Us(5,s);break;case 1:var h=s.stateNode;if(s.flags&4&&!pt)if(o===null)h.componentDidMount();else{var m=s.elementType===s.type?o.memoizedProps:Kt(s.type,o.memoizedProps);h.componentDidUpdate(m,o.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var v=s.updateQueue;v!==null&&Mc(s,v,h);break;case 3:var L=s.updateQueue;if(L!==null){if(o=null,s.child!==null)switch(s.child.tag){case 5:o=s.child.stateNode;break;case 1:o=s.child.stateNode}Mc(s,L,o)}break;case 5:var A=s.stateNode;if(o===null&&s.flags&4){o=A;var R=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":R.autoFocus&&o.focus();break;case"img":R.src&&(o.src=R.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var F=s.alternate;if(F!==null){var Y=F.memoizedState;if(Y!==null){var X=Y.dehydrated;X!==null&&aa(X)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(a(163))}pt||s.flags&512&&vo(s)}catch(j){We(s,s.return,j)}}if(s===i){le=null;break}if(o=s.sibling,o!==null){o.return=s.return,le=o;break}le=s.return}}function Bh(i){for(;le!==null;){var s=le;if(s===i){le=null;break}var o=s.sibling;if(o!==null){o.return=s.return,le=o;break}le=s.return}}function $h(i){for(;le!==null;){var s=le;try{switch(s.tag){case 0:case 11:case 15:var o=s.return;try{Us(4,s)}catch(R){We(s,o,R)}break;case 1:var h=s.stateNode;if(typeof h.componentDidMount=="function"){var m=s.return;try{h.componentDidMount()}catch(R){We(s,m,R)}}var v=s.return;try{vo(s)}catch(R){We(s,v,R)}break;case 5:var L=s.return;try{vo(s)}catch(R){We(s,L,R)}}}catch(R){We(s,s.return,R)}if(s===i){le=null;break}var A=s.sibling;if(A!==null){A.return=s.return,le=A;break}le=s.return}}var o0=Math.ceil,Bs=$.ReactCurrentDispatcher,So=$.ReactCurrentOwner,Ot=$.ReactCurrentBatchConfig,De=0,at=null,Xe=null,ct=0,_t=0,_i=Ir(0),et=0,Ra=null,Xr=0,$s=0,To=0,Da=null,kt=null,bo=0,xi=1/0,vr=null,Gs=!1,Lo=null,Nr=null,Vs=!1,Or=null,Hs=0,Ia=0,ko=null,Ks=-1,zs=0;function Et(){return De&6?je():Ks!==-1?Ks:Ks=je()}function Fr(i){return i.mode&1?De&2&&ct!==0?ct&-ct:zy.transition!==null?(zs===0&&(zs=Cd()),zs):(i=xe,i!==0||(i=window.event,i=i===void 0?16:Bd(i.type)),i):1}function jt(i,s,o,h){if(50<Ia)throw Ia=0,ko=null,Error(a(185));Zi(i,o,h),(!(De&2)||i!==at)&&(i===at&&(!(De&2)&&($s|=o),et===4&&Ur(i,ct)),At(i,h),o===1&&De===0&&!(s.mode&1)&&(xi=je()+500,Es&&_r()))}function At(i,s){var o=i.callbackNode;jv(i,s);var h=Qa(i,i===at?ct:0);if(h===0)o!==null&&Rd(o),i.callbackNode=null,i.callbackPriority=0;else if(s=h&-h,i.callbackPriority!==s){if(o!=null&&Rd(o),s===1)i.tag===0?Ky(Vh.bind(null,i)):Ac(Vh.bind(null,i)),$y(function(){!(De&6)&&_r()}),o=null;else{switch(_d(h)){case 1:o=sl;break;case 4:o=Dd;break;case 16:o=ja;break;case 536870912:o=Id;break;default:o=ja}o=Xh(o,Gh.bind(null,i))}i.callbackPriority=s,i.callbackNode=o}}function Gh(i,s){if(Ks=-1,zs=0,De&6)throw Error(a(327));var o=i.callbackNode;if(Pi()&&i.callbackNode!==o)return null;var h=Qa(i,i===at?ct:0);if(h===0)return null;if(h&30||h&i.expiredLanes||s)s=Ws(i,h);else{s=h;var m=De;De|=2;var v=Kh();(at!==i||ct!==s)&&(vr=null,xi=je()+500,Jr(i,s));do try{c0();break}catch(A){Hh(i,A)}while(!0);Vl(),Bs.current=v,De=m,Xe!==null?s=0:(at=null,ct=0,s=et)}if(s!==0){if(s===2&&(m=nl(i),m!==0&&(h=m,s=Ao(i,m))),s===1)throw o=Ra,Jr(i,0),Ur(i,h),At(i,je()),o;if(s===6)Ur(i,h);else{if(m=i.current.alternate,!(h&30)&&!u0(m)&&(s=Ws(i,h),s===2&&(v=nl(i),v!==0&&(h=v,s=Ao(i,v))),s===1))throw o=Ra,Jr(i,0),Ur(i,h),At(i,je()),o;switch(i.finishedWork=m,i.finishedLanes=h,s){case 0:case 1:throw Error(a(345));case 2:Zr(i,kt,vr);break;case 3:if(Ur(i,h),(h&130023424)===h&&(s=bo+500-je(),10<s)){if(Qa(i,0)!==0)break;if(m=i.suspendedLanes,(m&h)!==h){Et(),i.pingedLanes|=i.suspendedLanes&m;break}i.timeoutHandle=_l(Zr.bind(null,i,kt,vr),s);break}Zr(i,kt,vr);break;case 4:if(Ur(i,h),(h&4194240)===h)break;for(s=i.eventTimes,m=-1;0<h;){var L=31-Gt(h);v=1<<L,L=s[L],L>m&&(m=L),h&=~v}if(h=m,h=je()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*o0(h/1960))-h,10<h){i.timeoutHandle=_l(Zr.bind(null,i,kt,vr),h);break}Zr(i,kt,vr);break;case 5:Zr(i,kt,vr);break;default:throw Error(a(329))}}}return At(i,je()),i.callbackNode===o?Gh.bind(null,i):null}function Ao(i,s){var o=Da;return i.current.memoizedState.isDehydrated&&(Jr(i,s).flags|=256),i=Ws(i,s),i!==2&&(s=kt,kt=o,s!==null&&wo(s)),i}function wo(i){kt===null?kt=i:kt.push.apply(kt,i)}function u0(i){for(var s=i;;){if(s.flags&16384){var o=s.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var h=0;h<o.length;h++){var m=o[h],v=m.getSnapshot;m=m.value;try{if(!Vt(v(),m))return!1}catch{return!1}}}if(o=s.child,s.subtreeFlags&16384&&o!==null)o.return=s,s=o;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Ur(i,s){for(s&=~To,s&=~$s,i.suspendedLanes|=s,i.pingedLanes&=~s,i=i.expirationTimes;0<s;){var o=31-Gt(s),h=1<<o;i[o]=-1,s&=~h}}function Vh(i){if(De&6)throw Error(a(327));Pi();var s=Qa(i,0);if(!(s&1))return At(i,je()),null;var o=Ws(i,s);if(i.tag!==0&&o===2){var h=nl(i);h!==0&&(s=h,o=Ao(i,h))}if(o===1)throw o=Ra,Jr(i,0),Ur(i,s),At(i,je()),o;if(o===6)throw Error(a(345));return i.finishedWork=i.current.alternate,i.finishedLanes=s,Zr(i,kt,vr),At(i,je()),null}function Ro(i,s){var o=De;De|=1;try{return i(s)}finally{De=o,De===0&&(xi=je()+500,Es&&_r())}}function Qr(i){Or!==null&&Or.tag===0&&!(De&6)&&Pi();var s=De;De|=1;var o=Ot.transition,h=xe;try{if(Ot.transition=null,xe=1,i)return i()}finally{xe=h,Ot.transition=o,De=s,!(De&6)&&_r()}}function Do(){_t=_i.current,Ue(_i)}function Jr(i,s){i.finishedWork=null,i.finishedLanes=0;var o=i.timeoutHandle;if(o!==-1&&(i.timeoutHandle=-1,By(o)),Xe!==null)for(o=Xe.return;o!==null;){var h=o;switch(Fl(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&vs();break;case 3:Di(),Ue(Tt),Ue(ft),Jl();break;case 5:Xl(h);break;case 4:Di();break;case 13:Ue(Ve);break;case 19:Ue(Ve);break;case 10:Hl(h.type._context);break;case 22:case 23:Do()}o=o.return}if(at=i,Xe=i=Br(i.current,null),ct=_t=s,et=0,Ra=null,To=$s=Xr=0,kt=Da=null,jr!==null){for(s=0;s<jr.length;s++)if(o=jr[s],h=o.interleaved,h!==null){o.interleaved=null;var m=h.next,v=o.pending;if(v!==null){var L=v.next;v.next=m,h.next=L}o.pending=h}jr=null}return i}function Hh(i,s){do{var o=Xe;try{if(Vl(),Cs.current=Ms,_s){for(var h=He.memoizedState;h!==null;){var m=h.queue;m!==null&&(m.pending=null),h=h.next}_s=!1}if(qr=0,it=Ze=He=null,Ta=!1,ba=0,So.current=null,o===null||o.return===null){et=1,Ra=s,Xe=null;break}e:{var v=i,L=o.return,A=o,R=s;if(s=ct,A.flags|=32768,R!==null&&typeof R=="object"&&typeof R.then=="function"){var F=R,Y=A,X=Y.tag;if(!(Y.mode&1)&&(X===0||X===11||X===15)){var j=Y.alternate;j?(Y.updateQueue=j.updateQueue,Y.memoizedState=j.memoizedState,Y.lanes=j.lanes):(Y.updateQueue=null,Y.memoizedState=null)}var ne=fh(L);if(ne!==null){ne.flags&=-257,mh(ne,L,A,v,s),ne.mode&1&&hh(v,F,s),s=ne,R=F;var ue=s.updateQueue;if(ue===null){var ce=new Set;ce.add(R),s.updateQueue=ce}else ue.add(R);break e}else{if(!(s&1)){hh(v,F,s),Io();break e}R=Error(a(426))}}else if(Be&&A.mode&1){var Ye=fh(L);if(Ye!==null){!(Ye.flags&65536)&&(Ye.flags|=256),mh(Ye,L,A,v,s),$l(Ii(R,A));break e}}v=R=Ii(R,A),et!==4&&(et=2),Da===null?Da=[v]:Da.push(v),v=L;do{switch(v.tag){case 3:v.flags|=65536,s&=-s,v.lanes|=s;var M=dh(v,R,s);Pc(v,M);break e;case 1:A=R;var _=v.type,N=v.stateNode;if(!(v.flags&128)&&(typeof _.getDerivedStateFromError=="function"||N!==null&&typeof N.componentDidCatch=="function"&&(Nr===null||!Nr.has(N)))){v.flags|=65536,s&=-s,v.lanes|=s;var J=ch(v,A,s);Pc(v,J);break e}}v=v.return}while(v!==null)}Wh(o)}catch(fe){s=fe,Xe===o&&o!==null&&(Xe=o=o.return);continue}break}while(!0)}function Kh(){var i=Bs.current;return Bs.current=Ms,i===null?Ms:i}function Io(){(et===0||et===3||et===2)&&(et=4),at===null||!(Xr&268435455)&&!($s&268435455)||Ur(at,ct)}function Ws(i,s){var o=De;De|=2;var h=Kh();(at!==i||ct!==s)&&(vr=null,Jr(i,s));do try{d0();break}catch(m){Hh(i,m)}while(!0);if(Vl(),De=o,Bs.current=h,Xe!==null)throw Error(a(261));return at=null,ct=0,et}function d0(){for(;Xe!==null;)zh(Xe)}function c0(){for(;Xe!==null&&!Uv();)zh(Xe)}function zh(i){var s=qh(i.alternate,i,_t);i.memoizedProps=i.pendingProps,s===null?Wh(i):Xe=s,So.current=null}function Wh(i){var s=i;do{var o=s.alternate;if(i=s.return,s.flags&32768){if(o=a0(o,s),o!==null){o.flags&=32767,Xe=o;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{et=6,Xe=null;return}}else if(o=i0(o,s,_t),o!==null){Xe=o;return}if(s=s.sibling,s!==null){Xe=s;return}Xe=s=i}while(s!==null);et===0&&(et=5)}function Zr(i,s,o){var h=xe,m=Ot.transition;try{Ot.transition=null,xe=1,h0(i,s,o,h)}finally{Ot.transition=m,xe=h}return null}function h0(i,s,o,h){do Pi();while(Or!==null);if(De&6)throw Error(a(327));o=i.finishedWork;var m=i.finishedLanes;if(o===null)return null;if(i.finishedWork=null,i.finishedLanes=0,o===i.current)throw Error(a(177));i.callbackNode=null,i.callbackPriority=0;var v=o.lanes|o.childLanes;if(Yv(i,v),i===at&&(Xe=at=null,ct=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||Vs||(Vs=!0,Xh(ja,function(){return Pi(),null})),v=(o.flags&15990)!==0,o.subtreeFlags&15990||v){v=Ot.transition,Ot.transition=null;var L=xe;xe=1;var A=De;De|=4,So.current=null,n0(i,o),Oh(o,i),My(Il),es=!!Dl,Il=Dl=null,i.current=o,l0(o,i,m),Bv(),De=A,xe=L,Ot.transition=v}else i.current=o;if(Vs&&(Vs=!1,Or=i,Hs=m),v=i.pendingLanes,v===0&&(Nr=null),Vv(o.stateNode,h),At(i,je()),s!==null)for(h=i.onRecoverableError,o=0;o<s.length;o++)m=s[o],h(m.value,{componentStack:m.stack,digest:m.digest});if(Gs)throw Gs=!1,i=Lo,Lo=null,i;return Hs&1&&i.tag!==0&&Pi(),v=i.pendingLanes,v&1?i===ko?Ia++:(Ia=0,ko=i):Ia=0,_r(),null}function Pi(){if(Or!==null){var i=_d(Hs),s=Ot.transition,o=xe;try{if(Ot.transition=null,xe=16>i?16:i,Or===null)var h=!1;else{if(i=Or,Or=null,Hs=0,De&6)throw Error(a(331));var m=De;for(De|=4,le=i.current;le!==null;){var v=le,L=v.child;if(le.flags&16){var A=v.deletions;if(A!==null){for(var R=0;R<A.length;R++){var F=A[R];for(le=F;le!==null;){var Y=le;switch(Y.tag){case 0:case 11:case 15:wa(8,Y,v)}var X=Y.child;if(X!==null)X.return=Y,le=X;else for(;le!==null;){Y=le;var j=Y.sibling,ne=Y.return;if(_h(Y),Y===F){le=null;break}if(j!==null){j.return=ne,le=j;break}le=ne}}}var ue=v.alternate;if(ue!==null){var ce=ue.child;if(ce!==null){ue.child=null;do{var Ye=ce.sibling;ce.sibling=null,ce=Ye}while(ce!==null)}}le=v}}if(v.subtreeFlags&2064&&L!==null)L.return=v,le=L;else e:for(;le!==null;){if(v=le,v.flags&2048)switch(v.tag){case 0:case 11:case 15:wa(9,v,v.return)}var M=v.sibling;if(M!==null){M.return=v.return,le=M;break e}le=v.return}}var _=i.current;for(le=_;le!==null;){L=le;var N=L.child;if(L.subtreeFlags&2064&&N!==null)N.return=L,le=N;else e:for(L=_;le!==null;){if(A=le,A.flags&2048)try{switch(A.tag){case 0:case 11:case 15:Us(9,A)}}catch(fe){We(A,A.return,fe)}if(A===L){le=null;break e}var J=A.sibling;if(J!==null){J.return=A.return,le=J;break e}le=A.return}}if(De=m,_r(),Jt&&typeof Jt.onPostCommitFiberRoot=="function")try{Jt.onPostCommitFiberRoot(Ya,i)}catch{}h=!0}return h}finally{xe=o,Ot.transition=s}}return!1}function jh(i,s,o){s=Ii(o,s),s=dh(i,s,1),i=Pr(i,s,1),s=Et(),i!==null&&(Zi(i,1,s),At(i,s))}function We(i,s,o){if(i.tag===3)jh(i,i,o);else for(;s!==null;){if(s.tag===3){jh(s,i,o);break}else if(s.tag===1){var h=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Nr===null||!Nr.has(h))){i=Ii(o,i),i=ch(s,i,1),s=Pr(s,i,1),i=Et(),s!==null&&(Zi(s,1,i),At(s,i));break}}s=s.return}}function f0(i,s,o){var h=i.pingCache;h!==null&&h.delete(s),s=Et(),i.pingedLanes|=i.suspendedLanes&o,at===i&&(ct&o)===o&&(et===4||et===3&&(ct&130023424)===ct&&500>je()-bo?Jr(i,0):To|=o),At(i,s)}function Yh(i,s){s===0&&(i.mode&1?(s=Xa,Xa<<=1,!(Xa&130023424)&&(Xa=4194304)):s=1);var o=Et();i=mr(i,s),i!==null&&(Zi(i,s,o),At(i,o))}function m0(i){var s=i.memoizedState,o=0;s!==null&&(o=s.retryLane),Yh(i,o)}function g0(i,s){var o=0;switch(i.tag){case 13:var h=i.stateNode,m=i.memoizedState;m!==null&&(o=m.retryLane);break;case 19:h=i.stateNode;break;default:throw Error(a(314))}h!==null&&h.delete(s),Yh(i,o)}var qh;qh=function(i,s,o){if(i!==null)if(i.memoizedProps!==s.pendingProps||Tt.current)Lt=!0;else{if(!(i.lanes&o)&&!(s.flags&128))return Lt=!1,r0(i,s,o);Lt=!!(i.flags&131072)}else Lt=!1,Be&&s.flags&1048576&&wc(s,Ts,s.index);switch(s.lanes=0,s.tag){case 2:var h=s.type;Os(i,s),i=s.pendingProps;var m=Ti(s,ft.current);wi(s,o),m=to(null,s,h,i,m,o);var v=ro();return s.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,bt(h)?(v=!0,ys(s)):v=!1,s.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,Wl(s),m.updater=Rs,s.stateNode=m,m._reactInternals=s,Yl(s,h,i,o),s=co(null,s,h,!0,v,o)):(s.tag=0,Be&&v&&Ol(s),yt(null,s,m,o),s=s.child),s;case 16:h=s.elementType;e:{switch(Os(i,s),i=s.pendingProps,m=h._init,h=m(h._payload),s.type=h,m=s.tag=v0(h),i=Kt(h,i),m){case 0:s=uo(null,s,h,i,o);break e;case 1:s=Sh(null,s,h,i,o);break e;case 11:s=gh(null,s,h,i,o);break e;case 14:s=ph(null,s,h,Kt(h.type,i),o);break e}throw Error(a(306,h,""))}return s;case 0:return h=s.type,m=s.pendingProps,m=s.elementType===h?m:Kt(h,m),uo(i,s,h,m,o);case 1:return h=s.type,m=s.pendingProps,m=s.elementType===h?m:Kt(h,m),Sh(i,s,h,m,o);case 3:e:{if(Th(s),i===null)throw Error(a(387));h=s.pendingProps,v=s.memoizedState,m=v.element,xc(i,s),ws(s,h,null,o);var L=s.memoizedState;if(h=L.element,v.isDehydrated)if(v={element:h,isDehydrated:!1,cache:L.cache,pendingSuspenseBoundaries:L.pendingSuspenseBoundaries,transitions:L.transitions},s.updateQueue.baseState=v,s.memoizedState=v,s.flags&256){m=Ii(Error(a(423)),s),s=bh(i,s,h,o,m);break e}else if(h!==m){m=Ii(Error(a(424)),s),s=bh(i,s,h,o,m);break e}else for(Ct=Dr(s.stateNode.containerInfo.firstChild),It=s,Be=!0,Ht=null,o=Gc(s,null,h,o),s.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(ki(),h===m){s=pr(i,s,o);break e}yt(i,s,h,o)}s=s.child}return s;case 5:return Vc(s),i===null&&Bl(s),h=s.type,m=s.pendingProps,v=i!==null?i.memoizedProps:null,L=m.children,Cl(h,m)?L=null:v!==null&&Cl(h,v)&&(s.flags|=32),Eh(i,s),yt(i,s,L,o),s.child;case 6:return i===null&&Bl(s),null;case 13:return Lh(i,s,o);case 4:return ql(s,s.stateNode.containerInfo),h=s.pendingProps,i===null?s.child=Ri(s,null,h,o):yt(i,s,h,o),s.child;case 11:return h=s.type,m=s.pendingProps,m=s.elementType===h?m:Kt(h,m),gh(i,s,h,m,o);case 7:return yt(i,s,s.pendingProps,o),s.child;case 8:return yt(i,s,s.pendingProps.children,o),s.child;case 12:return yt(i,s,s.pendingProps.children,o),s.child;case 10:e:{if(h=s.type._context,m=s.pendingProps,v=s.memoizedProps,L=m.value,Ne(Ls,h._currentValue),h._currentValue=L,v!==null)if(Vt(v.value,L)){if(v.children===m.children&&!Tt.current){s=pr(i,s,o);break e}}else for(v=s.child,v!==null&&(v.return=s);v!==null;){var A=v.dependencies;if(A!==null){L=v.child;for(var R=A.firstContext;R!==null;){if(R.context===h){if(v.tag===1){R=gr(-1,o&-o),R.tag=2;var F=v.updateQueue;if(F!==null){F=F.shared;var Y=F.pending;Y===null?R.next=R:(R.next=Y.next,Y.next=R),F.pending=R}}v.lanes|=o,R=v.alternate,R!==null&&(R.lanes|=o),Kl(v.return,o,s),A.lanes|=o;break}R=R.next}}else if(v.tag===10)L=v.type===s.type?null:v.child;else if(v.tag===18){if(L=v.return,L===null)throw Error(a(341));L.lanes|=o,A=L.alternate,A!==null&&(A.lanes|=o),Kl(L,o,s),L=v.sibling}else L=v.child;if(L!==null)L.return=v;else for(L=v;L!==null;){if(L===s){L=null;break}if(v=L.sibling,v!==null){v.return=L.return,L=v;break}L=L.return}v=L}yt(i,s,m.children,o),s=s.child}return s;case 9:return m=s.type,h=s.pendingProps.children,wi(s,o),m=Mt(m),h=h(m),s.flags|=1,yt(i,s,h,o),s.child;case 14:return h=s.type,m=Kt(h,s.pendingProps),m=Kt(h.type,m),ph(i,s,h,m,o);case 15:return vh(i,s,s.type,s.pendingProps,o);case 17:return h=s.type,m=s.pendingProps,m=s.elementType===h?m:Kt(h,m),Os(i,s),s.tag=1,bt(h)?(i=!0,ys(s)):i=!1,wi(s,o),Fc(s,h,m),Yl(s,h,m,o),co(null,s,h,!0,i,o);case 19:return Ah(i,s,o);case 22:return yh(i,s,o)}throw Error(a(156,s.tag))};function Xh(i,s){return wd(i,s)}function p0(i,s,o,h){this.tag=i,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ft(i,s,o,h){return new p0(i,s,o,h)}function Co(i){return i=i.prototype,!(!i||!i.isReactComponent)}function v0(i){if(typeof i=="function")return Co(i)?1:0;if(i!=null){if(i=i.$$typeof,i===ie)return 11;if(i===q)return 14}return 2}function Br(i,s){var o=i.alternate;return o===null?(o=Ft(i.tag,s,i.key,i.mode),o.elementType=i.elementType,o.type=i.type,o.stateNode=i.stateNode,o.alternate=i,i.alternate=o):(o.pendingProps=s,o.type=i.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=i.flags&14680064,o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,s=i.dependencies,o.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},o.sibling=i.sibling,o.index=i.index,o.ref=i.ref,o}function js(i,s,o,h,m,v){var L=2;if(h=i,typeof i=="function")Co(i)&&(L=1);else if(typeof i=="string")L=5;else e:switch(i){case Q:return ei(o.children,m,v,s);case ae:L=8,m|=8;break;case W:return i=Ft(12,o,s,m|2),i.elementType=W,i.lanes=v,i;case se:return i=Ft(13,o,s,m),i.elementType=se,i.lanes=v,i;case de:return i=Ft(19,o,s,m),i.elementType=de,i.lanes=v,i;case H:return Ys(o,m,v,s);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case ee:L=10;break e;case ge:L=9;break e;case ie:L=11;break e;case q:L=14;break e;case re:L=16,h=null;break e}throw Error(a(130,i==null?i:typeof i,""))}return s=Ft(L,o,s,m),s.elementType=i,s.type=h,s.lanes=v,s}function ei(i,s,o,h){return i=Ft(7,i,h,s),i.lanes=o,i}function Ys(i,s,o,h){return i=Ft(22,i,h,s),i.elementType=H,i.lanes=o,i.stateNode={isHidden:!1},i}function _o(i,s,o){return i=Ft(6,i,null,s),i.lanes=o,i}function xo(i,s,o){return s=Ft(4,i.children!==null?i.children:[],i.key,s),s.lanes=o,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}function y0(i,s,o,h,m){this.tag=s,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ll(0),this.expirationTimes=ll(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ll(0),this.identifierPrefix=h,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function Po(i,s,o,h,m,v,L,A,R){return i=new y0(i,s,o,A,R),s===1?(s=1,v===!0&&(s|=8)):s=0,v=Ft(3,null,null,s),i.current=v,v.stateNode=i,v.memoizedState={element:h,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},Wl(v),i}function E0(i,s,o){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:K,key:h==null?null:""+h,children:i,containerInfo:s,implementation:o}}function Qh(i){if(!i)return Cr;i=i._reactInternals;e:{if(Vr(i)!==i||i.tag!==1)throw Error(a(170));var s=i;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(bt(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(a(171))}if(i.tag===1){var o=i.type;if(bt(o))return Lc(i,o,s)}return s}function Jh(i,s,o,h,m,v,L,A,R){return i=Po(o,h,!0,i,m,v,L,A,R),i.context=Qh(null),o=i.current,h=Et(),m=Fr(o),v=gr(h,m),v.callback=s??null,Pr(o,v,m),i.current.lanes=m,Zi(i,m,h),At(i,h),i}function qs(i,s,o,h){var m=s.current,v=Et(),L=Fr(m);return o=Qh(o),s.context===null?s.context=o:s.pendingContext=o,s=gr(v,L),s.payload={element:i},h=h===void 0?null:h,h!==null&&(s.callback=h),i=Pr(m,s,L),i!==null&&(jt(i,m,L,v),As(i,m,L)),L}function Xs(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function Zh(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var o=i.retryLane;i.retryLane=o!==0&&o<s?o:s}}function Mo(i,s){Zh(i,s),(i=i.alternate)&&Zh(i,s)}function S0(){return null}var ef=typeof reportError=="function"?reportError:function(i){console.error(i)};function No(i){this._internalRoot=i}Qs.prototype.render=No.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(a(409));qs(i,s,null,null)},Qs.prototype.unmount=No.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;Qr(function(){qs(null,i,null,null)}),s[dr]=null}};function Qs(i){this._internalRoot=i}Qs.prototype.unstable_scheduleHydration=function(i){if(i){var s=Md();i={blockedOn:null,target:i,priority:s};for(var o=0;o<Ar.length&&s!==0&&s<Ar[o].priority;o++);Ar.splice(o,0,i),o===0&&Fd(i)}};function Oo(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Js(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function tf(){}function T0(i,s,o,h,m){if(m){if(typeof h=="function"){var v=h;h=function(){var F=Xs(L);v.call(F)}}var L=Jh(s,h,i,0,null,!1,!1,"",tf);return i._reactRootContainer=L,i[dr]=L.current,fa(i.nodeType===8?i.parentNode:i),Qr(),L}for(;m=i.lastChild;)i.removeChild(m);if(typeof h=="function"){var A=h;h=function(){var F=Xs(R);A.call(F)}}var R=Po(i,0,!1,null,null,!1,!1,"",tf);return i._reactRootContainer=R,i[dr]=R.current,fa(i.nodeType===8?i.parentNode:i),Qr(function(){qs(s,R,o,h)}),R}function Zs(i,s,o,h,m){var v=o._reactRootContainer;if(v){var L=v;if(typeof m=="function"){var A=m;m=function(){var R=Xs(L);A.call(R)}}qs(s,L,i,m)}else L=T0(o,s,i,m,h);return Xs(L)}xd=function(i){switch(i.tag){case 3:var s=i.stateNode;if(s.current.memoizedState.isDehydrated){var o=Ji(s.pendingLanes);o!==0&&(ol(s,o|1),At(s,je()),!(De&6)&&(xi=je()+500,_r()))}break;case 13:Qr(function(){var h=mr(i,1);if(h!==null){var m=Et();jt(h,i,1,m)}}),Mo(i,1)}},ul=function(i){if(i.tag===13){var s=mr(i,134217728);if(s!==null){var o=Et();jt(s,i,134217728,o)}Mo(i,134217728)}},Pd=function(i){if(i.tag===13){var s=Fr(i),o=mr(i,s);if(o!==null){var h=Et();jt(o,i,s,h)}Mo(i,s)}},Md=function(){return xe},Nd=function(i,s){var o=xe;try{return xe=i,s()}finally{xe=o}},tl=function(i,s,o){switch(s){case"input":if(jn(i,o),s=o.name,o.type==="radio"&&s!=null){for(o=i;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<o.length;s++){var h=o[s];if(h!==i&&h.form===i.form){var m=ps(h);if(!m)throw Error(a(90));sd(h),jn(h,m)}}}break;case"textarea":dd(i,o);break;case"select":s=o.value,s!=null&&oi(i,!!o.multiple,s,!1)}},Ed=Ro,Sd=Qr;var b0={usingClientEntryPoint:!1,Events:[pa,Ei,ps,vd,yd,Ro]},Ca={findFiberByHostInstance:Hr,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},L0={bundleType:Ca.bundleType,version:Ca.version,rendererPackageName:Ca.rendererPackageName,rendererConfig:Ca.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=kd(i),i===null?null:i.stateNode},findFiberByHostInstance:Ca.findFiberByHostInstance||S0,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&(_a=__REACT_DEVTOOLS_GLOBAL_HOOK__,!_a.isDisabled&&_a.supportsFiber))try{Ya=_a.inject(L0),Jt=_a}catch{}var _a;e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=b0,e.createPortal=function(i,s){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Oo(s))throw Error(a(200));return E0(i,s,null,o)},e.createRoot=function(i,s){if(!Oo(i))throw Error(a(299));var o=!1,h="",m=ef;return s!=null&&(s.unstable_strictMode===!0&&(o=!0),s.identifierPrefix!==void 0&&(h=s.identifierPrefix),s.onRecoverableError!==void 0&&(m=s.onRecoverableError)),s=Po(i,1,!1,null,null,o,!1,h,m),i[dr]=s.current,fa(i.nodeType===8?i.parentNode:i),new No(s)},e.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(a(188)):(i=Object.keys(i).join(","),Error(a(268,i)));return i=kd(s),i=i===null?null:i.stateNode,i},e.flushSync=function(i){return Qr(i)},e.hydrate=function(i,s,o){if(!Js(s))throw Error(a(200));return Zs(null,i,s,!0,o)},e.hydrateRoot=function(i,s,o){if(!Oo(i))throw Error(a(405));var h=o!=null&&o.hydratedSources||null,m=!1,v="",L=ef;if(o!=null&&(o.unstable_strictMode===!0&&(m=!0),o.identifierPrefix!==void 0&&(v=o.identifierPrefix),o.onRecoverableError!==void 0&&(L=o.onRecoverableError)),s=Jh(s,null,i,1,o??null,m,!1,v,L),i[dr]=s.current,fa(i),h)for(i=0;i<h.length;i++)o=h[i],m=o._getVersion,m=m(o._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[o,m]:s.mutableSourceEagerHydrationData.push(o,m);return new Qs(s)},e.render=function(i,s,o){if(!Js(s))throw Error(a(200));return Zs(null,i,s,!1,o)},e.unmountComponentAtNode=function(i){if(!Js(i))throw Error(a(40));return i._reactRootContainer?(Qr(function(){Zs(null,null,i,!1,function(){i._reactRootContainer=null,i[dr]=null})}),!0):!1},e.unstable_batchedUpdates=Ro,e.unstable_renderSubtreeIntoContainer=function(i,s,o,h){if(!Js(o))throw Error(a(200));if(i==null||i._reactInternals===void 0)throw Error(a(38));return Zs(i,s,o,!1,h)},e.version="18.2.0-next-9e3b772b8-20220608"}),fm=cm((e,t)=>{"use strict";function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(a){console.error(a)}}r(),t.exports=Q0()}),mm={};q0(mm,{__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:()=>pm,createPortal:()=>vm,createRoot:()=>ym,default:()=>Dm,findDOMNode:()=>Em,flushSync:()=>Sm,hydrate:()=>Tm,hydrateRoot:()=>bm,render:()=>Lm,unmountComponentAtNode:()=>km,unstable_batchedUpdates:()=>Am,unstable_renderSubtreeIntoContainer:()=>wm,version:()=>Rm});var gm=hm(fm());X0(mm,hm(fm()));var{__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:pm,createPortal:vm,createRoot:ym,findDOMNode:Em,flushSync:Sm,hydrate:Tm,hydrateRoot:bm,render:Lm,unmountComponentAtNode:km,unstable_batchedUpdates:Am,unstable_renderSubtreeIntoContainer:wm,version:Rm}=gm,{default:dm,...J0}=gm,Dm=dm!==void 0?dm:J0;var Ni=e=>{let t=a=>typeof a.default<"u"?a.default:a,r=a=>Object.assign({},a);switch(e){case"react-dom":return t(Wo);default:throw new Error('module "'+e+'" not found')}},Z0=Object.create,Yo=Object.defineProperty,eE=Object.getOwnPropertyDescriptor,tE=Object.getOwnPropertyNames,rE=Object.getPrototypeOf,iE=Object.prototype.hasOwnProperty,aE=(e=>typeof Ni<"u"?Ni:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof Ni<"u"?Ni:t)[r]}):e)(function(e){if(typeof Ni<"u")return Ni.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),sE=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),nE=(e,t)=>{for(var r in t)Yo(e,r,{get:t[r],enumerable:!0})},jo=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of tE(t))!iE.call(e,n)&&n!==r&&Yo(e,n,{get:()=>t[n],enumerable:!(a=eE(t,n))||a.enumerable});return e},lE=(e,t,r)=>(jo(e,t,"default"),r&&jo(r,t,"default")),Cm=(e,t,r)=>(r=e!=null?Z0(rE(e)):{},jo(t||!e||!e.__esModule?Yo(r,"default",{value:e,enumerable:!0}):r,e)),_m=sE(e=>{"use strict";var t=aE("react-dom");e.createRoot=t.createRoot,e.hydrateRoot=t.hydrateRoot;var r}),xm={};nE(xm,{createRoot:()=>qo,default:()=>Mm,hydrateRoot:()=>oE});var Pm=Cm(_m());lE(xm,Cm(_m()));var{createRoot:qo,hydrateRoot:oE}=Pm,{default:Im,...uE}=Pm,Mm=Im!==void 0?Im:uE;var sn=class{getData(){let t=document.querySelector("#jsWatchInfo");if(t===null||!(t instanceof HTMLElement))return null;let r=t.dataset.jsWatchInfo;return r===""||r===void 0?null:JSON.parse(r)}};var Nm={canPlay:!1,video:void 0,jsWatchInfo:void 0,isPlaying:!1,isCommentVisible:!0,commentManager:void 0,comments:void 0,isSystemMessageVisible:!1,isShortcutVisible:!1,contextMenu:{open:!1,left:0,top:0},ngHandler:void 0},Ae=en({}),Om=(e,t)=>{switch(t.type){case"canPlay":return{...e,canPlay:t.payload};case"video":return{...e,video:t.payload};case"jsWatchInfo":return{...e,jsWatchInfo:t.payload};case"isPlaying":return{...e,isPlaying:t.payload};case"commentManager":return{...e,commentManager:t.payload};case"isCommentVisible":return{...e,isCommentVisible:t.payload};case"comments":return{...e,comments:t.payload};case"systemMessage":return{...e,isSystemMessageVisible:t.payload};case"contextMenu":return{...e,contextMenu:t.payload};case"shortcut":return{...e,isShortcutVisible:t.payload}}};var Fm=({comment:e})=>{function t(f){r.video&&(r.video.currentTime=f/1e3)}let{state:r,dispatch:a}=ke(Ae),n=new Date(e.postedAt),l=`${n.getFullYear()}/${n.getMonth()+1}/${n.getDate()} ${n.getHours()}:${n.getMinutes()}`,u=Math.floor(e.vposMS/6e4),d=Math.floor(e.vposMS%6e4/1e3),c=`${u.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`;return D.createElement("div",{className:"commentItem",onDoubleClick:()=>t(e.vposMS)},D.createElement("div",{className:"commentContent",title:e.body},e.body),D.createElement("div",{className:"commentTime"},c),D.createElement("div",{className:"commentNumber"},e.number),D.createElement("div",{className:"commentPostedAt"},l))};var Um=({data:e})=>{let t="";switch(e.ngType){case"word":t="\u30B3\u30E1\u30F3\u30C8";break;case"user":t="\u30E6\u30FC\u30B6\u30FC";break;case"command":t="\u30B3\u30DE\u30F3\u30C9"}return D.createElement("div",{className:"ngItem"},D.createElement("div",{className:"content"},D.createElement("div",{className:"type"},t),D.createElement("div",{className:"value"},e.value)),D.createElement("div",{className:"remove",onClick:e.remove},D.createElement("i",{className:"fa-solid fa-x"})))};Object.defineProperty(Array.prototype,"pushRange",{enumerable:!1,configurable:!0,writable:!0,value:function(e){e.forEach(t=>{this.push(t)})}});var Bm=({onAdd:e})=>{let{state:t,dispatch:r}=ke(Ae),[a,n]=Oe("word"),[l,u]=Oe("");async function d(){l!==""&&(await t.ngHandler.addNG(a,l),u(""),e())}return D.createElement("div",{className:"ngInput"},D.createElement("select",{className:"form-select ngSelect",value:a,onChange:c=>n(c.target.value)},D.createElement("option",{selected:!0},"NG\u306E\u7A2E\u985E"),D.createElement("option",{value:"word"},"\u30B3\u30E1\u30F3\u30C8"),D.createElement("option",{value:"command"},"\u30B3\u30DE\u30F3\u30C9"),D.createElement("option",{value:"user"},"\u30E6\u30FC\u30B6\u30FCID")),D.createElement("div",{className:"input-group mb-3"},D.createElement("input",{type:"text",className:"form-control",placeholder:`${a==="user"?"\u30E6\u30FC\u30B6\u30FCID":a==="command"?"\u30B3\u30DE\u30F3\u30C9":"\u30B3\u30E1\u30F3\u30C8"}\u3092\u5165\u529B`,value:l,onChange:c=>u(c.target.value)}),D.createElement("button",{className:"btn btn-outline-secondary",type:"button",onClick:d},"\u8FFD\u52A0")))};var $m=({isExpanded:e,close:t})=>{let{state:r,dispatch:a}=ke(Ae),[n,l]=Oe([]),[u,d]=Oe(!1);return Qe(()=>{(async()=>{let f=await r.ngHandler.getNGData(),g=[];function p(y,E){return y.map(T=>({ngType:E,value:T,remove:async()=>{await r.ngHandler.removeNG(E,T),d(!1)}}))}g.pushRange(p(f.words,"word")),g.pushRange(p(f.users,"user")),g.pushRange(p(f.commands,"command")),d(!0),l(g)})()},[u]),D.createElement("div",{className:`ngWrapper ${e?"":"collapsed"}`},D.createElement("div",{className:"listControler"},D.createElement("p",null,"NG\u8A2D\u5B9A"),D.createElement("p",{className:"close",onClick:t},D.createElement("i",{className:"fa-solid fa-x"}))),D.createElement("div",{className:"ngList"},n.map(c=>D.createElement(Um,{key:`${c.value}-${c.ngType}`,data:c}))),D.createElement(Bm,{onAdd:()=>d(!1)}))};var Xo=!0,Gm=()=>{let{state:e,dispatch:t}=ke(Ae),[r,a]=Oe(!0),[n,l]=Oe(!1),[u,d]=Oe(!0),c=tt(null),f=tt(""),g=tt(Date.now());Xo=u;function p(){return f.current===""?!0:e.commentManager===void 0?!1:f.current!==e.commentManager.currentID}function y(){Xo&&(g.current=Date.now(),d(!1),setTimeout(()=>{Date.now()-g.current<1e4||d(!0)},1e4))}Qe(()=>{p()&&e.commentManager!==void 0&&(e.commentManager.on("commentAdded",S=>{if(!Xo)return;let T=30*(S.innnerIndex+1-12);T<0&&(T=0),c.current?.scrollTo(0,T)}),f.current=e.jsWatchInfo?.video.niconicoID??"")});let E=e.comments?.comments.map(S=>D.createElement(Fm,{key:S.number,comment:S}));return D.createElement("div",{className:"commentWrapper"},D.createElement("div",{className:"listControler",onClick:()=>a(!r)},D.createElement("p",null,"\u30B3\u30E1\u30F3\u30C8\u30EA\u30B9\u30C8"),D.createElement("p",null,r?"\u2227":"\u2228")),D.createElement($m,{isExpanded:n,close:()=>l(!1)}),D.createElement("div",{className:`autoScroll form-check form-switch form-check-reverse ${r?"":"collapsed"}`},D.createElement("input",{className:"form-check-input",type:"checkbox",role:"switch",id:"commentScrollSwitch",checked:u,onChange:()=>d(!u)}),D.createElement("label",{className:"form-check-label",htmlFor:"commentScrollSwitch"},"\u81EA\u52D5\u30B9\u30AF\u30ED\u30FC\u30EB"),D.createElement("p",{className:"ngToggle",title:"NG\u8A2D\u5B9A",onClick:()=>l(!0)},D.createElement("i",{className:"fa-regular fa-thumbs-down fa-lg"}))),D.createElement("div",{className:`${r?"commentList":"commentList collapsed"}`,ref:c,onWheel:y},D.createElement("div",{className:"commentItem commentHeader"},D.createElement("div",{className:"commentContent"},"\u30B3\u30E1\u30F3\u30C8"),D.createElement("div",{className:"commentTime"},"\u518D\u751F\u6642\u9593"),D.createElement("div",{className:"commentNumber"},"\u30B3\u30E1\u756A"),D.createElement("div",{className:"commentPostedAt"},"\u6295\u7A3F\u6642\u523B")),E))};var Qo=class{listeners={};_messages=[];get messages(){return this._messages}log(t,r){let a=this.createLog("log",t,r);this.writeLog(a)}error(t){let r=this.createLog("error",t);this.writeLog(r)}warn(t){let r=this.createLog("warn",t);this.writeLog(r)}debug(t){}clear(){this._messages.splice(0),this.listeners.write!==void 0&&this.listeners.write.forEach(t=>t(null))}addEventListner(t,r){this.listeners[t]===void 0&&(this.listeners[t]=[]),this.listeners[t].push(r)}removeEventListner(t,r){this.listeners[t]!==void 0&&(this.listeners[t]=this.listeners[t].filter(a=>a!==r))}createLog(t,r,a){return{message:r,type:t,time:new Date,border:a??!1}}writeLog(t){this.listeners.write!==void 0&&this.listeners.write.forEach(r=>r(t)),this._messages.push(t)}},_e=new Qo;var Vm=({video:e,baseURL:t})=>{let{state:r,dispatch:a}=ke(Ae),n=new Date(e.uploadedAt),l=`${n.getFullYear()}/${(n.getMonth()+1).toString().padStart(2,"0")}/${n.getDate().toString().padStart(2,"0")} ${n.getHours().toString().padStart(2,"0")}:${n.getMinutes().toString().padStart(2,"0")}`,u;e.viewCount>1e4?u=`${Math.floor(e.viewCount/1e3)/10}\u4E07`:u=e.viewCount.toString();function d(c){_e.clear(),globalThis.scrollTo(0,0),_e.log(`${c}\u306E\u8AAD\u307F\u8FBC\u307F\u3092\u958B\u59CB\u3057\u307E\u3059\u3002`,!0);let f=`${t}${c}.json`;fetch(f).then(g=>g.json()).then(g=>{a({type:"jsWatchInfo",payload:g}),a({type:"isPlaying",payload:!1})}).catch(()=>{})}return D.createElement("div",{className:"playlistVideo",onClick:()=>d(e.niconicoID)},D.createElement("div",{className:"thumbnail"},D.createElement("img",{src:e.thumbnailURL})),D.createElement("div",{className:"videoInfo"},D.createElement("p",{className:"title"},e.title),D.createElement("p",{className:"other"},D.createElement("span",null,l,"\u6295\u7A3F\u30FB",u,"\u56DE\u518D\u751F"))))};var Hm=({videos:e,baseURL:t})=>D.createElement("div",{className:"playlist"},e.map(r=>D.createElement(Vm,{video:r,baseURL:t})));var Km=()=>{let{state:e,dispatch:t}=ke(Ae);function r(l){t({type:"contextMenu",payload:{open:!1,left:0,top:0}})}function a(){t({type:"contextMenu",payload:{open:!1,left:0,top:0}}),t({type:"systemMessage",payload:!0})}function n(){t({type:"contextMenu",payload:{open:!1,left:0,top:0}}),t({type:"shortcut",payload:!0})}return D.createElement("div",{className:"contextMenuWrapper",onClick:l=>r(l)},D.createElement("div",{className:`contextMenu ${e.contextMenu.open?"":"hide"}`,style:{left:`${e.contextMenu.left}px`,top:`${e.contextMenu.top}px`}},D.createElement("div",{className:"menuItem",onClick:a},"\u30B7\u30B9\u30C6\u30E0\u30E1\u30C3\u30BB\u30FC\u30B8\u3092\u958B\u304F"),D.createElement("div",{className:"menuItem",onClick:n},"\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\u4E00\u89A7\u3092\u958B\u304F")))};var zm=()=>{let{state:e,dispatch:t}=ke(Ae);function r(){t({type:"shortcut",payload:!1})}return D.createElement("div",{className:`shortcut ${e.isShortcutVisible?"":"hidden"}`},D.createElement("div",{className:"header"},D.createElement("p",null,"\u30B7\u30E7\u30FC\u30C8\u30AB\u30C3\u30C8\u30AD\u30FC \u4E00\u89A7"),D.createElement("p",{className:"closeButton",onClick:r},D.createElement("i",{className:"fa-solid fa-xmark fa-lg"}))),D.createElement("div",{className:"content"},D.createElement("p",{className:"section"},"\u52D5\u753B\u518D\u751F"),D.createElement("div",{className:"item"},D.createElement("p",null,"\u518D\u751F\u30FB\u4E00\u6642\u505C\u6B62"),D.createElement("p",null,"space / k")),D.createElement("div",{className:"item"},D.createElement("p",null,"\u30B3\u30E1\u30F3\u30C8\u8868\u793A\u30FB\u975E\u8868\u793A"),D.createElement("p",null,"c")),D.createElement("div",{className:"item"},D.createElement("p",null,"10\u79D2\u9032\u3081\u308B"),D.createElement("p",null,"\u2192 / l")),D.createElement("div",{className:"item"},D.createElement("p",null,"10\u79D2\u623B\u3059"),D.createElement("p",null,"\u2190 / j")),D.createElement("div",{className:"item"},D.createElement("p",null,"\u52D5\u753B\u306E\u6700\u521D\u306B\u79FB\u52D5"),D.createElement("p",null,"home"))))};function nn(e){return e.filter((t,r,a)=>a.indexOf(t)===r)}var ln=class{_ngDataFetcher;_ngData;constructor(t){this._ngDataFetcher=t}async addNG(t,r){return await this._ngDataFetcher.addNG(t,r),this._ngData===void 0&&(this._ngData=await this._ngDataFetcher.getNGData()),t==="word"?this._ngData.words=nn([...this._ngData.words,r]):t==="user"?this._ngData.users=nn([...this._ngData.users,r]):t==="command"&&(this._ngData.commands=nn([...this._ngData.commands,r])),_e.log(`NG\u8A2D\u5B9A\u3092\u8FFD\u52A0\u3057\u307E\u3057\u305F\u3002\u7A2E\u985E:${t} \u5024:${r}`),this._ngData}async removeNG(t,r){return await this._ngDataFetcher.removeNG(t,r),this._ngData===void 0&&(this._ngData=await this._ngDataFetcher.getNGData()),t==="word"?this._ngData.words=this._ngData.words.filter(a=>a!==r):t==="user"?this._ngData.users=this._ngData.users.filter(a=>a!==r):t==="command"&&(this._ngData.commands=this._ngData.commands.filter(a=>a!==r)),_e.log(`NG\u8A2D\u5B9A\u3092\u524A\u9664\u3057\u307E\u3057\u305F\u3002\u7A2E\u985E:${t} \u5024:${r}`),this._ngData}async getNGData(){return this._ngData===void 0&&(this._ngData=await this._ngDataFetcher.getNGData()),this._ngData}async filterNG(t){this._ngData===void 0&&(this._ngData=await this.getNGData());let r=0,a=t.filter(n=>{let l=!0;return this._ngData.words.forEach(u=>{if(n.body.includes(u)){l=!1,r++,_e.debug(`filtered: "${n.body}" due to rule "${u}", type: word`);return}}),!(!l||(this._ngData.users.forEach(u=>{if(n.userID===u){l=!1,r++,_e.debug(`filtered: "${n.body}" due to rule "${u}", type: user`);return}}),!l)||(this._ngData.commands.forEach(u=>{if(n.mail.includes(u)){l=!1,r++,_e.debug(`filtered: "${n.body}" due to rule "${u}", type: command`);return}}),!l))});return _e.log(`NG\u30D5\u30A3\u30EB\u30BF\u30EA\u30F3\u30B0\u3092\u5B9F\u884C\u3057\u307E\u3057\u305F\u3002${t.length}\u4EF6\u4E2D${r}\u4EF6\u304C\u30D5\u30A3\u30EB\u30BF\u30EA\u30F3\u30B0\u3055\u308C\u307E\u3057\u305F\u3002`),a.map((n,l)=>(n.innnerIndex=l,n))}};var on=class{constructor(t){this._baseURL=t}_baseURL;async addNG(t,r){let a=new URL(`${this._baseURL}/set`),n={type:t,value:r};await fetch(a.toString(),{method:"POST",body:JSON.stringify(n)})}async removeNG(t,r){let a=new URL(`${this._baseURL}/delete`),n={type:t,value:r};await fetch(a.toString(),{method:"POST",body:JSON.stringify(n)})}async getNGData(){let t=new URL(`${this._baseURL}/get`),a=await(await fetch(t.toString())).json();return{words:a.words,users:a.users,commands:a.commands}}};function dE(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Qg={exports:{}};(function(e,t){(function(r){var a=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,l=/(?:\/|^)\.(?=\/)/g,u=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,d={buildAbsoluteURL:function(c,f,g){if(g=g||{},c=c.trim(),f=f.trim(),!f){if(!g.alwaysNormalize)return c;var p=d.parseURL(c);if(!p)throw new Error("Error trying to parse base URL.");return p.path=d.normalizePath(p.path),d.buildURLFromParts(p)}var y=d.parseURL(f);if(!y)throw new Error("Error trying to parse relative URL.");if(y.scheme)return g.alwaysNormalize?(y.path=d.normalizePath(y.path),d.buildURLFromParts(y)):f;var E=d.parseURL(c);if(!E)throw new Error("Error trying to parse base URL.");if(!E.netLoc&&E.path&&E.path[0]!=="/"){var S=n.exec(E.path);E.netLoc=S[1],E.path=S[2]}E.netLoc&&!E.path&&(E.path="/");var T={scheme:E.scheme,netLoc:y.netLoc,path:null,params:y.params,query:y.query,fragment:y.fragment};if(!y.netLoc&&(T.netLoc=E.netLoc,y.path[0]!=="/"))if(!y.path)T.path=E.path,y.params||(T.params=E.params,y.query||(T.query=E.query));else{var k=E.path,C=k.substring(0,k.lastIndexOf("/")+1)+y.path;T.path=d.normalizePath(C)}return T.path===null&&(T.path=g.alwaysNormalize?d.normalizePath(y.path):y.path),d.buildURLFromParts(T)},parseURL:function(c){var f=a.exec(c);return f?{scheme:f[1]||"",netLoc:f[2]||"",path:f[3]||"",params:f[4]||"",query:f[5]||"",fragment:f[6]||""}:null},normalizePath:function(c){for(c=c.split("").reverse().join("").replace(l,"");c.length!==(c=c.replace(u,"")).length;);return c.split("").reverse().join("")},buildURLFromParts:function(c){return c.scheme+c.netLoc+c.path+c.params+c.query+c.fragment}};e.exports=d})()})(Qg);var Uu=Qg.exports;function Wm(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),r.push.apply(r,a)}return r}function ut(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Wm(Object(r),!0).forEach(function(a){fE(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Wm(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function cE(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var a=r.call(e,t||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function hE(e){var t=cE(e,"string");return typeof t=="symbol"?t:String(t)}function fE(e,t,r){return t=hE(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Je(){return Je=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},Je.apply(this,arguments)}var oe=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)},mE=Number.isSafeInteger||function(e){return typeof e=="number"&&Math.abs(e)<=gE},gE=Number.MAX_SAFE_INTEGER||9007199254740991,b=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",e}({}),Se=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),B=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown",e}({}),ri=function(){},Eu={trace:ri,debug:ri,log:ri,warn:ri,info:ri,error:ri},Oa=Eu;function pE(e){let t=self.console[e];return t?t.bind(self.console,`[${e}] >`):ri}function vE(e,...t){t.forEach(function(r){Oa[r]=e[r]?e[r].bind(e):pE(r)})}function yE(e,t){if(typeof console=="object"&&e===!0||typeof e=="object"){vE(e,"debug","log","info","warn","error");try{Oa.log(`Debug logs enabled for "${t}" in hls.js version 1.5.8`)}catch{Oa=Eu}}else Oa=Eu}var P=Oa,EE=/^(\d+)x(\d+)$/,jm=/(.+?)=(".*?"|.*?)(?:,|$)/g,qe=class Jg{constructor(t){typeof t=="string"&&(t=Jg.parseAttrList(t)),Je(this,t)}get clientAttrs(){return Object.keys(this).filter(t=>t.substring(0,2)==="X-")}decimalInteger(t){let r=parseInt(this[t],10);return r>Number.MAX_SAFE_INTEGER?1/0:r}hexadecimalInteger(t){if(this[t]){let r=(this[t]||"0x").slice(2);r=(r.length&1?"0":"")+r;let a=new Uint8Array(r.length/2);for(let n=0;n<r.length/2;n++)a[n]=parseInt(r.slice(n*2,n*2+2),16);return a}else return null}hexadecimalIntegerAsNumber(t){let r=parseInt(this[t],16);return r>Number.MAX_SAFE_INTEGER?1/0:r}decimalFloatingPoint(t){return parseFloat(this[t])}optionalFloat(t,r){let a=this[t];return a?parseFloat(a):r}enumeratedString(t){return this[t]}bool(t){return this[t]==="YES"}decimalResolution(t){let r=EE.exec(this[t]);if(r!==null)return{width:parseInt(r[1],10),height:parseInt(r[2],10)}}static parseAttrList(t){let r,a={},n='"';for(jm.lastIndex=0;(r=jm.exec(t))!==null;){let l=r[2];l.indexOf(n)===0&&l.lastIndexOf(n)===l.length-1&&(l=l.slice(1,-1));let u=r[1].trim();a[u]=l}return a}};function SE(e){return e!=="ID"&&e!=="CLASS"&&e!=="START-DATE"&&e!=="DURATION"&&e!=="END-DATE"&&e!=="END-ON-NEXT"}function TE(e){return e==="SCTE35-OUT"||e==="SCTE35-IN"}var Zg=class{constructor(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){let r=t.attr;for(let a in r)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==r[a]){P.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=Je(new qe({}),r,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){let r=new Date(this.attr["END-DATE"]);oe(r.getTime())&&(this._endDate=r)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;let e=this.duration;return e!==null?new Date(this._startDate.getTime()+e*1e3):null}get duration(){if("DURATION"in this.attr){let e=this.attr.decimalFloatingPoint("DURATION");if(oe(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&oe(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}},Un=class{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},Pe={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},ep=class{constructor(e){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[Pe.AUDIO]:null,[Pe.VIDEO]:null,[Pe.AUDIOVIDEO]:null},this.baseurl=e}setByteRange(e,t){let r=e.split("@",2),a;r.length===1?a=t?.byteRangeEndOffset||0:a=parseInt(r[1]),this._byteRange=[a,parseInt(r[0])+a]}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Uu.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}},Jo=class extends ep{constructor(e,t){super(t),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new Un,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get decryptdata(){let{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){let t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{let r=Object.keys(this.levelkeys);if(r.length===1)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!oe(this.programDateTime))return null;let e=oe(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){let t=Object.keys(this.levelkeys),r=t.length;if(r>1||r===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}setKeyFormat(e){if(this.levelkeys){let t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,r,a,n,l=!1){let{elementaryStreams:u}=this,d=u[e];if(!d){u[e]={startPTS:t,endPTS:r,startDTS:a,endDTS:n,partial:l};return}d.startPTS=Math.min(d.startPTS,t),d.endPTS=Math.max(d.endPTS,r),d.startDTS=Math.min(d.startDTS,a),d.endDTS=Math.max(d.endDTS,n)}clearElementaryStreamInfo(){let{elementaryStreams:e}=this;e[Pe.AUDIO]=null,e[Pe.VIDEO]=null,e[Pe.AUDIOVIDEO]=null}},bE=class extends ep{constructor(e,t,r,a,n){super(r),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new Un,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=a;let l=e.enumeratedString("BYTERANGE");l&&this.setByteRange(l,n),n&&(this.fragOffset=n.fragOffset+n.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){let{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}},LE=10,kE=class{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}let t=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&r>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?oe(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||LE}get drift(){let e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}};function Bu(e){return Uint8Array.from(atob(e),t=>t.charCodeAt(0))}function AE(e){let t=Su(e).subarray(0,16),r=new Uint8Array(16);return r.set(t,16-t.length),r}function wE(e){let t=function(r,a,n){let l=r[a];r[a]=r[n],r[n]=l};t(e,0,3),t(e,1,2),t(e,4,5),t(e,6,7)}function RE(e){let t=e.split(":"),r=null;if(t[0]==="data"&&t.length===2){let a=t[1].split(";"),n=a[a.length-1].split(",");if(n.length===2){let l=n[0]==="base64",u=n[1];l?(a.splice(-1,1),r=Bu(u)):r=AE(u)}}return r}function Su(e){return Uint8Array.from(unescape(encodeURIComponent(e)),t=>t.charCodeAt(0))}var Fa=typeof self<"u"?self:void 0,$e={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Rt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Ym(e){switch(e){case Rt.FAIRPLAY:return $e.FAIRPLAY;case Rt.PLAYREADY:return $e.PLAYREADY;case Rt.WIDEVINE:return $e.WIDEVINE;case Rt.CLEARKEY:return $e.CLEARKEY}}var tp={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function DE(e){if(e===tp.WIDEVINE)return $e.WIDEVINE}function qm(e){switch(e){case $e.FAIRPLAY:return Rt.FAIRPLAY;case $e.PLAYREADY:return Rt.PLAYREADY;case $e.WIDEVINE:return Rt.WIDEVINE;case $e.CLEARKEY:return Rt.CLEARKEY}}function Zo(e){let{drmSystems:t,widevineLicenseUrl:r}=e,a=t?[$e.FAIRPLAY,$e.WIDEVINE,$e.PLAYREADY,$e.CLEARKEY].filter(n=>!!t[n]):[];return!a[$e.WIDEVINE]&&r&&a.push($e.WIDEVINE),a}var rp=function(e){return Fa!=null&&(e=Fa.navigator)!=null&&e.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function IE(e,t,r,a){let n;switch(e){case $e.FAIRPLAY:n=["cenc","sinf"];break;case $e.WIDEVINE:case $e.PLAYREADY:n=["cenc"];break;case $e.CLEARKEY:n=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${e}`)}return CE(n,t,r,a)}function CE(e,t,r,a){return[{initDataTypes:e,persistentState:a.persistentState||"optional",distinctiveIdentifier:a.distinctiveIdentifier||"optional",sessionTypes:a.sessionTypes||[a.sessionType||"temporary"],audioCapabilities:t.map(n=>({contentType:`audio/mp4; codecs="${n}"`,robustness:a.audioRobustness||"",encryptionScheme:a.audioEncryptionScheme||null})),videoCapabilities:r.map(n=>({contentType:`video/mp4; codecs="${n}"`,robustness:a.videoRobustness||"",encryptionScheme:a.videoEncryptionScheme||null}))}]}function si(e,t,r){return Uint8Array.prototype.slice?e.slice(t,r):new Uint8Array(Array.prototype.slice.call(e,t,r))}var $u=(e,t)=>t+10<=e.length&&e[t]===73&&e[t+1]===68&&e[t+2]===51&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,ip=(e,t)=>t+10<=e.length&&e[t]===51&&e[t+1]===68&&e[t+2]===73&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128,Ua=(e,t)=>{let r=t,a=0;for(;$u(e,t);){a+=10;let n=Bn(e,t+6);a+=n,ip(e,t+10)&&(a+=10),t+=a}if(a>0)return e.subarray(r,r+a)},Bn=(e,t)=>{let r=0;return r=(e[t]&127)<<21,r|=(e[t+1]&127)<<14,r|=(e[t+2]&127)<<7,r|=e[t+3]&127,r},_E=(e,t)=>$u(e,t)&&Bn(e,t+6)+10<=e.length-t,Gu=e=>{let t=sp(e);for(let r=0;r<t.length;r++){let a=t[r];if(ap(a))return FE(a)}},ap=e=>e&&e.key==="PRIV"&&e.info==="com.apple.streaming.transportStreamTimestamp",xE=e=>{let t=String.fromCharCode(e[0],e[1],e[2],e[3]),r=Bn(e,4),a=10;return{type:t,size:r,data:e.subarray(a,a+r)}},sp=e=>{let t=0,r=[];for(;$u(e,t);){let a=Bn(e,t+6);t+=10;let n=t+a;for(;t+8<n;){let l=xE(e.subarray(t)),u=PE(l);u&&r.push(u),t+=l.size+10}ip(e,t)&&(t+=10)}return r},PE=e=>e.type==="PRIV"?ME(e):e.type[0]==="W"?OE(e):NE(e),ME=e=>{if(e.size<2)return;let t=lr(e.data,!0),r=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:r.buffer}},NE=e=>{if(e.size<2)return;if(e.type==="TXXX"){let r=1,a=lr(e.data.subarray(r),!0);r+=a.length+1;let n=lr(e.data.subarray(r));return{key:e.type,info:a,data:n}}let t=lr(e.data.subarray(1));return{key:e.type,data:t}},OE=e=>{if(e.type==="WXXX"){if(e.size<2)return;let r=1,a=lr(e.data.subarray(r),!0);r+=a.length+1;let n=lr(e.data.subarray(r));return{key:e.type,info:a,data:n}}let t=lr(e.data);return{key:e.type,data:t}},FE=e=>{if(e.data.byteLength===8){let t=new Uint8Array(e.data),r=t[3]&1,a=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return a/=45,r&&(a+=4772185884e-2),Math.round(a)}},lr=(e,t=!1)=>{let r=UE();if(r){let f=r.decode(e);if(t){let g=f.indexOf("\0");return g!==-1?f.substring(0,g):f}return f.replace(/\0/g,"")}let a=e.length,n,l,u,d="",c=0;for(;c<a;){if(n=e[c++],n===0&&t)return d;if(!(n===0||n===3))switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(n);break;case 12:case 13:l=e[c++],d+=String.fromCharCode((n&31)<<6|l&63);break;case 14:l=e[c++],u=e[c++],d+=String.fromCharCode((n&15)<<12|(l&63)<<6|(u&63)<<0);break}}return d},eu;function UE(){if(!navigator.userAgent.includes("PlayStation 4"))return!eu&&typeof self.TextDecoder<"u"&&(eu=new self.TextDecoder("utf-8")),eu}var ar={hexDump:function(e){let t="";for(let r=0;r<e.length;r++){let a=e[r].toString(16);a.length<2&&(a="0"+a),t+=a}return t}},Dn=Math.pow(2,32)-1,BE=[].push,np={video:1,audio:2,id3:3,text:4};function rt(e){return String.fromCharCode.apply(null,e)}function lp(e,t){let r=e[t]<<8|e[t+1];return r<0?65536+r:r}function ye(e,t){let r=op(e,t);return r<0?4294967296+r:r}function Xm(e,t){let r=ye(e,t);return r*=Math.pow(2,32),r+=ye(e,t+4),r}function op(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function tu(e,t,r){e[t]=r>>24,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=r&255}function $E(e){let t=e.byteLength;for(let r=0;r<t;){let a=ye(e,r);if(a>8&&e[r+4]===109&&e[r+5]===111&&e[r+6]===111&&e[r+7]===102)return!0;r=a>1?r+a:t}return!1}function Le(e,t){let r=[];if(!t.length)return r;let a=e.byteLength;for(let n=0;n<a;){let l=ye(e,n),u=rt(e.subarray(n+4,n+8)),d=l>1?n+l:a;if(u===t[0])if(t.length===1)r.push(e.subarray(n+8,d));else{let c=Le(e.subarray(n+8,d),t.slice(1));c.length&&BE.apply(r,c)}n=d}return r}function GE(e){let t=[],r=e[0],a=8,n=ye(e,a);a+=4;let l=0,u=0;r===0?(l=ye(e,a),u=ye(e,a+4),a+=8):(l=Xm(e,a),u=Xm(e,a+8),a+=16),a+=2;let d=e.length+u,c=lp(e,a);a+=2;for(let f=0;f<c;f++){let g=a,p=ye(e,g);g+=4;let y=p&2147483647;if((p&2147483648)>>>31===1)return P.warn("SIDX has hierarchical references (not supported)"),null;let E=ye(e,g);g+=4,t.push({referenceSize:y,subsegmentDuration:E,info:{duration:E/n,start:d,end:d+y-1}}),d+=y,g+=4,a=g}return{earliestPresentationTime:l,timescale:n,version:r,referencesCount:c,references:t}}function up(e){let t=[],r=Le(e,["moov","trak"]);for(let a=0;a<r.length;a++){let n=r[a],l=Le(n,["tkhd"])[0];if(l){let u=l[0],d=ye(l,u===0?12:20),c=Le(n,["mdia","mdhd"])[0];if(c){u=c[0];let f=ye(c,u===0?12:20),g=Le(n,["mdia","hdlr"])[0];if(g){let p=rt(g.subarray(8,12)),y={soun:Pe.AUDIO,vide:Pe.VIDEO}[p];if(y){let E=Le(n,["mdia","minf","stbl","stsd"])[0],S=VE(E);t[d]={timescale:f,type:y},t[y]=ut({timescale:f,id:d},S)}}}}}return Le(e,["moov","mvex","trex"]).forEach(a=>{let n=ye(a,4),l=t[n];l&&(l.default={duration:ye(a,12),flags:ye(a,20)})}),t}function VE(e){let t=e.subarray(8),r=t.subarray(86),a=rt(t.subarray(4,8)),n=a,l=a==="enca"||a==="encv";if(l){let u=Le(t,[a])[0].subarray(a==="enca"?28:78);Le(u,["sinf"]).forEach(d=>{let c=Le(d,["schm"])[0];if(c){let f=rt(c.subarray(4,8));if(f==="cbcs"||f==="cenc"){let g=Le(d,["frma"])[0];g&&(n=rt(g))}}})}switch(n){case"avc1":case"avc2":case"avc3":case"avc4":{let u=Le(r,["avcC"])[0];n+="."+un(u[1])+un(u[2])+un(u[3]);break}case"mp4a":{let u=Le(t,[a])[0],d=Le(u.subarray(28),["esds"])[0];if(d&&d.length>12){let c=4;if(d[c++]!==3)break;c=ru(d,c),c+=2;let f=d[c++];if(f&128&&(c+=2),f&64&&(c+=d[c++]),d[c++]!==4)break;c=ru(d,c);let g=d[c++];if(g===64)n+="."+un(g);else break;if(c+=12,d[c++]!==5)break;c=ru(d,c);let p=d[c++],y=(p&248)>>3;y===31&&(y+=1+((p&7)<<3)+((d[c]&224)>>5)),n+="."+y}break}case"hvc1":case"hev1":{let u=Le(r,["hvcC"])[0],d=u[1],c=["","A","B","C"][d>>6],f=d&31,g=ye(u,2),p=(d&32)>>5?"H":"L",y=u[12],E=u.subarray(6,12);n+="."+c+f,n+="."+g.toString(16).toUpperCase(),n+="."+p+y;let S="";for(let T=E.length;T--;){let k=E[T];(k||S)&&(S="."+k.toString(16).toUpperCase()+S)}n+=S;break}case"dvh1":case"dvhe":{let u=Le(r,["dvcC"])[0],d=u[2]>>1&127,c=u[2]<<5&32|u[3]>>3&31;n+="."+ir(d)+"."+ir(c);break}case"vp09":{let u=Le(r,["vpcC"])[0],d=u[4],c=u[5],f=u[6]>>4&15;n+="."+ir(d)+"."+ir(c)+"."+ir(f);break}case"av01":{let u=Le(r,["av1C"])[0],d=u[1]>>>5,c=u[1]&31,f=u[2]>>>7?"H":"M",g=(u[2]&64)>>6,p=(u[2]&32)>>5,y=d===2&&g?p?12:10:g?10:8,E=(u[2]&16)>>4,S=(u[2]&8)>>3,T=(u[2]&4)>>2,k=u[2]&3;n+="."+d+"."+ir(c)+f+"."+ir(y)+"."+E+"."+S+T+k+"."+ir(1)+"."+ir(1)+"."+ir(1)+".0";break}}return{codec:n,encrypted:l}}function ru(e,t){let r=t+5;for(;e[t++]&128&&t<r;);return t}function un(e){return("0"+e.toString(16).toUpperCase()).slice(-2)}function ir(e){return(e<10?"0":"")+e}function HE(e,t){if(!e||!t)return e;let r=t.keyId;return r&&t.isCommonEncryption&&Le(e,["moov","trak"]).forEach(a=>{let n=Le(a,["mdia","minf","stbl","stsd"])[0].subarray(8),l=Le(n,["enca"]),u=l.length>0;u||(l=Le(n,["encv"])),l.forEach(d=>{let c=u?d.subarray(28):d.subarray(78);Le(c,["sinf"]).forEach(f=>{let g=dp(f);if(g){let p=g.subarray(8,24);p.some(y=>y!==0)||(P.log(`[eme] Patching keyId in 'enc${u?"a":"v"}>sinf>>tenc' box: ${ar.hexDump(p)} -> ${ar.hexDump(r)}`),g.set(r,8))}})})}),e}function dp(e){let t=Le(e,["schm"])[0];if(t){let r=rt(t.subarray(4,8));if(r==="cbcs"||r==="cenc")return Le(e,["schi","tenc"])[0]}return P.error("[eme] missing 'schm' box"),null}function KE(e,t){return Le(t,["moof","traf"]).reduce((r,a)=>{let n=Le(a,["tfdt"])[0],l=n[0],u=Le(a,["tfhd"]).reduce((d,c)=>{let f=ye(c,4),g=e[f];if(g){let p=ye(n,4);if(l===1){if(p===Dn)return P.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),d;p*=Dn+1,p+=ye(n,8)}let y=g.timescale||9e4,E=p/y;if(oe(E)&&(d===null||E<d))return E}return d},null);return u!==null&&oe(u)&&(r===null||u<r)?u:r},null)}function zE(e,t){let r=0,a=0,n=0,l=Le(e,["moof","traf"]);for(let u=0;u<l.length;u++){let d=l[u],c=Le(d,["tfhd"])[0],f=ye(c,4),g=t[f];if(!g)continue;let p=g.default,y=ye(c,0)|p?.flags,E=p?.duration;y&8&&(y&2?E=ye(c,12):E=ye(c,8));let S=g.timescale||9e4,T=Le(d,["trun"]);for(let k=0;k<T.length;k++){if(r=WE(T[k]),!r&&E){let C=ye(T[k],4);r=E*C}g.type===Pe.VIDEO?a+=r/S:g.type===Pe.AUDIO&&(n+=r/S)}}if(a===0&&n===0){let u=1/0,d=0,c=0,f=Le(e,["sidx"]);for(let g=0;g<f.length;g++){let p=GE(f[g]);if(p!=null&&p.references){u=Math.min(u,p.earliestPresentationTime/p.timescale);let y=p.references.reduce((E,S)=>E+S.info.duration||0,0);d=Math.max(d,y+p.earliestPresentationTime/p.timescale),c=d-u}}if(c&&oe(c))return c}return a||n}function WE(e){let t=ye(e,0),r=8;t&1&&(r+=4),t&4&&(r+=4);let a=0,n=ye(e,4);for(let l=0;l<n;l++){if(t&256){let u=ye(e,r);a+=u,r+=4}t&512&&(r+=4),t&1024&&(r+=4),t&2048&&(r+=4)}return a}function jE(e,t,r){Le(t,["moof","traf"]).forEach(a=>{Le(a,["tfhd"]).forEach(n=>{let l=ye(n,4),u=e[l];if(!u)return;let d=u.timescale||9e4;Le(a,["tfdt"]).forEach(c=>{let f=c[0],g=r*d;if(g){let p=ye(c,4);if(f===0)p-=g,p=Math.max(p,0),tu(c,4,p);else{p*=Math.pow(2,32),p+=ye(c,8),p-=g,p=Math.max(p,0);let y=Math.floor(p/(Dn+1)),E=Math.floor(p%(Dn+1));tu(c,4,y),tu(c,8,E)}}})})})}function YE(e){let t={valid:null,remainder:null},r=Le(e,["moof"]);if(r.length<2)return t.remainder=e,t;let a=r[r.length-1];return t.valid=si(e,0,a.byteOffset-8),t.remainder=si(e,a.byteOffset-8),t}function $t(e,t){let r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function Qm(e,t){let r=[],a=t.samples,n=t.timescale,l=t.id,u=!1;return Le(a,["moof"]).map(d=>{let c=d.byteOffset-8;Le(d,["traf"]).map(f=>{let g=Le(f,["tfdt"]).map(p=>{let y=p[0],E=ye(p,4);return y===1&&(E*=Math.pow(2,32),E+=ye(p,8)),E/n})[0];return g!==void 0&&(e=g),Le(f,["tfhd"]).map(p=>{let y=ye(p,4),E=ye(p,0)&16777215,S=(E&1)!==0,T=(E&2)!==0,k=(E&8)!==0,C=0,I=(E&16)!==0,O=0,x=(E&32)!==0,$=8;y===l&&(S&&($+=8),T&&($+=4),k&&(C=ye(p,$),$+=4),I&&(O=ye(p,$),$+=4),x&&($+=4),t.type==="video"&&(u=qE(t.codec)),Le(f,["trun"]).map(G=>{let K=G[0],Q=ye(G,0)&16777215,ae=(Q&1)!==0,W=0,ee=(Q&4)!==0,ge=(Q&256)!==0,ie=0,se=(Q&512)!==0,de=0,q=(Q&1024)!==0,re=(Q&2048)!==0,H=0,te=ye(G,4),Z=8;ae&&(W=ye(G,Z),Z+=4),ee&&(Z+=4);let w=W+c;for(let V=0;V<te;V++){if(ge?(ie=ye(G,Z),Z+=4):ie=C,se?(de=ye(G,Z),Z+=4):de=O,q&&(Z+=4),re&&(K===0?H=ye(G,Z):H=op(G,Z),Z+=4),t.type===Pe.VIDEO){let he=0;for(;he<de;){let me=ye(a,w);if(w+=4,XE(u,a[w])){let Te=a.subarray(w,w+me);cp(Te,u?2:1,e+H/n,r)}w+=me,he+=me+4}}e+=ie/n}}))})})}),r}function qE(e){if(!e)return!1;let t=e.indexOf("."),r=t<0?e:e.substring(0,t);return r==="hvc1"||r==="hev1"||r==="dvh1"||r==="dvhe"}function XE(e,t){if(e){let r=t>>1&63;return r===39||r===40}else return(t&31)===6}function cp(e,t,r,a){let n=hp(e),l=0;l+=t;let u=0,d=0,c=0;for(;l<n.length;){u=0;do{if(l>=n.length)break;c=n[l++],u+=c}while(c===255);d=0;do{if(l>=n.length)break;c=n[l++],d+=c}while(c===255);let f=n.length-l,g=l;if(d<f)l+=d;else if(d>f){P.error(`Malformed SEI payload. ${d} is too small, only ${f} bytes left to parse.`);break}if(u===4){if(n[g++]===181){let p=lp(n,g);if(g+=2,p===49){let y=ye(n,g);if(g+=4,y===1195456820){let E=n[g++];if(E===3){let S=n[g++],T=31&S,k=64&S,C=k?2+T*3:0,I=new Uint8Array(C);if(k){I[0]=S;for(let O=1;O<C;O++)I[O]=n[g++]}a.push({type:E,payloadType:u,pts:r,bytes:I})}}}}}else if(u===5&&d>16){let p=[];for(let S=0;S<16;S++){let T=n[g++].toString(16);p.push(T.length==1?"0"+T:T),(S===3||S===5||S===7||S===9)&&p.push("-")}let y=d-16,E=new Uint8Array(y);for(let S=0;S<y;S++)E[S]=n[g++];a.push({payloadType:u,pts:r,uuid:p.join(""),userData:lr(E),userDataBytes:E})}}}function hp(e){let t=e.byteLength,r=[],a=1;for(;a<t-2;)e[a]===0&&e[a+1]===0&&e[a+2]===3?(r.push(a+2),a+=2):a++;if(r.length===0)return e;let n=t-r.length,l=new Uint8Array(n),u=0;for(a=0;a<n;u++,a++)u===r[0]&&(u++,r.shift()),l[a]=e[u];return l}function QE(e){let t=e[0],r="",a="",n=0,l=0,u=0,d=0,c=0,f=0;if(t===0){for(;rt(e.subarray(f,f+1))!=="\0";)r+=rt(e.subarray(f,f+1)),f+=1;for(r+=rt(e.subarray(f,f+1)),f+=1;rt(e.subarray(f,f+1))!=="\0";)a+=rt(e.subarray(f,f+1)),f+=1;a+=rt(e.subarray(f,f+1)),f+=1,n=ye(e,12),l=ye(e,16),d=ye(e,20),c=ye(e,24),f=28}else if(t===1){f+=4,n=ye(e,f),f+=4;let p=ye(e,f);f+=4;let y=ye(e,f);for(f+=4,u=2**32*p+y,mE(u)||(u=Number.MAX_SAFE_INTEGER,P.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),d=ye(e,f),f+=4,c=ye(e,f),f+=4;rt(e.subarray(f,f+1))!=="\0";)r+=rt(e.subarray(f,f+1)),f+=1;for(r+=rt(e.subarray(f,f+1)),f+=1;rt(e.subarray(f,f+1))!=="\0";)a+=rt(e.subarray(f,f+1)),f+=1;a+=rt(e.subarray(f,f+1)),f+=1}let g=e.subarray(f,e.byteLength);return{schemeIdUri:r,value:a,timeScale:n,presentationTime:u,presentationTimeDelta:l,eventDuration:d,id:c,payload:g}}function JE(e,...t){let r=t.length,a=8,n=r;for(;n--;)a+=t[n].byteLength;let l=new Uint8Array(a);for(l[0]=a>>24&255,l[1]=a>>16&255,l[2]=a>>8&255,l[3]=a&255,l.set(e,4),n=0,a=8;n<r;n++)l.set(t[n],a),a+=t[n].byteLength;return l}function ZE(e,t,r){if(e.byteLength!==16)throw new RangeError("Invalid system id");let a,n;if(t){a=1,n=new Uint8Array(t.length*16);for(let d=0;d<t.length;d++){let c=t[d];if(c.byteLength!==16)throw new RangeError("Invalid key");n.set(c,d*16)}}else a=0,n=new Uint8Array;let l;a>0?(l=new Uint8Array(4),t.length>0&&new DataView(l.buffer).setUint32(0,t.length,!1)):l=new Uint8Array;let u=new Uint8Array(4);return r&&r.byteLength>0&&new DataView(u.buffer).setUint32(0,r.byteLength,!1),JE([112,115,115,104],new Uint8Array([a,0,0,0]),e,l,n,u,r||new Uint8Array)}function eS(e){if(!(e instanceof ArrayBuffer)||e.byteLength<32)return null;let t={version:0,systemId:"",kids:null,data:null},r=new DataView(e),a=r.getUint32(0);if(e.byteLength!==a&&a>44||r.getUint32(4)!==1886614376||(t.version=r.getUint32(8)>>>24,t.version>1))return null;t.systemId=ar.hexDump(new Uint8Array(e,12,16));let n=r.getUint32(28);if(t.version===0){if(a-32<n)return null;t.data=new Uint8Array(e,32,n)}else if(t.version===1){t.kids=[];for(let l=0;l<n;l++)t.kids.push(new Uint8Array(e,32+l*16,16))}return t}var dn={},Tu=class fp{static clearKeyUriToKeyIdMap(){dn={}}constructor(t,r,a,n=[1],l=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=t,this.uri=r,this.keyFormat=a,this.keyFormatVersions=n,this.iv=l,this.encrypted=t?t!=="NONE":!1,this.isCommonEncryption=this.encrypted&&t!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Rt.FAIRPLAY:case Rt.WIDEVINE:case Rt.PLAYREADY:case Rt.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(t){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof t!="number"&&(this.method==="AES-128"&&!this.iv&&P.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),t=0);let a=tS(t);return new fp(this.method,this.uri,"identity",this.keyFormatVersions,a)}let r=RE(this.uri);if(r)switch(this.keyFormat){case Rt.WIDEVINE:this.pssh=r,r.length>=22&&(this.keyId=r.subarray(r.length-22,r.length-6));break;case Rt.PLAYREADY:{let a=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=ZE(a,null,r);let n=new Uint16Array(r.buffer,r.byteOffset,r.byteLength/2),l=String.fromCharCode.apply(null,Array.from(n)),u=l.substring(l.indexOf("<"),l.length),d=new DOMParser().parseFromString(u,"text/xml").getElementsByTagName("KID")[0];if(d){let c=d.childNodes[0]?d.childNodes[0].nodeValue:d.getAttribute("VALUE");if(c){let f=Bu(c).subarray(0,16);wE(f),this.keyId=f}}break}default:{let a=r.subarray(0,16);if(a.length!==16){let n=new Uint8Array(16);n.set(a,16-a.length),a=n}this.keyId=a;break}}if(!this.keyId||this.keyId.byteLength!==16){let a=dn[this.uri];if(!a){let n=Object.keys(dn).length%Number.MAX_SAFE_INTEGER;a=new Uint8Array(16),new DataView(a.buffer,12,4).setUint32(0,n),dn[this.uri]=a}this.keyId=a}return this}};function tS(e){let t=new Uint8Array(16);for(let r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t}var mp=/\{\$([a-zA-Z0-9-_]+)\}/g;function Jm(e){return mp.test(e)}function wt(e,t,r){if(e.variableList!==null||e.hasVariableRefs)for(let a=r.length;a--;){let n=r[a],l=t[n];l&&(t[n]=bu(e,l))}}function bu(e,t){if(e.variableList!==null||e.hasVariableRefs){let r=e.variableList;return t.replace(mp,a=>{let n=a.substring(2,a.length-1),l=r?.[n];return l===void 0?(e.playlistParsingError||(e.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${n}"`)),a):l})}return t}function Zm(e,t,r){let a=e.variableList;a||(e.variableList=a={});let n,l;if("QUERYPARAM"in t){n=t.QUERYPARAM;try{let u=new self.URL(r).searchParams;if(u.has(n))l=u.get(n);else throw new Error(`"${n}" does not match any query parameter in URI: "${r}"`)}catch(u){e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${u.message}`))}}else n=t.NAME,l=t.VALUE;n in a?e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${n}"`)):a[n]=l||""}function rS(e,t,r){let a=t.IMPORT;if(r&&a in r){let n=e.variableList;n||(e.variableList=n={}),n[a]=r[a]}else e.playlistParsingError||(e.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${a}"`))}function ni(e=!0){return typeof self>"u"?void 0:(e||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function iS(e){return typeof self<"u"&&e===self.ManagedMediaSource}var In={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function aS(e,t){let r=In[t];return!!r&&!!r[e.slice(0,4)]}function iu(e,t,r=!0){return!e.split(",").some(a=>!gp(a,t,r))}function gp(e,t,r=!0){var a;return(a=ni(r)?.isTypeSupported(Ba(e,t)))!=null?a:!1}function Ba(e,t){return`${t}/mp4;codecs="${e}"`}function eg(e){if(e){let t=e.substring(0,4);return In.video[t]}return 2}function Cn(e){return e.split(",").reduce((t,r)=>{let a=In.video[r];return a?(a*2+t)/(t?3:2):(In.audio[r]+t)/(t?2:1)},0)}var au={};function sS(e,t=!0){if(au[e])return au[e];let r={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"]}[e];for(let a=0;a<r.length;a++)if(gp(r[a],"audio",t))return au[e]=r[a],r[a];return e}var nS=/flac|opus/i;function _n(e,t=!0){return e.replace(nS,r=>sS(r.toLowerCase(),t))}function tg(e,t){return e&&e!=="mp4a"?e:t&&t.split(",")[0]}function lS(e){let t=e.split(".");if(t.length>2){let r=t.shift()+".";return r+=parseInt(t.shift()).toString(16),r+=("000"+parseInt(t.shift()).toString(16)).slice(-4),r}return e}var rg=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,ig=/#EXT-X-MEDIA:(.*)/g,oS=/^#EXT(?:INF|-X-TARGETDURATION):/m,ag=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),uS=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),Pa=class Ma{static findGroup(t,r){for(let a=0;a<t.length;a++){let n=t[a];if(n.id===r)return n}}static resolve(t,r){return Uu.buildAbsoluteURL(r,t,{alwaysNormalize:!0})}static isMediaPlaylist(t){return oS.test(t)}static parseMasterPlaylist(t,r){let a=Jm(t),n={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:a},l=[];rg.lastIndex=0;let u;for(;(u=rg.exec(t))!=null;)if(u[1]){var d;let f=new qe(u[1]);wt(n,f,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);let g=bu(n,u[2]),p={attrs:f,bitrate:f.decimalInteger("BANDWIDTH")||f.decimalInteger("AVERAGE-BANDWIDTH"),name:f.NAME,url:Ma.resolve(g,r)},y=f.decimalResolution("RESOLUTION");y&&(p.width=y.width,p.height=y.height),dS(f.CODECS,p),(d=p.unknownCodecs)!=null&&d.length||l.push(p),n.levels.push(p)}else if(u[3]){let f=u[3],g=u[4];switch(f){case"SESSION-DATA":{let p=new qe(g);wt(n,p,["DATA-ID","LANGUAGE","VALUE","URI"]);let y=p["DATA-ID"];y&&(n.sessionData===null&&(n.sessionData={}),n.sessionData[y]=p);break}case"SESSION-KEY":{let p=sg(g,r,n);p.encrypted&&p.isSupported()?(n.sessionKeys===null&&(n.sessionKeys=[]),n.sessionKeys.push(p)):P.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${g}"`);break}case"DEFINE":{{let p=new qe(g);wt(n,p,["NAME","VALUE","QUERYPARAM"]),Zm(n,p,r)}break}case"CONTENT-STEERING":{let p=new qe(g);wt(n,p,["SERVER-URI","PATHWAY-ID"]),n.contentSteering={uri:Ma.resolve(p["SERVER-URI"],r),pathwayId:p["PATHWAY-ID"]||"."};break}case"START":{n.startTimeOffset=ng(g);break}}}let c=l.length>0&&l.length<n.levels.length;return n.levels=c?l:n.levels,n.levels.length===0&&(n.playlistParsingError=new Error("no levels found in manifest")),n}static parseMasterPlaylistMedia(t,r,a){let n,l={},u=a.levels,d={AUDIO:u.map(f=>({id:f.attrs.AUDIO,audioCodec:f.audioCodec})),SUBTITLES:u.map(f=>({id:f.attrs.SUBTITLES,textCodec:f.textCodec})),"CLOSED-CAPTIONS":[]},c=0;for(ig.lastIndex=0;(n=ig.exec(t))!==null;){let f=new qe(n[1]),g=f.TYPE;if(g){let p=d[g],y=l[g]||[];l[g]=y,wt(a,f,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);let E=f.LANGUAGE,S=f["ASSOC-LANGUAGE"],T=f.CHANNELS,k=f.CHARACTERISTICS,C=f["INSTREAM-ID"],I={attrs:f,bitrate:0,id:c++,groupId:f["GROUP-ID"]||"",name:f.NAME||E||"",type:g,default:f.bool("DEFAULT"),autoselect:f.bool("AUTOSELECT"),forced:f.bool("FORCED"),lang:E,url:f.URI?Ma.resolve(f.URI,r):""};if(S&&(I.assocLang=S),T&&(I.channels=T),k&&(I.characteristics=k),C&&(I.instreamId=C),p!=null&&p.length){let O=Ma.findGroup(p,I.groupId)||p[0];lg(I,O,"audioCodec"),lg(I,O,"textCodec")}y.push(I)}}return l}static parseLevelPlaylist(t,r,a,n,l,u){let d=new kE(r),c=d.fragments,f=null,g=0,p=0,y=0,E=0,S=null,T=new Jo(n,r),k,C,I,O=-1,x=!1,$=null;for(ag.lastIndex=0,d.m3u8=t,d.hasVariableRefs=Jm(t);(k=ag.exec(t))!==null;){x&&(x=!1,T=new Jo(n,r),T.start=y,T.sn=g,T.cc=E,T.level=a,f&&(T.initSegment=f,T.rawProgramDateTime=f.rawProgramDateTime,f.rawProgramDateTime=null,$&&(T.setByteRange($),$=null)));let ae=k[1];if(ae){T.duration=parseFloat(ae);let W=(" "+k[2]).slice(1);T.title=W||null,T.tagList.push(W?["INF",ae,W]:["INF",ae])}else if(k[3]){if(oe(T.duration)){T.start=y,I&&dg(T,I,d),T.sn=g,T.level=a,T.cc=E,c.push(T);let W=(" "+k[3]).slice(1);T.relurl=bu(d,W),og(T,S),S=T,y+=T.duration,g++,p=0,x=!0}}else if(k[4]){let W=(" "+k[4]).slice(1);S?T.setByteRange(W,S):T.setByteRange(W)}else if(k[5])T.rawProgramDateTime=(" "+k[5]).slice(1),T.tagList.push(["PROGRAM-DATE-TIME",T.rawProgramDateTime]),O===-1&&(O=c.length);else{if(k=k[0].match(uS),!k){P.warn("No matches on slow regex match for level playlist!");continue}for(C=1;C<k.length&&!(typeof k[C]<"u");C++);let W=(" "+k[C]).slice(1),ee=(" "+k[C+1]).slice(1),ge=k[C+2]?(" "+k[C+2]).slice(1):"";switch(W){case"PLAYLIST-TYPE":d.type=ee.toUpperCase();break;case"MEDIA-SEQUENCE":g=d.startSN=parseInt(ee);break;case"SKIP":{let ie=new qe(ee);wt(d,ie,["RECENTLY-REMOVED-DATERANGES"]);let se=ie.decimalInteger("SKIPPED-SEGMENTS");if(oe(se)){d.skippedSegments=se;for(let q=se;q--;)c.unshift(null);g+=se}let de=ie.enumeratedString("RECENTLY-REMOVED-DATERANGES");de&&(d.recentlyRemovedDateranges=de.split("	"));break}case"TARGETDURATION":d.targetduration=Math.max(parseInt(ee),1);break;case"VERSION":d.version=parseInt(ee);break;case"INDEPENDENT-SEGMENTS":case"EXTM3U":break;case"ENDLIST":d.live=!1;break;case"#":(ee||ge)&&T.tagList.push(ge?[ee,ge]:[ee]);break;case"DISCONTINUITY":E++,T.tagList.push(["DIS"]);break;case"GAP":T.gap=!0,T.tagList.push([W]);break;case"BITRATE":T.tagList.push([W,ee]);break;case"DATERANGE":{let ie=new qe(ee);wt(d,ie,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),wt(d,ie,ie.clientAttrs);let se=new Zg(ie,d.dateRanges[ie.ID]);se.isValid||d.skippedSegments?d.dateRanges[se.id]=se:P.warn(`Ignoring invalid DATERANGE tag: "${ee}"`),T.tagList.push(["EXT-X-DATERANGE",ee]);break}case"DEFINE":{{let ie=new qe(ee);wt(d,ie,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in ie?rS(d,ie,u):Zm(d,ie,r)}break}case"DISCONTINUITY-SEQUENCE":E=parseInt(ee);break;case"KEY":{let ie=sg(ee,r,d);if(ie.isSupported()){if(ie.method==="NONE"){I=void 0;break}I||(I={}),I[ie.keyFormat]&&(I=Je({},I)),I[ie.keyFormat]=ie}else P.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${ee}"`);break}case"START":d.startTimeOffset=ng(ee);break;case"MAP":{let ie=new qe(ee);if(wt(d,ie,["BYTERANGE","URI"]),T.duration){let se=new Jo(n,r);ug(se,ie,a,I),f=se,T.initSegment=f,f.rawProgramDateTime&&!T.rawProgramDateTime&&(T.rawProgramDateTime=f.rawProgramDateTime)}else{let se=T.byteRangeEndOffset;if(se){let de=T.byteRangeStartOffset;$=`${se-de}@${de}`}else $=null;ug(T,ie,a,I),f=T,x=!0}break}case"SERVER-CONTROL":{let ie=new qe(ee);d.canBlockReload=ie.bool("CAN-BLOCK-RELOAD"),d.canSkipUntil=ie.optionalFloat("CAN-SKIP-UNTIL",0),d.canSkipDateRanges=d.canSkipUntil>0&&ie.bool("CAN-SKIP-DATERANGES"),d.partHoldBack=ie.optionalFloat("PART-HOLD-BACK",0),d.holdBack=ie.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{let ie=new qe(ee);d.partTarget=ie.decimalFloatingPoint("PART-TARGET");break}case"PART":{let ie=d.partList;ie||(ie=d.partList=[]);let se=p>0?ie[ie.length-1]:void 0,de=p++,q=new qe(ee);wt(d,q,["BYTERANGE","URI"]);let re=new bE(q,T,r,de,se);ie.push(re),T.duration+=re.duration;break}case"PRELOAD-HINT":{let ie=new qe(ee);wt(d,ie,["URI"]),d.preloadHint=ie;break}case"RENDITION-REPORT":{let ie=new qe(ee);wt(d,ie,["URI"]),d.renditionReports=d.renditionReports||[],d.renditionReports.push(ie);break}default:P.warn(`line parsed but not handled: ${k}`);break}}}S&&!S.relurl?(c.pop(),y-=S.duration,d.partList&&(d.fragmentHint=S)):d.partList&&(og(T,S),T.cc=E,d.fragmentHint=T,I&&dg(T,I,d));let G=c.length,K=c[0],Q=c[G-1];if(y+=d.skippedSegments*d.targetduration,y>0&&G&&Q){d.averagetargetduration=y/G;let ae=Q.sn;d.endSN=ae!=="initSegment"?ae:0,d.live||(Q.endList=!0),K&&(d.startCC=K.cc)}else d.endSN=0,d.startCC=0;return d.fragmentHint&&(y+=d.fragmentHint.duration),d.totalduration=y,d.endCC=E,O>0&&cS(c,O),d}};function sg(e,t,r){var a,n;let l=new qe(e);wt(r,l,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);let u=(a=l.METHOD)!=null?a:"",d=l.URI,c=l.hexadecimalInteger("IV"),f=l.KEYFORMATVERSIONS,g=(n=l.KEYFORMAT)!=null?n:"identity";d&&l.IV&&!c&&P.error(`Invalid IV: ${l.IV}`);let p=d?Pa.resolve(d,t):"",y=(f||"1").split("/").map(Number).filter(Number.isFinite);return new Tu(u,p,g,y,c)}function ng(e){let t=new qe(e).decimalFloatingPoint("TIME-OFFSET");return oe(t)?t:null}function dS(e,t){let r=(e||"").split(/[ ,]+/).filter(a=>a);["video","audio","text"].forEach(a=>{let n=r.filter(l=>aS(l,a));n.length&&(t[`${a}Codec`]=n.join(","),r=r.filter(l=>n.indexOf(l)===-1))}),t.unknownCodecs=r}function lg(e,t,r){let a=t[r];a&&(e[r]=a)}function cS(e,t){let r=e[t];for(let a=t;a--;){let n=e[a];if(!n)return;n.programDateTime=r.programDateTime-n.duration*1e3,r=n}}function og(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):t!=null&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),oe(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function ug(e,t,r,a){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=r,e.sn="initSegment",a&&(e.levelkeys=a),e.initSegment=null}function dg(e,t,r){e.levelkeys=t;let{encryptedFragments:a}=r;(!a.length||a[a.length-1].levelkeys!==t)&&Object.keys(t).some(n=>t[n].isCommonEncryption)&&a.push(e)}var Re={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},Ee={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function cg(e){let{type:t}=e;switch(t){case Re.AUDIO_TRACK:return Ee.AUDIO;case Re.SUBTITLE_TRACK:return Ee.SUBTITLE;default:return Ee.MAIN}}function su(e,t){let r=e.url;return(r===void 0||r.indexOf("data:")===0)&&(r=t.url),r}var hS=class{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){let{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){let{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(b.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(e){let t=this.hls.config,r=t.pLoader,a=t.loader,n=r||a,l=new n(t);return this.loaders[e.type]=l,l}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(let e in this.loaders){let t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){let{url:r}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Re.MANIFEST,url:r,deliveryDirectives:null})}onLevelLoading(e,t){let{id:r,level:a,pathwayId:n,url:l,deliveryDirectives:u}=t;this.load({id:r,level:a,pathwayId:n,responseType:"text",type:Re.LEVEL,url:l,deliveryDirectives:u})}onAudioTrackLoading(e,t){let{id:r,groupId:a,url:n,deliveryDirectives:l}=t;this.load({id:r,groupId:a,level:null,responseType:"text",type:Re.AUDIO_TRACK,url:n,deliveryDirectives:l})}onSubtitleTrackLoading(e,t){let{id:r,groupId:a,url:n,deliveryDirectives:l}=t;this.load({id:r,groupId:a,level:null,responseType:"text",type:Re.SUBTITLE_TRACK,url:n,deliveryDirectives:l})}load(e){var t;let r=this.hls.config,a=this.getInternalLoader(e);if(a){let c=a.context;if(c&&c.url===e.url&&c.level===e.level){P.trace("[playlist-loader]: playlist request ongoing");return}P.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),a.abort()}let n;if(e.type===Re.MANIFEST?n=r.manifestLoadPolicy.default:n=Je({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),a=this.createInternalLoader(e),oe((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===Re.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===Re.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===Re.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){let f=c.partTarget,g=c.targetduration;if(f&&g){let p=Math.max(f*3,g*.8)*1e3;n=Je({},n,{maxTimeToFirstByteMs:Math.min(p,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(p,n.maxTimeToFirstByteMs)})}}}let l=n.errorRetry||n.timeoutRetry||{},u={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},d={onSuccess:(c,f,g,p)=>{let y=this.getInternalLoader(g);this.resetInternalLoader(g.type);let E=c.data;if(E.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(c,g,new Error("no EXTM3U delimiter"),p||null,f);return}f.parsing.start=performance.now(),Pa.isMediaPlaylist(E)?this.handleTrackOrLevelPlaylist(c,f,g,p||null,y):this.handleMasterPlaylist(c,f,g,p)},onError:(c,f,g,p)=>{this.handleNetworkError(f,g,!1,c,p)},onTimeout:(c,f,g)=>{this.handleNetworkError(f,g,!0,void 0,c)}};a.load(e,u,d)}handleMasterPlaylist(e,t,r,a){let n=this.hls,l=e.data,u=su(e,r),d=Pa.parseMasterPlaylist(l,u);if(d.playlistParsingError){this.handleManifestParsingError(e,r,d.playlistParsingError,a,t);return}let{contentSteering:c,levels:f,sessionData:g,sessionKeys:p,startTimeOffset:y,variableList:E}=d;this.variableList=E;let{AUDIO:S=[],SUBTITLES:T,"CLOSED-CAPTIONS":k}=Pa.parseMasterPlaylistMedia(l,u,d);S.length&&!S.some(C=>!C.url)&&f[0].audioCodec&&!f[0].attrs.AUDIO&&(P.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),S.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new qe({}),bitrate:0,url:""})),n.trigger(b.MANIFEST_LOADED,{levels:f,audioTracks:S,subtitles:T,captions:k,contentSteering:c,url:u,stats:t,networkDetails:a,sessionData:g,sessionKeys:p,startTimeOffset:y,variableList:E})}handleTrackOrLevelPlaylist(e,t,r,a,n){let l=this.hls,{id:u,level:d,type:c}=r,f=su(e,r),g=0,p=oe(d)?d:oe(u)?u:0,y=cg(r),E=Pa.parseLevelPlaylist(e.data,f,p,y,g,this.variableList);if(c===Re.MANIFEST){let S={attrs:new qe({}),bitrate:0,details:E,name:"",url:f};l.trigger(b.MANIFEST_LOADED,{levels:[S],audioTracks:[],url:f,stats:t,networkDetails:a,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),r.levelDetails=E,this.handlePlaylistLoaded(E,e,t,r,a,n)}handleManifestParsingError(e,t,r,a,n){this.hls.trigger(b.ERROR,{type:Se.NETWORK_ERROR,details:B.MANIFEST_PARSING_ERROR,fatal:t.type===Re.MANIFEST,url:e.url,err:r,error:r,reason:r.message,response:e,context:t,networkDetails:a,stats:n})}handleNetworkError(e,t,r=!1,a,n){let l=`A network ${r?"timeout":"error"+(a?" (status "+a.code+")":"")} occurred while loading ${e.type}`;e.type===Re.LEVEL?l+=`: ${e.level} id: ${e.id}`:(e.type===Re.AUDIO_TRACK||e.type===Re.SUBTITLE_TRACK)&&(l+=` id: ${e.id} group-id: "${e.groupId}"`);let u=new Error(l);P.warn(`[playlist-loader]: ${l}`);let d=B.UNKNOWN,c=!1,f=this.getInternalLoader(e);switch(e.type){case Re.MANIFEST:d=r?B.MANIFEST_LOAD_TIMEOUT:B.MANIFEST_LOAD_ERROR,c=!0;break;case Re.LEVEL:d=r?B.LEVEL_LOAD_TIMEOUT:B.LEVEL_LOAD_ERROR,c=!1;break;case Re.AUDIO_TRACK:d=r?B.AUDIO_TRACK_LOAD_TIMEOUT:B.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case Re.SUBTITLE_TRACK:d=r?B.SUBTITLE_TRACK_LOAD_TIMEOUT:B.SUBTITLE_LOAD_ERROR,c=!1;break}f&&this.resetInternalLoader(e.type);let g={type:Se.NETWORK_ERROR,details:d,fatal:c,url:e.url,loader:f,context:e,error:u,networkDetails:t,stats:n};if(a){let p=t?.url||e.url;g.response=ut({url:p,data:void 0},a)}this.hls.trigger(b.ERROR,g)}handlePlaylistLoaded(e,t,r,a,n,l){let u=this.hls,{type:d,level:c,id:f,groupId:g,deliveryDirectives:p}=a,y=su(t,a),E=cg(a),S=typeof a.level=="number"&&E===Ee.MAIN?c:void 0;if(!e.fragments.length){let k=new Error("No Segments found in Playlist");u.trigger(b.ERROR,{type:Se.NETWORK_ERROR,details:B.LEVEL_EMPTY_ERROR,fatal:!1,url:y,error:k,reason:k.message,response:t,context:a,level:S,parent:E,networkDetails:n,stats:r});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));let T=e.playlistParsingError;if(T){u.trigger(b.ERROR,{type:Se.NETWORK_ERROR,details:B.LEVEL_PARSING_ERROR,fatal:!1,url:y,error:T,reason:T.message,response:t,context:a,level:S,parent:E,networkDetails:n,stats:r});return}switch(e.live&&l&&(l.getCacheAge&&(e.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),d){case Re.MANIFEST:case Re.LEVEL:u.trigger(b.LEVEL_LOADED,{details:e,level:S||0,id:f||0,stats:r,networkDetails:n,deliveryDirectives:p});break;case Re.AUDIO_TRACK:u.trigger(b.AUDIO_TRACK_LOADED,{details:e,id:f||0,groupId:g||"",stats:r,networkDetails:n,deliveryDirectives:p});break;case Re.SUBTITLE_TRACK:u.trigger(b.SUBTITLE_TRACK_LOADED,{details:e,id:f||0,groupId:g||"",stats:r,networkDetails:n,deliveryDirectives:p});break}}};function pp(e,t){let r;try{r=new Event("addtrack")}catch{r=document.createEvent("Event"),r.initEvent("addtrack",!1,!1)}r.track=e,t.dispatchEvent(r)}function vp(e,t){let r=e.mode;if(r==="disabled"&&(e.mode="hidden"),e.cues&&!e.cues.getCueById(t.id))try{if(e.addCue(t),!e.cues.getCueById(t.id))throw new Error(`addCue is failed for: ${t}`)}catch(a){P.debug(`[texttrack-utils]: ${a}`);try{let n=new self.TextTrackCue(t.startTime,t.endTime,t.text);n.id=t.id,e.addCue(n)}catch(n){P.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${n}`)}}r==="disabled"&&(e.mode=r)}function Vi(e){let t=e.mode;if(t==="disabled"&&(e.mode="hidden"),e.cues)for(let r=e.cues.length;r--;)e.removeCue(e.cues[r]);t==="disabled"&&(e.mode=t)}function Lu(e,t,r,a){let n=e.mode;if(n==="disabled"&&(e.mode="hidden"),e.cues&&e.cues.length>0){let l=mS(e.cues,t,r);for(let u=0;u<l.length;u++)(!a||a(l[u]))&&e.removeCue(l[u])}n==="disabled"&&(e.mode=n)}function fS(e,t){if(t<e[0].startTime)return 0;let r=e.length-1;if(t>e[r].endTime)return-1;let a=0,n=r;for(;a<=n;){let l=Math.floor((n+a)/2);if(t<e[l].startTime)n=l-1;else if(t>e[l].startTime&&a<r)a=l+1;else return l}return e[a].startTime-t<t-e[n].startTime?a:n}function mS(e,t,r){let a=[],n=fS(e,t);if(n>-1)for(let l=n,u=e.length;l<u;l++){let d=e[l];if(d.startTime>=t&&d.endTime<=r)a.push(d);else if(d.startTime>r)return a}return a}function En(e){let t=[];for(let r=0;r<e.length;r++){let a=e[r];(a.kind==="subtitles"||a.kind==="captions")&&a.label&&t.push(e[r])}return t}var Xt={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"},gS=.25;function ku(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function hg(e,t,r,a,n){let l=new e(t,r,"");try{l.value=a,n&&(l.type=n)}catch{l=new e(t,r,JSON.stringify(n?ut({type:n},a):a))}return l}var cn=(()=>{let e=ku();try{e&&new e(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function nu(e,t){return e.getTime()/1e3-t}function pS(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var vS=class{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){let{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){let{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(e,t){this.media=t.media}onMediaDetaching(){this.id3Track&&(Vi(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){let t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){let r=e[t];if(r.kind==="metadata"&&r.label==="id3")return pp(r,this.media),r}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;let{hls:{config:{enableEmsgMetadataCues:r,enableID3MetadataCues:a}}}=this;if(!r&&!a)return;let{samples:n}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));let l=ku();if(l)for(let u=0;u<n.length;u++){let d=n[u].type;if(d===Xt.emsg&&!r||!a)continue;let c=sp(n[u].data);if(c){let f=n[u].pts,g=f+n[u].duration;g>cn&&(g=cn),g-f<=0&&(g=f+gS);for(let p=0;p<c.length;p++){let y=c[p];if(!ap(y)){this.updateId3CueEnds(f,d);let E=hg(l,f,g,y,d);E&&this.id3Track.addCue(E)}}}}}updateId3CueEnds(e,t){var r;let a=(r=this.id3Track)==null?void 0:r.cues;if(a)for(let n=a.length;n--;){let l=a[n];l.type===t&&l.startTime<e&&l.endTime===cn&&(l.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:r,type:a}){let{id3Track:n,hls:l}=this;if(!l)return;let{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:d}}=l;if(n&&(u||d)){let c;a==="audio"?c=f=>f.type===Xt.audioId3&&d:a==="video"?c=f=>f.type===Xt.emsg&&u:c=f=>f.type===Xt.audioId3&&d||f.type===Xt.emsg&&u,Lu(n,t,r,c)}}onLevelUpdated(e,{details:t}){if(!this.media||!t.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;let{dateRangeCuesAppended:r,id3Track:a}=this,{dateRanges:n}=t,l=Object.keys(n);if(a){let f=Object.keys(r).filter(g=>!l.includes(g));for(let g=f.length;g--;){let p=f[g];Object.keys(r[p].cues).forEach(y=>{a.removeCue(r[p].cues[y])}),delete r[p]}}let u=t.fragments[t.fragments.length-1];if(l.length===0||!oe(u?.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));let d=u.programDateTime/1e3-u.start,c=ku();for(let f=0;f<l.length;f++){let g=l[f],p=n[g],y=nu(p.startDate,d),E=r[g],S=E?.cues||{},T=E?.durationKnown||!1,k=cn,C=p.endDate;if(C)k=nu(C,d),T=!0;else if(p.endOnNext&&!T){let O=l.reduce((x,$)=>{if($!==p.id){let G=n[$];if(G.class===p.class&&G.startDate>p.startDate&&(!x||p.startDate<x.startDate))return G}return x},null);O&&(k=nu(O.startDate,d),T=!0)}let I=Object.keys(p.attr);for(let O=0;O<I.length;O++){let x=I[O];if(!SE(x))continue;let $=S[x];if($)T&&!E.durationKnown&&($.endTime=k);else if(c){let G=p.attr[x];TE(x)&&(G=pS(G));let K=hg(c,y,k,{key:x,data:G},Xt.dateRange);K&&(K.id=g,this.id3Track.addCue(K),S[x]=K)}}r[g]={cues:S,dateRange:p,durationKnown:T}}}},yS=class{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=e,this.config=e.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){let{config:e,levelDetails:t}=this;return e.liveMaxLatencyDuration!==void 0?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){let{levelDetails:e}=this;if(e===null)return null;let{holdBack:t,partHoldBack:r,targetduration:a}=e,{liveSyncDuration:n,liveSyncDurationCount:l,lowLatencyMode:u}=this.config,d=this.hls.userConfig,c=u&&r||t;(d.liveSyncDuration||d.liveSyncDurationCount||c===0)&&(c=n!==void 0?n:l*a);let f=a;return c+Math.min(this.stallCount*1,f)}get liveSyncPosition(){let e=this.estimateLiveEdge(),t=this.targetLatency,r=this.levelDetails;if(e===null||t===null||r===null)return null;let a=r.edge,n=e-t-this.edgeStalled,l=a-r.totalduration,u=a-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return Math.min(Math.max(l,n),u)}get drift(){let{levelDetails:e}=this;return e===null?1:e.drift}get edgeStalled(){let{levelDetails:e}=this;if(e===null)return 0;let t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){let{media:e,levelDetails:t}=this;if(!e||!t)return 0;let r=e.buffered.length;return(r?e.buffered.end(r-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(b.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(b.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){this.levelDetails=t,t.advanced&&this.timeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(e,t){var r;t.details===B.BUFFER_STALLED_ERROR&&(this.stallCount++,(r=this.levelDetails)!=null&&r.live&&P.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){let{media:e,levelDetails:t}=this;if(!e||!t)return;this.currentTime=e.currentTime;let r=this.computeLatency();if(r===null)return;this._latency=r;let{lowLatencyMode:a,maxLiveSyncPlaybackRate:n}=this.config;if(!a||n===1||!t.live)return;let l=this.targetLatency;if(l===null)return;let u=r-l,d=Math.min(this.maxLatency,l+t.targetduration);if(u<d&&u>.05&&this.forwardBufferLength>1){let c=Math.min(2,Math.max(1,n)),f=Math.round(2/(1+Math.exp(-.75*u-this.edgeStalled))*20)/20;e.playbackRate=Math.min(c,Math.max(1,f))}else e.playbackRate!==1&&e.playbackRate!==0&&(e.playbackRate=1)}estimateLiveEdge(){let{levelDetails:e}=this;return e===null?null:e.edge+e.age}computeLatency(){let e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}},Au=["NONE","TYPE-0","TYPE-1",null];function ES(e){return Au.indexOf(e)>-1}var xn=["SDR","PQ","HLG"];function SS(e){return!!e&&xn.indexOf(e)>-1}var Sn={No:"",Yes:"YES",v2:"v2"};function fg(e){let{canSkipUntil:t,canSkipDateRanges:r,age:a}=e,n=a<t/2;return t&&n?r?Sn.v2:Sn.Yes:Sn.No}var mg=class{constructor(e,t,r){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=r}addDirectives(e){let t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}},Ki=class{constructor(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(t=>!!t).map(t=>t.substring(0,4)).join(","),this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return gg(this._audioGroups,e)}hasSubtitleGroup(e){return gg(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let r=this._audioGroups;r||(r=this._audioGroups=[]),r.indexOf(t)===-1&&r.push(t)}else if(e==="text"){let r=this._subtitleGroups;r||(r=this._subtitleGroups=[]),r.indexOf(t)===-1&&r.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}};function gg(e,t){return!t||!e?!1:e.indexOf(t)!==-1}function lu(e,t){let r=t.startPTS;if(oe(r)){let a=0,n;t.sn>e.sn?(a=r-e.start,n=e):(a=e.start-r,n=t),n.duration!==a&&(n.duration=a)}else t.sn>e.sn?e.cc===t.cc&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration:t.start=Math.max(e.start-t.duration,0)}function yp(e,t,r,a,n,l){a-r<=0&&(P.warn("Fragment should have a positive duration",t),a=r+t.duration,l=n+t.duration);let u=r,d=a,c=t.startPTS,f=t.endPTS;if(oe(c)){let T=Math.abs(c-r);oe(t.deltaPTS)?t.deltaPTS=Math.max(T,t.deltaPTS):t.deltaPTS=T,u=Math.max(r,c),r=Math.min(r,c),n=Math.min(n,t.startDTS),d=Math.min(a,f),a=Math.max(a,f),l=Math.max(l,t.endDTS)}let g=r-t.start;t.start!==0&&(t.start=r),t.duration=a-t.start,t.startPTS=r,t.maxStartPTS=u,t.startDTS=n,t.endPTS=a,t.minEndPTS=d,t.endDTS=l;let p=t.sn;if(!e||p<e.startSN||p>e.endSN)return 0;let y,E=p-e.startSN,S=e.fragments;for(S[E]=t,y=E;y>0;y--)lu(S[y],S[y-1]);for(y=E;y<S.length-1;y++)lu(S[y],S[y+1]);return e.fragmentHint&&lu(S[S.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,g}function TS(e,t){let r=null,a=e.fragments;for(let c=a.length-1;c>=0;c--){let f=a[c].initSegment;if(f){r=f;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;let n=0,l;if(kS(e,t,(c,f)=>{c.relurl&&(n=c.cc-f.cc),oe(c.startPTS)&&oe(c.endPTS)&&(f.start=f.startPTS=c.startPTS,f.startDTS=c.startDTS,f.maxStartPTS=c.maxStartPTS,f.endPTS=c.endPTS,f.endDTS=c.endDTS,f.minEndPTS=c.minEndPTS,f.duration=c.endPTS-c.startPTS,f.duration&&(l=f),t.PTSKnown=t.alignedSliding=!0),f.elementaryStreams=c.elementaryStreams,f.loader=c.loader,f.stats=c.stats,c.initSegment&&(f.initSegment=c.initSegment,r=c.initSegment)}),r&&(t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments).forEach(c=>{var f;c&&(!c.initSegment||c.initSegment.relurl===((f=r)==null?void 0:f.relurl))&&(c.initSegment=r)}),t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some(c=>!c),t.deltaUpdateFailed){P.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=t.skippedSegments;c--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=bS(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));let u=t.fragments;if(n){P.warn("discontinuity sliding from playlist, take drift into account");for(let c=0;c<u.length;c++)u[c].cc+=n}t.skippedSegments&&(t.startCC=t.fragments[0].cc),LS(e.partList,t.partList,(c,f)=>{f.elementaryStreams=c.elementaryStreams,f.stats=c.stats}),l?yp(t,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS):Ep(e,t),u.length&&(t.totalduration=t.edge-u[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;let d=t.advancedDateTime;if(t.advanced&&d){let c=t.edge;t.driftStart||(t.driftStartTime=d,t.driftStart=c),t.driftEndTime=d,t.driftEnd=c}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function bS(e,t,r){let a=Je({},e);return r&&r.forEach(n=>{delete a[n]}),Object.keys(t).forEach(n=>{let l=new Zg(t[n].attr,a[n]);l.isValid?a[n]=l:P.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(t[n].attr)}"`)}),a}function LS(e,t,r){if(e&&t){let a=0;for(let n=0,l=e.length;n<=l;n++){let u=e[n],d=t[n+a];u&&d&&u.index===d.index&&u.fragment.sn===d.fragment.sn?r(u,d):a--}}}function kS(e,t,r){let a=t.skippedSegments,n=Math.max(e.startSN,t.startSN)-t.startSN,l=(e.fragmentHint?1:0)+(a?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,u=t.startSN-e.startSN,d=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,c=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;for(let f=n;f<=l;f++){let g=c[u+f],p=d[f];a&&!p&&f<a&&(p=t.fragments[f]=g),g&&p&&r(g,p)}}function Ep(e,t){let r=t.startSN+t.skippedSegments-e.startSN,a=e.fragments;r<0||r>=a.length||wu(t,a[r].start)}function wu(e,t){if(t){let r=e.fragments;for(let a=e.skippedSegments;a<r.length;a++)r[a].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function AS(e,t=1/0){let r=1e3*e.targetduration;if(e.updated){let a=e.fragments;if(a.length&&r*4>t){let n=a[a.length-1].duration*1e3;n<r&&(r=n)}}else r/=2;return Math.round(r)}function wS(e,t,r){if(!(e!=null&&e.details))return null;let a=e.details,n=a.fragments[t-a.startSN];return n||(n=a.fragmentHint,n&&n.sn===t)?n:t<a.startSN&&r&&r.sn===t?r:null}function pg(e,t,r){var a;return e!=null&&e.details?Sp((a=e.details)==null?void 0:a.partList,t,r):null}function Sp(e,t,r){if(e)for(let a=e.length;a--;){let n=e[a];if(n.index===r&&n.fragment.sn===t)return n}return null}function Tp(e){e.forEach((t,r)=>{let{details:a}=t;a!=null&&a.fragments&&a.fragments.forEach(n=>{n.level=r})})}function Pn(e){switch(e.details){case B.FRAG_LOAD_TIMEOUT:case B.KEY_LOAD_TIMEOUT:case B.LEVEL_LOAD_TIMEOUT:case B.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function vg(e,t){let r=Pn(t);return e.default[`${r?"timeout":"error"}Retry`]}function Vu(e,t){let r=e.backoff==="linear"?1:Math.pow(2,t);return Math.min(r*e.retryDelayMs,e.maxRetryDelayMs)}function yg(e){return ut(ut({},e),{errorRetry:null,timeoutRetry:null})}function Mn(e,t,r,a){if(!e)return!1;let n=a?.code,l=t<e.maxNumRetry&&(RS(n)||!!r);return e.shouldRetry?e.shouldRetry(e,t,r,a,l):l}function RS(e){return e===0&&navigator.onLine===!1||!!e&&(e<400||e>499)}var bp={search:function(e,t){let r=0,a=e.length-1,n=null,l=null;for(;r<=a;){n=(r+a)/2|0,l=e[n];let u=t(l);if(u>0)r=n+1;else if(u<0)a=n-1;else return l}return null}};function DS(e,t,r){if(t===null||!Array.isArray(e)||!e.length||!oe(t))return null;let a=e[0].programDateTime;if(t<(a||0))return null;let n=e[e.length-1].endProgramDateTime;if(t>=(n||0))return null;r=r||0;for(let l=0;l<e.length;++l){let u=e[l];if(IS(t,r,u))return u}return null}function Nn(e,t,r=0,a=0){let n=null;if(e){n=t[e.sn-t[0].sn+1]||null;let u=e.endDTS-r;u>0&&u<15e-7&&(r+=15e-7)}else r===0&&t[0].start===0&&(n=t[0]);if(n&&(!e||e.level===n.level)&&Ru(r,a,n)===0)return n;let l=bp.search(t,Ru.bind(null,r,a));return l&&(l!==e||!n)?l:n}function Ru(e=0,t=0,r){if(r.start<=e&&r.start+r.duration>e)return 0;let a=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0));return r.start+r.duration-a<=e?1:r.start-a>e&&r.start?-1:0}function IS(e,t,r){let a=Math.min(t,r.duration+(r.deltaPTS?r.deltaPTS:0))*1e3;return(r.endProgramDateTime||0)-a>e}function CS(e,t){return bp.search(e,r=>r.cc<t?1:r.cc>t?-1:0)}var lt={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Yt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4},_S=class{constructor(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=P.log.bind(P,"[info]:"),this.warn=P.warn.bind(P,"[warning]:"),this.error=P.error.bind(P,"[error]:"),this.registerListeners()}registerListeners(){let e=this.hls;e.on(b.ERROR,this.onError,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){let e=this.hls;e&&(e.off(b.ERROR,this.onError,this),e.off(b.ERROR,this.onErrorOut,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===Ee.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var r,a;if(t.fatal)return;let n=this.hls,l=t.context;switch(t.details){case B.FRAG_LOAD_ERROR:case B.FRAG_LOAD_TIMEOUT:case B.KEY_LOAD_ERROR:case B.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case B.FRAG_PARSING_ERROR:if((r=t.frag)!=null&&r.gap){t.errorAction={action:lt.DoNothing,flags:Yt.None};return}case B.FRAG_GAP:case B.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=lt.SendAlternateToPenaltyBox;return}case B.LEVEL_EMPTY_ERROR:case B.LEVEL_PARSING_ERROR:{var u,d;let c=t.parent===Ee.MAIN?t.level:n.loadLevel;t.details===B.LEVEL_EMPTY_ERROR&&(u=t.context)!=null&&(d=u.levelDetails)!=null&&d.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,c):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,c))}return;case B.LEVEL_LOAD_ERROR:case B.LEVEL_LOAD_TIMEOUT:typeof l?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l.level));return;case B.AUDIO_TRACK_LOAD_ERROR:case B.AUDIO_TRACK_LOAD_TIMEOUT:case B.SUBTITLE_LOAD_ERROR:case B.SUBTITLE_TRACK_LOAD_TIMEOUT:if(l){let c=n.levels[n.loadLevel];if(c&&(l.type===Re.AUDIO_TRACK&&c.hasAudioGroup(l.groupId)||l.type===Re.SUBTITLE_TRACK&&c.hasSubtitleGroup(l.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=lt.SendAlternateToPenaltyBox,t.errorAction.flags=Yt.MoveAllAlternatesMatchingHost;return}}return;case B.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{let c=n.levels[n.loadLevel],f=c?.attrs["HDCP-LEVEL"];f?t.errorAction={action:lt.SendAlternateToPenaltyBox,flags:Yt.MoveAllAlternatesMatchingHDCP,hdcpLevel:f}:this.keySystemError(t)}return;case B.BUFFER_ADD_CODEC_ERROR:case B.REMUX_ALLOC_ERROR:case B.BUFFER_APPEND_ERROR:t.errorAction=this.getLevelSwitchAction(t,(a=t.level)!=null?a:n.loadLevel);return;case B.INTERNAL_EXCEPTION:case B.BUFFER_APPENDING_ERROR:case B.BUFFER_FULL_ERROR:case B.LEVEL_SWITCH_ERROR:case B.BUFFER_STALLED_ERROR:case B.BUFFER_SEEK_OVER_HOLE:case B.BUFFER_NUDGE_ON_STALL:t.errorAction={action:lt.DoNothing,flags:Yt.None};return}t.type===Se.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){let t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){let r=this.hls,a=vg(r.config.playlistLoadPolicy,e),n=this.playlistError++;if(Mn(a,n,Pn(e),e.response))return{action:lt.RetryRequest,flags:Yt.None,retryConfig:a,retryCount:n};let l=this.getLevelSwitchAction(e,t);return a&&(l.retryConfig=a,l.retryCount=n),l}getFragRetryOrSwitchAction(e){let t=this.hls,r=this.getVariantLevelIndex(e.frag),a=t.levels[r],{fragLoadPolicy:n,keyLoadPolicy:l}=t.config,u=vg(e.details.startsWith("key")?l:n,e),d=t.levels.reduce((f,g)=>f+g.fragmentError,0);if(a&&(e.details!==B.FRAG_GAP&&a.fragmentError++,Mn(u,d,Pn(e),e.response)))return{action:lt.RetryRequest,flags:Yt.None,retryConfig:u,retryCount:d};let c=this.getLevelSwitchAction(e,r);return u&&(c.retryConfig=u,c.retryCount=d),c}getLevelSwitchAction(e,t){let r=this.hls;t==null&&(t=r.loadLevel);let a=this.hls.levels[t];if(a){var n,l;let c=e.details;a.loadError++,c===B.BUFFER_APPEND_ERROR&&a.fragmentError++;let f=-1,{levels:g,loadLevel:p,minAutoLevel:y,maxAutoLevel:E}=r;r.autoLevelEnabled||(r.loadLevel=-1);let S=(n=e.frag)==null?void 0:n.type,T=(S===Ee.AUDIO&&c===B.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===B.BUFFER_ADD_CODEC_ERROR||c===B.BUFFER_APPEND_ERROR))&&g.some(({audioCodec:O})=>a.audioCodec!==O),k=e.sourceBufferName==="video"&&(c===B.BUFFER_ADD_CODEC_ERROR||c===B.BUFFER_APPEND_ERROR)&&g.some(({codecSet:O,audioCodec:x})=>a.codecSet!==O&&a.audioCodec===x),{type:C,groupId:I}=(l=e.context)!=null?l:{};for(let O=g.length;O--;){let x=(O+p)%g.length;if(x!==p&&x>=y&&x<=E&&g[x].loadError===0){var u,d;let $=g[x];if(c===B.FRAG_GAP&&e.frag){let G=g[x].details;if(G){let K=Nn(e.frag,G.fragments,e.frag.start);if(K!=null&&K.gap)continue}}else if(C===Re.AUDIO_TRACK&&$.hasAudioGroup(I)||C===Re.SUBTITLE_TRACK&&$.hasSubtitleGroup(I)||S===Ee.AUDIO&&(u=a.audioGroups)!=null&&u.some(G=>$.hasAudioGroup(G))||S===Ee.SUBTITLE&&(d=a.subtitleGroups)!=null&&d.some(G=>$.hasSubtitleGroup(G))||T&&a.audioCodec===$.audioCodec||!T&&a.audioCodec!==$.audioCodec||k&&a.codecSet===$.codecSet)continue;f=x;break}}if(f>-1&&r.loadLevel!==f)return e.levelRetry=!0,this.playlistError=0,{action:lt.SendAlternateToPenaltyBox,flags:Yt.None,nextAutoLevel:f}}return{action:lt.SendAlternateToPenaltyBox,flags:Yt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var r;switch((r=t.errorAction)==null?void 0:r.action){case lt.DoNothing:break;case lt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==B.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break;case lt.RetryRequest:break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){let t=this.hls,r=e.errorAction;if(!r)return;let{flags:a,hdcpLevel:n,nextAutoLevel:l}=r;switch(a){case Yt.None:this.switchLevel(e,l);break;case Yt.MoveAllAlternatesMatchingHDCP:n&&(t.maxHdcpLevel=Au[Au.indexOf(n)-1],r.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}r.resolved||this.switchLevel(e,l)}switchLevel(e,t){t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}},Hu=class{constructor(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=P.log.bind(P,`${t}:`),this.warn=P.warn.bind(P,`${t}:`),this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,r){let a=t?.renditionReports;if(a){let n=-1;for(let l=0;l<a.length;l++){let u=a[l],d;try{d=new self.URL(u.URI,t.url).href}catch(c){P.warn(`Could not construct new URL for Rendition Report: ${c}`),d=u.URI||""}if(d===e){n=l;break}else d===e.substring(0,d.length)&&(n=l)}if(n!==-1){let l=a[n],u=parseInt(l["LAST-MSN"])||t?.lastPartSn,d=parseInt(l["LAST-PART"])||t?.lastPartIndex;if(this.hls.config.lowLatencyMode){let f=Math.min(t.age-t.partTarget,t.targetduration);d>=0&&f>t.partTarget&&(d+=1)}let c=r&&fg(r);return new mg(u,d>=0?d:void 0,c)}}}loadPlaylist(e){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}shouldReloadPlaylist(e){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(e)}playlistLoaded(e,t,r){let{details:a,stats:n}=t,l=self.performance.now(),u=n.loading.first?Math.max(0,l-n.loading.first):0;if(a.advancedDateTime=Date.now()-u,a.live||r!=null&&r.live){if(a.reloaded(r),r&&this.log(`live playlist ${e} ${a.advanced?"REFRESHED "+a.lastPartSn+"-"+a.lastPartIndex:a.updated?"UPDATED":"MISSED"}`),r&&a.fragments.length>0&&TS(r,a),!this.canLoad||!a.live)return;let d,c,f;if(a.canBlockReload&&a.endSN&&a.advanced){let T=this.hls.config.lowLatencyMode,k=a.lastPartSn,C=a.endSN,I=a.lastPartIndex,O=I!==-1,x=k===C,$=T?0:I;O?(c=x?C+1:k,f=x?$:I+1):c=C+1;let G=a.age,K=G+a.ageHeader,Q=Math.min(K-a.partTarget,a.targetduration*1.5);if(Q>0){if(r&&Q>r.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${r.tuneInGoal} to: ${Q} with playlist age: ${a.age}`),Q=0;else{let ae=Math.floor(Q/a.targetduration);if(c+=ae,f!==void 0){let W=Math.round(Q%a.targetduration/a.partTarget);f+=W}this.log(`CDN Tune-in age: ${a.ageHeader}s last advanced ${G.toFixed(2)}s goal: ${Q} skip sn ${ae} to part ${f}`)}a.tuneInGoal=Q}if(d=this.getDeliveryDirectives(a,t.deliveryDirectives,c,f),T||!x){this.loadPlaylist(d);return}}else(a.canBlockReload||a.canSkipUntil)&&(d=this.getDeliveryDirectives(a,t.deliveryDirectives,c,f));let g=this.hls.mainForwardBufferInfo,p=g?g.end-g.len:0,y=(a.edge-p)*1e3,E=AS(a,y);a.updated&&l>this.requestScheduled+E&&(this.requestScheduled=n.loading.start),c!==void 0&&a.canBlockReload?this.requestScheduled=n.loading.first+E-(a.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+E<l?this.requestScheduled=l:this.requestScheduled-l<=0&&(this.requestScheduled+=E);let S=this.requestScheduled-l;S=Math.max(0,S),this.log(`reload live playlist ${e} in ${Math.round(S)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(d),S)}else this.clearTimer()}getDeliveryDirectives(e,t,r,a){let n=fg(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(r=t.msn,a=t.part,n=Sn.No),new mg(r,a,n)}checkRetry(e){let t=e.details,r=Pn(e),a=e.errorAction,{action:n,retryCount:l=0,retryConfig:u}=a||{},d=!!a&&!!u&&(n===lt.RetryRequest||!a.resolved&&n===lt.SendAlternateToPenaltyBox);if(d){var c;if(this.requestScheduled=-1,l>=u.maxNumRetry)return!1;if(r&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${l+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{let f=Vu(u,l);this.timer=self.setTimeout(()=>this.loadPlaylist(),f),this.warn(`Retrying playlist loading ${l+1}/${u.maxNumRetry} after "${t}" in ${f}ms`)}e.levelRetry=!0,a.resolved=!0}return d}},Oi=class{constructor(e,t=0,r=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=r}sample(e,t){let r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){let e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}},xS=class{constructor(e,t,r,a=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Oi(e),this.fast_=new Oi(t),this.defaultTTFB_=a,this.ttfb_=new Oi(e)}update(e,t){let{slow_:r,fast_:a,ttfb_:n}=this;r.halfLife!==e&&(this.slow_=new Oi(e,r.getEstimate(),r.getTotalWeight())),a.halfLife!==t&&(this.fast_=new Oi(t,a.getEstimate(),a.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new Oi(e,n.getEstimate(),n.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);let r=8*t,a=e/1e3,n=r/a;this.fast_.sample(a,n),this.slow_.sample(a,n)}sampleTTFB(e){let t=e/1e3,r=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(r,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}},Lp={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]},Eg={};function PS(e,t,r,a,n,l){let u=e.audioCodec?e.audioGroups:null,d=l?.audioCodec,c=l?.channels,f=c?parseInt(c):d?1/0:2,g=null;if(u!=null&&u.length)try{u.length===1&&u[0]?g=t.groups[u[0]].channels:g=u.reduce((p,y)=>{if(y){let E=t.groups[y];if(!E)throw new Error(`Audio track group ${y} not found`);Object.keys(E.channels).forEach(S=>{p[S]=(p[S]||0)+E.channels[S]})}return p},{2:0})}catch{return!0}return e.videoCodec!==void 0&&(e.width>1920&&e.height>1088||e.height>1920&&e.width>1088||e.frameRate>Math.max(a,30)||e.videoRange!=="SDR"&&e.videoRange!==r||e.bitrate>Math.max(n,8e6))||!!g&&oe(f)&&Object.keys(g).some(p=>parseInt(p)>f)}function MS(e,t,r){let a=e.videoCodec,n=e.audioCodec;if(!a||!n||!r)return Promise.resolve(Lp);let l={width:e.width,height:e.height,bitrate:Math.ceil(Math.max(e.bitrate*.9,e.averageBitrate)),framerate:e.frameRate||30},u=e.videoRange;u!=="SDR"&&(l.transferFunction=u.toLowerCase());let d=a.split(",").map(c=>({type:"media-source",video:ut(ut({},l),{},{contentType:Ba(c,"video")})}));return n&&e.audioGroups&&e.audioGroups.forEach(c=>{var f;c&&((f=t.groups[c])==null||f.tracks.forEach(g=>{if(g.groupId===c){let p=g.channels||"",y=parseFloat(p);oe(y)&&y>2&&d.push.apply(d,n.split(",").map(E=>({type:"media-source",audio:{contentType:Ba(E,"audio"),channels:""+y}})))}}))}),Promise.all(d.map(c=>{let f=NS(c);return Eg[f]||(Eg[f]=r.decodingInfo(c))})).then(c=>({supported:!c.some(f=>!f.supported),configurations:d,decodingInfoResults:c})).catch(c=>({supported:!1,configurations:d,decodingInfoResults:[],error:c}))}function NS(e){let{audio:t,video:r}=e,a=r||t;if(a){let n=a.contentType.split('"')[1];if(r)return`r${r.height}x${r.width}f${Math.ceil(r.framerate)}${r.transferFunction||"sd"}_${n}_${Math.ceil(r.bitrate/1e5)}`;if(t)return`c${t.channels}${t.spatialRendering?"s":"n"}_${n}`}return""}function OS(){if(typeof matchMedia=="function"){let e=matchMedia("(dynamic-range: high)"),t=matchMedia("bad query");if(e.media!==t.media)return e.matches===!0}return!1}function FS(e,t){let r=!1,a=[];return e&&(r=e!=="SDR",a=[e]),t&&(a=t.allowedVideoRanges||xn.slice(0),r=t.preferHDR!==void 0?t.preferHDR:OS(),r?a=a.filter(n=>n!=="SDR"):a=["SDR"]),{preferHDR:r,allowedVideoRanges:a}}function US(e,t,r,a,n){let l=Object.keys(e),u=a?.channels,d=a?.audioCodec,c=u&&parseInt(u)===2,f=!0,g=!1,p=1/0,y=1/0,E=1/0,S=0,T=[],{preferHDR:k,allowedVideoRanges:C}=FS(t,n);for(let x=l.length;x--;){let $=e[l[x]];f=$.channels[2]>0,p=Math.min(p,$.minHeight),y=Math.min(y,$.minFramerate),E=Math.min(E,$.minBitrate);let G=C.filter(K=>$.videoRanges[K]>0);G.length>0&&(g=!0,T=G)}p=oe(p)?p:0,y=oe(y)?y:0;let I=Math.max(1080,p),O=Math.max(30,y);return E=oe(E)?E:r,r=Math.max(E,r),g||(t=void 0,T=[]),{codecSet:l.reduce((x,$)=>{let G=e[$];if($===x)return x;if(G.minBitrate>r)return yr($,`min bitrate of ${G.minBitrate} > current estimate of ${r}`),x;if(!G.hasDefaultAudio)return yr($,"no renditions with default or auto-select sound found"),x;if(d&&$.indexOf(d.substring(0,4))%5!==0)return yr($,`audio codec preference "${d}" not found`),x;if(u&&!c){if(!G.channels[u])return yr($,`no renditions with ${u} channel sound found (channels options: ${Object.keys(G.channels)})`),x}else if((!d||c)&&f&&G.channels[2]===0)return yr($,"no renditions with stereo sound found"),x;return G.minHeight>I?(yr($,`min resolution of ${G.minHeight} > maximum of ${I}`),x):G.minFramerate>O?(yr($,`min framerate of ${G.minFramerate} > maximum of ${O}`),x):T.some(K=>G.videoRanges[K]>0)?G.maxScore<S?(yr($,`max score of ${G.maxScore} < selected max of ${S}`),x):x&&(Cn($)>=Cn(x)||G.fragmentError>e[x].fragmentError)?x:(S=G.maxScore,$):(yr($,`no variants with VIDEO-RANGE of ${JSON.stringify(T)} found`),x)},void 0),videoRanges:T,preferHDR:k,minFramerate:y,minBitrate:E}}function yr(e,t){P.log(`[abr] start candidates with "${e}" ignored because ${t}`)}function BS(e){return e.reduce((t,r)=>{let a=t.groups[r.groupId];a||(a=t.groups[r.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),a.tracks.push(r);let n=r.channels||"2";return a.channels[n]=(a.channels[n]||0)+1,a.hasDefault=a.hasDefault||r.default,a.hasAutoSelect=a.hasAutoSelect||r.autoselect,a.hasDefault&&(t.hasDefaultAudio=!0),a.hasAutoSelect&&(t.hasAutoSelectAudio=!0),t},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function $S(e,t,r,a){return e.slice(r,a+1).reduce((n,l)=>{if(!l.codecSet)return n;let u=l.audioGroups,d=n[l.codecSet];d||(n[l.codecSet]=d={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),d.minBitrate=Math.min(d.minBitrate,l.bitrate);let c=Math.min(l.height,l.width);return d.minHeight=Math.min(d.minHeight,c),d.minFramerate=Math.min(d.minFramerate,l.frameRate),d.maxScore=Math.max(d.maxScore,l.score),d.fragmentError+=l.fragmentError,d.videoRanges[l.videoRange]=(d.videoRanges[l.videoRange]||0)+1,u&&u.forEach(f=>{if(!f)return;let g=t.groups[f];g&&(d.hasDefaultAudio=d.hasDefaultAudio||t.hasDefaultAudio?g.hasDefault:g.hasAutoSelect||!t.hasDefaultAudio&&!t.hasAutoSelectAudio,Object.keys(g.channels).forEach(p=>{d.channels[p]=(d.channels[p]||0)+g.channels[p]}))}),n},{})}function nr(e,t,r){if("attrs"in e){let a=t.indexOf(e);if(a!==-1)return a}for(let a=0;a<t.length;a++){let n=t[a];if(Hi(e,n,r))return a}return-1}function Hi(e,t,r){let{groupId:a,name:n,lang:l,assocLang:u,characteristics:d,default:c}=e,f=e.forced;return(a===void 0||t.groupId===a)&&(n===void 0||t.name===n)&&(l===void 0||t.lang===l)&&(l===void 0||t.assocLang===u)&&(c===void 0||t.default===c)&&(f===void 0||t.forced===f)&&(d===void 0||GS(d,t.characteristics))&&(r===void 0||r(e,t))}function GS(e,t=""){let r=e.split(","),a=t.split(",");return r.length===a.length&&!r.some(n=>a.indexOf(n)===-1)}function Fi(e,t){let{audioCodec:r,channels:a}=e;return(r===void 0||(t.audioCodec||"").substring(0,4)===r.substring(0,4))&&(a===void 0||a===(t.channels||"2"))}function VS(e,t,r,a,n){let l=t[a],u=t.reduce((p,y,E)=>{let S=y.uri;return(p[S]||(p[S]=[])).push(E),p},{})[l.uri];u.length>1&&(a=Math.max.apply(Math,u));let d=l.videoRange,c=l.frameRate,f=l.codecSet.substring(0,4),g=Sg(t,a,p=>{if(p.videoRange!==d||p.frameRate!==c||p.codecSet.substring(0,4)!==f)return!1;let y=p.audioGroups,E=r.filter(S=>!y||y.indexOf(S.groupId)!==-1);return nr(e,E,n)>-1});return g>-1?g:Sg(t,a,p=>{let y=p.audioGroups,E=r.filter(S=>!y||y.indexOf(S.groupId)!==-1);return nr(e,E,n)>-1})}function Sg(e,t,r){for(let a=t;a;a--)if(r(e[a]))return a;for(let a=t+1;a<e.length;a++)if(r(e[a]))return a;return-1}var HS=class{constructor(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this._abandonRulesCheck=()=>{let{fragCurrent:t,partCurrent:r,hls:a}=this,{autoLevelEnabled:n,media:l}=a;if(!t||!l)return;let u=performance.now(),d=r?r.stats:t.stats,c=r?r.duration:t.duration,f=u-d.loading.start,g=a.minAutoLevel;if(d.aborted||d.loaded&&d.loaded===d.total||t.level<=g){this.clearTimer(),this._nextAutoLevel=-1;return}if(!n||l.paused||!l.playbackRate||!l.readyState)return;let p=a.mainForwardBufferInfo;if(p===null)return;let y=this.bwEstimator.getEstimateTTFB(),E=Math.abs(l.playbackRate);if(f<=Math.max(y,1e3*(c/(E*2))))return;let S=p.len/E,T=d.loading.first?d.loading.first-d.loading.start:-1,k=d.loaded&&T>-1,C=this.getBwEstimate(),I=a.levels,O=I[t.level],x=d.total||Math.max(d.loaded,Math.round(c*O.averageBitrate/8)),$=k?f-T:f;$<1&&k&&($=Math.min(f,d.loaded*8/C));let G=k?d.loaded*1e3/$:0,K=G?(x-d.loaded)/G:x*8/C+y/1e3;if(K<=S)return;let Q=G?G*8:C,ae=Number.POSITIVE_INFINITY,W;for(W=t.level-1;W>g;W--){let ge=I[W].maxBitrate;if(ae=this.getTimeToLoadFrag(y/1e3,Q,c*ge,!I[W].details),ae<S)break}if(ae>=K||ae>c*10)return;a.nextLoadLevel=a.nextAutoLevel=W,k?this.bwEstimator.sample(f-Math.min(y,T),d.loaded):this.bwEstimator.sampleTTFB(f);let ee=I[W].maxBitrate;this.getBwEstimate()*this.hls.config.abrBandWidthUpFactor>ee&&this.resetEstimator(ee),this.clearTimer(),P.warn(`[abr] Fragment ${t.sn}${r?" part "+r.index:""} of level ${t.level} is loading too slowly;
      Time to underbuffer: ${S.toFixed(3)} s
      Estimated load time for current fragment: ${K.toFixed(3)} s
      Estimated load time for down switch fragment: ${ae.toFixed(3)} s
      TTFB estimate: ${T|0} ms
      Current BW estimate: ${oe(C)?C|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${W} @ ${ee|0} bps`),a.trigger(b.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:r,stats:d})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(P.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){let e=this.hls.config;return new xS(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){let{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(b.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){let r=t.frag;if(!this.ignoreFragment(r)){if(!r.bitrateTest){var a;this.fragCurrent=r,this.partCurrent=(a=t.part)!=null?a:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case B.BUFFER_ADD_CODEC_ERROR:case B.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case B.FRAG_LOAD_TIMEOUT:{let r=t.frag,{fragCurrent:a,partCurrent:n}=this;if(r&&a&&r.sn===a.sn&&r.level===a.level){let l=performance.now(),u=n?n.stats:r.stats,d=l-u.loading.start,c=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&c>-1){let f=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(d-Math.min(f,c),u.loaded)}else this.bwEstimator.sampleTTFB(d)}break}}}getTimeToLoadFrag(e,t,r,a){let n=e+r/t,l=a?this.lastLevelLoadSec:0;return n+l}onLevelLoaded(e,t){let r=this.hls.config,{loading:a}=t.stats,n=a.end-a.start;oe(n)&&(this.lastLevelLoadSec=n/1e3),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)}onFragLoaded(e,{frag:t,part:r}){let a=r?r.stats:t.stats;if(t.type===Ee.MAIN&&this.bwEstimator.sampleTTFB(a.loading.first-a.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){let n=r?r.duration:t.duration,l=this.hls.levels[t.level],u=(l.loaded?l.loaded.bytes:0)+a.loaded,d=(l.loaded?l.loaded.duration:0)+n;l.loaded={bytes:u,duration:d},l.realBitrate=Math.round(8*u/d)}if(t.bitrateTest){let n={stats:a,frag:t,part:r,id:t.type};this.onFragBuffered(b.FRAG_BUFFERED,n),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){let{frag:r,part:a}=t,n=a!=null&&a.stats.loaded?a.stats:r.stats;if(n.aborted||this.ignoreFragment(r))return;let l=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(l,n.loaded),n.bwEstimate=this.getBwEstimate(),r.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==Ee.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){let{maxAutoLevel:e,minAutoLevel:t}=this.hls,r=this.getBwEstimate(),a=this.hls.config.maxStarvationDelay,n=this.findBestLevel(r,t,e,0,a,1,1);if(n>-1)return n;let l=this.hls.firstLevel,u=Math.min(Math.max(l,t),e);return P.warn(`[abr] Could not find best starting auto level. Defaulting to first in playlist ${l} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){let e=this.forcedAutoLevel,t=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!t||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;let a=t&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){let n=this.hls.levels;if(n.length>Math.max(e,a)&&n[e].loadError<=n[a].loadError)return e}return this._nextAutoLevel=a,this.nextAutoLevelKey=this.getAutoLevelKey(),a}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){let{fragCurrent:e,partCurrent:t,hls:r}=this,{maxAutoLevel:a,config:n,minAutoLevel:l}=r,u=t?t.duration:e?e.duration:0,d=this.getBwEstimate(),c=this.getStarvationDelay(),f=n.abrBandWidthFactor,g=n.abrBandWidthUpFactor;if(c){let T=this.findBestLevel(d,l,a,c,0,f,g);if(T>=0)return T}let p=u?Math.min(u,n.maxStarvationDelay):n.maxStarvationDelay;if(!c){let T=this.bitrateTestDelay;T&&(p=(u?Math.min(u,n.maxLoadingDelay):n.maxLoadingDelay)-T,P.info(`[abr] bitrate test took ${Math.round(1e3*T)}ms, set first fragment max fetchDuration to ${Math.round(1e3*p)} ms`),f=g=1)}let y=this.findBestLevel(d,l,a,c,p,f,g);if(P.info(`[abr] ${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${y}`),y>-1)return y;let E=r.levels[l],S=r.levels[r.loadLevel];return E?.bitrate<S?.bitrate?l:r.loadLevel}getStarvationDelay(){let e=this.hls,t=e.media;if(!t)return 1/0;let r=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,a=e.mainForwardBufferInfo;return(a?a.len:0)/r}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,r,a,n,l,u){var d;let c=a+n,f=this.lastLoadedFragLevel,g=f===-1?this.hls.firstLevel:f,{fragCurrent:p,partCurrent:y}=this,{levels:E,allAudioTracks:S,loadLevel:T,config:k}=this.hls;if(E.length===1)return 0;let C=E[g],I=!!(C!=null&&(d=C.details)!=null&&d.live),O=T===-1||f===-1,x,$="SDR",G=C?.frameRate||0,{audioPreference:K,videoPreference:Q}=k,ae=this.audioTracksByGroup||(this.audioTracksByGroup=BS(S));if(O){if(this.firstSelection!==-1)return this.firstSelection;let se=this.codecTiers||(this.codecTiers=$S(E,ae,t,r)),de=US(se,$,e,K,Q),{codecSet:q,videoRanges:re,minFramerate:H,minBitrate:te,preferHDR:Z}=de;x=q,$=Z?re[re.length-1]:re[0],G=H,e=Math.max(e,te),P.log(`[abr] picked start tier ${JSON.stringify(de)}`)}else x=C?.codecSet,$=C?.videoRange;let W=y?y.duration:p?p.duration:0,ee=this.bwEstimator.getEstimateTTFB()/1e3,ge=[];for(let se=r;se>=t;se--){var ie;let de=E[se],q=se>g;if(!de)continue;if(k.useMediaCapabilities&&!de.supportedResult&&!de.supportedPromise){let V=navigator.mediaCapabilities;typeof V?.decodingInfo=="function"&&PS(de,ae,$,G,e,K)?(de.supportedPromise=MS(de,ae,V),de.supportedPromise.then(he=>{if(!this.hls)return;de.supportedResult=he;let me=this.hls.levels,Te=me.indexOf(de);he.error?P.warn(`[abr] MediaCapabilities decodingInfo error: "${he.error}" for level ${Te} ${JSON.stringify(he)}`):he.supported||(P.warn(`[abr] Unsupported MediaCapabilities decodingInfo result for level ${Te} ${JSON.stringify(he)}`),Te>-1&&me.length>1&&(P.log(`[abr] Removing unsupported level ${Te}`),this.hls.removeLevel(Te)))})):de.supportedResult=Lp}if(x&&de.codecSet!==x||$&&de.videoRange!==$||q&&G>de.frameRate||!q&&G>0&&G<de.frameRate||de.supportedResult&&!((ie=de.supportedResult.decodingInfoResults)!=null&&ie[0].smooth)){ge.push(se);continue}let re=de.details,H=(y?re?.partTarget:re?.averagetargetduration)||W,te;q?te=u*e:te=l*e;let Z=W&&a>=W*2&&n===0?E[se].averageBitrate:E[se].maxBitrate,w=this.getTimeToLoadFrag(ee,te,Z*H,re===void 0);if(te>=Z&&(se===f||de.loadError===0&&de.fragmentError===0)&&(w<=ee||!oe(w)||I&&!this.bitrateTestDelay||w<c)){let V=this.forcedAutoLevel;return se!==T&&(V===-1||V!==T)&&(ge.length&&P.trace(`[abr] Skipped level(s) ${ge.join(",")} of ${r} max with CODECS and VIDEO-RANGE:"${E[ge[0]].codecs}" ${E[ge[0]].videoRange}; not compatible with "${C.codecs}" ${$}`),P.info(`[abr] switch candidate:${g}->${se} adjustedbw(${Math.round(te)})-bitrate=${Math.round(te-Z)} ttfb:${ee.toFixed(1)} avgDuration:${H.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${w.toFixed(1)} firstSelection:${O} codecSet:${x} videoRange:${$} hls.loadLevel:${T}`)),O&&(this.firstSelection=se),se}}return-1}set nextAutoLevel(e){let{maxAutoLevel:t,minAutoLevel:r}=this.hls,a=Math.min(Math.max(e,r),t);this._nextAutoLevel!==a&&(this.nextAutoLevelKey="",this._nextAutoLevel=a)}},KS=class{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}},ot={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},zS=class{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(b.BUFFER_APPENDED,this.onBufferAppended,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){let{hls:e}=this;e.off(b.BUFFER_APPENDED,this.onBufferAppended,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){let r=this.activePartLists[t];if(r)for(let a=r.length;a--;){let n=r[a];if(!n)break;let l=n.end;if(n.start<=e&&l!==null&&e<=l)return n}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){let{fragments:r}=this,a=Object.keys(r);for(let n=a.length;n--;){let l=r[a[n]];if(l?.body.type===t&&l.buffered){let u=l.body;if(u.start<=e&&e<=u.end)return u}}return null}detectEvictedFragments(e,t,r,a){this.timeRanges&&(this.timeRanges[e]=t);let n=a?.fragment.sn||-1;Object.keys(this.fragments).forEach(l=>{let u=this.fragments[l];if(!u||n>=u.body.sn)return;if(!u.buffered&&!u.loaded){u.body.type===r&&this.removeFragment(u.body);return}let d=u.range[e];d&&d.time.some(c=>{let f=!this.isTimeBuffered(c.startPTS,c.endPTS,t);return f&&this.removeFragment(u.body),f})})}detectPartialFragments(e){let t=this.timeRanges,{frag:r,part:a}=e;if(!t||r.sn==="initSegment")return;let n=Ui(r),l=this.fragments[n];if(!l||l.buffered&&r.gap)return;let u=!r.relurl;Object.keys(t).forEach(d=>{let c=r.elementaryStreams[d];if(!c)return;let f=t[d],g=u||c.partial===!0;l.range[d]=this.getBufferedTimes(r,a,g,f)}),l.loaded=null,Object.keys(l.range).length?(l.buffered=!0,(l.body.endList=r.endList||l.body.endList)&&(this.endListFragments[l.body.type]=l),hn(l)||this.removeParts(r.sn-1,r.type)):this.removeFragment(l.body)}removeParts(e,t){let r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter(a=>a.fragment.sn>=e))}fragBuffered(e,t){let r=Ui(e),a=this.fragments[r];!a&&t&&(a=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),a&&(a.loaded=null,a.buffered=!0)}getBufferedTimes(e,t,r,a){let n={time:[],partial:r},l=e.start,u=e.end,d=e.minEndPTS||u,c=e.maxStartPTS||l;for(let f=0;f<a.length;f++){let g=a.start(f)-this.bufferPadding,p=a.end(f)+this.bufferPadding;if(c>=g&&d<=p){n.time.push({startPTS:Math.max(l,a.start(f)),endPTS:Math.min(u,a.end(f))});break}else if(l<p&&u>g){let y=Math.max(l,a.start(f)),E=Math.min(u,a.end(f));E>y&&(n.partial=!0,n.time.push({startPTS:y,endPTS:E}))}else if(u<=g)break}return n}getPartialFragment(e){let t=null,r,a,n,l=0,{bufferPadding:u,fragments:d}=this;return Object.keys(d).forEach(c=>{let f=d[c];f&&hn(f)&&(a=f.body.start-u,n=f.body.end+u,e>=a&&e<=n&&(r=Math.min(e-a,n-e),l<=r&&(t=f.body,l=r)))}),t}isEndListAppended(e){let t=this.endListFragments[e];return t!==void 0&&(t.buffered||hn(t))}getState(e){let t=Ui(e),r=this.fragments[t];return r?r.buffered?hn(r)?ot.PARTIAL:ot.OK:ot.APPENDING:ot.NOT_LOADED}isTimeBuffered(e,t,r){let a,n;for(let l=0;l<r.length;l++){if(a=r.start(l)-this.bufferPadding,n=r.end(l)+this.bufferPadding,e>=a&&t<=n)return!0;if(t<=a)return!1}return!1}onFragLoaded(e,t){let{frag:r,part:a}=t;if(r.sn==="initSegment"||r.bitrateTest)return;let n=a?null:t,l=Ui(r);this.fragments[l]={body:r,appendedPTS:null,loaded:n,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){let{frag:r,part:a,timeRanges:n}=t;if(r.sn==="initSegment")return;let l=r.type;if(a){let u=this.activePartLists[l];u||(this.activePartLists[l]=u=[]),u.push(a)}this.timeRanges=n,Object.keys(n).forEach(u=>{let d=n[u];this.detectEvictedFragments(u,d,l,a)})}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){let t=Ui(e);return!!this.fragments[t]}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,r,a,n){a&&!this.hasGaps||Object.keys(this.fragments).forEach(l=>{let u=this.fragments[l];if(!u)return;let d=u.body;d.type!==r||a&&!d.gap||d.start<t&&d.end>e&&(u.buffered||n)&&this.removeFragment(d)})}removeFragment(e){let t=Ui(e);e.stats.loaded=0,e.clearElementaryStreamInfo();let r=this.activePartLists[e.type];if(r){let a=e.sn;this.activePartLists[e.type]=r.filter(n=>n.fragment.sn!==a)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}};function hn(e){var t,r,a;return e.buffered&&(e.body.gap||((t=e.range.video)==null?void 0:t.partial)||((r=e.range.audio)==null?void 0:r.partial)||((a=e.range.audiovideo)==null?void 0:a.partial))}function Ui(e){return`${e.type}_${e.level}_${e.sn}`}var WS={length:0,start:()=>0,end:()=>0},Ke=class Du{static isBuffered(t,r){try{if(t){let a=Du.getBuffered(t);for(let n=0;n<a.length;n++)if(r>=a.start(n)&&r<=a.end(n))return!0}}catch{}return!1}static bufferInfo(t,r,a){try{if(t){let n=Du.getBuffered(t),l=[],u;for(u=0;u<n.length;u++)l.push({start:n.start(u),end:n.end(u)});return this.bufferedInfo(l,r,a)}}catch{}return{len:0,start:r,end:r,nextStart:void 0}}static bufferedInfo(t,r,a){r=Math.max(0,r),t.sort(function(f,g){return f.start-g.start||g.end-f.end});let n=[];if(a)for(let f=0;f<t.length;f++){let g=n.length;if(g){let p=n[g-1].end;t[f].start-p<a?t[f].end>p&&(n[g-1].end=t[f].end):n.push(t[f])}else n.push(t[f])}else n=t;let l=0,u,d=r,c=r;for(let f=0;f<n.length;f++){let g=n[f].start,p=n[f].end;if(r+a>=g&&r<p)d=g,c=p,l=c-r;else if(r+a<g){u=g;break}}return{len:l,start:d||0,end:c||0,nextStart:u}}static getBuffered(t){try{return t.buffered}catch(r){return P.log("failed to get media.buffered",r),WS}}},Ku=class{constructor(e,t,r,a=0,n=-1,l=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=fn(),this.buffering={audio:fn(),video:fn(),audiovideo:fn()},this.level=e,this.sn=t,this.id=r,this.size=a,this.part=n,this.partial=l}};function fn(){return{start:0,executeStart:0,executeEnd:0,end:0}}function Tn(e,t){for(let a=0,n=e.length;a<n;a++){var r;if(((r=e[a])==null?void 0:r.cc)===t)return e[a]}return null}function jS(e,t,r){return!!(t&&(r.endCC>r.startCC||e&&e.cc<r.startCC))}function YS(e,t){let r=e.fragments,a=t.fragments;if(!a.length||!r.length){P.log("No fragments to align");return}let n=Tn(r,a[0].cc);if(!n||n&&!n.startPTS){P.log("No frag in previous level to align on");return}return n}function Tg(e,t){if(e){let r=e.start+t;e.start=e.startPTS=r,e.endPTS=r+e.duration}}function kp(e,t){let r=t.fragments;for(let a=0,n=r.length;a<n;a++)Tg(r[a],e);t.fragmentHint&&Tg(t.fragmentHint,e),t.alignedSliding=!0}function qS(e,t,r){t&&(XS(e,r,t),!r.alignedSliding&&t&&On(r,t),!r.alignedSliding&&t&&!r.skippedSegments&&Ep(t,r))}function XS(e,t,r){if(jS(e,r,t)){let a=YS(r,t);a&&oe(a.start)&&(P.log(`Adjusting PTS using last level due to CC increase within current level ${t.url}`),kp(a.start,t))}}function On(e,t){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;let r=e.fragments,a=t.fragments;if(!r.length||!a.length)return;let n,l,u=Math.min(t.endCC,e.endCC);t.startCC<u&&e.startCC<u&&(n=Tn(a,u),l=Tn(r,u)),(!n||!l)&&(n=a[Math.floor(a.length/2)],l=Tn(r,n.cc)||r[Math.floor(r.length/2)]);let d=n.programDateTime,c=l.programDateTime;if(!d||!c)return;let f=(c-d)/1e3-(l.start-n.start);kp(f,e)}var bg=Math.pow(2,17),QS=class{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){let r=e.url;if(!r)return Promise.reject(new Sr({type:Se.NETWORK_ERROR,details:B.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${r?"part list":"url"}`),networkDetails:null}));this.abort();let a=this.config,n=a.fLoader,l=a.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(y=>y[0]==="GAP")){d(kg(e));return}else e.gap=!1;let c=this.loader=e.loader=n?new n(a):new l(a),f=Lg(e),g=yg(a.fragLoadPolicy.default),p={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:bg};e.stats=c.stats,c.load(f,p,{onSuccess:(y,E,S,T)=>{this.resetLoader(e,c);let k=y.data;S.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(k.slice(0,16)),k=k.slice(16)),u({frag:e,part:null,payload:k,networkDetails:T})},onError:(y,E,S,T)=>{this.resetLoader(e,c),d(new Sr({type:Se.NETWORK_ERROR,details:B.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:ut({url:r,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:S,stats:T}))},onAbort:(y,E,S)=>{this.resetLoader(e,c),d(new Sr({type:Se.NETWORK_ERROR,details:B.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:S,stats:y}))},onTimeout:(y,E,S)=>{this.resetLoader(e,c),d(new Sr({type:Se.NETWORK_ERROR,details:B.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:S,stats:y}))},onProgress:(y,E,S,T)=>{t&&t({frag:e,part:null,payload:S,networkDetails:T})}})})}loadPart(e,t,r){this.abort();let a=this.config,n=a.fLoader,l=a.loader;return new Promise((u,d)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){d(kg(e,t));return}let c=this.loader=e.loader=n?new n(a):new l(a),f=Lg(e,t),g=yg(a.fragLoadPolicy.default),p={loadPolicy:g,timeout:g.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:bg};t.stats=c.stats,c.load(f,p,{onSuccess:(y,E,S,T)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);let k={frag:e,part:t,payload:y.data,networkDetails:T};r(k),u(k)},onError:(y,E,S,T)=>{this.resetLoader(e,c),d(new Sr({type:Se.NETWORK_ERROR,details:B.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:ut({url:f.url,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:S,stats:T}))},onAbort:(y,E,S)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),d(new Sr({type:Se.NETWORK_ERROR,details:B.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:S,stats:y}))},onTimeout:(y,E,S)=>{this.resetLoader(e,c),d(new Sr({type:Se.NETWORK_ERROR,details:B.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${p.timeout}ms`),networkDetails:S,stats:y}))}})})}updateStatsFromPart(e,t){let r=e.stats,a=t.stats,n=a.total;if(r.loaded+=a.loaded,n){let d=Math.round(e.duration/t.duration),c=Math.min(Math.round(r.loaded/n),d),f=(d-c)*Math.round(r.loaded/c);r.total=r.loaded+f}else r.total=Math.max(r.loaded,r.total);let l=r.loading,u=a.loading;l.start?l.first+=u.first-u.start:(l.start=u.start,l.first=u.first),l.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}};function Lg(e,t=null){let r=t||e,a={frag:e,part:t,responseType:"arraybuffer",url:r.url,headers:{},rangeStart:0,rangeEnd:0},n=r.byteRangeStartOffset,l=r.byteRangeEndOffset;if(oe(n)&&oe(l)){var u;let d=n,c=l;if(e.sn==="initSegment"&&((u=e.decryptdata)==null?void 0:u.method)==="AES-128"){let f=l-n;f%16&&(c=l+(16-f%16)),n!==0&&(a.resetIV=!0,d=n-16)}a.rangeStart=d,a.rangeEnd=c}return a}function kg(e,t){let r=new Error(`GAP ${e.gap?"tag":"attribute"} found`),a={type:Se.MEDIA_ERROR,details:B.FRAG_GAP,fatal:!1,frag:e,error:r,networkDetails:null};return t&&(a.part=t),(t||e).stats.aborted=!0,new Sr(a)}var Sr=class extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}},JS=class{constructor(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}decrypt(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)}},ZS=class{constructor(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}};function eT(e){let t=e.byteLength,r=t&&new DataView(e.buffer).getUint8(t-1);return r?si(e,0,t-r):e}var tT=class{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){let t=new DataView(e),r=new Uint32Array(4);for(let a=0;a<4;a++)r[a]=t.getUint32(a*4);return r}initTable(){let e=this.sBox,t=this.invSBox,r=this.subMix,a=r[0],n=r[1],l=r[2],u=r[3],d=this.invSubMix,c=d[0],f=d[1],g=d[2],p=d[3],y=new Uint32Array(256),E=0,S=0,T=0;for(T=0;T<256;T++)T<128?y[T]=T<<1:y[T]=T<<1^283;for(T=0;T<256;T++){let k=S^S<<1^S<<2^S<<3^S<<4;k=k>>>8^k&255^99,e[E]=k,t[k]=E;let C=y[E],I=y[C],O=y[I],x=y[k]*257^k*16843008;a[E]=x<<24|x>>>8,n[E]=x<<16|x>>>16,l[E]=x<<8|x>>>24,u[E]=x,x=O*16843009^I*65537^C*257^E*16843008,c[k]=x<<24|x>>>8,f[k]=x<<16|x>>>16,g[k]=x<<8|x>>>24,p[k]=x,E?(E=C^y[y[y[O^C]]],S^=y[y[S]]):E=S=1}}expandKey(e){let t=this.uint8ArrayToUint32Array_(e),r=!0,a=0;for(;a<t.length&&r;)r=t[a]===this.key[a],a++;if(r)return;this.key=t;let n=this.keySize=t.length;if(n!==4&&n!==6&&n!==8)throw new Error("Invalid aes key size="+n);let l=this.ksRows=(n+6+1)*4,u,d,c=this.keySchedule=new Uint32Array(l),f=this.invKeySchedule=new Uint32Array(l),g=this.sBox,p=this.rcon,y=this.invSubMix,E=y[0],S=y[1],T=y[2],k=y[3],C,I;for(u=0;u<l;u++){if(u<n){C=c[u]=t[u];continue}I=C,u%n===0?(I=I<<8|I>>>24,I=g[I>>>24]<<24|g[I>>>16&255]<<16|g[I>>>8&255]<<8|g[I&255],I^=p[u/n|0]<<24):n>6&&u%n===4&&(I=g[I>>>24]<<24|g[I>>>16&255]<<16|g[I>>>8&255]<<8|g[I&255]),c[u]=C=(c[u-n]^I)>>>0}for(d=0;d<l;d++)u=l-d,d&3?I=c[u]:I=c[u-4],d<4||u<=4?f[d]=I:f[d]=E[g[I>>>24]]^S[g[I>>>16&255]]^T[g[I>>>8&255]]^k[g[I&255]],f[d]=f[d]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,r){let a=this.keySize+6,n=this.invKeySchedule,l=this.invSBox,u=this.invSubMix,d=u[0],c=u[1],f=u[2],g=u[3],p=this.uint8ArrayToUint32Array_(r),y=p[0],E=p[1],S=p[2],T=p[3],k=new Int32Array(e),C=new Int32Array(k.length),I,O,x,$,G,K,Q,ae,W,ee,ge,ie,se,de,q=this.networkToHostOrderSwap;for(;t<k.length;){for(W=q(k[t]),ee=q(k[t+1]),ge=q(k[t+2]),ie=q(k[t+3]),G=W^n[0],K=ie^n[1],Q=ge^n[2],ae=ee^n[3],se=4,de=1;de<a;de++)I=d[G>>>24]^c[K>>16&255]^f[Q>>8&255]^g[ae&255]^n[se],O=d[K>>>24]^c[Q>>16&255]^f[ae>>8&255]^g[G&255]^n[se+1],x=d[Q>>>24]^c[ae>>16&255]^f[G>>8&255]^g[K&255]^n[se+2],$=d[ae>>>24]^c[G>>16&255]^f[K>>8&255]^g[Q&255]^n[se+3],G=I,K=O,Q=x,ae=$,se=se+4;I=l[G>>>24]<<24^l[K>>16&255]<<16^l[Q>>8&255]<<8^l[ae&255]^n[se],O=l[K>>>24]<<24^l[Q>>16&255]<<16^l[ae>>8&255]<<8^l[G&255]^n[se+1],x=l[Q>>>24]<<24^l[ae>>16&255]<<16^l[G>>8&255]<<8^l[K&255]^n[se+2],$=l[ae>>>24]<<24^l[G>>16&255]<<16^l[K>>8&255]<<8^l[Q&255]^n[se+3],C[t]=q(I^y),C[t+1]=q($^E),C[t+2]=q(x^S),C[t+3]=q(O^T),y=W,E=ee,S=ge,T=ie,t=t+4}return C.buffer}},rT=16,zu=class{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{let r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){let{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;let r=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?eT(r):r}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,r){return this.useSoftware?new Promise((a,n)=>{this.softwareDecrypt(new Uint8Array(e),t,r);let l=this.flush();l?a(l.buffer):n(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,r)}softwareDecrypt(e,t,r){let{currentIV:a,currentResult:n,remainderData:l}=this;this.logOnce("JS AES decrypt"),l&&(e=$t(l,e),this.remainderData=null);let u=this.getValidChunk(e);if(!u.length)return null;a&&(r=a);let d=this.softwareDecrypter;d||(d=this.softwareDecrypter=new tT),d.expandKey(t);let c=n;return this.currentResult=d.decrypt(u.buffer,0,r),this.currentIV=si(u,-16).buffer,c||null}webCryptoDecrypt(e,t,r){let a=this.subtle;return(this.key!==t||!this.fastAesKey)&&(this.key=t,this.fastAesKey=new ZS(a,t)),this.fastAesKey.expandKey().then(n=>a?(this.logOnce("WebCrypto AES decrypt"),new JS(a,new Uint8Array(r)).decrypt(e.buffer,n)):Promise.reject(new Error("web crypto not initialized"))).catch(n=>(P.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${n.name}: ${n.message}`),this.onWebCryptoError(e,t,r)))}onWebCryptoError(e,t,r){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,r);let a=this.flush();if(a)return a.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(e){let t=e,r=e.length-e.length%rT;return r!==e.length&&(t=si(e,0,r),this.remainderData=si(e,r)),t}logOnce(e){this.logEnabled&&(P.log(`[decrypter]: ${e}`),this.logEnabled=!1)}},iT={toString:function(e){let t="",r=e.length;for(let a=0;a<r;a++)t+=`[${e.start(a).toFixed(3)}-${e.end(a).toFixed(3)}]`;return t}},z={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},Wu=class extends KS{constructor(e,t,r,a,n){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=z.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=n,this.logPrefix=a,this.log=P.log.bind(P,`${a}:`),this.warn=P.warn.bind(P,`${a}:`),this.hls=e,this.fragmentLoader=new QS(e.config),this.keyLoader=r,this.fragmentTracker=t,this.config=e.config,this.decrypter=new zu(e.config),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);let e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=z.STOPPED}_streamEnded(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;let r=t.partList;if(r!=null&&r.length){let n=r[r.length-1];return Ke.isBuffered(this.media,n.start+n.duration/2)}let a=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(a)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}onMediaAttached(e,t){let r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);let a=this.config;this.levels&&a.autoStartLoad&&this.state===z.STOPPED&&this.startLoad(a.startPosition)}onMediaDetaching(){let e=this.media;e!=null&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){let{config:e,fragCurrent:t,media:r,mediaBuffer:a,state:n}=this,l=r?r.currentTime:0,u=Ke.bufferInfo(a||r,l,e.maxBufferHole);if(this.log(`media seeking to ${oe(l)?l.toFixed(3):l}, state: ${n}`),this.state===z.ENDED)this.resetLoadingState();else if(t){let d=e.maxFragLookUpTolerance,c=t.start-d,f=t.start+t.duration+d;if(!u.len||f<u.start||c>u.end){let g=l>f;(l<c||g)&&(g&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(l,1/0,this.playlistType,!0),this.lastCurrentTime=l),!this.loadedmetadata&&!u.len&&(this.nextLoadPosition=this.startPosition=l),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.hls.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),this.stopLoad(),super.onHandlerDestroying(),this.hls=null}onHandlerDestroyed(){this.state=z.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,r){this._loadFragForPlayback(e,t,r)}_loadFragForPlayback(e,t,r){let a=n=>{if(this.fragContextChanged(e)){this.warn(`Fragment ${e.sn}${n.part?" p: "+n.part.index:""} of level ${e.level} was dropped during download.`),this.fragmentTracker.removeFragment(e);return}e.stats.chunkCount++,this._handleFragmentLoadProgress(n)};this._doFragLoad(e,t,r,a).then(n=>{if(!n)return;let l=this.state;if(this.fragContextChanged(e)){(l===z.FRAG_LOADING||!this.fragCurrent&&l===z.PARSING)&&(this.fragmentTracker.removeFragment(e),this.state=z.IDLE);return}"payload"in n&&(this.log(`Loaded fragment ${e.sn} of level ${e.level}`),this.hls.trigger(b.FRAG_LOADED,n)),this._handleFragmentLoadComplete(n)}).catch(n=>{this.state===z.STOPPED||this.state===z.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;let{fragmentTracker:r}=this;if(r.getState(e)===ot.APPENDING){let a=e.type,n=this.getFwdBufferInfo(this.mediaBuffer,a),l=Math.max(e.duration,n?n.len:this.config.maxBufferLength);this.reduceMaxBufferLength(l)&&r.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?r.removeAllFragments():r.hasParts(e.type)&&(r.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),r.getState(e)===ot.PARTIAL&&r.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){let t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}flushMainBuffer(e,t,r=null){if(!(e-t))return;let a={startOffset:e,endOffset:t,type:r};this.hls.trigger(b.BUFFER_FLUSHING,a)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(r=>{if(!r||this.fragContextChanged(e)||!this.levels)throw new Error("init load aborted");return r}).then(r=>{let{hls:a}=this,{payload:n}=r,l=e.decryptdata;if(n&&n.byteLength>0&&l!=null&&l.key&&l.iv&&l.method==="AES-128"){let u=self.performance.now();return this.decrypter.decrypt(new Uint8Array(n),l.key.buffer,l.iv.buffer).catch(d=>{throw a.trigger(b.ERROR,{type:Se.MEDIA_ERROR,details:B.FRAG_DECRYPT_ERROR,fatal:!1,error:d,reason:d.message,frag:e}),d}).then(d=>{let c=self.performance.now();return a.trigger(b.FRAG_DECRYPTED,{frag:e,payload:d,stats:{tstart:u,tdecrypt:c}}),r.payload=d,this.completeInitSegmentLoad(r)})}return this.completeInitSegmentLoad(r)}).catch(r=>{this.state===z.STOPPED||this.state===z.ERROR||(this.warn(r),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){let{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");let r=e.frag.stats;this.state=z.IDLE,e.frag.data=new Uint8Array(e.payload),r.parsing.start=r.buffering.start=self.performance.now(),r.parsing.end=r.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){let{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){var r,a,n,l;let u=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.playlistType===Ee.MAIN?"level":"track"} ${e.level} (frag:[${((r=e.startPTS)!=null?r:NaN).toFixed(3)}-${((a=e.endPTS)!=null?a:NaN).toFixed(3)}] > buffer:${u?iT.toString(Ke.getBuffered(u)):"(detached)"})`),e.sn!=="initSegment"){var d;if(e.type!==Ee.SUBTITLE){let f=e.elementaryStreams;if(!Object.keys(f).some(g=>!!f[g])){this.state=z.IDLE;return}}let c=(d=this.levels)==null?void 0:d[e.level];c!=null&&c.fragmentError&&(this.log(`Resetting level fragment error count of ${c.fragmentError} on frag buffered`),c.fragmentError=0)}this.state=z.IDLE,u&&(!this.loadedmetadata&&e.type==Ee.MAIN&&u.buffered.length&&((n=this.fragCurrent)==null?void 0:n.sn)===((l=this.fragPrevious)==null?void 0:l.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(e){let{transmuxer:t}=this;if(!t)return;let{frag:r,part:a,partsLoaded:n}=e,l=!n||n.length===0||n.some(d=>!d),u=new Ku(r.level,r.sn,r.stats.chunkCount+1,0,a?a.index:-1,!l);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,r=null,a){var n;let l=t?.details;if(!this.levels||!l)throw new Error(`frag load aborted, missing level${l?"":" detail"}s`);let u=null;if(e.encrypted&&!((n=e.decryptdata)!=null&&n.key)?(this.log(`Loading key for ${e.sn} of [${l.startSN}-${l.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${e.level}`),this.state=z.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(f=>{if(!this.fragContextChanged(f.frag))return this.hls.trigger(b.KEY_LOADED,f),this.state===z.KEY_LOADING&&(this.state=z.IDLE),f}),this.hls.trigger(b.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(u=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&l.encryptedFragments.length&&this.keyLoader.loadClear(e,l.encryptedFragments),r=Math.max(e.start,r||0),this.config.lowLatencyMode&&e.sn!=="initSegment"){let f=l.partList;if(f&&a){r>e.end&&l.fragmentHint&&(e=l.fragmentHint);let g=this.getNextPart(f,e,r);if(g>-1){let p=f[g];this.log(`Loading part sn: ${e.sn} p: ${p.index} cc: ${e.cc} of playlist [${l.startSN}-${l.endSN}] parts [0-${g}-${f.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),this.nextLoadPosition=p.start+p.duration,this.state=z.FRAG_LOADING;let y;return u?y=u.then(E=>!E||this.fragContextChanged(E.frag)?null:this.doFragPartsLoad(e,p,t,a)).catch(E=>this.handleFragLoadError(E)):y=this.doFragPartsLoad(e,p,t,a).catch(E=>this.handleFragLoadError(E)),this.hls.trigger(b.FRAG_LOADING,{frag:e,part:p,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):y}else if(!e.url||this.loadedEndOfParts(f,r))return Promise.resolve(null)}}this.log(`Loading fragment ${e.sn} cc: ${e.cc} ${l?"of ["+l.startSN+"-"+l.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${e.level}, target: ${parseFloat(r.toFixed(3))}`),oe(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=z.FRAG_LOADING;let d=this.config.progressive,c;return d&&u?c=u.then(f=>!f||this.fragContextChanged(f?.frag)?null:this.fragmentLoader.load(e,a)).catch(f=>this.handleFragLoadError(f)):c=Promise.all([this.fragmentLoader.load(e,d?a:void 0),u]).then(([f])=>(!d&&f&&a&&a(f),f)).catch(f=>this.handleFragLoadError(f)),this.hls.trigger(b.FRAG_LOADING,{frag:e,targetBufferTime:r}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):c}doFragPartsLoad(e,t,r,a){return new Promise((n,l)=>{var u;let d=[],c=(u=r.details)==null?void 0:u.partList,f=g=>{this.fragmentLoader.loadPart(e,g,a).then(p=>{d[g.index]=p;let y=p.part;this.hls.trigger(b.FRAG_LOADED,p);let E=pg(r,e.sn,g.index+1)||Sp(c,e.sn,g.index+1);if(E)f(E);else return n({frag:e,part:y,partsLoaded:d})}).catch(l)};f(t)})}handleFragLoadError(e){if("data"in e){let t=e.data;e.data&&t.details===B.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(b.ERROR,t)}else this.hls.trigger(b.ERROR,{type:Se.OTHER_ERROR,details:B.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){let t=this.getCurrentContext(e);if(!t||this.state!==z.PARSING){!this.fragCurrent&&this.state!==z.STOPPED&&this.state!==z.ERROR&&(this.state=z.IDLE);return}let{frag:r,part:a,level:n}=t,l=self.performance.now();r.stats.parsing.end=l,a&&(a.stats.parsing.end=l),this.updateLevelTiming(r,a,n,e.partial)}getCurrentContext(e){let{levels:t,fragCurrent:r}=this,{level:a,sn:n,part:l}=e;if(!(t!=null&&t[a]))return this.warn(`Levels object was unset while buffering fragment ${n} of level ${a}. The current chunk will not be buffered.`),null;let u=t[a],d=l>-1?pg(u,n,l):null,c=d?d.fragment:wS(u,n,r);return c?(r&&r!==c&&(c.stats=r.stats),{frag:c,part:d,level:u}):null}bufferFragmentData(e,t,r,a,n){var l;if(!e||this.state!==z.PARSING)return;let{data1:u,data2:d}=e,c=u;if(u&&d&&(c=$t(u,d)),!((l=c)!=null&&l.length))return;let f={type:e.type,frag:t,part:r,chunkMeta:a,parent:t.type,data:c};if(this.hls.trigger(b.BUFFER_APPENDING,f),e.dropped&&e.independent&&!r){if(n)return;this.flushBufferGap(t)}}flushBufferGap(e){let t=this.media;if(!t)return;if(!Ke.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}let r=t.currentTime,a=Ke.bufferInfo(t,r,0),n=e.duration,l=Math.min(this.config.maxFragLookUpTolerance*2,n*.25),u=Math.max(Math.min(e.start-l,a.end-l),r+l);e.start-u>l&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){let r=this.getLoadPosition();return oe(r)?this.getFwdBufferInfoAtPos(e,r,t):null}getFwdBufferInfoAtPos(e,t,r){let{config:{maxBufferHole:a}}=this,n=Ke.bufferInfo(e,t,a);if(n.len===0&&n.nextStart!==void 0){let l=this.fragmentTracker.getBufferedFrag(t,r);if(l&&n.nextStart<l.end)return Ke.bufferInfo(e,t,Math.max(n.nextStart,a))}return n}getMaxBufferLength(e){let{config:t}=this,r;return e?r=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):r=t.maxBufferLength,Math.min(r,t.maxMaxBufferLength)}reduceMaxBufferLength(e){let t=this.config,r=e||t.maxBufferLength;return t.maxMaxBufferLength>=r?(t.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${t.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(e,t=Ee.MAIN){let r=this.fragmentTracker.getAppendedFrag(e,Ee.MAIN);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){let r=t.fragments,a=r.length;if(!a)return null;let{config:n}=this,l=r[0].start,u;if(t.live){let d=n.initialLiveManifestSize;if(a<d)return this.warn(`Not enough fragments to start playback (have: ${a}, need: ${d})`),null;(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<l)&&(u=this.getInitialLiveFragment(t,r),this.startPosition=this.nextLoadPosition=u?this.hls.liveSyncPosition||u.start:e)}else e<=l&&(u=r[0]);if(!u){let d=n.lowLatencyMode?t.partEnd:t.fragmentEnd;u=this.getFragmentAtPosition(e,d,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){let r=this.fragmentTracker.getState(e);return(r===ot.OK||r===ot.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,r,a,n){let l=e.gap,u=this.getNextFragment(this.nextLoadPosition,t);if(u===null)return u;if(e=u,l&&e&&!e.gap&&r.nextStart){let d=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,r.nextStart,a);if(d!==null&&r.len+d.len>=n)return this.log(`buffer full after gaps in "${a}" playlist starting at sn: ${e.sn}`),null}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,r){let a=-1,n=!1,l=!0;for(let u=0,d=e.length;u<d;u++){let c=e[u];if(l=l&&!c.independent,a>-1&&r<c.start)break;let f=c.loaded;f?a=-1:(n||c.independent||l)&&c.fragment===t&&(a=u),n=f}return a}loadedEndOfParts(e,t){let r=e[e.length-1];return r&&t>r.start&&r.loaded}getInitialLiveFragment(e,t){let r=this.fragPrevious,a=null;if(r){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${r.programDateTime}`),a=DS(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!a){let n=r.sn+1;if(n>=e.startSN&&n<=e.endSN){let l=t[n-e.startSN];r.cc===l.cc&&(a=l,this.log(`Live playlist, switching playlist, load frag with next SN: ${a.sn}`))}a||(a=CS(t,r.cc),a&&this.log(`Live playlist, switching playlist, load frag with same CC: ${a.sn}`))}}else{let n=this.hls.liveSyncPosition;n!==null&&(a=this.getFragmentAtPosition(n,this.bitrateTest?e.fragmentEnd:e.edge,e))}return a}getFragmentAtPosition(e,t,r){let{config:a}=this,{fragPrevious:n}=this,{fragments:l,endSN:u}=r,{fragmentHint:d}=r,c=a.maxFragLookUpTolerance,f=r.partList,g=!!(a.lowLatencyMode&&f!=null&&f.length&&d);g&&d&&!this.bitrateTest&&(l=l.concat(d),u=d.sn);let p;if(e<t){let y=e>t-c?0:c;p=Nn(n,l,e,y)}else p=l[l.length-1];if(p){let y=p.sn-r.startSN,E=this.fragmentTracker.getState(p);if((E===ot.OK||E===ot.PARTIAL&&p.gap)&&(n=p),n&&p.sn===n.sn&&(!g||f[0].fragment.sn>p.sn)&&n&&p.level===n.level){let S=l[y+1];p.sn<u&&this.fragmentTracker.getState(S)!==ot.OK?p=S:p=null}}return p}synchronizeToLiveEdge(e){let{config:t,media:r}=this;if(!r)return;let a=this.hls.liveSyncPosition,n=r.currentTime,l=e.fragments[0].start,u=e.edge,d=n>=l-t.maxFragLookUpTolerance&&n<=u;if(a!==null&&r.duration>a&&(n<a||!d)){let c=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!d&&r.readyState<4||n<u-c)&&(this.loadedmetadata||(this.nextLoadPosition=a),r.readyState&&(this.warn(`Playback: ${n.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${a.toFixed(3)}`),r.currentTime=a))}}alignPlaylists(e,t,r){let a=e.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;let n=e.fragments[0].start,l=!t,u=e.alignedSliding&&oe(n);if(l||!u&&!n){let{fragPrevious:d}=this;qS(d,r,e);let c=e.fragments[0].start;return this.log(`Live playlist sliding: ${c.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} prev-sn: ${d?d.sn:"na"} fragments: ${a}`),c}return n}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let r=this.startPosition;if(r<t&&(r=-1),r===-1||this.lastCurrentTime===-1){let a=this.startTimeOffset!==null,n=a?this.startTimeOffset:e.startTimeOffset;n!==null&&oe(n)?(r=t+n,n<0&&(r+=e.totalduration),r=Math.min(Math.max(t,r),t+e.totalduration),this.log(`Start time offset ${n} found in ${a?"multivariant":"media"} playlist, adjust startPosition to ${r}`),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r}getLoadPosition(){let{media:e}=this,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t}handleFragLoadAborted(e,t){this.transmuxer&&e.sn!=="initSegment"&&e.stats.aborted&&(this.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==z.FRAG_LOADING_WAITING_RETRY)&&(this.state=z.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){let f=this.getCurrentContext(t.chunkMeta);f&&(t.frag=f.frag)}let r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var a;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(a=this.fragCurrent)==null?void 0:a.url}`);return}let n=t.details===B.FRAG_GAP;n&&this.fragmentTracker.fragBuffered(r,!0);let l=t.errorAction,{action:u,retryCount:d=0,retryConfig:c}=l||{};if(l&&u===lt.RetryRequest&&c){this.resetStartWhenNotLoaded(this.levelLastLoaded);let f=Vu(c,d);this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${d+1}/${c.maxNumRetry} in ${f}ms`),l.resolved=!0,this.retryDate=self.performance.now()+f,this.state=z.FRAG_LOADING_WAITING_RETRY}else if(c&&l)if(this.resetFragmentErrors(e),d<c.maxNumRetry)!n&&u!==lt.RemoveAlternatePermanently&&(l.resolved=!0);else{P.warn(`${t.details} reached or exceeded max retry (${d})`);return}else l?.action===lt.SendAlternateToPenaltyBox?this.state=z.WAITING_LEVEL:this.state=z.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===z.PARSING||this.state===z.PARSED){let t=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,t),a=r&&r.len>.5;a&&this.reduceMaxBufferLength(r.len);let n=!a;return n&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${t} buffer`),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),n}return!1}resetFragmentErrors(e){e===Ee.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==z.STOPPED&&(this.state=z.IDLE)}afterBufferFlushed(e,t,r){if(!e)return;let a=Ke.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,a,r),this.state===z.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=z.IDLE}resetStartWhenNotLoaded(e){if(!this.loadedmetadata){this.startFragRequested=!1;let t=e?e.details:null;t!=null&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of level ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,r,a){var n;let l=r.details;if(!l){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((u,d)=>{let c=e.elementaryStreams[d];if(c){let f=c.endPTS-c.startPTS;if(f<=0)return this.warn(`Could not parse fragment ${e.sn} ${d} duration reliably (${f})`),u||!1;let g=a?0:yp(l,e,c.startPTS,c.endPTS,c.startDTS,c.endDTS);return this.hls.trigger(b.LEVEL_PTS_UPDATED,{details:l,level:r,drift:g,type:d,frag:e,start:c.startPTS,end:c.endPTS}),!0}return u},!1)&&((n=this.transmuxer)==null?void 0:n.error)===null){let u=new Error(`Found no media in fragment ${e.sn} of level ${e.level} resetting transmuxer to fallback to playlist timing`);if(r.fragmentError===0&&(r.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(u.message),this.hls.trigger(b.ERROR,{type:Se.MEDIA_ERROR,details:B.FRAG_PARSING_ERROR,fatal:!1,error:u,frag:e,reason:`Found no media in msn ${e.sn} of level "${r.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=z.PARSED,this.hls.trigger(b.FRAG_PARSED,{frag:e,part:t})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){let t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}},Ap=class{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){let{chunks:e,dataLength:t}=this,r;if(e.length)e.length===1?r=e[0]:r=aT(e,t);else return new Uint8Array(0);return this.reset(),r}reset(){this.chunks.length=0,this.dataLength=0}};function aT(e,t){let r=new Uint8Array(t),a=0;for(let n=0;n<e.length;n++){let l=e[n];r.set(l,a),a+=l.length}return r}function sT(){return typeof __HLS_WORKER_BUNDLE__=="function"}function nT(){let e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e);return{worker:new self.Worker(t),objectURL:t}}function lT(e){let t=new self.URL(e,self.location.href).href;return{worker:new self.Worker(t),scriptURL:t}}function sr(e="",t=9e4){return{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}var ju=class{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,r,a){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,r){}demux(e,t){this.cachedData&&(e=$t(this.cachedData,e),this.cachedData=null);let r=Ua(e,0),a=r?r.length:0,n,l=this._audioTrack,u=this._id3Track,d=r?Gu(r):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&oe(d))&&(this.basePTS=oT(d,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),r&&r.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Xt.audioId3,duration:Number.POSITIVE_INFINITY});a<c;){if(this.canParse(e,a)){let f=this.appendFrame(l,e,a);f?(this.frameIndex++,this.lastPTS=f.sample.pts,a+=f.length,n=a):a=c}else _E(e,a)?(r=Ua(e,a),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:Xt.audioId3,duration:Number.POSITIVE_INFINITY}),a+=r.length,n=a):a++;if(a===c&&n!==c){let f=si(e,n);this.cachedData?this.cachedData=$t(this.cachedData,f):this.cachedData=f}}return{audioTrack:l,videoTrack:sr(),id3Track:u,textTrack:sr()}}demuxSampleAes(e,t,r){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){let t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:sr(),id3Track:this._id3Track,textTrack:sr()}}destroy(){}},oT=(e,t,r)=>{if(oe(e))return e*90;let a=r?r.baseTime*9e4/r.timescale:0;return t*9e4+a};function uT(e,t,r,a){let n,l,u,d,c=navigator.userAgent.toLowerCase(),f=a,g=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=((t[r+2]&192)>>>6)+1;let p=(t[r+2]&60)>>>2;if(p>g.length-1){let y=new Error(`invalid ADTS sampling index:${p}`);e.emit(b.ERROR,b.ERROR,{type:Se.MEDIA_ERROR,details:B.FRAG_PARSING_ERROR,fatal:!0,error:y,reason:y.message});return}return u=(t[r+2]&1)<<2,u|=(t[r+3]&192)>>>6,P.log(`manifest codec:${a}, ADTS type:${n}, samplingIndex:${p}`),/firefox/i.test(c)?p>=6?(n=5,d=new Array(4),l=p-3):(n=2,d=new Array(2),l=p):c.indexOf("android")!==-1?(n=2,d=new Array(2),l=p):(n=5,d=new Array(4),a&&(a.indexOf("mp4a.40.29")!==-1||a.indexOf("mp4a.40.5")!==-1)||!a&&p>=6?l=p-3:((a&&a.indexOf("mp4a.40.2")!==-1&&(p>=6&&u===1||/vivaldi/i.test(c))||!a&&u===1)&&(n=2,d=new Array(2)),l=p)),d[0]=n<<3,d[0]|=(p&14)>>1,d[1]|=(p&1)<<7,d[1]|=u<<3,n===5&&(d[1]|=(l&14)>>1,d[2]=(l&1)<<7,d[2]|=8,d[3]=0),{config:d,samplerate:g[p],channelCount:u,codec:"mp4a.40."+n,manifestCodec:f}}function wp(e,t){return e[t]===255&&(e[t+1]&246)===240}function Rp(e,t){return e[t+1]&1?7:9}function Yu(e,t){return(e[t+3]&3)<<11|e[t+4]<<3|(e[t+5]&224)>>>5}function dT(e,t){return t+5<e.length}function Fn(e,t){return t+1<e.length&&wp(e,t)}function cT(e,t){return dT(e,t)&&wp(e,t)&&Yu(e,t)<=e.length-t}function hT(e,t){if(Fn(e,t)){let r=Rp(e,t);if(t+r>=e.length)return!1;let a=Yu(e,t);if(a<=r)return!1;let n=t+a;return n===e.length||Fn(e,n)}return!1}function Dp(e,t,r,a,n){if(!e.samplerate){let l=uT(t,r,a,n);if(!l)return;e.config=l.config,e.samplerate=l.samplerate,e.channelCount=l.channelCount,e.codec=l.codec,e.manifestCodec=l.manifestCodec,P.log(`parsed codec:${e.codec}, rate:${l.samplerate}, channels:${l.channelCount}`)}}function Ip(e){return 1024*9e4/e}function fT(e,t){let r=Rp(e,t);if(t+r<=e.length){let a=Yu(e,t)-r;if(a>0)return{headerLength:r,frameLength:a}}}function Cp(e,t,r,a,n){let l=Ip(e.samplerate),u=a+n*l,d=fT(t,r),c;if(d){let{frameLength:g,headerLength:p}=d,y=p+g,E=Math.max(0,r+y-t.length);E?(c=new Uint8Array(y-p),c.set(t.subarray(r+p,t.length),0)):c=t.subarray(r+p,r+y);let S={unit:c,pts:u};return E||e.samples.push(S),{sample:S,length:y,missing:E}}let f=t.length-r;return c=new Uint8Array(f),c.set(t.subarray(r,t.length),0),{sample:{unit:c,pts:u},length:f,missing:-1}}var mn=null,mT=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],gT=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],pT=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],vT=[0,1,1,4];function _p(e,t,r,a,n){if(r+24>t.length)return;let l=xp(t,r);if(l&&r+l.frameLength<=t.length){let u=l.samplesPerFrame*9e4/l.sampleRate,d=a+n*u,c={unit:t.subarray(r,r+l.frameLength),pts:d,dts:d};return e.config=[],e.channelCount=l.channelCount,e.samplerate=l.sampleRate,e.samples.push(c),{sample:c,length:l.frameLength,missing:0}}}function xp(e,t){let r=e[t+1]>>3&3,a=e[t+1]>>1&3,n=e[t+2]>>4&15,l=e[t+2]>>2&3;if(r!==1&&n!==0&&n!==15&&l!==3){let u=e[t+2]>>1&1,d=e[t+3]>>6,c=r===3?3-a:a===3?3:4,f=mT[c*14+n-1]*1e3,g=gT[(r===3?0:r===2?1:2)*3+l],p=d===3?1:2,y=pT[r][a],E=vT[a],S=y*8*E,T=Math.floor(y*f/g+u)*E;if(mn===null){let k=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);mn=k?parseInt(k[1]):0}return mn&&mn<=87&&a===2&&f>=224e3&&d===0&&(e[t+3]=e[t+3]|128),{sampleRate:g,channelCount:p,frameLength:T,samplesPerFrame:S}}}function qu(e,t){return e[t]===255&&(e[t+1]&224)===224&&(e[t+1]&6)!==0}function Pp(e,t){return t+1<e.length&&qu(e,t)}function yT(e,t){return qu(e,t)&&4<=e.length-t}function Mp(e,t){if(t+1<e.length&&qu(e,t)){let r=xp(e,t),a=4;r!=null&&r.frameLength&&(a=r.frameLength);let n=t+a;return n===e.length||Pp(e,n)}return!1}var ET=class extends ju{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,r,a){super.resetInitSegment(e,t,r,a),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=Ua(e,0),r=t?.length||0;if(Mp(e,r))return!1;for(let a=e.length;r<a;r++)if(hT(e,r))return P.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return cT(e,t)}appendFrame(e,t,r){Dp(e,this.observer,t,r,e.manifestCodec);let a=Cp(e,t,r,this.basePTS,this.frameIndex);if(a&&a.missing===0)return a}},ST=/\/emsg[-/]ID3/i,TT=class{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,r,a){let n=this.videoTrack=sr("video",1),l=this.audioTrack=sr("audio",1),u=this.txtTrack=sr("text",1);if(this.id3Track=sr("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;let d=up(e);if(d.video){let{id:c,timescale:f,codec:g}=d.video;n.id=c,n.timescale=u.timescale=f,n.codec=g}if(d.audio){let{id:c,timescale:f,codec:g}=d.audio;l.id=c,l.timescale=f,l.codec=g}u.id=np.text,n.sampleDuration=0,n.duration=l.duration=a}resetContiguity(){this.remainderData=null}static probe(e){return $E(e)}demux(e,t){this.timeOffset=t;let r=e,a=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=$t(this.remainderData,e));let u=YE(r);this.remainderData=u.remainder,a.samples=u.valid||new Uint8Array}else a.samples=r;let l=this.extractID3Track(a,t);return n.samples=Qm(t,a),{videoTrack:a,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}}flush(){let e=this.timeOffset,t=this.videoTrack,r=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;let a=this.extractID3Track(t,this.timeOffset);return r.samples=Qm(e,t),{videoTrack:t,audioTrack:sr(),id3Track:a,textTrack:sr()}}extractID3Track(e,t){let r=this.id3Track;if(e.samples.length){let a=Le(e.samples,["emsg"]);a&&a.forEach(n=>{let l=QE(n);if(ST.test(l.schemeIdUri)){let u=oe(l.presentationTime)?l.presentationTime/l.timeScale:t+l.presentationTimeDelta/l.timeScale,d=l.eventDuration===4294967295?Number.POSITIVE_INFINITY:l.eventDuration/l.timeScale;d<=.001&&(d=Number.POSITIVE_INFINITY);let c=l.payload;r.samples.push({data:c,len:c.byteLength,dts:u,pts:u,type:Xt.emsg,duration:d})}})}return r}demuxSampleAes(e,t,r){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}},Np=(e,t)=>{let r=0,a=5;t+=a;let n=new Uint32Array(1),l=new Uint32Array(1),u=new Uint8Array(1);for(;a>0;){u[0]=e[t];let d=Math.min(a,8),c=8-d;l[0]=4278190080>>>24+c<<c,n[0]=(u[0]&l[0])>>c,r=r?r<<d|n[0]:n[0],t+=1,a-=d}return r},bT=class extends ju{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,r,a){super.resetInitSegment(e,t,r,a),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,r){let a=Op(e,t,r,this.basePTS,this.frameIndex);if(a!==-1)return{sample:e.samples[e.samples.length-1],length:a,missing:0}}static probe(e){if(!e)return!1;let t=Ua(e,0);if(!t)return!1;let r=t.length;return e[r]===11&&e[r+1]===119&&Gu(t)!==void 0&&Np(e,r)<16}};function Op(e,t,r,a,n){if(r+8>t.length||t[r]!==11||t[r+1]!==119)return-1;let l=t[r+4]>>6;if(l>=3)return-1;let u=[48e3,44100,32e3][l],d=t[r+4]&63,c=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][d*3+l]*2;if(r+c>t.length)return-1;let f=t[r+6]>>5,g=0;f===2?g+=2:(f&1&&f!==1&&(g+=2),f&4&&(g+=2));let p=(t[r+6]<<8|t[r+7])>>12-g&1,y=[2,1,2,3,3,4,4,5][f]+p,E=t[r+5]>>3,S=t[r+5]&7,T=new Uint8Array([l<<6|E<<1|S>>2,(S&3)<<6|f<<3|p<<2|d>>4,d<<4&224]),k=1536/u*9e4,C=a+n*k,I=t.subarray(r,r+c);return e.config=T,e.channelCount=y,e.samplerate=u,e.samples.push({unit:I,pts:C}),c}var LT=class{constructor(){this.VideoSample=null}createVideoSample(e,t,r,a){return{key:e,frame:!1,pts:t,dts:r,units:[],debug:a,length:0}}getLastNalUnit(e){var t;let r=this.VideoSample,a;if((!r||r.units.length===0)&&(r=e[e.length-1]),(t=r)!=null&&t.units){let n=r.units;a=n[n.length-1]}return a}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){let r=t.samples,a=r.length;if(a){let n=r[a-1];e.pts=n.pts,e.dts=n.dts}else{t.dropped++;return}}t.samples.push(e)}e.debug.length&&P.log(e.pts+"/"+e.dts+":"+e.debug)}},Ag=class{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){let e=this.data,t=this.bytesAvailable,r=e.byteLength-t,a=new Uint8Array(4),n=Math.min(4,t);if(n===0)throw new Error("no bytes available");a.set(e.subarray(r,r+n)),this.word=new DataView(a.buffer).getUint32(0),this.bitsAvailable=n*8,this.bytesAvailable-=n}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;if(e>32&&P.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if(this.word&2147483648>>>e)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){let e=this.skipLZ();return this.readBits(e+1)-1}readEG(){let e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(e){let t=8,r=8,a;for(let n=0;n<e;n++)r!==0&&(a=this.readEG(),r=(t+a+256)%256),t=r===0?t:r}readSPS(){let e=0,t=0,r=0,a=0,n,l,u,d=this.readUByte.bind(this),c=this.readBits.bind(this),f=this.readUEG.bind(this),g=this.readBoolean.bind(this),p=this.skipBits.bind(this),y=this.skipEG.bind(this),E=this.skipUEG.bind(this),S=this.skipScalingList.bind(this);d();let T=d();if(c(5),p(3),d(),E(),T===100||T===110||T===122||T===244||T===44||T===83||T===86||T===118||T===128){let $=f();if($===3&&p(1),E(),E(),p(1),g())for(l=$!==3?8:12,u=0;u<l;u++)g()&&(u<6?S(16):S(64))}E();let k=f();if(k===0)f();else if(k===1)for(p(1),y(),y(),n=f(),u=0;u<n;u++)y();E(),p(1);let C=f(),I=f(),O=c(1);O===0&&p(1),p(1),g()&&(e=f(),t=f(),r=f(),a=f());let x=[1,1];if(g()&&g())switch(d()){case 1:x=[1,1];break;case 2:x=[12,11];break;case 3:x=[10,11];break;case 4:x=[16,11];break;case 5:x=[40,33];break;case 6:x=[24,11];break;case 7:x=[20,11];break;case 8:x=[32,11];break;case 9:x=[80,33];break;case 10:x=[18,11];break;case 11:x=[15,11];break;case 12:x=[64,33];break;case 13:x=[160,99];break;case 14:x=[4,3];break;case 15:x=[3,2];break;case 16:x=[2,1];break;case 255:{x=[d()<<8|d(),d()<<8|d()];break}}return{width:Math.ceil((C+1)*16-e*2-t*2),height:(2-O)*(I+1)*16-(O?2:4)*(r+a),pixelRatio:x}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}},kT=class extends LT{parseAVCPES(e,t,r,a,n){let l=this.parseAVCNALu(e,r.data),u=this.VideoSample,d,c=!1;r.data=null,u&&l.length&&!e.audFound&&(this.pushAccessUnit(u,e),u=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"")),l.forEach(f=>{var g;switch(f.type){case 1:{let S=!1;d=!0;let T=f.data;if(c&&T.length>4){let k=new Ag(T).readSliceType();(k===2||k===4||k===7||k===9)&&(S=!0)}if(S){var p;(p=u)!=null&&p.frame&&!u.key&&(this.pushAccessUnit(u,e),u=this.VideoSample=null)}u||(u=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),u.frame=!0,u.key=S;break}case 5:d=!0,(g=u)!=null&&g.frame&&!u.key&&(this.pushAccessUnit(u,e),u=this.VideoSample=null),u||(u=this.VideoSample=this.createVideoSample(!0,r.pts,r.dts,"")),u.key=!0,u.frame=!0;break;case 6:{d=!0,cp(f.data,1,r.pts,t.samples);break}case 7:{var y,E;d=!0,c=!0;let S=f.data,T=new Ag(S).readSPS();if(!e.sps||e.width!==T.width||e.height!==T.height||((y=e.pixelRatio)==null?void 0:y[0])!==T.pixelRatio[0]||((E=e.pixelRatio)==null?void 0:E[1])!==T.pixelRatio[1]){e.width=T.width,e.height=T.height,e.pixelRatio=T.pixelRatio,e.sps=[S],e.duration=n;let k=S.subarray(1,4),C="avc1.";for(let I=0;I<3;I++){let O=k[I].toString(16);O.length<2&&(O="0"+O),C+=O}e.codec=C}break}case 8:d=!0,e.pps=[f.data];break;case 9:d=!0,e.audFound=!0,u&&this.pushAccessUnit(u,e),u=this.VideoSample=this.createVideoSample(!1,r.pts,r.dts,"");break;case 12:d=!0;break;default:d=!1,u&&(u.debug+="unknown NAL "+f.type+" ");break}u&&d&&u.units.push(f)}),a&&u&&(this.pushAccessUnit(u,e),this.VideoSample=null)}parseAVCNALu(e,t){let r=t.byteLength,a=e.naluState||0,n=a,l=[],u=0,d,c,f,g=-1,p=0;for(a===-1&&(g=0,p=t[0]&31,a=0,u=1);u<r;){if(d=t[u++],!a){a=d?0:1;continue}if(a===1){a=d?0:2;continue}if(!d)a=3;else if(d===1){if(c=u-a-1,g>=0){let y={data:t.subarray(g,c),type:p};l.push(y)}else{let y=this.getLastNalUnit(e.samples);y&&(n&&u<=4-n&&y.state&&(y.data=y.data.subarray(0,y.data.byteLength-n)),c>0&&(y.data=$t(y.data,t.subarray(0,c)),y.state=0))}u<r?(f=t[u]&31,g=u,p=f,a=0):a=-1}else a=0}if(g>=0&&a>=0){let y={data:t.subarray(g,r),type:p,state:a};l.push(y)}if(l.length===0){let y=this.getLastNalUnit(e.samples);y&&(y.data=$t(y.data,t))}return e.naluState=a,l}},AT=class{constructor(e,t,r){this.keyData=void 0,this.decrypter=void 0,this.keyData=r,this.decrypter=new zu(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(e,t,r){let a=e[t].unit;if(a.length<=16)return;let n=a.subarray(16,a.length-a.length%16),l=n.buffer.slice(n.byteOffset,n.byteOffset+n.length);this.decryptBuffer(l).then(u=>{let d=new Uint8Array(u);a.set(d,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,r)})}decryptAacSamples(e,t,r){for(;;t++){if(t>=e.length){r();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,r),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){let t=Math.floor((e.length-48)/160)*16+16,r=new Int8Array(t),a=0;for(let n=32;n<e.length-16;n+=160,a+=16)r.set(e.subarray(n,n+16),a);return r}getAvcDecryptedUnit(e,t){let r=new Uint8Array(t),a=0;for(let n=32;n<e.length-16;n+=160,a+=16)e.set(r.subarray(a,a+16),n);return e}decryptAvcSample(e,t,r,a,n){let l=hp(n.data),u=this.getAvcEncryptedData(l);this.decryptBuffer(u.buffer).then(d=>{n.data=this.getAvcDecryptedUnit(l,d),this.decrypter.isSync()||this.decryptAvcSamples(e,t,r+1,a)})}decryptAvcSamples(e,t,r,a){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,r=0){if(t>=e.length){a();return}let n=e[t].units;for(;!(r>=n.length);r++){let l=n[r];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(e,t,r,a,l),!this.decrypter.isSync()))return}}}},nt=188,wT=class ii{constructor(t,r,a){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=t,this.config=r,this.typeSupported=a,this.videoParser=new kT}static probe(t){let r=ii.syncOffset(t);return r>0&&P.warn(`MPEG2-TS detected but first sync word found @ offset ${r}`),r!==-1}static syncOffset(t){let r=t.length,a=Math.min(nt*5,r-nt)+1,n=0;for(;n<a;){let l=!1,u=-1,d=0;for(let c=n;c<r;c+=nt)if(t[c]===71&&(r-c===nt||t[c+nt]===71)){if(d++,u===-1&&(u=c,u!==0&&(a=Math.min(u+nt*99,t.length-nt)+1)),l||(l=Iu(t,c)===0),l&&d>1&&(u===0&&d>2||c+nt>a))return u}else{if(d)return-1;break}n++}return-1}static createTrack(t,r){return{container:t==="video"||t==="audio"?"video/mp2t":void 0,type:t,id:np[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:t==="audio"?r:void 0}}resetInitSegment(t,r,a,n){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=ii.createTrack("video"),this._audioTrack=ii.createTrack("audio",n),this._id3Track=ii.createTrack("id3"),this._txtTrack=ii.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=r,this.videoCodec=a,this._duration=n}resetTimeStamp(){}resetContiguity(){let{_audioTrack:t,_videoTrack:r,_id3Track:a}=this;t&&(t.pesData=null),r&&(r.pesData=null),a&&(a.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(t,r,a=!1,n=!1){a||(this.sampleAes=null);let l,u=this._videoTrack,d=this._audioTrack,c=this._id3Track,f=this._txtTrack,g=u.pid,p=u.pesData,y=d.pid,E=c.pid,S=d.pesData,T=c.pesData,k=null,C=this.pmtParsed,I=this._pmtId,O=t.length;if(this.remainderData&&(t=$t(this.remainderData,t),O=t.length,this.remainderData=null),O<nt&&!n)return this.remainderData=t,{audioTrack:d,videoTrack:u,id3Track:c,textTrack:f};let x=Math.max(0,ii.syncOffset(t));O-=(O-x)%nt,O<t.byteLength&&!n&&(this.remainderData=new Uint8Array(t.buffer,O,t.buffer.byteLength-O));let $=0;for(let K=x;K<O;K+=nt)if(t[K]===71){let Q=!!(t[K+1]&64),ae=Iu(t,K),W=(t[K+3]&48)>>4,ee;if(W>1){if(ee=K+5+t[K+4],ee===K+nt)continue}else ee=K+4;switch(ae){case g:Q&&(p&&(l=Bi(p))&&this.videoParser.parseAVCPES(u,f,l,!1,this._duration),p={data:[],size:0}),p&&(p.data.push(t.subarray(ee,K+nt)),p.size+=K+nt-ee);break;case y:if(Q){if(S&&(l=Bi(S)))switch(d.segmentCodec){case"aac":this.parseAACPES(d,l);break;case"mp3":this.parseMPEGPES(d,l);break;case"ac3":this.parseAC3PES(d,l);break}S={data:[],size:0}}S&&(S.data.push(t.subarray(ee,K+nt)),S.size+=K+nt-ee);break;case E:Q&&(T&&(l=Bi(T))&&this.parseID3PES(c,l),T={data:[],size:0}),T&&(T.data.push(t.subarray(ee,K+nt)),T.size+=K+nt-ee);break;case 0:Q&&(ee+=t[ee]+1),I=this._pmtId=RT(t,ee);break;case I:{Q&&(ee+=t[ee]+1);let ge=DT(t,ee,this.typeSupported,a);g=ge.videoPid,g>0&&(u.pid=g,u.segmentCodec=ge.segmentVideoCodec),y=ge.audioPid,y>0&&(d.pid=y,d.segmentCodec=ge.segmentAudioCodec),E=ge.id3Pid,E>0&&(c.pid=E),k!==null&&!C&&(P.warn(`MPEG-TS PMT found at ${K} after unknown PID '${k}'. Backtracking to sync byte @${x} to parse all TS packets.`),k=null,K=x-188),C=this.pmtParsed=!0;break}case 17:case 8191:break;default:k=ae;break}}else $++;if($>0){let K=new Error(`Found ${$} TS packet/s that do not start with 0x47`);this.observer.emit(b.ERROR,b.ERROR,{type:Se.MEDIA_ERROR,details:B.FRAG_PARSING_ERROR,fatal:!1,error:K,reason:K.message})}u.pesData=p,d.pesData=S,c.pesData=T;let G={audioTrack:d,videoTrack:u,id3Track:c,textTrack:f};return n&&this.extractRemainingSamples(G),G}flush(){let{remainderData:t}=this;this.remainderData=null;let r;return t?r=this.demux(t,-1,!1,!0):r={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(r),this.sampleAes?this.decrypt(r,this.sampleAes):r}extractRemainingSamples(t){let{audioTrack:r,videoTrack:a,id3Track:n,textTrack:l}=t,u=a.pesData,d=r.pesData,c=n.pesData,f;if(u&&(f=Bi(u))?(this.videoParser.parseAVCPES(a,l,f,!0,this._duration),a.pesData=null):a.pesData=u,d&&(f=Bi(d))){switch(r.segmentCodec){case"aac":this.parseAACPES(r,f);break;case"mp3":this.parseMPEGPES(r,f);break;case"ac3":this.parseAC3PES(r,f);break}r.pesData=null}else d!=null&&d.size&&P.log("last AAC PES packet truncated,might overlap between fragments"),r.pesData=d;c&&(f=Bi(c))?(this.parseID3PES(n,f),n.pesData=null):n.pesData=c}demuxSampleAes(t,r,a){let n=this.demux(t,a,!0,!this.config.progressive),l=this.sampleAes=new AT(this.observer,this.config,r);return this.decrypt(n,l)}decrypt(t,r){return new Promise(a=>{let{audioTrack:n,videoTrack:l}=t;n.samples&&n.segmentCodec==="aac"?r.decryptAacSamples(n.samples,0,()=>{l.samples?r.decryptAvcSamples(l.samples,0,0,()=>{a(t)}):a(t)}):l.samples&&r.decryptAvcSamples(l.samples,0,0,()=>{a(t)})})}destroy(){this._duration=0}parseAACPES(t,r){let a=0,n=this.aacOverFlow,l=r.data;if(n){this.aacOverFlow=null;let p=n.missing,y=n.sample.unit.byteLength;if(p===-1)l=$t(n.sample.unit,l);else{let E=y-p;n.sample.unit.set(l.subarray(0,p),E),t.samples.push(n.sample),a=n.missing}}let u,d;for(u=a,d=l.length;u<d-1&&!Fn(l,u);u++);if(u!==a){let p,y=u<d-1;y?p=`AAC PES did not start with ADTS header,offset:${u}`:p="No ADTS header found in AAC PES";let E=new Error(p);if(P.warn(`parsing error: ${p}`),this.observer.emit(b.ERROR,b.ERROR,{type:Se.MEDIA_ERROR,details:B.FRAG_PARSING_ERROR,fatal:!1,levelRetry:y,error:E,reason:p}),!y)return}Dp(t,this.observer,l,u,this.audioCodec);let c;if(r.pts!==void 0)c=r.pts;else if(n){let p=Ip(t.samplerate);c=n.sample.pts+p}else{P.warn("[tsdemuxer]: AAC PES unknown PTS");return}let f=0,g;for(;u<d;)if(g=Cp(t,l,u,c,f),u+=g.length,g.missing){this.aacOverFlow=g;break}else for(f++;u<d-1&&!Fn(l,u);u++);}parseMPEGPES(t,r){let a=r.data,n=a.length,l=0,u=0,d=r.pts;if(d===void 0){P.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;u<n;)if(Pp(a,u)){let c=_p(t,a,u,d,l);if(c)u+=c.length,l++;else break}else u++}parseAC3PES(t,r){{let a=r.data,n=r.pts;if(n===void 0){P.warn("[tsdemuxer]: AC3 PES unknown PTS");return}let l=a.length,u=0,d=0,c;for(;d<l&&(c=Op(t,a,d,n,u++))>0;)d+=c}}parseID3PES(t,r){if(r.pts===void 0){P.warn("[tsdemuxer]: ID3 PES unknown PTS");return}let a=Je({},r,{type:this._videoTrack?Xt.emsg:Xt.audioId3,duration:Number.POSITIVE_INFINITY});t.samples.push(a)}};function Iu(e,t){return((e[t+1]&31)<<8)+e[t+2]}function RT(e,t){return(e[t+10]&31)<<8|e[t+11]}function DT(e,t,r,a){let n={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},l=(e[t+1]&15)<<8|e[t+2],u=t+3+l-4,d=(e[t+10]&15)<<8|e[t+11];for(t+=12+d;t<u;){let c=Iu(e,t),f=(e[t+3]&15)<<8|e[t+4];switch(e[t]){case 207:if(!a){ou("ADTS AAC");break}case 15:n.audioPid===-1&&(n.audioPid=c);break;case 21:n.id3Pid===-1&&(n.id3Pid=c);break;case 219:if(!a){ou("H.264");break}case 27:n.videoPid===-1&&(n.videoPid=c,n.segmentVideoCodec="avc");break;case 3:case 4:!r.mpeg&&!r.mp3?P.log("MPEG audio found, not supported in this browser"):n.audioPid===-1&&(n.audioPid=c,n.segmentAudioCodec="mp3");break;case 193:if(!a){ou("AC-3");break}case 129:r.ac3?n.audioPid===-1&&(n.audioPid=c,n.segmentAudioCodec="ac3"):P.log("AC-3 audio found, not supported in this browser");break;case 6:if(n.audioPid===-1&&f>0){let g=t+5,p=f;for(;p>2;){switch(e[g]){case 106:r.ac3!==!0?P.log("AC-3 audio found, not supported in this browser for now"):(n.audioPid=c,n.segmentAudioCodec="ac3");break}let y=e[g+1]+2;g+=y,p-=y}}break;case 194:case 135:P.warn("Unsupported EC-3 in M2TS found");break;case 36:P.warn("Unsupported HEVC in M2TS found");break}t+=f+5}return n}function ou(e){P.log(`${e} with AES-128-CBC encryption found in unencrypted stream`)}function Bi(e){let t=0,r,a,n,l,u,d=e.data;if(!e||e.size===0)return null;for(;d[0].length<19&&d.length>1;)d[0]=$t(d[0],d[1]),d.splice(1,1);if(r=d[0],(r[0]<<16)+(r[1]<<8)+r[2]===1){if(a=(r[4]<<8)+r[5],a&&a>e.size-6)return null;let c=r[7];c&192&&(l=(r[9]&14)*536870912+(r[10]&255)*4194304+(r[11]&254)*16384+(r[12]&255)*128+(r[13]&254)/2,c&64?(u=(r[14]&14)*536870912+(r[15]&255)*4194304+(r[16]&254)*16384+(r[17]&255)*128+(r[18]&254)/2,l-u>60*9e4&&(P.warn(`${Math.round((l-u)/9e4)}s delta between PTS and DTS, align them`),l=u)):u=l),n=r[8];let f=n+9;if(e.size<=f)return null;e.size-=f;let g=new Uint8Array(e.size);for(let p=0,y=d.length;p<y;p++){r=d[p];let E=r.byteLength;if(f)if(f>E){f-=E;continue}else r=r.subarray(f),E-=f,f=0;g.set(r,t),t+=E}return a&&(a-=n+3),{data:g,pts:l,dts:u,len:a}}return null}var IT=class extends ju{resetInitSegment(e,t,r,a){super.resetInitSegment(e,t,r,a),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:a,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;let t=Ua(e,0),r=t?.length||0;if(t&&e[r]===11&&e[r+1]===119&&Gu(t)!==void 0&&Np(e,r)<=16)return!1;for(let a=e.length;r<a;r++)if(Mp(e,r))return P.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return yT(e,t)}appendFrame(e,t,r){if(this.basePTS!==null)return _p(e,t,r,this.basePTS,this.frameIndex)}},wg=class{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}},Gr=Math.pow(2,32)-1,ht=class U{static init(){U.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let t;for(t in U.types)U.types.hasOwnProperty(t)&&(U.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);let r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),a=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);U.HDLR_TYPES={video:r,audio:a};let n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),l=new Uint8Array([0,0,0,0,0,0,0,0]);U.STTS=U.STSC=U.STCO=l,U.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),U.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),U.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),U.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);let u=new Uint8Array([105,115,111,109]),d=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);U.FTYP=U.box(U.types.ftyp,u,c,u,d),U.DINF=U.box(U.types.dinf,U.box(U.types.dref,n))}static box(t,...r){let a=8,n=r.length,l=n;for(;n--;)a+=r[n].byteLength;let u=new Uint8Array(a);for(u[0]=a>>24&255,u[1]=a>>16&255,u[2]=a>>8&255,u[3]=a&255,u.set(t,4),n=0,a=8;n<l;n++)u.set(r[n],a),a+=r[n].byteLength;return u}static hdlr(t){return U.box(U.types.hdlr,U.HDLR_TYPES[t])}static mdat(t){return U.box(U.types.mdat,t)}static mdhd(t,r){r*=t;let a=Math.floor(r/(Gr+1)),n=Math.floor(r%(Gr+1));return U.box(U.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,a>>24,a>>16&255,a>>8&255,a&255,n>>24,n>>16&255,n>>8&255,n&255,85,196,0,0]))}static mdia(t){return U.box(U.types.mdia,U.mdhd(t.timescale,t.duration),U.hdlr(t.type),U.minf(t))}static mfhd(t){return U.box(U.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255]))}static minf(t){return t.type==="audio"?U.box(U.types.minf,U.box(U.types.smhd,U.SMHD),U.DINF,U.stbl(t)):U.box(U.types.minf,U.box(U.types.vmhd,U.VMHD),U.DINF,U.stbl(t))}static moof(t,r,a){return U.box(U.types.moof,U.mfhd(t),U.traf(a,r))}static moov(t){let r=t.length,a=[];for(;r--;)a[r]=U.trak(t[r]);return U.box.apply(null,[U.types.moov,U.mvhd(t[0].timescale,t[0].duration)].concat(a).concat(U.mvex(t)))}static mvex(t){let r=t.length,a=[];for(;r--;)a[r]=U.trex(t[r]);return U.box.apply(null,[U.types.mvex,...a])}static mvhd(t,r){r*=t;let a=Math.floor(r/(Gr+1)),n=Math.floor(r%(Gr+1)),l=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,a>>24,a>>16&255,a>>8&255,a&255,n>>24,n>>16&255,n>>8&255,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return U.box(U.types.mvhd,l)}static sdtp(t){let r=t.samples||[],a=new Uint8Array(4+r.length),n,l;for(n=0;n<r.length;n++)l=r[n].flags,a[n+4]=l.dependsOn<<4|l.isDependedOn<<2|l.hasRedundancy;return U.box(U.types.sdtp,a)}static stbl(t){return U.box(U.types.stbl,U.stsd(t),U.box(U.types.stts,U.STTS),U.box(U.types.stsc,U.STSC),U.box(U.types.stsz,U.STSZ),U.box(U.types.stco,U.STCO))}static avc1(t){let r=[],a=[],n,l,u;for(n=0;n<t.sps.length;n++)l=t.sps[n],u=l.byteLength,r.push(u>>>8&255),r.push(u&255),r=r.concat(Array.prototype.slice.call(l));for(n=0;n<t.pps.length;n++)l=t.pps[n],u=l.byteLength,a.push(u>>>8&255),a.push(u&255),a=a.concat(Array.prototype.slice.call(l));let d=U.box(U.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|t.sps.length].concat(r).concat([t.pps.length]).concat(a))),c=t.width,f=t.height,g=t.pixelRatio[0],p=t.pixelRatio[1];return U.box(U.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),d,U.box(U.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),U.box(U.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,p>>24,p>>16&255,p>>8&255,p&255])))}static esds(t){let r=t.config.length;return new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t.config).concat([6,1,2]))}static audioStsd(t){let r=t.samplerate;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,r&255,0,0])}static mp4a(t){return U.box(U.types.mp4a,U.audioStsd(t),U.box(U.types.esds,U.esds(t)))}static mp3(t){return U.box(U.types[".mp3"],U.audioStsd(t))}static ac3(t){return U.box(U.types["ac-3"],U.audioStsd(t),U.box(U.types.dac3,t.config))}static stsd(t){return t.type==="audio"?t.segmentCodec==="mp3"&&t.codec==="mp3"?U.box(U.types.stsd,U.STSD,U.mp3(t)):t.segmentCodec==="ac3"?U.box(U.types.stsd,U.STSD,U.ac3(t)):U.box(U.types.stsd,U.STSD,U.mp4a(t)):U.box(U.types.stsd,U.STSD,U.avc1(t))}static tkhd(t){let r=t.id,a=t.duration*t.timescale,n=t.width,l=t.height,u=Math.floor(a/(Gr+1)),d=Math.floor(a%(Gr+1));return U.box(U.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,r&255,0,0,0,0,u>>24,u>>16&255,u>>8&255,u&255,d>>24,d>>16&255,d>>8&255,d&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,n>>8&255,n&255,0,0,l>>8&255,l&255,0,0]))}static traf(t,r){let a=U.sdtp(t),n=t.id,l=Math.floor(r/(Gr+1)),u=Math.floor(r%(Gr+1));return U.box(U.types.traf,U.box(U.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,n&255])),U.box(U.types.tfdt,new Uint8Array([1,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,u>>24,u>>16&255,u>>8&255,u&255])),U.trun(t,a.length+16+20+8+16+8+8),a)}static trak(t){return t.duration=t.duration||4294967295,U.box(U.types.trak,U.tkhd(t),U.mdia(t))}static trex(t){let r=t.id;return U.box(U.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(t,r){let a=t.samples||[],n=a.length,l=12+16*n,u=new Uint8Array(l),d,c,f,g,p,y;for(r+=8+l,u.set([t.type==="video"?1:0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,n&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255],0),d=0;d<n;d++)c=a[d],f=c.duration,g=c.size,p=c.flags,y=c.cts,u.set([f>>>24&255,f>>>16&255,f>>>8&255,f&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255,p.isLeading<<2|p.dependsOn,p.isDependedOn<<6|p.hasRedundancy<<4|p.paddingValue<<1|p.isNonSync,p.degradPrio&61440,p.degradPrio&15,y>>>24&255,y>>>16&255,y>>>8&255,y&255],12+16*d);return U.box(U.types.trun,u)}static initSegment(t){U.types||U.init();let r=U.moov(t);return $t(U.FTYP,r)}};ht.types=void 0;ht.HDLR_TYPES=void 0;ht.STTS=void 0;ht.STSC=void 0;ht.STCO=void 0;ht.STSZ=void 0;ht.VMHD=void 0;ht.SMHD=void 0;ht.STSD=void 0;ht.FTYP=void 0;ht.DINF=void 0;var Fp=9e4;function Xu(e,t,r=1,a=!1){let n=e*t*r;return a?Math.round(n):n}function CT(e,t,r=1,a=!1){return Xu(e,t,1/r,a)}function xa(e,t=!1){return Xu(e,1e3,1/Fp,t)}function _T(e,t=1){return Xu(e,Fp,1/t)}var xT=10*1e3,Rg=1024,PT=1152,MT=1536,$i=null,uu=null,bn=class{constructor(e,t,r,a=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=r,this.ISGenerated=!1,$i===null){let n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);$i=n?parseInt(n[1]):0}if(uu===null){let n=navigator.userAgent.match(/Safari\/(\d+)/i);uu=n?parseInt(n[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){P.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){P.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){P.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1,r=e.reduce((a,n)=>{let l=n.pts-a;return l<-4294967296?(t=!0,Bt(a,n.pts)):l>0?a:n.pts},e[0].pts);return t&&P.debug("PTS rollover detected"),r}remux(e,t,r,a,n,l,u,d){let c,f,g,p,y,E,S=n,T=n,k=e.pid>-1,C=t.pid>-1,I=t.samples.length,O=e.samples.length>0,x=u&&I>0||I>1;if((!k||O)&&(!C||x)||this.ISGenerated||u){if(this.ISGenerated){var $,G,K,Q;let ge=this.videoTrackConfig;ge&&(t.width!==ge.width||t.height!==ge.height||(($=t.pixelRatio)==null?void 0:$[0])!==((G=ge.pixelRatio)==null?void 0:G[0])||((K=t.pixelRatio)==null?void 0:K[1])!==((Q=ge.pixelRatio)==null?void 0:Q[1]))&&this.resetInitSegment()}else g=this.generateIS(e,t,n,l);let ae=this.isVideoContiguous,W=-1,ee;if(x&&(W=NT(t.samples),!ae&&this.config.forceKeyFrameOnDiscontinuity))if(E=!0,W>0){P.warn(`[mp4-remuxer]: Dropped ${W} out of ${I} video samples due to a missing keyframe`);let ge=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(W),t.dropped+=W,T+=(t.samples[0].pts-ge)/t.inputTimeScale,ee=T}else W===-1&&(P.warn(`[mp4-remuxer]: No keyframe found out of ${I} video samples`),E=!1);if(this.ISGenerated){if(O&&x){let ge=this.getVideoStartPts(t.samples),ie=(Bt(e.samples[0].pts,ge)-ge)/t.inputTimeScale;S+=Math.max(0,ie),T+=Math.max(0,-ie)}if(O){if(e.samplerate||(P.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),g=this.generateIS(e,t,n,l)),f=this.remuxAudio(e,S,this.isAudioContiguous,l,C||x||d===Ee.AUDIO?T:void 0),x){let ge=f?f.endPTS-f.startPTS:0;t.inputTimeScale||(P.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),g=this.generateIS(e,t,n,l)),c=this.remuxVideo(t,T,ae,ge)}}else x&&(c=this.remuxVideo(t,T,ae,0));c&&(c.firstKeyFrame=W,c.independent=W!==-1,c.firstKeyFramePTS=ee)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(r.samples.length&&(y=Up(r,n,this._initPTS,this._initDTS)),a.samples.length&&(p=Bp(a,n,this._initPTS))),{audio:f,video:c,initSegment:g,independent:E,text:p,id3:y}}generateIS(e,t,r,a){let n=e.samples,l=t.samples,u=this.typeSupported,d={},c=this._initPTS,f=!c||a,g="audio/mp4",p,y,E;if(f&&(p=y=1/0),e.config&&n.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(g="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}d.audio={id:"audio",container:g,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):ht.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(E=e.inputTimeScale,!c||E!==c.timescale?p=y=n[0].pts-Math.round(E*r):f=!1)}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,d.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:ht.initSegment([t]),metadata:{width:t.width,height:t.height}},f)if(E=t.inputTimeScale,!c||E!==c.timescale){let S=this.getVideoStartPts(l),T=Math.round(E*r);y=Math.min(y,Bt(l[0].dts,S)-T),p=Math.min(p,S-T)}else f=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(d).length)return this.ISGenerated=!0,f?(this._initPTS={baseTime:p,timescale:E},this._initDTS={baseTime:y,timescale:E}):p=E=void 0,{tracks:d,initPTS:p,timescale:E}}remuxVideo(e,t,r,a){let n=e.inputTimeScale,l=e.samples,u=[],d=l.length,c=this._initPTS,f=this.nextAvcDts,g=8,p=this.videoSampleDuration,y,E,S=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,k=!1;if(!r||f===null){let q=t*n,re=l[0].pts-Bt(l[0].dts,l[0].pts);$i&&f!==null&&Math.abs(q-re-f)<15e3?r=!0:f=q-re}let C=c.baseTime*n/c.timescale;for(let q=0;q<d;q++){let re=l[q];re.pts=Bt(re.pts-C,f),re.dts=Bt(re.dts-C,f),re.dts<l[q>0?q-1:q].dts&&(k=!0)}k&&l.sort(function(q,re){let H=q.dts-re.dts,te=q.pts-re.pts;return H||te}),y=l[0].dts,E=l[l.length-1].dts;let I=E-y,O=I?Math.round(I/(d-1)):p||e.inputTimeScale/30;if(r){let q=y-f,re=q>O,H=q<-1;if((re||H)&&(re?P.warn(`AVC: ${xa(q,!0)} ms (${q}dts) hole between fragments detected at ${t.toFixed(3)}`):P.warn(`AVC: ${xa(-q,!0)} ms (${q}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!H||f>=l[0].pts||$i)){y=f;let te=l[0].pts-q;if(re)l[0].dts=y,l[0].pts=te;else for(let Z=0;Z<l.length&&!(l[Z].dts>te);Z++)l[Z].dts-=q,l[Z].pts-=q;P.log(`Video: Initial PTS/DTS adjusted: ${xa(te,!0)}/${xa(y,!0)}, delta: ${xa(q,!0)} ms`)}}y=Math.max(0,y);let x=0,$=0,G=y;for(let q=0;q<d;q++){let re=l[q],H=re.units,te=H.length,Z=0;for(let w=0;w<te;w++)Z+=H[w].data.length;$+=Z,x+=te,re.length=Z,re.dts<G?(re.dts=G,G+=O/4|0||1):G=re.dts,S=Math.min(re.pts,S),T=Math.max(re.pts,T)}E=l[d-1].dts;let K=$+4*x+8,Q;try{Q=new Uint8Array(K)}catch(q){this.observer.emit(b.ERROR,b.ERROR,{type:Se.MUX_ERROR,details:B.REMUX_ALLOC_ERROR,fatal:!1,error:q,bytes:K,reason:`fail allocating video mdat ${K}`});return}let ae=new DataView(Q.buffer);ae.setUint32(0,K),Q.set(ht.types.mdat,4);let W=!1,ee=Number.POSITIVE_INFINITY,ge=Number.POSITIVE_INFINITY,ie=Number.NEGATIVE_INFINITY,se=Number.NEGATIVE_INFINITY;for(let q=0;q<d;q++){let re=l[q],H=re.units,te=0;for(let V=0,he=H.length;V<he;V++){let me=H[V],Te=me.data,we=me.data.byteLength;ae.setUint32(g,we),g+=4,Q.set(Te,g),g+=we,te+=4+we}let Z;if(q<d-1)p=l[q+1].dts-re.dts,Z=l[q+1].pts-re.pts;else{let V=this.config,he=q>0?re.dts-l[q-1].dts:O;if(Z=q>0?re.pts-l[q-1].pts:O,V.stretchShortVideoTrack&&this.nextAudioPts!==null){let me=Math.floor(V.maxBufferHole*n),Te=(a?S+a*n:this.nextAudioPts)-re.pts;Te>me?(p=Te-he,p<0?p=he:W=!0,P.log(`[mp4-remuxer]: It is approximately ${Te/90} ms to the next segment; using duration ${p/90} ms for the last video frame.`)):p=he}else p=he}let w=Math.round(re.pts-re.dts);ee=Math.min(ee,p),ie=Math.max(ie,p),ge=Math.min(ge,Z),se=Math.max(se,Z),u.push(new Dg(re.key,p,te,w))}if(u.length){if($i){if($i<70){let q=u[0].flags;q.dependsOn=2,q.isNonSync=0}}else if(uu&&se-ge<ie-ee&&O/ie<.025&&u[0].cts===0){P.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let q=y;for(let re=0,H=u.length;re<H;re++){let te=q+u[re].duration,Z=q+u[re].cts;if(re<H-1){let w=te+u[re+1].cts;u[re].duration=w-Z}else u[re].duration=re?u[re-1].duration:O;u[re].cts=0,q=te}}}p=W||!p?O:p,this.nextAvcDts=f=E+p,this.videoSampleDuration=p,this.isVideoContiguous=!0;let de={data1:ht.moof(e.sequenceNumber++,y,Je({},e,{samples:u})),data2:Q,startPTS:S/n,endPTS:(T+p)/n,startDTS:y/n,endDTS:f/n,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,de}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return PT;case"ac3":return MT;default:return Rg}}remuxAudio(e,t,r,a,n){let l=e.inputTimeScale,u=e.samplerate?e.samplerate:l,d=l/u,c=this.getSamplesPerFrame(e),f=c*d,g=this._initPTS,p=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,y=[],E=n!==void 0,S=e.samples,T=p?0:8,k=this.nextAudioPts||-1,C=t*l,I=g.baseTime*l/g.timescale;if(this.isAudioContiguous=r=r||S.length&&k>0&&(a&&Math.abs(C-k)<9e3||Math.abs(Bt(S[0].pts-I,C)-k)<20*f),S.forEach(function(se){se.pts=Bt(se.pts-I,C)}),!r||k<0){if(S=S.filter(se=>se.pts>=0),!S.length)return;n===0?k=0:a&&!E?k=Math.max(0,C):k=S[0].pts}if(e.segmentCodec==="aac"){let se=this.config.maxAudioFramesDrift;for(let de=0,q=k;de<S.length;de++){let re=S[de],H=re.pts,te=H-q,Z=Math.abs(1e3*te/l);if(te<=-se*f&&E)de===0&&(P.warn(`Audio frame @ ${(H/l).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*te/l)} ms.`),this.nextAudioPts=k=q=H);else if(te>=se*f&&Z<xT&&E){let w=Math.round(te/f);q=H-w*f,q<0&&(w--,q+=f),de===0&&(this.nextAudioPts=k=q),P.warn(`[mp4-remuxer]: Injecting ${w} audio frame @ ${(q/l).toFixed(3)}s due to ${Math.round(1e3*te/l)} ms gap.`);for(let V=0;V<w;V++){let he=Math.max(q,0),me=wg.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);me||(P.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),me=re.unit.subarray()),S.splice(de,0,{unit:me,pts:he}),q+=f,de++}}re.pts=q,q+=f}}let O=null,x=null,$,G=0,K=S.length;for(;K--;)G+=S[K].unit.byteLength;for(let se=0,de=S.length;se<de;se++){let q=S[se],re=q.unit,H=q.pts;if(x!==null){let Z=y[se-1];Z.duration=Math.round((H-x)/d)}else if(r&&e.segmentCodec==="aac"&&(H=k),O=H,G>0){G+=T;try{$=new Uint8Array(G)}catch(Z){this.observer.emit(b.ERROR,b.ERROR,{type:Se.MUX_ERROR,details:B.REMUX_ALLOC_ERROR,fatal:!1,error:Z,bytes:G,reason:`fail allocating audio mdat ${G}`});return}p||(new DataView($.buffer).setUint32(0,G),$.set(ht.types.mdat,4))}else return;$.set(re,T);let te=re.byteLength;T+=te,y.push(new Dg(!0,c,te,0)),x=H}let Q=y.length;if(!Q)return;let ae=y[y.length-1];this.nextAudioPts=k=x+d*ae.duration;let W=p?new Uint8Array(0):ht.moof(e.sequenceNumber++,O/d,Je({},e,{samples:y}));e.samples=[];let ee=O/l,ge=k/l,ie={data1:W,data2:$,startPTS:ee,endPTS:ge,startDTS:ee,endDTS:ge,type:"audio",hasAudio:!0,hasVideo:!1,nb:Q};return this.isAudioContiguous=!0,ie}remuxEmptyAudio(e,t,r,a){let n=e.inputTimeScale,l=e.samplerate?e.samplerate:n,u=n/l,d=this.nextAudioPts,c=this._initDTS,f=c.baseTime*9e4/c.timescale,g=(d!==null?d:a.startDTS*n)+f,p=a.endDTS*n+f,y=u*Rg,E=Math.ceil((p-g)/y),S=wg.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(P.warn("[mp4-remuxer]: remux empty Audio"),!S){P.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}let T=[];for(let k=0;k<E;k++){let C=g+k*y;T.push({unit:S,pts:C,dts:C})}return e.samples=T,this.remuxAudio(e,t,r,!1)}};function Bt(e,t){let r;if(t===null)return e;for(t<e?r=-8589934592:r=8589934592;Math.abs(e-t)>4294967296;)e+=r;return e}function NT(e){for(let t=0;t<e.length;t++)if(e[t].key)return t;return-1}function Up(e,t,r,a){let n=e.samples.length;if(!n)return;let l=e.inputTimeScale;for(let d=0;d<n;d++){let c=e.samples[d];c.pts=Bt(c.pts-r.baseTime*l/r.timescale,t*l)/l,c.dts=Bt(c.dts-a.baseTime*l/a.timescale,t*l)/l}let u=e.samples;return e.samples=[],{samples:u}}function Bp(e,t,r){let a=e.samples.length;if(!a)return;let n=e.inputTimeScale;for(let u=0;u<a;u++){let d=e.samples[u];d.pts=Bt(d.pts-r.baseTime*n/r.timescale,t*n)/n}e.samples.sort((u,d)=>u.pts-d.pts);let l=e.samples;return e.samples=[],{samples:l}}var Dg=class{constructor(e,t,r,a){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=r,this.cts=a,this.flags={isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:e?2:1,isNonSync:e?0:1}}},OT=class{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(e){this.initPTS=e,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(e,t,r,a){this.audioCodec=t,this.videoCodec=r,this.generateInitSegment(HE(e,a)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}let a=this.initData=up(e);a.audio&&(t=Ig(a.audio,Pe.AUDIO)),a.video&&(r=Ig(a.video,Pe.VIDEO));let n={};a.audio&&a.video?n.audiovideo={container:"video/mp4",codec:t+","+r,initSegment:e,id:"main"}:a.audio?n.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:a.video?n.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:P.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n}remux(e,t,r,a,n,l){var u,d;let{initPTS:c,lastEndTime:f}=this,g={audio:void 0,video:void 0,text:a,id3:r,initSegment:void 0};oe(f)||(f=this.lastEndTime=n||0);let p=t.samples;if(!(p!=null&&p.length))return g;let y={initPTS:void 0,timescale:1},E=this.initData;if((u=E)!=null&&u.length||(this.generateInitSegment(p),E=this.initData),!((d=E)!=null&&d.length))return P.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),g;this.emitInitSegment&&(y.tracks=this.initTracks,this.emitInitSegment=!1);let S=zE(p,E),T=KE(E,p),k=T===null?n:T;(FT(c,k,n,S)||y.timescale!==c.timescale&&l)&&(y.initPTS=k-n,c&&c.timescale===1&&P.warn(`Adjusting initPTS by ${y.initPTS-c.baseTime}`),this.initPTS=c={baseTime:y.initPTS,timescale:1});let C=e?k-c.baseTime/c.timescale:f,I=C+S;jE(E,p,c.baseTime/c.timescale),S>0?this.lastEndTime=I:(P.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());let O=!!E.audio,x=!!E.video,$="";O&&($+="audio"),x&&($+="video");let G={data1:p,startPTS:C,startDTS:C,endPTS:I,endDTS:I,type:$,hasAudio:O,hasVideo:x,nb:1,dropped:0};return g.audio=G.type==="audio"?G:void 0,g.video=G.type!=="audio"?G:void 0,g.initSegment=y,g.id3=Up(r,n,c,c),a.samples.length&&(g.text=Bp(a,n,c)),g}};function FT(e,t,r,a){if(e===null)return!0;let n=Math.max(a,1),l=t-e.baseTime/e.timescale;return Math.abs(l-r)>n}function Ig(e,t){let r=e?.codec;if(r&&r.length>4)return r;if(t===Pe.AUDIO){if(r==="ec-3"||r==="ac-3"||r==="alac")return r;if(r==="fLaC"||r==="Opus")return _n(r,!1);let a="mp4a.40.5";return P.info(`Parsed audio codec "${r}" or audio object type not handled. Using "${a}"`),a}return P.warn(`Unhandled video codec "${r}"`),r==="hvc1"||r==="hev1"?"hvc1.1.6.L120.90":r==="av01"?"av01.0.04M.08":"avc1.42e01e"}var Tr;try{Tr=self.performance.now.bind(self.performance)}catch{P.debug("Unable to use Performance API on this environment"),Tr=Fa?.Date.now}var Ln=[{demux:TT,remux:OT},{demux:wT,remux:bn},{demux:ET,remux:bn},{demux:IT,remux:bn}];Ln.splice(2,0,{demux:bT,remux:bn});var Cg=class{constructor(e,t,r,a,n){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=r,this.vendor=a,this.id=n}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,r,a){let n=r.transmuxing;n.executeStart=Tr();let l=new Uint8Array(e),{currentTransmuxState:u,transmuxConfig:d}=this;a&&(this.currentTransmuxState=a);let{contiguous:c,discontinuity:f,trackSwitch:g,accurateTimeOffset:p,timeOffset:y,initSegmentChange:E}=a||u,{audioCodec:S,videoCodec:T,defaultInitPts:k,duration:C,initSegmentData:I}=d,O=UT(l,t);if(O&&O.method==="AES-128"){let K=this.getDecrypter();if(K.isSync()){let Q=K.softwareDecrypt(l,O.key.buffer,O.iv.buffer);if(r.part>-1&&(Q=K.flush()),!Q)return n.executeEnd=Tr(),du(r);l=new Uint8Array(Q)}else return this.decryptionPromise=K.webCryptoDecrypt(l,O.key.buffer,O.iv.buffer).then(Q=>{let ae=this.push(Q,null,r);return this.decryptionPromise=null,ae}),this.decryptionPromise}let x=this.needsProbing(f,g);if(x){let K=this.configureTransmuxer(l);if(K)return P.warn(`[transmuxer] ${K.message}`),this.observer.emit(b.ERROR,b.ERROR,{type:Se.MEDIA_ERROR,details:B.FRAG_PARSING_ERROR,fatal:!1,error:K,reason:K.message}),n.executeEnd=Tr(),du(r)}(f||g||E||x)&&this.resetInitSegment(I,S,T,C,t),(f||E||x)&&this.resetInitialTimestamp(k),c||this.resetContiguity();let $=this.transmux(l,O,y,p,r),G=this.currentTransmuxState;return G.contiguous=!0,G.discontinuity=!1,G.trackSwitch=!1,n.executeEnd=Tr(),$}flush(e){let t=e.transmuxing;t.executeStart=Tr();let{decrypter:r,currentTransmuxState:a,decryptionPromise:n}=this;if(n)return n.then(()=>this.flush(e));let l=[],{timeOffset:u}=a;if(r){let g=r.flush();g&&l.push(this.push(g,null,e))}let{demuxer:d,remuxer:c}=this;if(!d||!c)return t.executeEnd=Tr(),[du(e)];let f=d.flush(u);return kn(f)?f.then(g=>(this.flushRemux(l,g,e),l)):(this.flushRemux(l,f,e),l)}flushRemux(e,t,r){let{audioTrack:a,videoTrack:n,id3Track:l,textTrack:u}=t,{accurateTimeOffset:d,timeOffset:c}=this.currentTransmuxState;P.log(`[transmuxer.ts]: Flushed fragment ${r.sn}${r.part>-1?" p: "+r.part:""} of level ${r.level}`);let f=this.remuxer.remux(a,n,l,u,c,d,!0,this.id);e.push({remuxResult:f,chunkMeta:r}),r.transmuxing.executeEnd=Tr()}resetInitialTimestamp(e){let{demuxer:t,remuxer:r}=this;!t||!r||(t.resetTimeStamp(e),r.resetTimeStamp(e))}resetContiguity(){let{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,r,a,n){let{demuxer:l,remuxer:u}=this;!l||!u||(l.resetInitSegment(e,t,r,a),u.resetInitSegment(e,t,r,n))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,r,a,n){let l;return t&&t.method==="SAMPLE-AES"?l=this.transmuxSampleAes(e,t,r,a,n):l=this.transmuxUnencrypted(e,r,a,n),l}transmuxUnencrypted(e,t,r,a){let{audioTrack:n,videoTrack:l,id3Track:u,textTrack:d}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(n,l,u,d,t,r,!1,this.id),chunkMeta:a}}transmuxSampleAes(e,t,r,a,n){return this.demuxer.demuxSampleAes(e,t,r).then(l=>({remuxResult:this.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,r,a,!1,this.id),chunkMeta:n}))}configureTransmuxer(e){let{config:t,observer:r,typeSupported:a,vendor:n}=this,l;for(let p=0,y=Ln.length;p<y;p++){var u;if((u=Ln[p].demux)!=null&&u.probe(e)){l=Ln[p];break}}if(!l)return new Error("Failed to find demuxer by probing fragment data");let d=this.demuxer,c=this.remuxer,f=l.remux,g=l.demux;(!c||!(c instanceof f))&&(this.remuxer=new f(r,t,a,n)),(!d||!(d instanceof g))&&(this.demuxer=new g(r,t,a),this.probe=g.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new zu(this.config)),e}};function UT(e,t){let r=null;return e.byteLength>0&&t?.key!=null&&t.iv!==null&&t.method!=null&&(r=t),r}var du=e=>({remuxResult:{},chunkMeta:e});function kn(e){return"then"in e&&e.then instanceof Function}var BT=class{constructor(e,t,r,a,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=r,this.duration=a,this.defaultInitPts=n||null}},$T=class{constructor(e,t,r,a,n,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=r,this.trackSwitch=a,this.timeOffset=n,this.initSegmentChange=l}},$p={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function a(){}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(r=!1));function n(c,f,g){this.fn=c,this.context=f,this.once=g||!1}function l(c,f,g,p,y){if(typeof g!="function")throw new TypeError("The listener must be a function");var E=new n(g,p||c,y),S=r?r+f:f;return c._events[S]?c._events[S].fn?c._events[S]=[c._events[S],E]:c._events[S].push(E):(c._events[S]=E,c._eventsCount++),c}function u(c,f){--c._eventsCount===0?c._events=new a:delete c._events[f]}function d(){this._events=new a,this._eventsCount=0}d.prototype.eventNames=function(){var c=[],f,g;if(this._eventsCount===0)return c;for(g in f=this._events)t.call(f,g)&&c.push(r?g.slice(1):g);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(f)):c},d.prototype.listeners=function(c){var f=r?r+c:c,g=this._events[f];if(!g)return[];if(g.fn)return[g.fn];for(var p=0,y=g.length,E=new Array(y);p<y;p++)E[p]=g[p].fn;return E},d.prototype.listenerCount=function(c){var f=r?r+c:c,g=this._events[f];return g?g.fn?1:g.length:0},d.prototype.emit=function(c,f,g,p,y,E){var S=r?r+c:c;if(!this._events[S])return!1;var T=this._events[S],k=arguments.length,C,I;if(T.fn){switch(T.once&&this.removeListener(c,T.fn,void 0,!0),k){case 1:return T.fn.call(T.context),!0;case 2:return T.fn.call(T.context,f),!0;case 3:return T.fn.call(T.context,f,g),!0;case 4:return T.fn.call(T.context,f,g,p),!0;case 5:return T.fn.call(T.context,f,g,p,y),!0;case 6:return T.fn.call(T.context,f,g,p,y,E),!0}for(I=1,C=new Array(k-1);I<k;I++)C[I-1]=arguments[I];T.fn.apply(T.context,C)}else{var O=T.length,x;for(I=0;I<O;I++)switch(T[I].once&&this.removeListener(c,T[I].fn,void 0,!0),k){case 1:T[I].fn.call(T[I].context);break;case 2:T[I].fn.call(T[I].context,f);break;case 3:T[I].fn.call(T[I].context,f,g);break;case 4:T[I].fn.call(T[I].context,f,g,p);break;default:if(!C)for(x=1,C=new Array(k-1);x<k;x++)C[x-1]=arguments[x];T[I].fn.apply(T[I].context,C)}}return!0},d.prototype.on=function(c,f,g){return l(this,c,f,g,!1)},d.prototype.once=function(c,f,g){return l(this,c,f,g,!0)},d.prototype.removeListener=function(c,f,g,p){var y=r?r+c:c;if(!this._events[y])return this;if(!f)return u(this,y),this;var E=this._events[y];if(E.fn)E.fn===f&&(!p||E.once)&&(!g||E.context===g)&&u(this,y);else{for(var S=0,T=[],k=E.length;S<k;S++)(E[S].fn!==f||p&&!E[S].once||g&&E[S].context!==g)&&T.push(E[S]);T.length?this._events[y]=T.length===1?T[0]:T:u(this,y)}return this},d.prototype.removeAllListeners=function(c){var f;return c?(f=r?r+c:c,this._events[f]&&u(this,f)):(this._events=new a,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=r,d.EventEmitter=d,e.exports=d})($p);var GT=$p.exports,Qu=dE(GT),Gp=class{constructor(e,t,r,a){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;let n=e.config;this.hls=e,this.id=t,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=r,this.onFlush=a;let l=(f,g)=>{g=g||{},g.frag=this.frag,g.id=this.id,f===b.ERROR&&(this.error=g.error),this.hls.trigger(f,g)};this.observer=new Qu,this.observer.on(b.FRAG_DECRYPTED,l),this.observer.on(b.ERROR,l);let u=ni(n.preferManagedMediaSource)||{isTypeSupported:()=>!1},d={mpeg:u.isTypeSupported("audio/mpeg"),mp3:u.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:u.isTypeSupported('audio/mp4; codecs="ac-3"')},c=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&(n.workerPath||sT())){try{n.workerPath?(P.log(`loading Web Worker ${n.workerPath} for "${t}"`),this.workerContext=lT(n.workerPath)):(P.log(`injecting Web Worker for "${t}"`),this.workerContext=nT()),this.onwmsg=g=>this.onWorkerMessage(g);let{worker:f}=this.workerContext;f.addEventListener("message",this.onwmsg),f.onerror=g=>{let p=new Error(`${g.message}  (${g.filename}:${g.lineno})`);n.enableWorker=!1,P.warn(`Error in "${t}" Web Worker, fallback to inline`),this.hls.trigger(b.ERROR,{type:Se.OTHER_ERROR,details:B.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:p})},f.postMessage({cmd:"init",typeSupported:d,vendor:c,id:t,config:JSON.stringify(n)})}catch(f){P.warn(`Error setting up "${t}" Web Worker, fallback to inline`,f),this.resetWorker(),this.error=null,this.transmuxer=new Cg(this.observer,d,n,c,t)}return}this.transmuxer=new Cg(this.observer,d,n,c,t)}resetWorker(){if(this.workerContext){let{worker:e,objectURL:t}=this.workerContext;t&&self.URL.revokeObjectURL(t),e.removeEventListener("message",this.onwmsg),e.onerror=null,e.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{let t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}let e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(e,t,r,a,n,l,u,d,c,f){var g,p;c.transmuxing.start=self.performance.now();let{transmuxer:y}=this,E=l?l.start:n.start,S=n.decryptdata,T=this.frag,k=!(T&&n.cc===T.cc),C=!(T&&c.level===T.level),I=T?c.sn-T.sn:-1,O=this.part?c.part-this.part.index:-1,x=I===0&&c.id>1&&c.id===T?.stats.chunkCount,$=!C&&(I===1||I===0&&(O===1||x&&O<=0)),G=self.performance.now();(C||I||n.stats.parsing.start===0)&&(n.stats.parsing.start=G),l&&(O||!$)&&(l.stats.parsing.start=G);let K=!(T&&((g=n.initSegment)==null?void 0:g.url)===((p=T.initSegment)==null?void 0:p.url)),Q=new $T(k,$,d,C,E,K);if(!$||k||K){P.log(`[transmuxer-interface, ${n.type}]: Starting new transmux session for sn: ${c.sn} p: ${c.part} level: ${c.level} id: ${c.id}
        discontinuity: ${k}
        trackSwitch: ${C}
        contiguous: ${$}
        accurateTimeOffset: ${d}
        timeOffset: ${E}
        initSegmentChange: ${K}`);let ae=new BT(r,a,t,u,f);this.configureTransmuxer(ae)}if(this.frag=n,this.part=l,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:S,chunkMeta:c,state:Q},e instanceof ArrayBuffer?[e]:[]);else if(y){let ae=y.push(e,S,c,Q);kn(ae)?(y.async=!0,ae.then(W=>{this.handleTransmuxComplete(W)}).catch(W=>{this.transmuxerError(W,c,"transmuxer-interface push error")})):(y.async=!1,this.handleTransmuxComplete(ae))}}flush(e){e.transmuxing.start=self.performance.now();let{transmuxer:t}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(t){let r=t.flush(e);kn(r)||t.async?(kn(r)||(r=Promise.resolve(r)),r.then(a=>{this.handleFlushResult(a,e)}).catch(a=>{this.transmuxerError(a,e,"transmuxer-interface flush error")})):this.handleFlushResult(r,e)}}transmuxerError(e,t,r){this.hls&&(this.error=e,this.hls.trigger(b.ERROR,{type:Se.MEDIA_ERROR,details:B.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:r}))}handleFlushResult(e,t){e.forEach(r=>{this.handleTransmuxComplete(r)}),this.onFlush(t)}onWorkerMessage(e){let t=e.data,r=this.hls;switch(t.event){case"init":{var a;let n=(a=this.workerContext)==null?void 0:a.objectURL;n&&self.URL.revokeObjectURL(n);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":P[t.data.logType]&&P[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data);break}}}configureTransmuxer(e){let{transmuxer:t}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}};function Vp(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!zi(e[r].attrs,t[r].attrs))return!1;return!0}function zi(e,t,r){let a=e["STABLE-RENDITION-ID"];return a&&!r?a===t["STABLE-RENDITION-ID"]:!(r||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(n=>e[n]!==t[n])}function Cu(e,t){return t.label.toLowerCase()===e.name.toLowerCase()&&(!t.language||t.language.toLowerCase()===(e.lang||"").toLowerCase())}var _g=100,VT=class extends Wu{constructor(e,t,r){super(e,t,r,"[audio-stream-controller]",Ee.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){let{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(b.ERROR,this.onError,this),e.on(b.BUFFER_RESET,this.onBufferReset,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){let{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(b.ERROR,this.onError,this),e.off(b.BUFFER_RESET,this.onBufferReset,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(e,{frag:t,id:r,initPTS:a,timescale:n}){if(r==="main"){let l=t.cc;this.initPTS[t.cc]={baseTime:a,timescale:n},this.log(`InitPTS for cc: ${l} found from main: ${a}`),this.videoTrackCC=l,this.state===z.WAITING_INIT_PTS&&this.tick()}}startLoad(e){if(!this.levels){this.startPosition=e,this.state=z.STOPPED;return}let t=this.lastCurrentTime;this.stopLoad(),this.setInterval(_g),t>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t,this.state=z.IDLE):(this.loadedmetadata=!1,this.state=z.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}doTick(){switch(this.state){case z.IDLE:this.doTickIdle();break;case z.WAITING_TRACK:{var e;let{levels:r,trackId:a}=this,n=r==null||(e=r[a])==null?void 0:e.details;if(n){if(this.waitForCdnTuneIn(n))break;this.state=z.WAITING_INIT_PTS}break}case z.FRAG_LOADING_WAITING_RETRY:{var t;let r=performance.now(),a=this.retryDate;if(!a||r>=a||(t=this.media)!=null&&t.seeking){let{levels:n,trackId:l}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(n?.[l]||null),this.state=z.IDLE}break}case z.WAITING_INIT_PTS:{let r=this.waitingData;if(r){let{frag:a,part:n,cache:l,complete:u}=r;if(this.initPTS[a.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=z.FRAG_LOADING;let d=l.flush(),c={frag:a,part:n,payload:d,networkDetails:null};this._handleFragmentLoadProgress(c),u&&super._handleFragmentLoadComplete(c)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${a.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{let d=this.getLoadPosition(),c=Ke.bufferInfo(this.mediaBuffer,d,this.config.maxBufferHole);Ru(c.end,this.config.maxFragLookUpTolerance,a)<0&&(this.log(`Waiting fragment cc (${a.cc}) @ ${a.start} cancelled because another fragment at ${c.end} is needed`),this.clearWaitingFragment())}}else this.state=z.IDLE}}this.onTickEnd()}clearWaitingFragment(){let e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=z.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){let{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){let{hls:e,levels:t,media:r,trackId:a}=this,n=e.config;if(!r&&(this.startFragRequested||!n.startFragPrefetch)||!(t!=null&&t[a]))return;let l=t[a],u=l.details;if(!u||u.live&&this.levelLastLoaded!==l||this.waitForCdnTuneIn(u)){this.state=z.WAITING_TRACK;return}let d=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&d&&(this.bufferFlushed=!1,this.afterBufferFlushed(d,Pe.AUDIO,Ee.AUDIO));let c=this.getFwdBufferInfo(d,Ee.AUDIO);if(c===null)return;let{bufferedTrack:f,switchingTrack:g}=this;if(!g&&this._streamEnded(c,u)){e.trigger(b.BUFFER_EOS,{type:"audio"}),this.state=z.ENDED;return}let p=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,Ee.MAIN),y=c.len,E=this.getMaxBufferLength(p?.len),S=u.fragments,T=S[0].start,k=this.flushing?this.getLoadPosition():c.end;if(g&&r){let x=this.getLoadPosition();f&&!zi(g.attrs,f.attrs)&&(k=x),u.PTSKnown&&x<T&&(c.end>T||c.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=T+.05)}if(y>=E&&!g&&k<S[S.length-1].start)return;let C=this.getNextFragment(k,u),I=!1;if(C&&this.isLoopLoading(C,k)&&(I=!!C.gap,C=this.getNextFragmentLoopLoading(C,u,c,Ee.MAIN,E)),!C){this.bufferFlushed=!0;return}let O=p&&C.start>p.end+u.targetduration;if(O||!(p!=null&&p.len)&&c.len){let x=this.getAppendedFrag(C.start,Ee.MAIN);if(x===null||(I||(I=!!x.gap||!!O&&p.len===0),O&&!I||I&&c.nextStart&&c.nextStart<x.end))return}this.loadFragment(C,l,k)}getMaxBufferLength(e){let t=super.getMaxBufferLength();return e?Math.min(Math.max(t,e),this.config.maxMaxBufferLength):t}onMediaDetaching(){this.videoBuffer=null,this.bufferFlushed=this.flushing=!1,super.onMediaDetaching()}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(r=>new Ki(r))}onAudioTrackSwitching(e,t){let r=!!t.url;this.trackId=t.id;let{fragCurrent:a}=this;a&&(a.abortRequests(),this.removeUnbufferedFrags(a.start)),this.resetLoadingState(),r?this.setInterval(_g):this.resetTransmuxer(),r?(this.switchingTrack=t,this.state=z.IDLE,this.flushAudioIfNeeded(t)):(this.switchingTrack=null,this.bufferedTrack=t,this.state=z.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=this.flushing=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(e,t){this.mainDetails=t.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(b.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(e,t){var r;if(this.mainDetails==null){this.cachedTrackLoadedData=t;return}let{levels:a}=this,{details:n,id:l}=t;if(!a){this.warn(`Audio tracks were reset while loading level ${l}`);return}this.log(`Audio track ${l} loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`);let u=a[l],d=0;if(n.live||(r=u.details)!=null&&r.live){this.checkLiveUpdate(n);let f=this.mainDetails;if(n.deltaUpdateFailed||!f)return;if(!u.details&&n.hasProgramDateTime&&f.hasProgramDateTime)On(n,f),d=n.fragments[0].start;else{var c;d=this.alignPlaylists(n,u.details,(c=this.levelLastLoaded)==null?void 0:c.details)}}u.details=n,this.levelLastLoaded=u,!this.startFragRequested&&(this.mainDetails||!n.live)&&this.setStartPosition(this.mainDetails||n,d),this.state===z.WAITING_TRACK&&!this.waitForCdnTuneIn(n)&&(this.state=z.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;let{frag:r,part:a,payload:n}=e,{config:l,trackId:u,levels:d}=this;if(!d){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}let c=d[u];if(!c){this.warn("Audio track is undefined on fragment load progress");return}let f=c.details;if(!f){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(r.start);return}let g=l.defaultAudioCodec||c.audioCodec||"mp4a.40.2",p=this.transmuxer;p||(p=this.transmuxer=new Gp(this.hls,Ee.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));let y=this.initPTS[r.cc],E=(t=r.initSegment)==null?void 0:t.data;if(y!==void 0){let S=a?a.index:-1,T=S!==-1,k=new Ku(r.level,r.sn,r.stats.chunkCount,n.byteLength,S,T);p.push(n,E,g,"",r,a,f.totalduration,!1,k,y)}else{this.log(`Unknown video PTS for cc ${r.cc}, waiting for video PTS before demuxing audio frag ${r.sn} of [${f.startSN} ,${f.endSN}],track ${u}`);let{cache:S}=this.waitingData=this.waitingData||{frag:r,part:a,cache:new Ap,complete:!1};S.push(new Uint8Array(n)),this.waitingVideoCC=this.videoTrackCC,this.state=z.WAITING_INIT_PTS}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(e,t){let r=t.tracks.audio;r&&(this.mediaBuffer=r.buffer||null),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer||null)}onFragBuffered(e,t){let{frag:r,part:a}=t;if(r.type!==Ee.AUDIO){if(!this.loadedmetadata&&r.type===Ee.MAIN){let n=this.videoBuffer||this.media;n&&Ke.getBuffered(n).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${a?" p: "+a.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(r.sn!=="initSegment"){this.fragPrevious=r;let n=this.switchingTrack;n&&(this.bufferedTrack=n,this.switchingTrack=null,this.hls.trigger(b.AUDIO_TRACK_SWITCHED,ut({},n)))}this.fragBufferedComplete(r,a)}onError(e,t){var r;if(t.fatal){this.state=z.ERROR;return}switch(t.details){case B.FRAG_GAP:case B.FRAG_PARSING_ERROR:case B.FRAG_DECRYPT_ERROR:case B.FRAG_LOAD_ERROR:case B.FRAG_LOAD_TIMEOUT:case B.KEY_LOAD_ERROR:case B.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ee.AUDIO,t);break;case B.AUDIO_TRACK_LOAD_ERROR:case B.AUDIO_TRACK_LOAD_TIMEOUT:case B.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===z.WAITING_TRACK&&((r=t.context)==null?void 0:r.type)===Re.AUDIO_TRACK&&(this.state=z.IDLE);break;case B.BUFFER_APPEND_ERROR:case B.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="audio")return;if(t.details===B.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case B.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Pe.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Pe.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===z.ENDED&&(this.state=z.IDLE);let r=this.mediaBuffer||this.media;r&&(this.afterBufferFlushed(r,t,Ee.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;let r="audio",{hls:a}=this,{remuxResult:n,chunkMeta:l}=e,u=this.getCurrentContext(l);if(!u){this.resetWhenMissingContext(l);return}let{frag:d,part:c,level:f}=u,{details:g}=f,{audio:p,text:y,id3:E,initSegment:S}=n;if(this.fragContextChanged(d)||!g){this.fragmentTracker.removeFragment(d);return}if(this.state=z.PARSING,this.switchingTrack&&p&&this.completeAudioSwitch(this.switchingTrack),S!=null&&S.tracks){let T=d.initSegment||d;this._bufferInitSegment(f,S.tracks,T,l),a.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:r,tracks:S.tracks})}if(p){let{startPTS:T,endPTS:k,startDTS:C,endDTS:I}=p;c&&(c.elementaryStreams[Pe.AUDIO]={startPTS:T,endPTS:k,startDTS:C,endDTS:I}),d.setElementaryStreamInfo(Pe.AUDIO,T,k,C,I),this.bufferFragmentData(p,d,c,l)}if(E!=null&&(t=E.samples)!=null&&t.length){let T=Je({id:r,frag:d,details:g},E);a.trigger(b.FRAG_PARSING_METADATA,T)}if(y){let T=Je({id:r,frag:d,details:g},y);a.trigger(b.FRAG_PARSING_USERDATA,T)}}_bufferInitSegment(e,t,r,a){if(this.state!==z.PARSING)return;t.video&&delete t.video;let n=t.audio;if(!n)return;n.id="audio";let l=e.audioCodec;this.log(`Init audio buffer, container:${n.container}, codecs[level/parsed]=[${l}/${n.codec}]`),l&&l.split(",").length===1&&(n.levelCodec=l),this.hls.trigger(b.BUFFER_CODECS,t);let u=n.initSegment;if(u!=null&&u.byteLength){let d={type:"audio",frag:r,part:null,chunkMeta:a,parent:r.type,data:u};this.hls.trigger(b.BUFFER_APPENDING,d)}this.tickImmediate()}loadFragment(e,t,r){let a=this.fragmentTracker.getState(e);if(this.fragCurrent=e,this.switchingTrack||a===ot.NOT_LOADED||a===ot.PARTIAL){var n;if(e.sn==="initSegment")this._loadInitSegment(e,t);else if((n=t.details)!=null&&n.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=z.WAITING_INIT_PTS;let l=this.mainDetails;l&&l.fragments[0].start!==t.details.fragments[0].start&&On(t.details,l)}else this.startFragRequested=!0,super.loadFragment(e,t,r)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){let{media:t,bufferedTrack:r}=this,a=r?.attrs,n=e.attrs;t&&a&&(a.CHANNELS!==n.CHANNELS||r.name!==e.name||r.lang!==e.lang)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null)}completeAudioSwitch(e){let{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(b.AUDIO_TRACK_SWITCHED,ut({},e))}},HT=class extends Hu{constructor(e){super(e,"[audio-track-controller]"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){let{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(b.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){let{id:r,groupId:a,details:n}=t,l=this.tracksInGroup[r];if(!l||l.groupId!==a){this.warn(`Audio track with id:${r} and group:${a} not found in active group ${l?.groupId}`);return}let u=l.details;l.details=t.details,this.log(`Audio track ${r} "${l.name}" lang:${l.lang} group:${a} loaded [${n.startSN}-${n.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!t)return;let r=t.audioGroups||null,a=this.groupIds,n=this.currentTrack;if(!r||a?.length!==r?.length||r!=null&&r.some(u=>a?.indexOf(u)===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;let u=this.tracks.filter(p=>!r||r.indexOf(p.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(p=>p.default)&&(this.selectDefaultTrack=!1),u.forEach((p,y)=>{p.id=y});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=u;let d=this.hls.config.audioPreference;if(!n&&d){let p=nr(d,u,Fi);if(p>-1)n=u[p];else{let y=nr(d,this.tracks);n=this.tracks[y]}}let c=this.findTrackId(n);c===-1&&n&&(c=this.findTrackId(null));let f={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${r?.join(",")}`),this.hls.trigger(b.AUDIO_TRACKS_UPDATED,f);let g=this.trackId;if(c!==-1&&g===-1)this.setAudioTrack(c);else if(u.length&&g===-1){var l;let p=new Error(`No audio track selected for current audio group-ID(s): ${(l=this.groupIds)==null?void 0:l.join(",")} track count: ${u.length}`);this.warn(p.message),this.hls.trigger(b.ERROR,{type:Se.MEDIA_ERROR,details:B.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:p})}}else this.shouldReloadPlaylist(n)&&this.setAudioTrack(this.trackId)}onError(e,t){t.fatal||!t.context||t.context.type===Re.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&(this.requestScheduled=-1,this.checkRetry(t))}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){let t=this.hls;if(t.config.audioPreference=e,e){let r=this.allAudioTracks;if(this.selectDefaultTrack=!1,r.length){let a=this.currentTrack;if(a&&Hi(e,a,Fi))return a;let n=nr(e,this.tracksInGroup,Fi);if(n>-1){let l=this.tracksInGroup[n];return this.setAudioTrack(n),l}else if(a){let l=t.loadLevel;l===-1&&(l=t.firstAutoLevel);let u=VS(e,t.levels,r,l,Fi);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){let l=nr(e,r);if(l>-1)return r[l]}}}return null}setAudioTrack(e){let t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;let r=this.currentTrack,a=t[e],n=a.details&&!a.details.live;if(e===this.trackId&&a===r&&n||(this.log(`Switching to audio-track ${e} "${a.name}" lang:${a.lang} group:${a.groupId} channels:${a.channels}`),this.trackId=e,this.currentTrack=a,this.hls.trigger(b.AUDIO_TRACK_SWITCHING,ut({},a)),n))return;let l=this.switchParams(a.url,r?.details,a.details);this.loadPlaylist(l)}findTrackId(e){let t=this.tracksInGroup;for(let r=0;r<t.length;r++){let a=t[r];if(!(this.selectDefaultTrack&&!a.default)&&(!e||Hi(e,a,Fi)))return r}if(e){let{name:r,lang:a,assocLang:n,characteristics:l,audioCodec:u,channels:d}=e;for(let c=0;c<t.length;c++){let f=t[c];if(Hi({name:r,lang:a,assocLang:n,characteristics:l,audioCodec:u,channels:d},f,Fi))return c}for(let c=0;c<t.length;c++){let f=t[c];if(zi(e.attrs,f.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){let f=t[c];if(zi(e.attrs,f.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){let t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){super.loadPlaylist();let r=t.id,a=t.groupId,n=t.url;if(e)try{n=e.addDirectives(n)}catch(l){this.warn(`Could not construct new URL with HLS Delivery Directives: ${l}`)}this.log(`loading audio-track playlist ${r} "${t.name}" lang:${t.lang} group:${a}`),this.clearTimer(),this.hls.trigger(b.AUDIO_TRACK_LOADING,{url:n,id:r,groupId:a,deliveryDirectives:e||null})}}},xg=500,KT=class extends Wu{constructor(e,t,r){super(e,t,r,"[subtitle-stream-controller]",Ee.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}_registerListeners(){let{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.ERROR,this.onError,this),e.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){let{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.ERROR,this.onError,this),e.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(b.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(e){this.stopLoad(),this.state=z.IDLE,this.setInterval(xg),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){let{frag:r,success:a}=t;if(this.fragPrevious=r,this.state=z.IDLE,!a)return;let n=this.tracksBuffered[this.currentTrackId];if(!n)return;let l,u=r.start;for(let c=0;c<n.length;c++)if(u>=n[c].start&&u<=n[c].end){l=n[c];break}let d=r.start+r.duration;l?l.end=d:(l={start:u,end:d},n.push(l)),this.fragmentTracker.fragBuffered(r),this.fragBufferedComplete(r,null)}onBufferFlushing(e,t){let{startOffset:r,endOffset:a}=t;if(r===0&&a!==Number.POSITIVE_INFINITY){let n=a-1;if(n<=0)return;t.endOffsetSubtitles=Math.max(0,n),this.tracksBuffered.forEach(l=>{for(let u=0;u<l.length;){if(l[u].end<=n){l.shift();continue}else if(l[u].start<n)l[u].start=n;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(r,n,Ee.SUBTITLE)}}onFragBuffered(e,t){if(!this.loadedmetadata&&t.frag.type===Ee.MAIN){var r;(r=this.media)!=null&&r.buffered.length&&(this.loadedmetadata=!0)}}onError(e,t){t.frag?.type===Ee.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==z.STOPPED&&(this.state=z.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Vp(this.levels,t)){this.levels=t.map(r=>new Ki(r));return}this.tracksBuffered=[],this.levels=t.map(r=>{let a=new Ki(r);return this.tracksBuffered[a.id]=[],a}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,Ee.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var r;if(this.currentTrackId=t.id,!((r=this.levels)!=null&&r.length)||this.currentTrackId===-1){this.clearInterval();return}let a=this.levels[this.currentTrackId];a!=null&&a.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,a&&this.setInterval(xg)}onSubtitleTrackLoaded(e,t){var r;let{currentTrackId:a,levels:n}=this,{details:l,id:u}=t;if(!n){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}let d=n[a];if(u>=n.length||u!==a||!d)return;this.log(`Subtitle track ${u} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(l.live||(r=d.details)!=null&&r.live){let g=this.mainDetails;if(l.deltaUpdateFailed||!g)return;let p=g.fragments[0];if(!d.details)l.hasProgramDateTime&&g.hasProgramDateTime?(On(l,g),c=l.fragments[0].start):p&&(c=p.start,wu(l,c));else{var f;c=this.alignPlaylists(l,d.details,(f=this.levelLastLoaded)==null?void 0:f.details),c===0&&p&&(c=p.start,wu(l,c))}}d.details=l,this.levelLastLoaded=d,!this.startFragRequested&&(this.mainDetails||!l.live)&&this.setStartPosition(this.mainDetails||l,c),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===z.IDLE&&(Nn(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),d.details=void 0))}_handleFragmentLoadComplete(e){let{frag:t,payload:r}=e,a=t.decryptdata,n=this.hls;if(!this.fragContextChanged(t)&&r&&r.byteLength>0&&a!=null&&a.key&&a.iv&&a.method==="AES-128"){let l=performance.now();this.decrypter.decrypt(new Uint8Array(r),a.key.buffer,a.iv.buffer).catch(u=>{throw n.trigger(b.ERROR,{type:Se.MEDIA_ERROR,details:B.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{let d=performance.now();n.trigger(b.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:l,tdecrypt:d}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=z.IDLE})}}doTick(){if(!this.media){this.state=z.IDLE;return}if(this.state===z.IDLE){let{currentTrackId:e,levels:t}=this,r=t?.[e];if(!r||!t.length||!r.details)return;let{config:a}=this,n=this.getLoadPosition(),l=Ke.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n,a.maxBufferHole),{end:u,len:d}=l,c=this.getFwdBufferInfo(this.media,Ee.MAIN),f=r.details,g=this.getMaxBufferLength(c?.len)+f.levelTargetDuration;if(d>g)return;let p=f.fragments,y=p.length,E=f.edge,S=null,T=this.fragPrevious;if(u<E){let k=a.maxFragLookUpTolerance,C=u>E-k?0:k;S=Nn(T,p,Math.max(p[0].start,u),C),!S&&T&&T.start<p[0].start&&(S=p[0])}else S=p[y-1];if(!S)return;if(S=this.mapToInitFragWhenRequired(S),S.sn!=="initSegment"){let k=S.sn-f.startSN,C=p[k-1];C&&C.cc===S.cc&&this.fragmentTracker.getState(C)===ot.NOT_LOADED&&(S=C)}this.fragmentTracker.getState(S)===ot.NOT_LOADED&&this.loadFragment(S,r,u)}}getMaxBufferLength(e){let t=super.getMaxBufferLength();return e?Math.max(t,e):t}loadFragment(e,t,r){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e,t):(this.startFragRequested=!0,super.loadFragment(e,t,r))}get mediaBufferTimeRanges(){return new zT(this.tracksBuffered[this.currentTrackId]||[])}},zT=class{constructor(e){this.buffered=void 0;let t=(r,a,n)=>{if(a=a>>>0,a>n-1)throw new DOMException(`Failed to execute '${r}' on 'TimeRanges': The index provided (${a}) is greater than the maximum bound (${n})`);return e[a][r]};this.buffered={get length(){return e.length},end(r){return t("end",r,e.length)},start(r){return t("start",r,e.length)}}}},WT=class extends Hu{constructor(e){super(e,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null,r=En(this.media.textTracks);for(let n=0;n<r.length;n++)if(r[n].mode==="hidden")t=r[n];else if(r[n].mode==="showing"){t=r[n];break}let a=this.findTrackForTextTrack(t);this.subtitleTrack!==a&&this.setSubtitleTrack(a)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){let{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){let{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),En(this.media.textTracks).forEach(e=>{Vi(e)}),this.subtitleTrack=-1,this.media=null)}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){let{id:r,groupId:a,details:n}=t,l=this.tracksInGroup[r];if(!l||l.groupId!==a){this.warn(`Subtitle track with id:${r} and group:${a} not found in active group ${l?.groupId}`);return}let u=l.details;l.details=t.details,this.log(`Subtitle track ${r} "${l.name}" lang:${l.lang} group:${a} loaded [${n.startSN}-${n.endSN}]`),r===this.trackId&&this.playlistLoaded(r,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){let t=this.hls.levels[e];if(!t)return;let r=t.subtitleGroups||null,a=this.groupIds,n=this.currentTrack;if(!r||a?.length!==r?.length||r!=null&&r.some(l=>a?.indexOf(l)===-1)){this.groupIds=r,this.trackId=-1,this.currentTrack=null;let l=this.tracks.filter(f=>!r||r.indexOf(f.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(f=>f.default)&&(this.selectDefaultTrack=!1),l.forEach((f,g)=>{f.id=g});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=l;let u=this.hls.config.subtitlePreference;if(!n&&u){this.selectDefaultTrack=!1;let f=nr(u,l);if(f>-1)n=l[f];else{let g=nr(u,this.tracks);n=this.tracks[g]}}let d=this.findTrackId(n);d===-1&&n&&(d=this.findTrackId(null));let c={subtitleTracks:l};this.log(`Updating subtitle tracks, ${l.length} track(s) found in "${r?.join(",")}" group-id`),this.hls.trigger(b.SUBTITLE_TRACKS_UPDATED,c),d!==-1&&this.trackId===-1&&this.setSubtitleTrack(d)}else this.shouldReloadPlaylist(n)&&this.setSubtitleTrack(this.trackId)}findTrackId(e){let t=this.tracksInGroup,r=this.selectDefaultTrack;for(let a=0;a<t.length;a++){let n=t[a];if(!(r&&!n.default||!r&&!e)&&(!e||Hi(n,e)))return a}if(e){for(let a=0;a<t.length;a++){let n=t[a];if(zi(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return a}for(let a=0;a<t.length;a++){let n=t[a];if(zi(e.attrs,n.attrs,["LANGUAGE"]))return a}}return-1}findTrackForTextTrack(e){if(e){let t=this.tracksInGroup;for(let r=0;r<t.length;r++){let a=t[r];if(Cu(a,e))return r}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Re.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){let t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){let r=this.currentTrack;if(r&&Hi(e,r))return r;let a=nr(e,this.tracksInGroup);if(a>-1){let n=this.tracksInGroup[a];return this.setSubtitleTrack(a),n}else{if(r)return null;{let n=nr(e,t);if(n>-1)return t[n]}}}}return null}loadPlaylist(e){super.loadPlaylist();let t=this.currentTrack;if(this.shouldLoadPlaylist(t)&&t){let r=t.id,a=t.groupId,n=t.url;if(e)try{n=e.addDirectives(n)}catch(l){this.warn(`Could not construct new URL with HLS Delivery Directives: ${l}`)}this.log(`Loading subtitle playlist for id ${r}`),this.hls.trigger(b.SUBTITLE_TRACK_LOADING,{url:n,id:r,groupId:a,deliveryDirectives:e||null})}}toggleTrackModes(){let{media:e}=this;if(!e)return;let t=En(e.textTracks),r=this.currentTrack,a;if(r&&(a=t.filter(n=>Cu(r,n))[0],a||this.warn(`Unable to find subtitle TextTrack with name "${r.name}" and language "${r.lang}"`)),[].slice.call(t).forEach(n=>{n.mode!=="disabled"&&n!==a&&(n.mode="disabled")}),a){let n=this.subtitleDisplay?"showing":"hidden";a.mode!==n&&(a.mode=n)}}setSubtitleTrack(e){let t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!oe(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.clearTimer(),this.selectDefaultTrack=!1;let r=this.currentTrack,a=t[e]||null;if(this.trackId=e,this.currentTrack=a,this.toggleTrackModes(),!a){this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:e});return}let n=!!a.details&&!a.details.live;if(e===this.trackId&&a===r&&n)return;this.log(`Switching to subtitle-track ${e}`+(a?` "${a.name}" lang:${a.lang} group:${a.groupId}`:""));let{id:l,groupId:u="",name:d,type:c,url:f}=a;this.hls.trigger(b.SUBTITLE_TRACK_SWITCH,{id:l,groupId:u,name:d,type:c,url:f});let g=this.switchParams(a.url,r?.details,a.details);this.loadPlaylist(g)}},jT=class{constructor(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}append(e,t,r){let a=this.queues[t];a.push(e),a.length===1&&!r&&this.executeNext(t)}insertAbort(e,t){this.queues[t].unshift(e),this.executeNext(t)}appendBlocker(e){let t,r=new Promise(n=>{t=n}),a={execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(a,e),r}executeNext(e){let t=this.queues[e];if(t.length){let r=t[0];try{r.execute()}catch(a){P.warn(`[buffer-operation-queue]: Exception executing "${e}" SourceBuffer operation: ${a}`),r.onError(a);let n=this.buffers[e];n!=null&&n.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues[e].shift(),this.executeNext(e)}current(e){return this.queues[e][0]}},Pg=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,YT=class{constructor(e){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendSource=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this.log=void 0,this.warn=void 0,this.error=void 0,this._onEndStreaming=r=>{this.hls&&this.hls.pauseBuffering()},this._onStartStreaming=r=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=()=>{let{media:r,mediaSource:a}=this;this.log("Media source opened"),r&&(r.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(b.MEDIA_ATTACHED,{media:r,mediaSource:a})),a&&a.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{let{mediaSrc:r,_objectUrl:a}=this;r!==a&&P.error(`Media element src was set while attaching MediaSource (${a} > ${r})`)},this.hls=e;let t="[buffer-controller]";this.appendSource=iS(ni(e.config.preferManagedMediaSource)),this.log=P.log.bind(P,t),this.warn=P.warn.bind(P,t),this.error=P.error.bind(P,t),this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null,this.hls=null}registerListeners(){let{hls:e}=this;e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.BUFFER_RESET,this.onBufferReset,this),e.on(b.BUFFER_APPENDING,this.onBufferAppending,this),e.on(b.BUFFER_CODECS,this.onBufferCodecs,this),e.on(b.BUFFER_EOS,this.onBufferEos,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(b.FRAG_PARSED,this.onFragParsed,this),e.on(b.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){let{hls:e}=this;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.BUFFER_RESET,this.onBufferReset,this),e.off(b.BUFFER_APPENDING,this.onBufferAppending,this),e.off(b.BUFFER_CODECS,this.onBufferCodecs,this),e.off(b.BUFFER_EOS,this.onBufferEos,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(b.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(b.FRAG_PARSED,this.onFragParsed,this),e.off(b.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new jT(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.appendErrors={audio:0,video:0,audiovideo:0},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(e,t){let r=this.media=t.media,a=ni(this.appendSource);if(r&&a){var n;let l=this.mediaSource=new a;this.log(`created media source: ${(n=l.constructor)==null?void 0:n.name}`),l.addEventListener("sourceopen",this._onMediaSourceOpen),l.addEventListener("sourceended",this._onMediaSourceEnded),l.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(l.addEventListener("startstreaming",this._onStartStreaming),l.addEventListener("endstreaming",this._onEndStreaming));let u=this._objectUrl=self.URL.createObjectURL(l);if(this.appendSource)try{r.removeAttribute("src");let d=self.ManagedMediaSource;r.disableRemotePlayback=r.disableRemotePlayback||d&&l instanceof d,Mg(r),qT(r,u),r.load()}catch{r.src=u}else r.src=u;r.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){let{media:e,mediaSource:t,_objectUrl:r}=this;if(t){if(this.log("media source detaching"),t.readyState==="open")try{t.endOfStream()}catch(a){this.warn(`onMediaDetaching: ${a.message} while calling endOfStream`)}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(t.removeEventListener("startstreaming",this._onStartStreaming),t.removeEventListener("endstreaming",this._onEndStreaming)),e&&(e.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),this.mediaSrc===r?(e.removeAttribute("src"),this.appendSource&&Mg(e),e.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(b.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(e=>{this.resetBuffer(e)}),this._initSourceBuffer()}resetBuffer(e){let t=this.sourceBuffer[e];try{if(t){var r;this.removeBufferListeners(e),this.sourceBuffer[e]=void 0,(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(t)}}catch(a){this.warn(`onBufferReset ${e}`,a)}}onBufferCodecs(e,t){let r=this.getSourceBufferTypes().length,a=Object.keys(t);if(a.forEach(l=>{if(r){let d=this.tracks[l];if(d&&typeof d.buffer.changeType=="function"){var u;let{id:c,codec:f,levelCodec:g,container:p,metadata:y}=t[l],E=tg(d.codec,d.levelCodec),S=E?.replace(Pg,"$1"),T=tg(f,g),k=(u=T)==null?void 0:u.replace(Pg,"$1");if(T&&S!==k){l.slice(0,5)==="audio"&&(T=_n(T,this.appendSource));let C=`${p};codecs=${T}`;this.appendChangeType(l,C),this.log(`switching codec ${E} to ${T}`),this.tracks[l]={buffer:d.buffer,codec:f,container:p,levelCodec:g,metadata:y,id:c}}}}else this.pendingTracks[l]=t[l]}),r)return;let n=Math.max(this.bufferCodecEventsExpected-1,0);this.bufferCodecEventsExpected!==n&&(this.log(`${n} bufferCodec event(s) expected ${a.join(",")}`),this.bufferCodecEventsExpected=n),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks()}appendChangeType(e,t){let{operationQueue:r}=this,a={execute:()=>{let n=this.sourceBuffer[e];n&&(this.log(`changing ${e} sourceBuffer type to ${t}`),n.changeType(t)),r.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:n=>{this.warn(`Failed to change ${e} SourceBuffer type`,n)}};r.append(a,e,!!this.pendingTracks[e])}onBufferAppending(e,t){let{hls:r,operationQueue:a,tracks:n}=this,{data:l,type:u,frag:d,part:c,chunkMeta:f}=t,g=f.buffering[u],p=self.performance.now();g.start=p;let y=d.stats.buffering,E=c?c.stats.buffering:null;y.start===0&&(y.start=p),E&&E.start===0&&(E.start=p);let S=n.audio,T=!1;u==="audio"&&S?.container==="audio/mpeg"&&(T=!this.lastMpegAudioChunk||f.id===1||this.lastMpegAudioChunk.sn!==f.sn,this.lastMpegAudioChunk=f);let k=d.start,C={execute:()=>{if(g.executeStart=self.performance.now(),T){let I=this.sourceBuffer[u];if(I){let O=k-I.timestampOffset;Math.abs(O)>=.1&&(this.log(`Updating audio SourceBuffer timestampOffset to ${k} (delta: ${O}) sn: ${d.sn})`),I.timestampOffset=k)}}this.appendExecutor(l,u)},onStart:()=>{},onComplete:()=>{let I=self.performance.now();g.executeEnd=g.end=I,y.first===0&&(y.first=I),E&&E.first===0&&(E.first=I);let{sourceBuffer:O}=this,x={};for(let $ in O)x[$]=Ke.getBuffered(O[$]);this.appendErrors[u]=0,u==="audio"||u==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(b.BUFFER_APPENDED,{type:u,frag:d,part:c,chunkMeta:f,parent:d.type,timeRanges:x})},onError:I=>{let O={type:Se.MEDIA_ERROR,parent:d.type,details:B.BUFFER_APPEND_ERROR,sourceBufferName:u,frag:d,part:c,chunkMeta:f,error:I,err:I,fatal:!1};if(I.code===DOMException.QUOTA_EXCEEDED_ERR)O.details=B.BUFFER_FULL_ERROR;else{let x=++this.appendErrors[u];O.details=B.BUFFER_APPEND_ERROR,this.warn(`Failed ${x}/${r.config.appendErrorMaxRetry} times to append segment in "${u}" sourceBuffer`),x>=r.config.appendErrorMaxRetry&&(O.fatal=!0)}r.trigger(b.ERROR,O)}};a.append(C,u,!!this.pendingTracks[u])}onBufferFlushing(e,t){let{operationQueue:r}=this,a=n=>({execute:this.removeExecutor.bind(this,n,t.startOffset,t.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(b.BUFFER_FLUSHED,{type:n})},onError:l=>{this.warn(`Failed to remove from ${n} SourceBuffer`,l)}});t.type?r.append(a(t.type),t.type):this.getSourceBufferTypes().forEach(n=>{r.append(a(n),n)})}onFragParsed(e,t){let{frag:r,part:a}=t,n=[],l=a?a.elementaryStreams:r.elementaryStreams;l[Pe.AUDIOVIDEO]?n.push("audiovideo"):(l[Pe.AUDIO]&&n.push("audio"),l[Pe.VIDEO]&&n.push("video"));let u=()=>{let d=self.performance.now();r.stats.buffering.end=d,a&&(a.stats.buffering.end=d);let c=a?a.stats:r.stats;this.hls.trigger(b.FRAG_BUFFERED,{frag:r,part:a,stats:c,id:r.type})};n.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${r.type} level: ${r.level} sn: ${r.sn}`),this.blockBuffers(u,n)}onFragChanged(e,t){this.trimBuffers()}onBufferEos(e,t){this.getSourceBufferTypes().reduce((r,a)=>{let n=this.sourceBuffer[a];return n&&(!t.type||t.type===a)&&(n.ending=!0,n.ended||(n.ended=!0,this.log(`${a} sourceBuffer now EOS`))),r&&!!(!n||n.ended)},!0)&&(this.log("Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach(a=>{let n=this.sourceBuffer[a];n&&(n.ending=!1)});let{mediaSource:r}=this;if(!r||r.readyState!=="open"){r&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${r.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),r.endOfStream()}))}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}trimBuffers(){let{hls:e,details:t,media:r}=this;if(!r||t===null||!this.getSourceBufferTypes().length)return;let a=e.config,n=r.currentTime,l=t.levelTargetDuration,u=t.live&&a.liveBackBufferLength!==null?a.liveBackBufferLength:a.backBufferLength;if(oe(u)&&u>0){let d=Math.max(u,l),c=Math.floor(n/l)*l-d;this.flushBackBuffer(n,l,c)}if(oe(a.frontBufferFlushThreshold)&&a.frontBufferFlushThreshold>0){let d=Math.max(a.maxBufferLength,a.frontBufferFlushThreshold),c=Math.max(d,l),f=Math.floor(n/l)*l+c;this.flushFrontBuffer(n,l,f)}}flushBackBuffer(e,t,r){let{details:a,sourceBuffer:n}=this;this.getSourceBufferTypes().forEach(l=>{let u=n[l];if(u){let d=Ke.getBuffered(u);if(d.length>0&&r>d.start(0)){if(this.hls.trigger(b.BACK_BUFFER_REACHED,{bufferEnd:r}),a!=null&&a.live)this.hls.trigger(b.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r});else if(u.ended&&d.end(d.length-1)-e<t*2){this.log(`Cannot flush ${l} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:r,type:l})}}})}flushFrontBuffer(e,t,r){let{sourceBuffer:a}=this;this.getSourceBufferTypes().forEach(n=>{let l=a[n];if(l){let u=Ke.getBuffered(l),d=u.length;if(d<2)return;let c=u.start(d-1),f=u.end(d-1);if(r>c||e>=c&&e<=f)return;if(l.ended&&e-f<2*t){this.log(`Cannot flush ${n} front buffer while SourceBuffer is in ended state`);return}this.hls.trigger(b.BUFFER_FLUSHING,{startOffset:c,endOffset:1/0,type:n})}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;let{details:e,hls:t,media:r,mediaSource:a}=this,n=e.fragments[0].start+e.totalduration,l=r.duration,u=oe(a.duration)?a.duration:0;e.live&&t.config.liveDurationInfinity?(a.duration=1/0,this.updateSeekableRange(e)):(n>u&&n>l||!oe(l))&&(this.log(`Updating Media Source duration to ${n.toFixed(3)}`),a.duration=n)}updateSeekableRange(e){let t=this.mediaSource,r=e.fragments;if(r.length&&e.live&&t!=null&&t.setLiveSeekableRange){let a=Math.max(0,r[0].start),n=Math.max(a,a+e.totalduration);this.log(`Media Source duration is set to ${t.duration}. Setting seekable range to ${a}-${n}.`),t.setLiveSeekableRange(a,n)}}checkPendingTracks(){let{bufferCodecEventsExpected:e,operationQueue:t,pendingTracks:r}=this,a=Object.keys(r).length;if(a&&(!e||a===2||"audiovideo"in r)){this.createSourceBuffers(r),this.pendingTracks={};let n=this.getSourceBufferTypes();if(n.length)this.hls.trigger(b.BUFFER_CREATED,{tracks:this.tracks}),n.forEach(l=>{t.executeNext(l)});else{let l=new Error("could not create source buffer for media codec(s)");this.hls.trigger(b.ERROR,{type:Se.MEDIA_ERROR,details:B.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:l,reason:l.message})}}}createSourceBuffers(e){let{sourceBuffer:t,mediaSource:r}=this;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(let n in e)if(!t[n]){var a;let l=e[n];if(!l)throw Error(`source buffer exists for track ${n}, however track does not`);let u=((a=l.levelCodec)==null?void 0:a.indexOf(","))===-1?l.levelCodec:l.codec;u&&n.slice(0,5)==="audio"&&(u=_n(u,this.appendSource));let d=`${l.container};codecs=${u}`;this.log(`creating sourceBuffer(${d})`);try{let c=t[n]=r.addSourceBuffer(d),f=n;this.addBufferListener(f,"updatestart",this._onSBUpdateStart),this.addBufferListener(f,"updateend",this._onSBUpdateEnd),this.addBufferListener(f,"error",this._onSBUpdateError),this.appendSource&&this.addBufferListener(f,"bufferedchange",(g,p)=>{let y=p.removedRanges;y!=null&&y.length&&this.hls.trigger(b.BUFFER_FLUSHED,{type:n})}),this.tracks[n]={buffer:c,codec:u,container:l.container,levelCodec:l.levelCodec,metadata:l.metadata,id:l.id}}catch(c){this.error(`error while trying to add sourceBuffer: ${c.message}`),this.hls.trigger(b.ERROR,{type:Se.MEDIA_ERROR,details:B.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:c,sourceBufferName:n,mimeType:d})}}}get mediaSrc(){var e;return(((e=this.media)==null?void 0:e.firstChild)||this.media)?.src}_onSBUpdateStart(e){let{operationQueue:t}=this;t.current(e).onStart()}_onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}let{operationQueue:r}=this;r.current(e).onComplete(),r.shiftAndExecuteNext(e)}_onSBUpdateError(e,t){var r;let a=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(r=this.mediaSource)==null?void 0:r.readyState}`);this.error(`${a}`,t),this.hls.trigger(b.ERROR,{type:Se.MEDIA_ERROR,details:B.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:a,fatal:!1});let n=this.operationQueue.current(e);n&&n.onError(a)}removeExecutor(e,t,r){let{media:a,mediaSource:n,operationQueue:l,sourceBuffer:u}=this,d=u[e];if(!a||!n||!d){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),l.shiftAndExecuteNext(e);return}let c=oe(a.duration)?a.duration:1/0,f=oe(n.duration)?n.duration:1/0,g=Math.max(0,t),p=Math.min(r,c,f);p>g&&(!d.ending||d.ended)?(d.ended=!1,this.log(`Removing [${g},${p}] from the ${e} SourceBuffer`),d.remove(g,p)):l.shiftAndExecuteNext(e)}appendExecutor(e,t){let r=this.sourceBuffer[t];if(!r){if(!this.pendingTracks[t])throw new Error(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);return}r.ended=!1,r.appendBuffer(e)}blockBuffers(e,t=this.getSourceBufferTypes()){if(!t.length){this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}let{operationQueue:r}=this,a=t.map(n=>r.appendBlocker(n));Promise.all(a).then(()=>{e(),t.forEach(n=>{let l=this.sourceBuffer[n];l!=null&&l.updating||r.shiftAndExecuteNext(n)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(e,t,r){let a=this.sourceBuffer[e];if(!a)return;let n=r.bind(this,e);this.listeners[e].push({event:t,listener:n}),a.addEventListener(t,n)}removeBufferListeners(e){let t=this.sourceBuffer[e];t&&this.listeners[e].forEach(r=>{t.removeEventListener(r.event,r.listener)})}};function Mg(e){let t=e.querySelectorAll("source");[].slice.call(t).forEach(r=>{e.removeChild(r)})}function qT(e,t){let r=self.document.createElement("source");r.type="video/mp4",r.src=t,e.appendChild(r)}var Ng={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},Hp=function(e){let t=e;return Ng.hasOwnProperty(e)&&(t=Ng[e]),String.fromCharCode(t)},qt=15,Er=100,XT={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},QT={17:2,18:4,21:6,22:8,23:10,19:13,20:15},JT={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},ZT={25:2,26:4,29:6,30:8,31:10,27:13,28:15},eb=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],tb=class{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){let r=typeof t=="function"?t():t;P.log(`${this.time} [${e}] ${r}`)}}},ti=function(e){let t=[];for(let r=0;r<e.length;r++)t.push(e[r].toString(16));return t},Kp=class{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){let t=["foreground","underline","italics","background","flash"];for(let r=0;r<t.length;r++){let a=t[r];e.hasOwnProperty(a)&&(this[a]=e[a])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}},rb=class{constructor(){this.uchar=" ",this.penState=new Kp}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}},ib=class{constructor(e){this.chars=[],this.pos=0,this.currPenState=new Kp,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<Er;t++)this.chars.push(new rb);this.logger=e}equals(e){for(let t=0;t<Er;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<Er;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<Er;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>Er&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=Er)}moveCursor(e){let t=this.pos+e;if(e>1)for(let r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();let t=Hp(e);if(this.pos>=Er){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<Er;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){let e=[],t=!0;for(let r=0;r<Er;r++){let a=this.chars[r].uchar;a!==" "&&(t=!1),e.push(a)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}},cu=class{constructor(e){this.rows=[],this.currRow=qt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<qt;t++)this.rows.push(new ib(e));this.logger=e}reset(){for(let e=0;e<qt;e++)this.rows[e].clear();this.currRow=qt-1}equals(e){let t=!0;for(let r=0;r<qt;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t}copy(e){for(let t=0;t<qt;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<qt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+JSON.stringify(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<qt;u++)this.rows[u].clear();let n=this.currRow+1-this.nrRollUpRows,l=this.lastOutputScreen;if(l){let u=l.rows[n].cueStartTime,d=this.logger.time;if(u!==null&&d!==null&&u<d)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(l.rows[n+c])}}this.currRow=t;let r=this.rows[this.currRow];if(e.indent!==null){let n=e.indent,l=Math.max(n-1,0);r.setCursor(e.indent),e.color=r.chars[l].penState.foreground}let a={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(a)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());let e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;let t=[],r="",a=-1;for(let n=0;n<qt;n++){let l=this.rows[n].getTextString();l&&(a=n+1,e?t.push("Row "+a+": '"+l+"'"):t.push(l.trim()))}return t.length>0&&(e?r="["+t.join(" | ")+"]":r=t.join(`
`)),r}getTextAndFormat(){return this.rows}},Og=class{constructor(e,t,r){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new cu(r),this.nonDisplayedMemory=new cu(r),this.lastOutputScreen=new cu(r),this.currRollUpRow=this.displayedMemory.rows[qt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=r}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[qt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let r=0;r<e.length;r++)this.writeScreen.insertChar(e[r]);let t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){let e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){let t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{let r=Math.floor(e/2)-16,a=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=a[r]}this.logger.log(2,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){let t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}},Fg=class{constructor(e,t,r){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Bg(),this.logger=void 0;let a=this.logger=new tb;this.channels=[null,new Og(e,t,a),new Og(e+1,r,a)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){let r,a,n,l=!1;this.logger.time=e;for(let u=0;u<t.length;u+=2)if(a=t[u]&127,n=t[u+1]&127,!(a===0&&n===0)){if(this.logger.log(3,"["+ti([t[u],t[u+1]])+"] -> ("+ti([a,n])+")"),r=this.parseCmd(a,n),r||(r=this.parseMidrow(a,n)),r||(r=this.parsePAC(a,n)),r||(r=this.parseBackgroundAttributes(a,n)),!r&&(l=this.parseChars(a,n),l)){let d=this.currentChannel;d&&d>0?this.channels[d].insertChars(l):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!r&&!l&&this.logger.log(2,"Couldn't parse cleaned data "+ti([a,n])+" orig: "+ti([t[u],t[u+1]]))}}parseCmd(e,t){let{cmdHistory:r}=this,a=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,n=(e===23||e===31)&&t>=33&&t<=35;if(!(a||n))return!1;if(Ug(e,t,r))return Gi(null,null,r),this.logger.log(3,"Repeated command ("+ti([e,t])+") is dropped"),!0;let l=e===20||e===21||e===23?1:2,u=this.channels[l];return e===20||e===21||e===28||e===29?t===32?u.ccRCL():t===33?u.ccBS():t===34?u.ccAOF():t===35?u.ccAON():t===36?u.ccDER():t===37?u.ccRU(2):t===38?u.ccRU(3):t===39?u.ccRU(4):t===40?u.ccFON():t===41?u.ccRDC():t===42?u.ccTR():t===43?u.ccRTD():t===44?u.ccEDM():t===45?u.ccCR():t===46?u.ccENM():t===47&&u.ccEOC():u.ccTO(t-32),Gi(e,t,r),this.currentChannel=l,!0}parseMidrow(e,t){let r=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?r=1:r=2,r!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;let a=this.channels[r];return a?(a.ccMIDROW(t),this.logger.log(3,"MIDROW ("+ti([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let r,a=this.cmdHistory,n=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,l=(e===16||e===24)&&t>=64&&t<=95;if(!(n||l))return!1;if(Ug(e,t,a))return Gi(null,null,a),!0;let u=e<=23?1:2;t>=64&&t<=95?r=u===1?XT[e]:JT[e]:r=u===1?QT[e]:ZT[e];let d=this.channels[u];return d?(d.setPAC(this.interpretPAC(r,t)),Gi(e,t,a),this.currentChannel=u,!0):!1}interpretPAC(e,t){let r,a={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?r=t-96:r=t-64,a.underline=(r&1)===1,r<=13?a.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(r/2)]:r<=15?(a.italics=!0,a.color="white"):a.indent=Math.floor((r-16)/2)*4,a}parseChars(e,t){let r,a=null,n=null;if(e>=25?(r=2,n=e-8):(r=1,n=e),n>=17&&n<=19){let l;n===17?l=t+80:n===18?l=t+112:l=t+144,this.logger.log(2,"Special char '"+Hp(l)+"' in channel "+r),a=[l]}else e>=32&&e<=127&&(a=t===0?[e]:[e,t]);if(a){let l=ti(a);this.logger.log(3,"Char codes =  "+l.join(",")),Gi(e,t,this.cmdHistory)}return a}parseBackgroundAttributes(e,t){let r=(e===16||e===24)&&t>=32&&t<=47,a=(e===23||e===31)&&t>=45&&t<=47;if(!(r||a))return!1;let n,l={};e===16||e===24?(n=Math.floor((t-32)/2),l.background=eb[n],t%2===1&&(l.background=l.background+"_semi")):t===45?l.background="transparent":(l.foreground="black",t===47&&(l.underline=!0));let u=e<=23?1:2;return this.channels[u].setBkgData(l),Gi(e,t,this.cmdHistory),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){let t=this.channels[e];t&&t.reset()}this.cmdHistory=Bg()}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){let r=this.channels[t];r&&r.cueSplitAtTime(e)}}};function Gi(e,t,r){r.a=e,r.b=t}function Ug(e,t,r){return r.a===e&&r.b===t}function Bg(){return{a:null,b:null}}var gn=class{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,r){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=r,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}},Ju=function(){if(Fa!=null&&Fa.VTTCue)return self.VTTCue;let e=["","lr","rl"],t=["start","middle","end","left","right"];function r(d,c){if(typeof c!="string"||!Array.isArray(d))return!1;let f=c.toLowerCase();return~d.indexOf(f)?f:!1}function a(d){return r(e,d)}function n(d){return r(t,d)}function l(d,...c){let f=1;for(;f<arguments.length;f++){let g=arguments[f];for(let p in g)d[p]=g[p]}return d}function u(d,c,f){let g=this,p={enumerable:!0};g.hasBeenReset=!1;let y="",E=!1,S=d,T=c,k=f,C=null,I="",O=!0,x="auto",$="start",G=50,K="middle",Q=50,ae="middle";Object.defineProperty(g,"id",l({},p,{get:function(){return y},set:function(W){y=""+W}})),Object.defineProperty(g,"pauseOnExit",l({},p,{get:function(){return E},set:function(W){E=!!W}})),Object.defineProperty(g,"startTime",l({},p,{get:function(){return S},set:function(W){if(typeof W!="number")throw new TypeError("Start time must be set to a number.");S=W,this.hasBeenReset=!0}})),Object.defineProperty(g,"endTime",l({},p,{get:function(){return T},set:function(W){if(typeof W!="number")throw new TypeError("End time must be set to a number.");T=W,this.hasBeenReset=!0}})),Object.defineProperty(g,"text",l({},p,{get:function(){return k},set:function(W){k=""+W,this.hasBeenReset=!0}})),Object.defineProperty(g,"region",l({},p,{get:function(){return C},set:function(W){C=W,this.hasBeenReset=!0}})),Object.defineProperty(g,"vertical",l({},p,{get:function(){return I},set:function(W){let ee=a(W);if(ee===!1)throw new SyntaxError("An invalid or illegal string was specified.");I=ee,this.hasBeenReset=!0}})),Object.defineProperty(g,"snapToLines",l({},p,{get:function(){return O},set:function(W){O=!!W,this.hasBeenReset=!0}})),Object.defineProperty(g,"line",l({},p,{get:function(){return x},set:function(W){if(typeof W!="number"&&W!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");x=W,this.hasBeenReset=!0}})),Object.defineProperty(g,"lineAlign",l({},p,{get:function(){return $},set:function(W){let ee=n(W);if(!ee)throw new SyntaxError("An invalid or illegal string was specified.");$=ee,this.hasBeenReset=!0}})),Object.defineProperty(g,"position",l({},p,{get:function(){return G},set:function(W){if(W<0||W>100)throw new Error("Position must be between 0 and 100.");G=W,this.hasBeenReset=!0}})),Object.defineProperty(g,"positionAlign",l({},p,{get:function(){return K},set:function(W){let ee=n(W);if(!ee)throw new SyntaxError("An invalid or illegal string was specified.");K=ee,this.hasBeenReset=!0}})),Object.defineProperty(g,"size",l({},p,{get:function(){return Q},set:function(W){if(W<0||W>100)throw new Error("Size must be between 0 and 100.");Q=W,this.hasBeenReset=!0}})),Object.defineProperty(g,"align",l({},p,{get:function(){return ae},set:function(W){let ee=n(W);if(!ee)throw new SyntaxError("An invalid or illegal string was specified.");ae=ee,this.hasBeenReset=!0}})),g.displayState=void 0}return u.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},u}(),ab=class{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}};function zp(e){function t(a,n,l,u){return(a|0)*3600+(n|0)*60+(l|0)+parseFloat(u||0)}let r=e.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return r?parseFloat(r[2])>59?t(r[2],r[3],0,r[4]):t(r[1],r[2],r[3],r[4]):null}var sb=class{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,r){for(let a=0;a<r.length;++a)if(t===r[a]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){let r=parseFloat(t);if(r>=0&&r<=100)return this.set(e,r),!0}return!1}};function Wp(e,t,r,a){let n=a?e.split(a):[e];for(let l in n){if(typeof n[l]!="string")continue;let u=n[l].split(r);if(u.length!==2)continue;let d=u[0],c=u[1];t(d,c)}}var _u=new Ju(0,0,""),pn=_u.align==="middle"?"middle":"center";function nb(e,t,r){let a=e;function n(){let d=zp(e);if(d===null)throw new Error("Malformed timestamp: "+a);return e=e.replace(/^[^\sa-zA-Z-]+/,""),d}function l(d,c){let f=new sb;Wp(d,function(y,E){let S;switch(y){case"region":for(let T=r.length-1;T>=0;T--)if(r[T].id===E){f.set(y,r[T].region);break}break;case"vertical":f.alt(y,E,["rl","lr"]);break;case"line":S=E.split(","),f.integer(y,S[0]),f.percent(y,S[0])&&f.set("snapToLines",!1),f.alt(y,S[0],["auto"]),S.length===2&&f.alt("lineAlign",S[1],["start",pn,"end"]);break;case"position":S=E.split(","),f.percent(y,S[0]),S.length===2&&f.alt("positionAlign",S[1],["start",pn,"end","line-left","line-right","auto"]);break;case"size":f.percent(y,E);break;case"align":f.alt(y,E,["start",pn,"end","left","right"]);break}},/:/,/\s/),c.region=f.get("region",null),c.vertical=f.get("vertical","");let g=f.get("line","auto");g==="auto"&&_u.line===-1&&(g=-1),c.line=g,c.lineAlign=f.get("lineAlign","start"),c.snapToLines=f.get("snapToLines",!0),c.size=f.get("size",100),c.align=f.get("align",pn);let p=f.get("position","auto");p==="auto"&&_u.position===50&&(p=c.align==="start"||c.align==="left"?0:c.align==="end"||c.align==="right"?100:50),c.position=p}function u(){e=e.replace(/^\s+/,"")}if(u(),t.startTime=n(),u(),e.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+a);e=e.slice(3),u(),t.endTime=n(),u(),l(e,t)}function jp(e){return e.replace(/<br(?: \/)?>/gi,`
`)}var lb=class{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new ab,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){let t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function r(){let n=t.buffer,l=0;for(n=jp(n);l<n.length&&n[l]!=="\r"&&n[l]!==`
`;)++l;let u=n.slice(0,l);return n[l]==="\r"&&++l,n[l]===`
`&&++l,t.buffer=n.slice(l),u}function a(n){Wp(n,function(l,u){},/:/)}try{let n="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;n=r();let u=n.match(/^()?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let l=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(l?l=!1:n=r(),t.state){case"HEADER":/:/.test(n)?a(n):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new Ju(0,0,""),t.state="CUE",n.indexOf("-->")===-1){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{nb(n,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{let u=n.indexOf("-->")!==-1;if(!n||u&&(l=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n}continue;case"BADCUE":n||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){let e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}},ob=/\r\n|\n\r|\n|\r/g,hu=function(e,t,r=0){return e.slice(r,r+t.length)===t},ub=function(e){let t=parseInt(e.slice(-3)),r=parseInt(e.slice(-6,-4)),a=parseInt(e.slice(-9,-7)),n=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!oe(t)||!oe(r)||!oe(a)||!oe(n))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*r,t+=60*1e3*a,t+=60*60*1e3*n,t},fu=function(e){let t=5381,r=e.length;for(;r;)t=t*33^e.charCodeAt(--r);return(t>>>0).toString()};function Zu(e,t,r){return fu(e.toString())+fu(t.toString())+fu(r)}var db=function(e,t,r){let a=e[t],n=e[a.prevCC];if(!n||!n.new&&a.new){e.ccOffset=e.presentationOffset=a.start,a.new=!1;return}for(;(l=n)!=null&&l.new;){var l;e.ccOffset+=a.start-n.start,a.new=!1,a=n,n=e[a.prevCC]}e.presentationOffset=r};function cb(e,t,r,a,n,l,u){let d=new lb,c=lr(new Uint8Array(e)).trim().replace(ob,`
`).split(`
`),f=[],g=t?_T(t.baseTime,t.timescale):0,p="00:00.000",y=0,E=0,S,T=!0;d.oncue=function(k){let C=r[a],I=r.ccOffset,O=(y-g)/9e4;if(C!=null&&C.new&&(E!==void 0?I=r.ccOffset=C.start:db(r,a,O)),O){if(!t){S=new Error("Missing initPTS for VTT MPEGTS");return}I=O-r.presentationOffset}let x=k.endTime-k.startTime,$=Bt((k.startTime+I-E)*9e4,n*9e4)/9e4;k.startTime=Math.max($,0),k.endTime=Math.max($+x,0);let G=k.text.trim();k.text=decodeURIComponent(encodeURIComponent(G)),k.id||(k.id=Zu(k.startTime,k.endTime,G)),k.endTime>0&&f.push(k)},d.onparsingerror=function(k){S=k},d.onflush=function(){if(S){u(S);return}l(f)},c.forEach(k=>{if(T)if(hu(k,"X-TIMESTAMP-MAP=")){T=!1,k.slice(16).split(",").forEach(C=>{hu(C,"LOCAL:")?p=C.slice(6):hu(C,"MPEGTS:")&&(y=parseInt(C.slice(7)))});try{E=ub(p)/1e3}catch(C){S=C}return}else k===""&&(T=!1);d.parse(k+`
`)}),d.flush()}var mu="stpp.ttml.im1t",Yp=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,qp=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,hb={left:"start",center:"center",right:"end",start:"start",end:"end"};function $g(e,t,r,a){let n=Le(new Uint8Array(e),["mdat"]);if(n.length===0){a(new Error("Could not parse IMSC1 mdat"));return}let l=n.map(d=>lr(d)),u=CT(t.baseTime,1,t.timescale);try{l.forEach(d=>r(fb(d,u)))}catch(d){a(d)}}function fb(e,t){let r=new DOMParser().parseFromString(e,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");let a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},n=Object.keys(a).reduce((f,g)=>(f[g]=r.getAttribute(`ttp:${g}`)||a[g],f),{}),l=r.getAttribute("xml:space")!=="preserve",u=Gg(gu(r,"styling","style")),d=Gg(gu(r,"layout","region")),c=gu(r,"body","[begin]");return[].map.call(c,f=>{let g=Xp(f,l);if(!g||!f.hasAttribute("begin"))return null;let p=vu(f.getAttribute("begin"),n),y=vu(f.getAttribute("dur"),n),E=vu(f.getAttribute("end"),n);if(p===null)throw Vg(f);if(E===null){if(y===null)throw Vg(f);E=p+y}let S=new Ju(p-t,E-t,g);S.id=Zu(S.startTime,S.endTime,S.text);let T=d[f.getAttribute("region")],k=u[f.getAttribute("style")],C=mb(T,k,u),{textAlign:I}=C;if(I){let O=hb[I];O&&(S.lineAlign=O),S.align=I}return Je(S,C),S}).filter(f=>f!==null)}function gu(e,t,r){let a=e.getElementsByTagName(t)[0];return a?[].slice.call(a.querySelectorAll(r)):[]}function Gg(e){return e.reduce((t,r)=>{let a=r.getAttribute("xml:id");return a&&(t[a]=r),t},{})}function Xp(e,t){return[].slice.call(e.childNodes).reduce((r,a,n)=>{var l;return a.nodeName==="br"&&n?r+`
`:(l=a.childNodes)!=null&&l.length?Xp(a,t):t?r+a.textContent.trim().replace(/\s+/g," "):r+a.textContent},"")}function mb(e,t,r){let a="http://www.w3.org/ns/ttml#styling",n=null,l=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],u=e!=null&&e.hasAttribute("style")?e.getAttribute("style"):null;return u&&r.hasOwnProperty(u)&&(n=r[u]),l.reduce((d,c)=>{let f=pu(t,a,c)||pu(e,a,c)||pu(n,a,c);return f&&(d[c]=f),d},{})}function pu(e,t,r){return e&&e.hasAttributeNS(t,r)?e.getAttributeNS(t,r):null}function Vg(e){return new Error(`Could not parse ttml timestamp ${e}`)}function vu(e,t){if(!e)return null;let r=zp(e);return r===null&&(Yp.test(e)?r=gb(e,t):qp.test(e)&&(r=pb(e,t))),r}function gb(e,t){let r=Yp.exec(e),a=(r[4]|0)+(r[5]|0)/t.subFrameRate;return(r[1]|0)*3600+(r[2]|0)*60+(r[3]|0)+a/t.frameRate}function pb(e,t){let r=qp.exec(e),a=Number(r[1]);switch(r[2]){case"h":return a*3600;case"m":return a*60;case"ms":return a*1e3;case"f":return a/t.frameRate;case"t":return a/t.tickRate}return a}var vb=class{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Kg(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(b.FRAG_LOADING,this.onFragLoading,this),e.on(b.FRAG_LOADED,this.onFragLoaded,this),e.on(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(b.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(b.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){let{hls:e}=this;e.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(b.FRAG_LOADING,this.onFragLoading,this),e.off(b.FRAG_LOADED,this.onFragLoaded,this),e.off(b.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(b.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(b.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(b.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(b.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){if(this.config.enableCEA708Captions&&(!this.cea608Parser1||!this.cea608Parser2)){let e=new gn(this,"textTrack1"),t=new gn(this,"textTrack2"),r=new gn(this,"textTrack3"),a=new gn(this,"textTrack4");this.cea608Parser1=new Fg(1,e,t),this.cea608Parser2=new Fg(3,r,a)}}addCues(e,t,r,a,n){let l=!1;for(let u=n.length;u--;){let d=n[u],c=yb(d[0],d[1],t,r);if(c>=0&&(d[0]=Math.min(d[0],t),d[1]=Math.max(d[1],r),l=!0,c/(r-t)>.5))return}if(l||n.push([t,r]),this.config.renderTextTracksNatively){let u=this.captionsTracks[e];this.Cues.newCue(u,t,r,a)}else{let u=this.Cues.newCue(null,t,r,a);this.hls.trigger(b.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:r,initPTS:a,timescale:n}){let{unparsedVttFrags:l}=this;r==="main"&&(this.initPTS[t.cc]={baseTime:a,timescale:n}),l.length&&(this.unparsedVttFrags=[],l.forEach(u=>{this.onFragLoaded(b.FRAG_LOADED,u)}))}getExistingTrack(e,t){let{media:r}=this;if(r)for(let a=0;a<r.textTracks.length;a++){let n=r.textTracks[a];if(Hg(n,{name:e,lang:t,attrs:{}}))return n}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;let{captionsProperties:t,captionsTracks:r,media:a}=this,{label:n,languageCode:l}=t[e],u=this.getExistingTrack(n,l);if(u)r[e]=u,Vi(r[e]),pp(r[e],a);else{let d=this.createTextTrack("captions",n,l);d&&(d[e]=!0,r[e]=d)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;let t=this.captionsProperties[e];if(!t)return;let r=t.label,a={_id:e,label:r,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=a,this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[a]})}createTextTrack(e,t,r){let a=this.media;if(a)return a.addTextTrack(e,t,r)}onMediaAttaching(e,t){this.media=t.media,this._cleanTracks()}onMediaDetaching(){let{captionsTracks:e}=this;Object.keys(e).forEach(t=>{Vi(e[t]),delete e[t]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Kg(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){let{media:e}=this;if(!e)return;let t=e.textTracks;if(t)for(let r=0;r<t.length;r++)Vi(t[r])}onSubtitleTracksUpdated(e,t){let r=t.subtitleTracks||[],a=r.some(n=>n.textCodec===mu);if(this.config.enableWebVTT||a&&this.config.enableIMSC1){if(Vp(this.tracks,r)){this.tracks=r;return}if(this.textTracks=[],this.tracks=r,this.config.renderTextTracksNatively){let n=this.media,l=n?En(n.textTracks):null;if(this.tracks.forEach((u,d)=>{let c;if(l){let f=null;for(let g=0;g<l.length;g++)if(l[g]&&Hg(l[g],u)){f=l[g],l[g]=null;break}f&&(c=f)}if(c)Vi(c);else{let f=Qp(u);c=this.createTextTrack(f,u.name,u.lang),c&&(c.mode="disabled")}c&&this.textTracks.push(c)}),l!=null&&l.length){let u=l.filter(d=>d!==null).map(d=>d.label);u.length&&P.warn(`Media element contains unused subtitle tracks: ${u.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){let n=this.tracks.map(l=>({label:l.name,kind:l.type.toLowerCase(),default:l.default,subtitleTrack:l}));this.hls.trigger(b.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:n})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(r=>{let a=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!a)return;let n=`textTrack${a[1]}`,l=this.captionsProperties[n];l&&(l.label=r.name,r.lang&&(l.languageCode=r.lang),l.media=r)})}closedCaptionsForLevel(e){return this.hls.levels[e.level]?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){this.initCea608Parsers();let{cea608Parser1:r,cea608Parser2:a,lastCc:n,lastSn:l,lastPartIndex:u}=this;if(!(!this.enabled||!r||!a)&&t.frag.type===Ee.MAIN){var d,c;let{cc:f,sn:g}=t.frag,p=(d=t==null||(c=t.part)==null?void 0:c.index)!=null?d:-1;g===l+1||g===l&&p===u+1||f===n||(r.reset(),a.reset()),this.lastCc=f,this.lastSn=g,this.lastPartIndex=p}}onFragLoaded(e,t){let{frag:r,payload:a}=t;if(r.type===Ee.SUBTITLE)if(a.byteLength){let n=r.decryptdata,l="stats"in t;if(n==null||!n.encrypted||l){let u=this.tracks[r.level],d=this.vttCCs;d[r.cc]||(d[r.cc]={start:r.start,prevCC:this.prevCC,new:!0},this.prevCC=r.cc),u&&u.textCodec===mu?this._parseIMSC1(r,a):this._parseVTTs(t)}}else this.hls.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){let r=this.hls;$g(t,this.initPTS[e.cc],a=>{this._appendCues(a,e.level),r.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},a=>{P.log(`Failed to parse IMSC1: ${a}`),r.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:a})})}_parseVTTs(e){var t;let{frag:r,payload:a}=e,{initPTS:n,unparsedVttFrags:l}=this,u=n.length-1;if(!n[r.cc]&&u===-1){l.push(e);return}let d=this.hls,c=(t=r.initSegment)!=null&&t.data?$t(r.initSegment.data,new Uint8Array(a)):a;cb(c,this.initPTS[r.cc],this.vttCCs,r.cc,r.start,f=>{this._appendCues(f,r.level),d.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:r})},f=>{let g=f.message==="Missing initPTS for VTT MPEGTS";g?l.push(e):this._fallbackToIMSC1(r,a),P.log(`Failed to parse VTT cue: ${f}`),!(g&&u>r.cc)&&d.trigger(b.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:r,error:f})})}_fallbackToIMSC1(e,t){let r=this.tracks[e.level];r.textCodec||$g(t,this.initPTS[e.cc],()=>{r.textCodec=mu,this._parseIMSC1(e,t)},()=>{r.textCodec="wvtt"})}_appendCues(e,t){let r=this.hls;if(this.config.renderTextTracksNatively){let a=this.textTracks[t];if(!a||a.mode==="disabled")return;e.forEach(n=>vp(a,n))}else{let a=this.tracks[t];if(!a)return;let n=a.default?"default":"subtitles"+t;r.trigger(b.CUES_PARSED,{type:"subtitles",cues:e,track:n})}}onFragDecrypted(e,t){let{frag:r}=t;r.type===Ee.SUBTITLE&&this.onFragLoaded(b.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){this.initCea608Parsers();let{cea608Parser1:r,cea608Parser2:a}=this;if(!this.enabled||!r||!a)return;let{frag:n,samples:l}=t;if(!(n.type===Ee.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let u=0;u<l.length;u++){let d=l[u].bytes;if(d){let c=this.extractCea608Data(d);r.addData(l[u].pts,c[0]),a.addData(l[u].pts,c[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:r,endOffsetSubtitles:a,type:n}){let{media:l}=this;if(!(!l||l.currentTime<r)){if(!n||n==="video"){let{captionsTracks:u}=this;Object.keys(u).forEach(d=>Lu(u[d],t,r))}if(this.config.renderTextTracksNatively&&t===0&&a!==void 0){let{textTracks:u}=this;Object.keys(u).forEach(d=>Lu(u[d],t,a))}}}extractCea608Data(e){let t=[[],[]],r=e[0]&31,a=2;for(let n=0;n<r;n++){let l=e[a++],u=127&e[a++],d=127&e[a++];if(!(u===0&&d===0)&&4&l){let c=3&l;(c===0||c===1)&&(t[c].push(u),t[c].push(d))}}return t}};function Qp(e){return e.characteristics&&/transcribes-spoken-dialog/gi.test(e.characteristics)&&/describes-music-and-sound/gi.test(e.characteristics)?"captions":"subtitles"}function Hg(e,t){return!!e&&e.kind===Qp(t)&&Cu(t,e)}function yb(e,t,r,a){return Math.min(t,a)-Math.max(e,r)}function Kg(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}var Eb=class Jp{constructor(t){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(t){this.streamController=t}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){let{hls:t}=this;t.on(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(b.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(b.BUFFER_CODECS,this.onBufferCodecs,this),t.on(b.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){let{hls:t}=this;t.off(b.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(b.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(b.BUFFER_CODECS,this.onBufferCodecs,this),t.off(b.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(t,r){let a=this.hls.levels[r.droppedLevel];this.isLevelAllowed(a)&&this.restrictedLevels.push({bitrate:a.bitrate,height:a.height,width:a.width})}onMediaAttaching(t,r){this.media=r.media instanceof HTMLVideoElement?r.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(t,r){let a=this.hls;this.restrictedLevels=[],this.firstLevel=r.firstLevel,a.config.capLevelToPlayerSize&&r.video&&this.startCapping()}onLevelsUpdated(t,r){this.timer&&oe(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(t,r){this.hls.config.capLevelToPlayerSize&&r.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}let t=this.hls.levels;if(t.length){let r=this.hls,a=this.getMaxLevel(t.length-1);a!==this.autoLevelCapping&&P.log(`Setting autoLevelCapping to ${a}: ${t[a].height}p@${t[a].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),r.autoLevelCapping=a,r.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=r.autoLevelCapping}}}getMaxLevel(t){let r=this.hls.levels;if(!r.length)return-1;let a=r.filter((n,l)=>this.isLevelAllowed(n)&&l<=t);return this.clientRect=null,Jp.getMaxLevelByMediaSize(a,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;let t=this.media,r={width:0,height:0};if(t){let a=t.getBoundingClientRect();r.width=a.width,r.height=a.height,!r.width&&!r.height&&(r.width=a.right-a.left||t.width||0,r.height=a.bottom-a.top||t.height||0)}return this.clientRect=r,r}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch{}return t}isLevelAllowed(t){return!this.restrictedLevels.some(r=>t.bitrate===r.bitrate&&t.width===r.width&&t.height===r.height)}static getMaxLevelByMediaSize(t,r,a){if(!(t!=null&&t.length))return-1;let n=(d,c)=>c?d.width!==c.width||d.height!==c.height:!0,l=t.length-1,u=Math.max(r,a);for(let d=0;d<t.length;d+=1){let c=t[d];if((c.width>=u||c.height>=u)&&n(c,t[d+1])){l=d;break}}return l}},Sb=class{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(b.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){let r=this.hls.config;if(r.capLevelOnFPSDrop){let a=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=a,a&&typeof a.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}checkFPS(e,t,r){let a=performance.now();if(t){if(this.lastTime){let n=a-this.lastTime,l=r-this.lastDroppedFrames,u=t-this.lastDecodedFrames,d=1e3*l/n,c=this.hls;if(c.trigger(b.FPS_DROP,{currentDropped:l,currentDecoded:u,totalDroppedFrames:r}),d>0&&l>c.config.fpsDroppedMonitoringThreshold*u){let f=c.currentLevel;P.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=f)&&(f=f-1,c.trigger(b.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:c.currentLevel}),c.autoLevelCapping=f,this.streamController.nextLevelSwitch())}}this.lastTime=a,this.lastDroppedFrames=r,this.lastDecodedFrames=t}}checkFPSInterval(){let e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){let t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}},vn="[eme]",Zp=class An{constructor(t){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=An.CDMCleanupPromise?[An.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=P.debug.bind(P,vn),this.log=P.log.bind(P,vn),this.warn=P.warn.bind(P,vn),this.error=P.error.bind(P,vn),this.hls=t,this.config=t.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();let t=this.config;t.requestMediaKeySystemAccessFunc=null,t.licenseXhrSetup=t.licenseResponseCallback=void 0,t.drmSystems=t.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(b.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(b.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(b.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(t){let{drmSystems:r,widevineLicenseUrl:a}=this.config,n=r[t];if(n)return n.licenseUrl;if(t===$e.WIDEVINE&&a)return a;throw new Error(`no license server URL configured for key-system "${t}"`)}getServerCertificateUrl(t){let{drmSystems:r}=this.config,a=r[t];if(a)return a.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${t}"]`)}attemptKeySystemAccess(t){let r=this.hls.levels,a=(u,d,c)=>!!u&&c.indexOf(u)===d,n=r.map(u=>u.audioCodec).filter(a),l=r.map(u=>u.videoCodec).filter(a);return n.length+l.length===0&&l.push("avc1.42e01e"),new Promise((u,d)=>{let c=f=>{let g=f.shift();this.getMediaKeysPromise(g,n,l).then(p=>u({keySystem:g,mediaKeys:p})).catch(p=>{f.length?c(f):p instanceof Ut?d(p):d(new Ut({type:Se.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_NO_ACCESS,error:p,fatal:!0},p.message))})};c(t)})}requestMediaKeySystemAccess(t,r){let{requestMediaKeySystemAccessFunc:a}=this.config;if(typeof a!="function"){let n=`Configured requestMediaKeySystemAccess is not a function ${a}`;return rp===null&&self.location.protocol==="http:"&&(n=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(n))}return a(t,r)}getMediaKeysPromise(t,r,a){let n=IE(t,r,a,this.config.drmSystemOptions),l=this.keySystemAccessPromises[t],u=l?.keySystemAccess;if(!u){this.log(`Requesting encrypted media "${t}" key-system access with config: ${JSON.stringify(n)}`),u=this.requestMediaKeySystemAccess(t,n);let d=this.keySystemAccessPromises[t]={keySystemAccess:u};return u.catch(c=>{this.log(`Failed to obtain access to key-system "${t}": ${c}`)}),u.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);let f=this.fetchServerCertificate(t);return this.log(`Create media-keys for "${t}"`),d.mediaKeys=c.createMediaKeys().then(g=>(this.log(`Media-keys created for "${t}"`),f.then(p=>p?this.setMediaKeysServerCertificate(g,t,p):g))),d.mediaKeys.catch(g=>{this.error(`Failed to create media-keys for "${t}"}: ${g}`)}),d.mediaKeys})}return u.then(()=>l.mediaKeys)}createMediaKeySessionContext({decryptdata:t,keySystem:r,mediaKeys:a}){this.log(`Creating key-system session "${r}" keyId: ${ar.hexDump(t.keyId||[])}`);let n=a.createSession(),l={decryptdata:t,keySystem:r,mediaKeys:a,mediaKeysSession:n,keyStatus:"status-pending"};return this.mediaKeySessions.push(l),l}renewKeySession(t){let r=t.decryptdata;if(r.pssh){let a=this.createMediaKeySessionContext(t),n=this.getKeyIdString(r),l="cenc";this.keyIdToKeySessionPromise[n]=this.generateRequestWithPreferredKeySession(a,l,r.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(t)}getKeyIdString(t){if(!t)throw new Error("Could not read keyId of undefined decryptdata");if(t.keyId===null)throw new Error("keyId is null");return ar.hexDump(t.keyId)}updateKeySession(t,r){var a;let n=t.mediaKeysSession;return this.log(`Updating key-session "${n.sessionId}" for keyID ${ar.hexDump(((a=t.decryptdata)==null?void 0:a.keyId)||[])}
      } (data length: ${r&&r.byteLength})`),n.update(r)}selectKeySystemFormat(t){let r=Object.keys(t.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${t.sn} ${t.type}: ${t.level}) key formats ${r.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(r)),this.keyFormatPromise}getKeyFormatPromise(t){return new Promise((r,a)=>{let n=Zo(this.config),l=t.map(Ym).filter(u=>!!u&&n.indexOf(u)!==-1);return this.getKeySystemSelectionPromise(l).then(({keySystem:u})=>{let d=qm(u);d?r(d):a(new Error(`Unable to find format for key-system "${u}"`))}).catch(a)})}loadKey(t){let r=t.keyInfo.decryptdata,a=this.getKeyIdString(r),n=`(keyId: ${a} format: "${r.keyFormat}" method: ${r.method} uri: ${r.uri})`;this.log(`Starting session for key ${n}`);let l=this.keyIdToKeySessionPromise[a];return l||(l=this.keyIdToKeySessionPromise[a]=this.getKeySystemForKeyPromise(r).then(({keySystem:u,mediaKeys:d})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${t.frag.sn} ${t.frag.type}: ${t.frag.level} using key ${n}`),this.attemptSetMediaKeys(u,d).then(()=>{this.throwIfDestroyed();let c=this.createMediaKeySessionContext({keySystem:u,mediaKeys:d,decryptdata:r});return this.generateRequestWithPreferredKeySession(c,"cenc",r.pssh,"playlist-key")}))),l.catch(u=>this.handleError(u))),l}throwIfDestroyed(t="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(t){this.hls&&(this.error(t.message),t instanceof Ut?this.hls.trigger(b.ERROR,t.data):this.hls.trigger(b.ERROR,{type:Se.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_NO_KEYS,error:t,fatal:!0}))}getKeySystemForKeyPromise(t){let r=this.getKeyIdString(t),a=this.keyIdToKeySessionPromise[r];if(!a){let n=Ym(t.keyFormat),l=n?[n]:Zo(this.config);return this.attemptKeySystemAccess(l)}return a}getKeySystemSelectionPromise(t){if(t.length||(t=Zo(this.config)),t.length===0)throw new Ut({type:Se.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(t)}_onMediaEncrypted(t){let{initDataType:r,initData:a}=t;if(this.debug(`"${t.type}" event: init data type: "${r}"`),a===null)return;let n,l;if(r==="sinf"&&this.config.drmSystems[$e.FAIRPLAY]){let g=rt(new Uint8Array(a));try{let p=Bu(JSON.parse(g).sinf),y=dp(new Uint8Array(p));if(!y)return;n=y.subarray(8,24),l=$e.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{let g=eS(a);if(g===null)return;g.version===0&&g.systemId===tp.WIDEVINE&&g.data&&(n=g.data.subarray(8,24)),l=DE(g.systemId)}if(!l||!n)return;let u=ar.hexDump(n),{keyIdToKeySessionPromise:d,mediaKeySessions:c}=this,f=d[u];for(let g=0;g<c.length;g++){let p=c[g],y=p.decryptdata;if(y.pssh||!y.keyId)continue;let E=ar.hexDump(y.keyId);if(u===E||y.uri.replace(/-/g,"").indexOf(u)!==-1){f=d[E],delete d[E],y.pssh=new Uint8Array(a),y.keyId=n,f=d[u]=f.then(()=>this.generateRequestWithPreferredKeySession(p,r,a,"encrypted-event-key-match"));break}}f||(f=d[u]=this.getKeySystemSelectionPromise([l]).then(({keySystem:g,mediaKeys:p})=>{var y;this.throwIfDestroyed();let E=new Tu("ISO-23001-7",u,(y=qm(g))!=null?y:"");return E.pssh=new Uint8Array(a),E.keyId=n,this.attemptSetMediaKeys(g,p).then(()=>{this.throwIfDestroyed();let S=this.createMediaKeySessionContext({decryptdata:E,keySystem:g,mediaKeys:p});return this.generateRequestWithPreferredKeySession(S,r,a,"encrypted-event-no-match")})})),f.catch(g=>this.handleError(g))}_onWaitingForKey(t){this.log(`"${t.type}" event`)}attemptSetMediaKeys(t,r){let a=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${t}"`);let n=Promise.all(a).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(r)});return this.setMediaKeysQueue.push(n),n.then(()=>{this.log(`Media-keys set for "${t}"`),a.push(n),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(l=>a.indexOf(l)===-1)})}generateRequestWithPreferredKeySession(t,r,a,n){var l,u;let d=(l=this.config.drmSystems)==null||(u=l[t.keySystem])==null?void 0:u.generateRequest;if(d)try{let S=d.call(this.hls,r,a,t);if(!S)throw new Error("Invalid response from configured generateRequest filter");r=S.initDataType,a=t.decryptdata.pssh=S.initData?new Uint8Array(S.initData):null}catch(S){var c;if(this.warn(S.message),(c=this.hls)!=null&&c.config.debug)throw S}if(a===null)return this.log(`Skipping key-session request for "${n}" (no initData)`),Promise.resolve(t);let f=this.getKeyIdString(t.decryptdata);this.log(`Generating key-session request for "${n}": ${f} (init data type: ${r} length: ${a?a.byteLength:null})`);let g=new Qu,p=t._onmessage=S=>{let T=t.mediaKeysSession;if(!T){g.emit("error",new Error("invalid state"));return}let{messageType:k,message:C}=S;this.log(`"${k}" message event for session "${T.sessionId}" message size: ${C.byteLength}`),k==="license-request"||k==="license-renewal"?this.renewLicense(t,C).catch(I=>{this.handleError(I),g.emit("error",I)}):k==="license-release"?t.keySystem===$e.FAIRPLAY&&(this.updateKeySession(t,Su("acknowledged")),this.removeSession(t)):this.warn(`unhandled media key message type "${k}"`)},y=t._onkeystatuseschange=S=>{if(!t.mediaKeysSession){g.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(t);let T=t.keyStatus;g.emit("keyStatus",T),T==="expired"&&(this.warn(`${t.keySystem} expired for key ${f}`),this.renewKeySession(t))};t.mediaKeysSession.addEventListener("message",p),t.mediaKeysSession.addEventListener("keystatuseschange",y);let E=new Promise((S,T)=>{g.on("error",T),g.on("keyStatus",k=>{k.startsWith("usable")?S():k==="output-restricted"?T(new Ut({type:Se.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):k==="internal-error"?T(new Ut({type:Se.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${k}"`)):k==="expired"?T(new Error("key expired while generating request")):this.warn(`unhandled key status change "${k}"`)})});return t.mediaKeysSession.generateRequest(r,a).then(()=>{var S;this.log(`Request generated for key-session "${(S=t.mediaKeysSession)==null?void 0:S.sessionId}" keyId: ${f}`)}).catch(S=>{throw new Ut({type:Se.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_NO_SESSION,error:S,fatal:!1},`Error generating key-session request: ${S}`)}).then(()=>E).catch(S=>{throw g.removeAllListeners(),this.removeSession(t),S}).then(()=>(g.removeAllListeners(),t))}onKeyStatusChange(t){t.mediaKeysSession.keyStatuses.forEach((r,a)=>{this.log(`key status change "${r}" for keyStatuses keyId: ${ar.hexDump("buffer"in a?new Uint8Array(a.buffer,a.byteOffset,a.byteLength):new Uint8Array(a))} session keyId: ${ar.hexDump(new Uint8Array(t.decryptdata.keyId||[]))} uri: ${t.decryptdata.uri}`),t.keyStatus=r})}fetchServerCertificate(t){let r=this.config,a=r.loader,n=new a(r),l=this.getServerCertificateUrl(t);return l?(this.log(`Fetching server certificate for "${t}"`),new Promise((u,d)=>{let c={responseType:"arraybuffer",url:l},f=r.certLoadPolicy.default,g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},p={onSuccess:(y,E,S,T)=>{u(y.data)},onError:(y,E,S,T)=>{d(new Ut({type:Se.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:ut({url:c.url,data:void 0},y)},`"${t}" certificate request failed (${l}). Status: ${y.code} (${y.text})`))},onTimeout:(y,E,S)=>{d(new Ut({type:Se.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:S,response:{url:c.url,data:void 0}},`"${t}" certificate request timed out (${l})`))},onAbort:(y,E,S)=>{d(new Error("aborted"))}};n.load(c,g,p)})):Promise.resolve()}setMediaKeysServerCertificate(t,r,a){return new Promise((n,l)=>{t.setServerCertificate(a).then(u=>{this.log(`setServerCertificate ${u?"success":"not supported by CDM"} (${a?.byteLength}) on "${r}"`),n(t)}).catch(u=>{l(new Ut({type:Se.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:u,fatal:!0},u.message))})})}renewLicense(t,r){return this.requestLicense(t,new Uint8Array(r)).then(a=>this.updateKeySession(t,new Uint8Array(a)).catch(n=>{throw new Ut({type:Se.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:n,fatal:!0},n.message)}))}unpackPlayReadyKeyMessage(t,r){let a=String.fromCharCode.apply(null,new Uint16Array(r.buffer));if(!a.includes("PlayReadyKeyMessage"))return t.setRequestHeader("Content-Type","text/xml; charset=utf-8"),r;let n=new DOMParser().parseFromString(a,"application/xml"),l=n.querySelectorAll("HttpHeader");if(l.length>0){let g;for(let p=0,y=l.length;p<y;p++){var u,d;g=l[p];let E=(u=g.querySelector("name"))==null?void 0:u.textContent,S=(d=g.querySelector("value"))==null?void 0:d.textContent;E&&S&&t.setRequestHeader(E,S)}}let c=n.querySelector("Challenge"),f=c?.textContent;if(!f)throw new Error("Cannot find <Challenge> in key message");return Su(atob(f))}setupLicenseXHR(t,r,a,n){let l=this.config.licenseXhrSetup;return l?Promise.resolve().then(()=>{if(!a.decryptdata)throw new Error("Key removed");return l.call(this.hls,t,r,a,n)}).catch(u=>{if(!a.decryptdata)throw u;return t.open("POST",r,!0),l.call(this.hls,t,r,a,n)}).then(u=>(t.readyState||t.open("POST",r,!0),{xhr:t,licenseChallenge:u||n})):(t.open("POST",r,!0),Promise.resolve({xhr:t,licenseChallenge:n}))}requestLicense(t,r){let a=this.config.keyLoadPolicy.default;return new Promise((n,l)=>{let u=this.getLicenseServerUrl(t.keySystem);this.log(`Sending license request to URL: ${u}`);let d=new XMLHttpRequest;d.responseType="arraybuffer",d.onreadystatechange=()=>{if(!this.hls||!t.mediaKeysSession)return l(new Error("invalid state"));if(d.readyState===4)if(d.status===200){this._requestLicenseFailureCount=0;let c=d.response;this.log(`License received ${c instanceof ArrayBuffer?c.byteLength:c}`);let f=this.config.licenseResponseCallback;if(f)try{c=f.call(this.hls,d,u,t)}catch(g){this.error(g)}n(c)}else{let c=a.errorRetry,f=c?c.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>f||d.status>=400&&d.status<500)l(new Ut({type:Se.KEY_SYSTEM_ERROR,details:B.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:d,response:{url:u,data:void 0,code:d.status,text:d.statusText}},`License Request XHR failed (${u}). Status: ${d.status} (${d.statusText})`));else{let g=f-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${g} attempts left`),this.requestLicense(t,r).then(n,l)}}},t.licenseXhr&&t.licenseXhr.readyState!==XMLHttpRequest.DONE&&t.licenseXhr.abort(),t.licenseXhr=d,this.setupLicenseXHR(d,u,t,r).then(({xhr:c,licenseChallenge:f})=>{t.keySystem==$e.PLAYREADY&&(f=this.unpackPlayReadyKeyMessage(c,f)),c.send(f)})})}onMediaAttached(t,r){if(!this.config.emeEnabled)return;let a=r.media;this.media=a,a.addEventListener("encrypted",this.onMediaEncrypted),a.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){let t=this.media,r=this.mediaKeySessions;t&&(t.removeEventListener("encrypted",this.onMediaEncrypted),t.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},Tu.clearKeyUriToKeyIdMap();let a=r.length;An.CDMCleanupPromise=Promise.all(r.map(n=>this.removeSession(n)).concat(t?.setMediaKeys(null).catch(n=>{this.log(`Could not clear media keys: ${n}`)}))).then(()=>{a&&(this.log("finished closing key sessions and clearing media keys"),r.length=0)}).catch(n=>{this.log(`Could not close sessions and clear media keys: ${n}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(t,{sessionKeys:r}){if(!(!r||!this.config.emeEnabled)&&!this.keyFormatPromise){let a=r.reduce((n,l)=>(n.indexOf(l.keyFormat)===-1&&n.push(l.keyFormat),n),[]);this.log(`Selecting key-system from session-keys ${a.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(a)}}removeSession(t){let{mediaKeysSession:r,licenseXhr:a}=t;if(r){this.log(`Remove licenses and keys and close session ${r.sessionId}`),t._onmessage&&(r.removeEventListener("message",t._onmessage),t._onmessage=void 0),t._onkeystatuseschange&&(r.removeEventListener("keystatuseschange",t._onkeystatuseschange),t._onkeystatuseschange=void 0),a&&a.readyState!==XMLHttpRequest.DONE&&a.abort(),t.mediaKeysSession=t.decryptdata=t.licenseXhr=void 0;let n=this.mediaKeySessions.indexOf(t);return n>-1&&this.mediaKeySessions.splice(n,1),r.remove().catch(l=>{this.log(`Could not remove session: ${l}`)}).then(()=>r.close()).catch(l=>{this.log(`Could not close session: ${l}`)})}}};Zp.CDMCleanupPromise=void 0;var Ut=class extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}},vt;(function(e){e.MANIFEST="m",e.AUDIO="a",e.VIDEO="v",e.MUXED="av",e.INIT="i",e.CAPTION="c",e.TIMED_TEXT="tt",e.KEY="k",e.OTHER="o"})(vt||(vt={}));var xu;(function(e){e.DASH="d",e.HLS="h",e.SMOOTH="s",e.OTHER="o"})(xu||(xu={}));var ai;(function(e){e.OBJECT="CMCD-Object",e.REQUEST="CMCD-Request",e.SESSION="CMCD-Session",e.STATUS="CMCD-Status"})(ai||(ai={}));var Tb={[ai.OBJECT]:["br","d","ot","tb"],[ai.REQUEST]:["bl","dl","mtp","nor","nrr","su"],[ai.SESSION]:["cid","pr","sf","sid","st","v"],[ai.STATUS]:["bs","rtp"]},Pu=class Mu{constructor(t,r){this.value=void 0,this.params=void 0,Array.isArray(t)&&(t=t.map(a=>a instanceof Mu?a:new Mu(a))),this.value=t,this.params=r}},ev=class{constructor(e){this.description=void 0,this.description=e}},bb="Dict";function Lb(e){return Array.isArray(e)?JSON.stringify(e):e instanceof Map?"Map{}":e instanceof Set?"Set{}":typeof e=="object"?JSON.stringify(e):String(e)}function kb(e,t,r,a){return new Error(`failed to ${e} "${Lb(t)}" as ${r}`,{cause:a})}var zg="Bare Item",Ab="Boolean",wb="Byte Sequence",Rb="Decimal",Db="Integer";function Ib(e){return e<-999999999999999||999999999999999<e}var Cb=/[\x00-\x1f\x7f]+/,_b="Token",xb="Key";function or(e,t,r){return kb("serialize",e,t,r)}function Pb(e){if(typeof e!="boolean")throw or(e,Ab);return e?"?1":"?0"}function Mb(e){return btoa(String.fromCharCode(...e))}function Nb(e){if(ArrayBuffer.isView(e)===!1)throw or(e,wb);return`:${Mb(e)}:`}function tv(e){if(Ib(e))throw or(e,Db);return e.toString()}function Ob(e){return`@${tv(e.getTime()/1e3)}`}function rv(e,t){if(e<0)return-rv(-e,t);let r=Math.pow(10,t);if(Math.abs(e*r%1-.5)<Number.EPSILON){let a=Math.floor(e*r);return(a%2===0?a:a+1)/r}else return Math.round(e*r)/r}function Fb(e){let t=rv(e,3);if(Math.floor(Math.abs(t)).toString().length>12)throw or(e,Rb);let r=t.toString();return r.includes(".")?r:`${r}.0`}var Ub="String";function Bb(e){if(Cb.test(e))throw or(e,Ub);return`"${e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function $b(e){return e.description||e.toString().slice(7,-1)}function Wg(e){let t=$b(e);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(t)===!1)throw or(t,_b);return t}function Nu(e){switch(typeof e){case"number":if(!oe(e))throw or(e,zg);return Number.isInteger(e)?tv(e):Fb(e);case"string":return Bb(e);case"symbol":return Wg(e);case"boolean":return Pb(e);case"object":if(e instanceof Date)return Ob(e);if(e instanceof Uint8Array)return Nb(e);if(e instanceof ev)return Wg(e);default:throw or(e,zg)}}function Ou(e){if(/^[a-z*][a-z0-9\-_.*]*$/.test(e)===!1)throw or(e,xb);return e}function ed(e){return e==null?"":Object.entries(e).map(([t,r])=>r===!0?`;${Ou(t)}`:`;${Ou(t)}=${Nu(r)}`).join("")}function iv(e){return e instanceof Pu?`${Nu(e.value)}${ed(e.params)}`:Nu(e)}function Gb(e){return`(${e.value.map(iv).join(" ")})${ed(e.params)}`}function Vb(e,t={whitespace:!0}){if(typeof e!="object")throw or(e,bb);let r=e instanceof Map?e.entries():Object.entries(e),a=t!=null&&t.whitespace?" ":"";return Array.from(r).map(([n,l])=>{l instanceof Pu||(l=new Pu(l));let u=Ou(n);return l.value===!0?u+=ed(l.params):(u+="=",Array.isArray(l.value)?u+=Gb(l):u+=iv(l)),u}).join(`,${a}`)}function Hb(e,t){return Vb(e,t)}var Kb=e=>e==="ot"||e==="sf"||e==="st",zb=e=>typeof e=="number"?oe(e):e!=null&&e!==""&&e!==!1;function Wb(e,t){let r=new URL(e),a=new URL(t);if(r.origin!==a.origin)return e;let n=r.pathname.split("/").slice(1),l=a.pathname.split("/").slice(1,-1);for(;n[0]===l[0];)n.shift(),l.shift();for(;l.length;)l.shift(),n.unshift("..");return n.join("/")}function jb(){try{return crypto.randomUUID()}catch{try{let e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let e=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{let r=(e+Math.random()*16)%16|0;return e=Math.floor(e/16),(t=="x"?r:r&3|8).toString(16)})}}}var wn=e=>Math.round(e),Yb=(e,t)=>(t!=null&&t.baseUrl&&(e=Wb(e,t.baseUrl)),encodeURIComponent(e)),yn=e=>wn(e/100)*100,qb={br:wn,d:wn,bl:yn,dl:yn,mtp:yn,nor:Yb,rtp:yn,tb:wn};function Xb(e,t){let r={};if(e==null||typeof e!="object")return r;let a=Object.keys(e).sort(),n=Je({},qb,t?.formatters),l=t?.filter;return a.forEach(u=>{if(l!=null&&l(u))return;let d=e[u],c=n[u];c&&(d=c(d,t)),!(u==="v"&&d===1)&&(u=="pr"&&d===1||zb(d)&&(Kb(u)&&typeof d=="string"&&(d=new ev(d)),r[u]=d))}),r}function av(e,t={}){return e?Hb(Xb(e,t),Je({whitespace:!1},t)):""}function Qb(e,t={}){if(!e)return{};let r=Object.entries(e),a=Object.entries(Tb).concat(Object.entries(t?.customHeaderMap||{})),n=r.reduce((l,u)=>{var d,c;let[f,g]=u,p=((d=a.find(y=>y[1].includes(f)))==null?void 0:d[0])||ai.REQUEST;return(c=l[p])!=null||(l[p]={}),l[p][f]=g,l},{});return Object.entries(n).reduce((l,[u,d])=>(l[u]=av(d,t),l),{})}function Jb(e,t,r){return Je(e,Qb(t,r))}var Zb="CMCD";function e1(e,t={}){if(!e)return"";let r=av(e,t);return`${Zb}=${encodeURIComponent(r)}`}var jg=/CMCD=[^&#]+/;function t1(e,t,r){let a=e1(t,r);if(!a)return e;if(jg.test(e))return e.replace(jg,a);let n=e.includes("?")?"&":"?";return`${e}${n}${a}`}var r1=class{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=a=>{try{this.apply(a,{ot:vt.MANIFEST,su:!this.initialized})}catch(n){P.warn("Could not generate manifest CMCD data.",n)}},this.applyFragmentData=a=>{try{let n=a.frag,l=this.hls.levels[n.level],u=this.getObjectType(n),d={d:n.duration*1e3,ot:u};(u===vt.VIDEO||u===vt.AUDIO||u==vt.MUXED)&&(d.br=l.bitrate/1e3,d.tb=this.getTopBandwidth(u)/1e3,d.bl=this.getBufferLength(u)),this.apply(a,d)}catch(n){P.warn("Could not generate segment CMCD data.",n)}},this.hls=e;let t=this.config=e.config,{cmcd:r}=t;r!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||jb(),this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.includeKeys=r.includeKeys,this.registerListeners())}registerListeners(){let e=this.hls;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHED,this.onMediaDetached,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){let e=this.hls;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHED,this.onMediaDetached,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var r,a;this.audioBuffer=(r=t.tracks.audio)==null?void 0:r.buffer,this.videoBuffer=(a=t.tracks.video)==null?void 0:a.buffer}createData(){var e;return{v:1,sf:xu.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Je(t,this.createData());let r=t.ot===vt.INIT||t.ot===vt.VIDEO||t.ot===vt.MUXED;this.starved&&r&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);let{includeKeys:a}=this;a&&(t=Object.keys(t).reduce((n,l)=>(a.includes(l)&&(n[l]=t[l]),n),{})),this.useHeaders?(e.headers||(e.headers={}),Jb(e.headers,t)):e.url=t1(e.url,t)}getObjectType(e){let{type:t}=e;if(t==="subtitle")return vt.TIMED_TEXT;if(e.sn==="initSegment")return vt.INIT;if(t==="audio")return vt.AUDIO;if(t==="main")return this.hls.audioTracks.length?vt.VIDEO:vt.MUXED}getTopBandwidth(e){let t=0,r,a=this.hls;if(e===vt.AUDIO)r=a.audioTracks;else{let n=a.maxAutoLevel,l=n>-1?n+1:a.levels.length;r=a.levels.slice(0,l)}for(let n of r)n.bitrate>t&&(t=n.bitrate);return t>0?t:NaN}getBufferLength(e){let t=this.hls.media,r=e===vt.AUDIO?this.audioBuffer:this.videoBuffer;return!r||!t?NaN:Ke.bufferInfo(r,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){let{pLoader:e}=this.config,t=this.applyPlaylistData,r=e||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new r(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,n,l){t(a),this.loader.load(a,n,l)}}}createFragmentLoader(){let{fLoader:e}=this.config,t=this.applyFragmentData,r=e||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new r(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,n,l){t(a),this.loader.load(a,n,l)}}}},i1=3e5,a1=class{constructor(e){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.log=P.log.bind(P,"[content-steering]:"),this.registerListeners()}registerListeners(){let e=this.hls;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.ERROR,this.onError,this)}unregisterListeners(){let e=this.hls;e&&(e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.ERROR,this.onError,this))}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){let e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){let t=this.levels;t&&(this.levels=t.filter(r=>r!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){let{contentSteering:r}=t;r!==null&&(this.pathwayId=r.pathwayId,this.uri=r.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){let{errorAction:r}=t;if(r?.action===lt.SendAlternateToPenaltyBox&&r.flags===Yt.MoveAllAlternatesMatchingHost){let a=this.levels,n=this.pathwayPriority,l=this.pathwayId;if(t.context){let{groupId:u,pathwayId:d,type:c}=t.context;u&&a?l=this.getPathwayForGroupId(u,c,l):d&&(l=d)}l in this.penalizedPathways||(this.penalizedPathways[l]=performance.now()),!n&&a&&(n=a.reduce((u,d)=>(u.indexOf(d.pathwayId)===-1&&u.push(d.pathwayId),u),[])),n&&n.length>1&&(this.updatePathwayPriority(n),r.resolved=this.pathwayId!==l),r.resolved||P.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${l} levels: ${a&&a.length} priorities: ${JSON.stringify(n)} penalized: ${JSON.stringify(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){let r=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${r}"`),t=this.getLevelsForPathway(r),this.pathwayId=r}return t.length!==e.length?(this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t):e}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this.pathwayPriority=e;let t,r=this.penalizedPathways,a=performance.now();Object.keys(r).forEach(n=>{a-r[n]>i1&&delete r[n]});for(let n=0;n<e.length;n++){let l=e[n];if(l in r)continue;if(l===this.pathwayId)return;let u=this.hls.nextLoadLevel,d=this.hls.levels[u];if(t=this.getLevelsForPathway(l),t.length>0){this.log(`Setting Pathway to "${l}"`),this.pathwayId=l,Tp(t),this.hls.trigger(b.LEVELS_UPDATED,{levels:t});let c=this.hls.levels[u];d&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==d.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==d.bitrate&&this.log(`Unstable Pathways change from bitrate ${d.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,r){let a=this.getLevelsForPathway(r).concat(this.levels||[]);for(let n=0;n<a.length;n++)if(t===Re.AUDIO_TRACK&&a[n].hasAudioGroup(e)||t===Re.SUBTITLE_TRACK&&a[n].hasSubtitleGroup(e))return a[n].pathwayId;return r}clonePathways(e){let t=this.levels;if(!t)return;let r={},a={};e.forEach(n=>{let{ID:l,"BASE-ID":u,"URI-REPLACEMENT":d}=n;if(t.some(f=>f.pathwayId===l))return;let c=this.getLevelsForPathway(u).map(f=>{let g=new qe(f.attrs);g["PATHWAY-ID"]=l;let p=g.AUDIO&&`${g.AUDIO}_clone_${l}`,y=g.SUBTITLES&&`${g.SUBTITLES}_clone_${l}`;p&&(r[g.AUDIO]=p,g.AUDIO=p),y&&(a[g.SUBTITLES]=y,g.SUBTITLES=y);let E=sv(f.uri,g["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",d),S=new Ki({attrs:g,audioCodec:f.audioCodec,bitrate:f.bitrate,height:f.height,name:f.name,url:E,videoCodec:f.videoCodec,width:f.width});if(f.audioGroups)for(let T=1;T<f.audioGroups.length;T++)S.addGroupId("audio",`${f.audioGroups[T]}_clone_${l}`);if(f.subtitleGroups)for(let T=1;T<f.subtitleGroups.length;T++)S.addGroupId("text",`${f.subtitleGroups[T]}_clone_${l}`);return S});t.push(...c),Yg(this.audioTracks,r,d,l),Yg(this.subtitleTracks,a,d,l)})}loadSteeringManifest(e){let t=this.hls.config,r=t.loader;this.loader&&this.loader.destroy(),this.loader=new r(t);let a;try{a=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(a.protocol!=="data:"){let f=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;a.searchParams.set("_HLS_pathway",this.pathwayId),a.searchParams.set("_HLS_throughput",""+f)}let n={responseType:"json",url:a.href},l=t.steeringManifestLoadPolicy.default,u=l.errorRetry||l.timeoutRetry||{},d={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},c={onSuccess:(f,g,p,y)=>{this.log(`Loaded steering manifest: "${a}"`);let E=f.data;if(E.VERSION!==1){this.log(`Steering VERSION ${E.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=E.TTL;let{"RELOAD-URI":S,"PATHWAY-CLONES":T,"PATHWAY-PRIORITY":k}=E;if(S)try{this.uri=new self.URL(S,a).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${S}`);return}this.scheduleRefresh(this.uri||p.url),T&&this.clonePathways(T);let C={steeringManifest:E,url:a.toString()};this.hls.trigger(b.STEERING_MANIFEST_LOADED,C),k&&this.updatePathwayPriority(k)},onError:(f,g,p,y)=>{if(this.log(`Error loading steering manifest: ${f.code} ${f.text} (${g.url})`),this.stopLoad(),f.code===410){this.enabled=!1,this.log(`Steering manifest ${g.url} no longer available`);return}let E=this.timeToLoad*1e3;if(f.code===429){let S=this.loader;if(typeof S?.getResponseHeader=="function"){let T=S.getResponseHeader("Retry-After");T&&(E=parseFloat(T)*1e3)}this.log(`Steering manifest ${g.url} rate limited`);return}this.scheduleRefresh(this.uri||g.url,E)},onTimeout:(f,g,p)=>{this.log(`Timeout loading steering manifest (${g.url})`),this.scheduleRefresh(this.uri||g.url)}};this.log(`Requesting steering manifest: ${a}`),this.loader.load(n,d,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var r;let a=(r=this.hls)==null?void 0:r.media;if(a&&!a.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}};function Yg(e,t,r,a){e&&Object.keys(t).forEach(n=>{let l=e.filter(u=>u.groupId===n).map(u=>{let d=Je({},u);return d.details=void 0,d.attrs=new qe(d.attrs),d.url=d.attrs.URI=sv(u.url,u.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",r),d.groupId=d.attrs["GROUP-ID"]=t[n],d.attrs["PATHWAY-ID"]=a,d});e.push(...l)})}function sv(e,t,r,a){let{HOST:n,PARAMS:l,[r]:u}=a,d;t&&(d=u?.[t],d&&(e=d));let c=new self.URL(e);return n&&!d&&(c.host=n),l&&Object.keys(l).sort().forEach(f=>{f&&c.searchParams.set(f,l[f])}),c.href}var s1=/^age:\s*[\d.]+\s*$/im,nv=class{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new Un,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null,this.stats=null}abortInternal(){let e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,r){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=r,this.loadInternal()}loadInternal(){let{config:e,context:t}=this;if(!e||!t)return;let r=this.loader=new self.XMLHttpRequest,a=this.stats;a.loading.first=0,a.loaded=0,a.aborted=!1;let n=this.xhrSetup;n?Promise.resolve().then(()=>{if(!this.stats.aborted)return n(r,t.url)}).catch(l=>(r.open("GET",t.url,!0),n(r,t.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(r,t,e)}).catch(l=>{this.callbacks.onError({code:r.status,text:l.message},t,r,a)}):this.openAndSendXhr(r,t,e)}openAndSendXhr(e,t,r){e.readyState||e.open("GET",t.url,!0);let a=t.headers,{maxTimeToFirstByteMs:n,maxLoadTimeMs:l}=r.loadPolicy;if(a)for(let u in a)e.setRequestHeader(u,a[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),r.timeout=n&&oe(n)?n:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.timeout),e.send()}readystatechange(){let{context:e,loader:t,stats:r}=this;if(!e||!t)return;let a=t.readyState,n=this.config;if(!r.aborted&&a>=2&&(r.loading.first===0&&(r.loading.first=Math.max(self.performance.now(),r.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),a===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;let l=t.status,u=t.responseType!=="text";if(l>=200&&l<300&&(u&&t.response||t.responseText!==null)){r.loading.end=Math.max(self.performance.now(),r.loading.first);let d=u?t.response:t.responseText,c=t.responseType==="arraybuffer"?d.byteLength:d.length;if(r.loaded=r.total=c,r.bwEstimate=r.total*8e3/(r.loading.end-r.loading.first),!this.callbacks)return;let f=this.callbacks.onProgress;if(f&&f(r,e,d,t),!this.callbacks)return;let g={url:t.responseURL,data:d,code:l};this.callbacks.onSuccess(g,r,e,t)}else{let d=n.loadPolicy.errorRetry,c=r.retry,f={url:e.url,data:void 0,code:l};Mn(d,c,!1,f)?this.retry(d):(P.error(`${l} while loading ${e.url}`),this.callbacks.onError({code:l,text:t.statusText},e,t,r))}}}loadtimeout(){var e;let t=(e=this.config)==null?void 0:e.loadPolicy.timeoutRetry,r=this.stats.retry;if(Mn(t,r,!0))this.retry(t);else{var a;P.warn(`timeout while loading ${(a=this.context)==null?void 0:a.url}`);let n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}}retry(e){let{context:t,stats:r}=this;this.retryDelay=Vu(e,r.retry),r.retry++,P.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${r.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){let t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&s1.test(this.loader.getAllResponseHeaders())){let t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}};function n1(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var l1=/(\d+)-(\d+)\/(\d+)/,qg=class{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||c1,this.controller=new self.AbortController,this.stats=new Un}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,r){let a=this.stats;if(a.loading.start)throw new Error("Loader can only be used once.");a.loading.start=self.performance.now();let n=o1(e,this.controller.signal),l=r.onProgress,u=e.responseType==="arraybuffer",d=u?"byteLength":"length",{maxTimeToFirstByteMs:c,maxLoadTimeMs:f}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=r,this.request=this.fetchSetup(e,n),self.clearTimeout(this.requestTimeout),t.timeout=c&&oe(c)?c:f,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(a,e,this.response)},t.timeout),self.fetch(this.request).then(g=>{this.response=this.loader=g;let p=Math.max(self.performance.now(),a.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=f,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),r.onTimeout(a,e,this.response)},f-(p-a.loading.start)),!g.ok){let{status:y,statusText:E}=g;throw new h1(E||"fetch, bad network response",y,g)}return a.loading.first=p,a.total=d1(g.headers)||a.total,l&&oe(t.highWaterMark)?this.loadProgressively(g,a,e,t.highWaterMark,l):u?g.arrayBuffer():e.responseType==="json"?g.json():g.text()}).then(g=>{let p=this.response;if(!p)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),a.loading.end=Math.max(self.performance.now(),a.loading.first);let y=g[d];y&&(a.loaded=a.total=y);let E={url:p.url,data:g,code:p.status};l&&!oe(t.highWaterMark)&&l(a,e,g,p),r.onSuccess(E,a,e,p)}).catch(g=>{if(self.clearTimeout(this.requestTimeout),a.aborted)return;let p=g&&g.code||0,y=g?g.message:null;r.onError({code:p,text:y},e,g?g.details:null,a)})}getCacheAge(){let e=null;if(this.response){let t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,r,a=0,n){let l=new Ap,u=e.body.getReader(),d=()=>u.read().then(c=>{if(c.done)return l.dataLength&&n(t,r,l.flush(),e),Promise.resolve(new ArrayBuffer(0));let f=c.value,g=f.length;return t.loaded+=g,g<a||l.dataLength?(l.push(f),l.dataLength>=a&&n(t,r,l.flush(),e)):n(t,r,f,e),d()}).catch(()=>Promise.reject());return d()}};function o1(e,t){let r={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(Je({},e.headers))};return e.rangeEnd&&r.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),r}function u1(e){let t=l1.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}function d1(e){let t=e.get("Content-Range");if(t){let a=u1(t);if(oe(a))return a}let r=e.get("Content-Length");if(r)return parseInt(r)}function c1(e,t){return new self.Request(e.url,t)}var h1=class extends Error{constructor(e,t,r){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=r}},f1=/\s/,m1={newCue(e,t,r,a){let n=[],l,u,d,c,f,g=self.VTTCue||self.TextTrackCue;for(let y=0;y<a.rows.length;y++)if(l=a.rows[y],d=!0,c=0,f="",!l.isEmpty()){var p;for(let T=0;T<l.chars.length;T++)f1.test(l.chars[T].uchar)&&d?c++:(f+=l.chars[T].uchar,d=!1);l.cueStartTime=t,t===r&&(r+=1e-4),c>=16?c--:c++;let E=jp(f.trim()),S=Zu(t,r,E);e!=null&&(p=e.cues)!=null&&p.getCueById(S)||(u=new g(t,r,E),u.id=S,u.line=y+1,u.align="left",u.position=10+Math.min(80,Math.floor(c*8/32)*10),n.push(u))}return e&&n.length&&(n.sort((y,E)=>y.line==="auto"||E.line==="auto"?0:y.line>8&&E.line>8?E.line-y.line:y.line-E.line),n.forEach(y=>vp(e,y))),n}},g1={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},lv=ut(ut({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:nv,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:HS,bufferController:YT,capLevelController:Eb,errorController:_S,fpsController:Sb,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:rp,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,useMediaCapabilities:!0,certLoadPolicy:{default:g1},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},p1()),{},{subtitleStreamController:KT,subtitleTrackController:WT,timelineController:vb,audioStreamController:VT,audioTrackController:HT,emeController:Zp,cmcdController:r1,contentSteeringController:a1});function p1(){return{cueHandler:m1,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function v1(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(t.liveMaxLatencyDurationCount!==void 0&&(t.liveSyncDurationCount===void 0||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(t.liveMaxLatencyDuration!==void 0&&(t.liveSyncDuration===void 0||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');let r=Fu(e),a=["manifest","level","frag"],n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return a.forEach(l=>{let u=`${l==="level"?"playlist":l}LoadPolicy`,d=t[u]===void 0,c=[];n.forEach(f=>{let g=`${l}Loading${f}`,p=t[g];if(p!==void 0&&d){c.push(g);let y=r[u].default;switch(t[u]={default:y},f){case"TimeOut":y.maxLoadTimeMs=p,y.maxTimeToFirstByteMs=p;break;case"MaxRetry":y.errorRetry.maxNumRetry=p,y.timeoutRetry.maxNumRetry=p;break;case"RetryDelay":y.errorRetry.retryDelayMs=p,y.timeoutRetry.retryDelayMs=p;break;case"MaxRetryTimeout":y.errorRetry.maxRetryDelayMs=p,y.timeoutRetry.maxRetryDelayMs=p;break}}}),c.length&&P.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${u}": ${JSON.stringify(t[u])}`)}),ut(ut({},r),t)}function Fu(e){return e&&typeof e=="object"?Array.isArray(e)?e.map(Fu):Object.keys(e).reduce((t,r)=>(t[r]=Fu(e[r]),t),{}):e}function y1(e){let t=e.loader;t!==qg&&t!==nv?(P.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1):n1()&&(e.loader=qg,e.progressive=!0,e.enableSoftwareAES=!0,P.log("[config]: Progressive streaming enabled, using FetchLoader"))}var yu,E1=class extends Hu{constructor(e,t){super(e,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this),e.on(b.ERROR,this.onError,this)}_unregisterListeners(){let{hls:e}=this;e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this),e.off(b.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(e=>{e.loadError=0,e.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){let r=this.hls.config.preferManagedMediaSource,a=[],n={},l={},u=!1,d=!1,c=!1;t.levels.forEach(f=>{var g,p;let y=f.attrs,{audioCodec:E,videoCodec:S}=f;((g=E)==null?void 0:g.indexOf("mp4a.40.34"))!==-1&&(yu||(yu=/chrome|firefox/i.test(navigator.userAgent)),yu&&(f.audioCodec=E=void 0)),E&&(f.audioCodec=E=_n(E,r)),((p=S)==null?void 0:p.indexOf("avc1"))===0&&(S=f.videoCodec=lS(S));let{width:T,height:k,unknownCodecs:C}=f;if(u||(u=!!(T&&k)),d||(d=!!S),c||(c=!!E),C!=null&&C.length||E&&!iu(E,"audio",r)||S&&!iu(S,"video",r))return;let{CODECS:I,"FRAME-RATE":O,"HDCP-LEVEL":x,"PATHWAY-ID":$,RESOLUTION:G,"VIDEO-RANGE":K}=y,Q=`${`${$||"."}-`}${f.bitrate}-${G}-${O}-${I}-${K}-${x}`;if(n[Q])if(n[Q].uri!==f.url&&!f.attrs["PATHWAY-ID"]){let ae=l[Q]+=1;f.attrs["PATHWAY-ID"]=new Array(ae+1).join(".");let W=new Ki(f);n[Q]=W,a.push(W)}else n[Q].addGroupId("audio",y.AUDIO),n[Q].addGroupId("text",y.SUBTITLES);else{let ae=new Ki(f);n[Q]=ae,l[Q]=1,a.push(ae)}}),this.filterAndSortMediaOptions(a,t,u,d,c)}filterAndSortMediaOptions(e,t,r,a,n){let l=[],u=[],d=e;if((r||a)&&n&&(d=d.filter(({videoCodec:E,videoRange:S,width:T,height:k})=>(!!E||!!(T&&k))&&SS(S))),d.length===0){Promise.resolve().then(()=>{if(this.hls){t.levels.length&&this.warn(`One or more CODECS in variant not supported: ${JSON.stringify(t.levels[0].attrs)}`);let E=new Error("no level with compatible codecs found in manifest");this.hls.trigger(b.ERROR,{type:Se.MEDIA_ERROR,details:B.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:E,reason:E.message})}});return}if(t.audioTracks){let{preferManagedMediaSource:E}=this.hls.config;l=t.audioTracks.filter(S=>!S.audioCodec||iu(S.audioCodec,"audio",E)),Xg(l)}t.subtitles&&(u=t.subtitles,Xg(u));let c=d.slice(0);d.sort((E,S)=>{if(E.attrs["HDCP-LEVEL"]!==S.attrs["HDCP-LEVEL"])return(E.attrs["HDCP-LEVEL"]||"")>(S.attrs["HDCP-LEVEL"]||"")?1:-1;if(r&&E.height!==S.height)return E.height-S.height;if(E.frameRate!==S.frameRate)return E.frameRate-S.frameRate;if(E.videoRange!==S.videoRange)return xn.indexOf(E.videoRange)-xn.indexOf(S.videoRange);if(E.videoCodec!==S.videoCodec){let T=eg(E.videoCodec),k=eg(S.videoCodec);if(T!==k)return k-T}if(E.uri===S.uri&&E.codecSet!==S.codecSet){let T=Cn(E.codecSet),k=Cn(S.codecSet);if(T!==k)return k-T}return E.averageBitrate!==S.averageBitrate?E.averageBitrate-S.averageBitrate:0});let f=c[0];if(this.steering&&(d=this.steering.filterParsedLevels(d),d.length!==c.length)){for(let E=0;E<c.length;E++)if(c[E].pathwayId===d[0].pathwayId){f=c[E];break}}this._levels=d;for(let E=0;E<d.length;E++)if(d[E]===f){var g;this._firstLevel=E;let S=f.bitrate,T=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${d.length} level(s) found, first bitrate: ${S}`),((g=this.hls.userConfig)==null?void 0:g.abrEwmaDefaultEstimate)===void 0){let k=Math.min(S,this.hls.config.abrEwmaDefaultEstimateMax);k>T&&T===lv.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=k)}break}let p=n&&!a,y={levels:d,audioTracks:l,subtitleTracks:u,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:n,video:a,altAudio:!p&&l.some(E=>!!E.url)};this.hls.trigger(b.MANIFEST_PARSED,y),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(e){let t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){let f=new Error("invalid level idx"),g=e<0;if(this.hls.trigger(b.ERROR,{type:Se.OTHER_ERROR,details:B.LEVEL_SWITCH_ERROR,level:e,fatal:g,error:f,reason:f.message}),g)return;e=Math.min(e,t.length-1)}let r=this.currentLevelIndex,a=this.currentLevel,n=a?a.attrs["PATHWAY-ID"]:void 0,l=t[e],u=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=l,r===e&&l.details&&a&&n===u)return;this.log(`Switching to level ${e} (${l.height?l.height+"p ":""}${l.videoRange?l.videoRange+" ":""}${l.codecSet?l.codecSet+" ":""}@${l.bitrate})${u?" with Pathway "+u:""} from level ${r}${n?" with Pathway "+n:""}`);let d={level:e,attrs:l.attrs,details:l.details,bitrate:l.bitrate,averageBitrate:l.averageBitrate,maxBitrate:l.maxBitrate,realBitrate:l.realBitrate,width:l.width,height:l.height,codecSet:l.codecSet,audioCodec:l.audioCodec,videoCodec:l.videoCodec,audioGroups:l.audioGroups,subtitleGroups:l.subtitleGroups,loaded:l.loaded,loadError:l.loadError,fragmentError:l.fragmentError,name:l.name,id:l.id,uri:l.uri,url:l.url,urlId:0,audioGroupIds:l.audioGroupIds,textGroupIds:l.textGroupIds};this.hls.trigger(b.LEVEL_SWITCHING,d);let c=l.details;if(!c||c.live){let f=this.switchParams(l.uri,a?.details,c);this.loadPlaylist(f)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){let e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}onError(e,t){t.fatal||!t.context||t.context.type===Re.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===Ee.MAIN){let r=t.elementaryStreams;if(!Object.keys(r).some(n=>!!r[n]))return;let a=this._levels[t.level];a!=null&&a.loadError&&(this.log(`Resetting level error count of ${a.loadError} on frag buffered`),a.loadError=0)}}onLevelLoaded(e,t){var r;let{level:a,details:n}=t,l=this._levels[a];if(!l){var u;this.warn(`Invalid level index ${a}`),(u=t.deliveryDirectives)!=null&&u.skip&&(n.deltaUpdateFailed=!0);return}a===this.currentLevelIndex?(l.fragmentError===0&&(l.loadError=0),this.playlistLoaded(a,t,l.details)):(r=t.deliveryDirectives)!=null&&r.skip&&(n.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist();let t=this.currentLevelIndex,r=this.currentLevel;if(r&&this.shouldLoadPlaylist(r)){let a=r.uri;if(e)try{a=e.addDirectives(a)}catch(l){this.warn(`Could not construct new URL with HLS Delivery Directives: ${l}`)}let n=r.attrs["PATHWAY-ID"];this.log(`Loading level index ${t}${e?.msn!==void 0?" at sn "+e.msn+" part "+e.part:""} with${n?" Pathway "+n:""} ${a}`),this.clearTimer(),this.hls.trigger(b.LEVEL_LOADING,{url:a,level:t,pathwayId:r.attrs["PATHWAY-ID"],id:0,deliveryDirectives:e||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;let r=this._levels.filter((a,n)=>n!==e?!0:(this.steering&&this.steering.removeLevel(a),a===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,a.details&&a.details.fragments.forEach(l=>l.level=-1)),!1));Tp(r),this._levels=r,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.hls.trigger(b.LEVELS_UPDATED,{levels:r})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){let{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:r}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(b.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:r}))}};function Xg(e){let t={};e.forEach(r=>{let a=r.groupId||"";r.id=t[a]=t[a]||0,t[a]++})}var S1=class{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(let r in this.keyUriToKeyInfo){let a=this.keyUriToKeyInfo[r].loader;if(a){var t;if(e&&e!==((t=a.context)==null?void 0:t.frag.type))return;a.abort()}}}detach(){for(let e in this.keyUriToKeyInfo){let t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(let e in this.keyUriToKeyInfo){let t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=B.KEY_LOAD_ERROR,r,a,n){return new Sr({type:Se.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:r,networkDetails:a})}loadClear(e,t){if(this.emeController&&this.config.emeEnabled){let{sn:r,cc:a}=e;for(let n=0;n<t.length;n++){let l=t[n];if(a<=l.cc&&(r==="initSegment"||l.sn==="initSegment"||r<l.sn)){this.emeController.selectKeySystemFormat(l).then(u=>{l.setKeyFormat(u)});break}}}}load(e){return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var r,a;t&&e.setKeyFormat(t);let n=e.decryptdata;if(!n){let c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,B.KEY_LOAD_ERROR,c))}let l=n.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,B.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${l}"`)));let u=this.keyUriToKeyInfo[l];if((r=u)!=null&&r.decryptdata.key)return n.key=u.decryptdata.key,Promise.resolve({frag:e,keyInfo:u});if((a=u)!=null&&a.keyLoadPromise){var d;switch((d=u.mediaKeySessionContext)==null?void 0:d.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return u.keyLoadPromise.then(c=>(n.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:u}))}}switch(u=this.keyUriToKeyInfo[l]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return n.keyFormat==="identity"?this.loadKeyHTTP(u,e):this.loadKeyEME(u,e);case"AES-128":return this.loadKeyHTTP(u,e);default:return Promise.reject(this.createKeyLoadError(e,B.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${n.method}"`)))}}loadKeyEME(e,t){let r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){let a=this.emeController.loadKey(r);if(a)return(e.keyLoadPromise=a.then(n=>(e.mediaKeySessionContext=n,r))).catch(n=>{throw e.keyLoadPromise=null,n})}return Promise.resolve(r)}loadKeyHTTP(e,t){let r=this.config,a=r.loader,n=new a(r);return t.keyLoader=e.loader=n,e.keyLoadPromise=new Promise((l,u)=>{let d={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=r.keyLoadPolicy.default,f={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},g={onSuccess:(p,y,E,S)=>{let{frag:T,keyInfo:k,url:C}=E;if(!T.decryptdata||k!==this.keyUriToKeyInfo[C])return u(this.createKeyLoadError(T,B.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),S));k.decryptdata.key=T.decryptdata.key=new Uint8Array(p.data),T.keyLoader=null,k.loader=null,l({frag:T,keyInfo:k})},onError:(p,y,E,S)=>{this.resetLoader(y),u(this.createKeyLoadError(t,B.KEY_LOAD_ERROR,new Error(`HTTP Error ${p.code} loading key ${p.text}`),E,ut({url:d.url,data:void 0},p)))},onTimeout:(p,y,E)=>{this.resetLoader(y),u(this.createKeyLoadError(t,B.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),E))},onAbort:(p,y,E)=>{this.resetLoader(y),u(this.createKeyLoadError(t,B.INTERNAL_ABORTED,new Error("key loading aborted"),E))}};n.load(d,f,g)})}resetLoader(e){let{frag:t,keyInfo:r,url:a}=e,n=r.loader;t.keyLoader===n&&(t.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[a],n&&n.destroy()}};function ov(){return self.SourceBuffer||self.WebKitSourceBuffer}function uv(){if(!ni())return!1;let e=ov();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function T1(){if(!uv())return!1;let e=ni();return typeof e?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(t=>e.isTypeSupported(Ba(t,"video")))||["mp4a.40.2","fLaC"].some(t=>e.isTypeSupported(Ba(t,"audio"))))}function b1(){var e;let t=ov();return typeof(t==null||(e=t.prototype)==null?void 0:e.changeType)=="function"}var L1=250,Rn=2,k1=.1,A1=.05,w1=class{constructor(e,t,r,a){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=r,this.hls=a}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(e,t){let{config:r,media:a,stalled:n}=this;if(a===null)return;let{currentTime:l,seeking:u}=a,d=this.seeking&&!u,c=!this.seeking&&u;if(this.seeking=u,l!==e){if(this.moved=!0,u||(this.nudgeRetry=0),n!==null){if(this.stallReported){let T=self.performance.now()-n;P.warn(`playback not stuck anymore @${l}, after ${Math.round(T)}ms`),this.stallReported=!1}this.stalled=null}return}if(c||d){this.stalled=null;return}if(a.paused&&!u||a.ended||a.playbackRate===0||!Ke.getBuffered(a).length){this.nudgeRetry=0;return}let f=Ke.bufferInfo(a,l,0),g=f.nextStart||0;if(u){let T=f.len>Rn,k=!g||t&&t.start<=l||g-l>Rn&&!this.fragmentTracker.getPartialFragment(l);if(T||k)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var p;if(!(f.len>0)&&!g)return;let T=Math.max(g,f.start||0)-l,k=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,C=!(k==null||(p=k.details)==null)&&p.live?k.details.targetduration*2:Rn,I=this.fragmentTracker.getPartialFragment(l);if(T>0&&(T<=C||I)){a.paused||this._trySkipBufferHole(I);return}}let y=self.performance.now();if(n===null){this.stalled=y;return}let E=y-n;if(!u&&E>=L1&&(this._reportStall(f),!this.media))return;let S=Ke.bufferInfo(a,l,r.maxBufferHole);this._tryFixBufferStall(S,E)}_tryFixBufferStall(e,t){let{config:r,fragmentTracker:a,media:n}=this;if(n===null)return;let l=n.currentTime,u=a.getPartialFragment(l);u&&(this._trySkipBufferHole(u)||!this.media)||(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-l<r.maxBufferHole)&&t>r.highBufferWatchdogPeriod*1e3&&(P.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(e){let{hls:t,media:r,stallReported:a}=this;if(!a&&r){this.stallReported=!0;let n=new Error(`Playback stalling at @${r.currentTime} due to low buffer (${JSON.stringify(e)})`);P.warn(n.message),t.trigger(b.ERROR,{type:Se.MEDIA_ERROR,details:B.BUFFER_STALLED_ERROR,fatal:!1,error:n,buffer:e.len})}}_trySkipBufferHole(e){let{config:t,hls:r,media:a}=this;if(a===null)return 0;let n=a.currentTime,l=Ke.bufferInfo(a,n,0),u=n<l.start?l.start:l.nextStart;if(u){let d=l.len<=t.maxBufferHole,c=l.len>0&&l.len<1&&a.readyState<3,f=u-n;if(f>0&&(d||c)){if(f>t.maxBufferHole){let{fragmentTracker:p}=this,y=!1;if(n===0){let E=p.getAppendedFrag(0,Ee.MAIN);E&&u<E.end&&(y=!0)}if(!y){let E=e||p.getAppendedFrag(n,Ee.MAIN);if(E){let S=!1,T=E.end;for(;T<u;){let k=p.getPartialFragment(T);if(k)T+=k.duration;else{S=!0;break}}if(S)return 0}}}let g=Math.max(u+A1,n+k1);if(P.warn(`skipping hole, adjusting currentTime from ${n} to ${g}`),this.moved=!0,this.stalled=null,a.currentTime=g,e&&!e.gap){let p=new Error(`fragment loaded with buffer holes, seeking from ${n} to ${g}`);r.trigger(b.ERROR,{type:Se.MEDIA_ERROR,details:B.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:p,reason:p.message,frag:e})}return g}}return 0}_tryNudgeBuffer(){let{config:e,hls:t,media:r,nudgeRetry:a}=this;if(r===null)return;let n=r.currentTime;if(this.nudgeRetry++,a<e.nudgeMaxRetry){let l=n+(a+1)*e.nudgeOffset,u=new Error(`Nudging 'currentTime' from ${n} to ${l}`);P.warn(u.message),r.currentTime=l,t.trigger(b.ERROR,{type:Se.MEDIA_ERROR,details:B.BUFFER_NUDGE_ON_STALL,error:u,fatal:!1})}else{let l=new Error(`Playhead still not moving while enough data buffered @${n} after ${e.nudgeMaxRetry} nudges`);P.error(l.message),t.trigger(b.ERROR,{type:Se.MEDIA_ERROR,details:B.BUFFER_STALLED_ERROR,error:l,fatal:!0})}}},R1=100,D1=class extends Wu{constructor(e,t,r){super(e,t,r,"[stream-controller]",Ee.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){let{hls:e}=this;e.on(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.LEVEL_LOADED,this.onLevelLoaded,this),e.on(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(b.ERROR,this.onError,this),e.on(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(b.BUFFER_CREATED,this.onBufferCreated,this),e.on(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(b.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){let{hls:e}=this;e.off(b.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.LEVEL_LOADED,this.onLevelLoaded,this),e.off(b.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(b.ERROR,this.onError,this),e.off(b.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(b.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(b.BUFFER_CREATED,this.onBufferCreated,this),e.off(b.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(b.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(b.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),super.onHandlerDestroying()}startLoad(e){if(this.levels){let{lastCurrentTime:t,hls:r}=this;if(this.stopLoad(),this.setInterval(R1),this.level=-1,!this.startFragRequested){let a=r.startLevel;a===-1&&(r.config.testBandwidth&&this.levels.length>1?(a=0,this.bitrateTest=!0):a=r.firstAutoLevel),r.nextLoadLevel=a,this.level=r.loadLevel,this.loadedmetadata=!1}t>0&&e===-1&&(this.log(`Override startPosition with lastCurrentTime @${t.toFixed(3)}`),e=t),this.state=z.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=z.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case z.WAITING_LEVEL:{let{levels:t,level:r}=this,a=t?.[r],n=a?.details;if(n&&(!n.live||this.levelLastLoaded===a)){if(this.waitForCdnTuneIn(n))break;this.state=z.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=z.IDLE;break}break}case z.FRAG_LOADING_WAITING_RETRY:{var e;let t=self.performance.now(),r=this.retryDate;if(!r||t>=r||(e=this.media)!=null&&e.seeking){let{levels:a,level:n}=this,l=a?.[n];this.resetStartWhenNotLoaded(l||null),this.state=z.IDLE}}break}this.state===z.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){let{hls:e,levelLastLoaded:t,levels:r,media:a}=this;if(t===null||!a&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;let n=e.nextLoadLevel;if(!(r!=null&&r[n]))return;let l=r[n],u=this.getMainFwdBufferInfo();if(u===null)return;let d=this.getLevelDetails();if(d&&this._streamEnded(u,d)){let S={};this.altAudio&&(S.type="video"),this.hls.trigger(b.BUFFER_EOS,S),this.state=z.ENDED;return}e.loadLevel!==n&&e.manualLevel===-1&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=e.nextLoadLevel=n;let c=l.details;if(!c||this.state===z.WAITING_LEVEL||c.live&&this.levelLastLoaded!==l){this.level=n,this.state=z.WAITING_LEVEL;return}let f=u.len,g=this.getMaxBufferLength(l.maxBitrate);if(f>=g)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);let p=this.backtrackFragment?this.backtrackFragment.start:u.end,y=this.getNextFragment(p,c);if(this.couldBacktrack&&!this.fragPrevious&&y&&y.sn!=="initSegment"&&this.fragmentTracker.getState(y)!==ot.OK){var E;let S=((E=this.backtrackFragment)!=null?E:y).sn-c.startSN,T=c.fragments[S-1];T&&y.cc===T.cc&&(y=T,this.fragmentTracker.removeFragment(T))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(y&&this.isLoopLoading(y,p)){if(!y.gap){let S=this.audioOnly&&!this.altAudio?Pe.AUDIO:Pe.VIDEO,T=(S===Pe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;T&&this.afterBufferFlushed(T,S,Ee.MAIN)}y=this.getNextFragmentLoopLoading(y,c,u,Ee.MAIN,g)}y&&(y.initSegment&&!y.initSegment.data&&!this.bitrateTest&&(y=y.initSegment),this.loadFragment(y,l,p))}loadFragment(e,t,r){let a=this.fragmentTracker.getState(e);this.fragCurrent=e,a===ot.NOT_LOADED||a===ot.PARTIAL?e.sn==="initSegment"?this._loadInitSegment(e,t):this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):(this.startFragRequested=!0,super.loadFragment(e,t,r)):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,Ee.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){let{levels:e,media:t}=this;if(t!=null&&t.readyState){let r,a=this.getAppendedFrag(t.currentTime);a&&a.start>1&&this.flushMainBuffer(0,a.start-1);let n=this.getLevelDetails();if(n!=null&&n.live){let u=this.getMainFwdBufferInfo();if(!u||u.len<n.targetduration*2)return}if(!t.paused&&e){let u=this.hls.nextLoadLevel,d=e[u],c=this.fragLastKbps;c&&this.fragCurrent?r=this.fragCurrent.duration*d.maxBitrate/(1e3*c)+1:r=0}else r=0;let l=this.getBufferedFrag(t.currentTime+r);if(l){let u=this.followingBufferedFrag(l);if(u){this.abortCurrentFrag();let d=u.maxStartPTS?u.maxStartPTS:u.start,c=u.duration,f=Math.max(l.end,d+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){let e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case z.KEY_LOADING:case z.FRAG_LOADING:case z.FRAG_LOADING_WAITING_RETRY:case z.PARSING:case z.PARSED:this.state=z.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);let r=t.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new w1(this.config,r,this.fragmentTracker,this.hls)}onMediaDetaching(){let{media:e}=this;e&&this.onvplaying&&this.onvseeked&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){let e=this.media,t=e?e.currentTime:null;oe(t)&&this.log(`Media seeked to ${t.toFixed(3)}`);let r=this.getMainFwdBufferInfo();if(r===null||r.len===0){this.warn(`Main forward buffer length on "seeked" event ${r?r.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=this.fragLastKbps=0,this.levels=this.fragPlaying=this.backtrackFragment=this.levelLastLoaded=null,this.altAudio=this.audioOnly=this.startFragRequested=!1}onManifestParsed(e,t){let r=!1,a=!1;t.levels.forEach(n=>{let l=n.audioCodec;l&&(r=r||l.indexOf("mp4a.40.2")!==-1,a=a||l.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=r&&a&&!b1(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){let{levels:r}=this;if(!r||this.state!==z.IDLE)return;let a=r[t.level];(!a.details||a.details.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(a.details))&&(this.state=z.WAITING_LEVEL)}onLevelLoaded(e,t){var r;let{levels:a}=this,n=t.level,l=t.details,u=l.totalduration;if(!a){this.warn(`Levels were reset while loading level ${n}`);return}this.log(`Level ${n} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""}, cc [${l.startCC}, ${l.endCC}] duration:${u}`);let d=a[n],c=this.fragCurrent;c&&(this.state===z.FRAG_LOADING||this.state===z.FRAG_LOADING_WAITING_RETRY)&&c.level!==t.level&&c.loader&&this.abortCurrentFrag();let f=0;if(l.live||(r=d.details)!=null&&r.live){var g;if(this.checkLiveUpdate(l),l.deltaUpdateFailed)return;f=this.alignPlaylists(l,d.details,(g=this.levelLastLoaded)==null?void 0:g.details)}if(d.details=l,this.levelLastLoaded=d,this.hls.trigger(b.LEVEL_UPDATED,{details:l,level:n}),this.state===z.WAITING_LEVEL){if(this.waitForCdnTuneIn(l))return;this.state=z.IDLE}this.startFragRequested?l.live&&this.synchronizeToLiveEdge(l):this.setStartPosition(l,f),this.tick()}_handleFragmentLoadProgress(e){var t;let{frag:r,part:a,payload:n}=e,{levels:l}=this;if(!l){this.warn(`Levels were reset while fragment load was in progress. Fragment ${r.sn} of level ${r.level} will not be buffered`);return}let u=l[r.level],d=u.details;if(!d){this.warn(`Dropping fragment ${r.sn} of level ${r.level} after level details were reset`),this.fragmentTracker.removeFragment(r);return}let c=u.videoCodec,f=d.PTSKnown||!d.live,g=(t=r.initSegment)==null?void 0:t.data,p=this._getAudioCodec(u),y=this.transmuxer=this.transmuxer||new Gp(this.hls,Ee.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),E=a?a.index:-1,S=E!==-1,T=new Ku(r.level,r.sn,r.stats.chunkCount,n.byteLength,E,S),k=this.initPTS[r.cc];y.push(n,g,p,c,r,a,d.totalduration,f,T,k)}onAudioTrackSwitching(e,t){let r=this.altAudio;if(!t.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;let n=this.fragCurrent;n&&(this.log("Switching to main audio track, cancel main fragment load"),n.abortRequests(),this.fragmentTracker.removeFragment(n)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();let a=this.hls;r&&(a.trigger(b.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),a.trigger(b.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){let r=t.id,a=!!this.hls.audioTracks[r].url;if(a){let n=this.videoBuffer;n&&this.mediaBuffer!==n&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=n)}this.altAudio=a,this.tick()}onBufferCreated(e,t){let r=t.tracks,a,n,l=!1;for(let u in r){let d=r[u];if(d.id==="main"){if(n=u,a=d,u==="video"){let c=r[u];c&&(this.videoBuffer=c.buffer)}}else l=!0}l&&a?(this.log(`Alternate track found, use ${n}.buffered to schedule main fragment loading`),this.mediaBuffer=a.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){let{frag:r,part:a}=t;if(r&&r.type!==Ee.MAIN)return;if(this.fragContextChanged(r)){this.warn(`Fragment ${r.sn}${a?" p: "+a.index:""} of level ${r.level} finished buffering, but was aborted. state: ${this.state}`),this.state===z.PARSED&&(this.state=z.IDLE);return}let n=a?a.stats:r.stats;this.fragLastKbps=Math.round(8*n.total/(n.buffering.end-n.loading.first)),r.sn!=="initSegment"&&(this.fragPrevious=r),this.fragBufferedComplete(r,a)}onError(e,t){var r;if(t.fatal){this.state=z.ERROR;return}switch(t.details){case B.FRAG_GAP:case B.FRAG_PARSING_ERROR:case B.FRAG_DECRYPT_ERROR:case B.FRAG_LOAD_ERROR:case B.FRAG_LOAD_TIMEOUT:case B.KEY_LOAD_ERROR:case B.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(Ee.MAIN,t);break;case B.LEVEL_LOAD_ERROR:case B.LEVEL_LOAD_TIMEOUT:case B.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===z.WAITING_LEVEL&&((r=t.context)==null?void 0:r.type)===Re.LEVEL&&(this.state=z.IDLE);break;case B.BUFFER_APPEND_ERROR:case B.BUFFER_FULL_ERROR:if(!t.parent||t.parent!=="main")return;if(t.details===B.BUFFER_APPEND_ERROR){this.resetLoadingState();return}this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case B.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}checkBuffer(){let{media:e,gapController:t}=this;if(!(!e||!t||!e.readyState)){if(this.loadedmetadata||!Ke.getBuffered(e).length){let r=this.state!==z.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,r)}this.lastCurrentTime=e.currentTime}}onFragLoadEmergencyAborted(){this.state=z.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Pe.AUDIO||this.audioOnly&&!this.altAudio){let r=(t===Pe.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(r,t,Ee.MAIN),this.tick()}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){let{media:e}=this;if(!e)return;let t=e.currentTime,r=this.startPosition;if(r>=0&&t<r){if(e.seeking){this.log(`could not seek to ${r}, already seeking at ${t}`);return}let a=Ke.getBuffered(e),n=(a.length?a.start(0):0)-r;n>0&&(n<this.config.maxBufferHole||n<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${n} to match buffer start`),r+=n,this.startPosition=r),this.log(`seek to target start position ${r} from current time ${t}`),e.currentTime=r}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(r=>{let{hls:a}=this;if(!r||this.fragContextChanged(e))return;t.fragmentError=0,this.state=z.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;let n=e.stats;n.parsing.start=n.parsing.end=n.buffering.start=n.buffering.end=self.performance.now(),a.trigger(b.FRAG_LOADED,r),e.bitrateTest=!1})}_handleTransmuxComplete(e){var t;let r="main",{hls:a}=this,{remuxResult:n,chunkMeta:l}=e,u=this.getCurrentContext(l);if(!u){this.resetWhenMissingContext(l);return}let{frag:d,part:c,level:f}=u,{video:g,text:p,id3:y,initSegment:E}=n,{details:S}=f,T=this.altAudio?void 0:n.audio;if(this.fragContextChanged(d)){this.fragmentTracker.removeFragment(d);return}if(this.state=z.PARSING,E){if(E!=null&&E.tracks){let I=d.initSegment||d;this._bufferInitSegment(f,E.tracks,I,l),a.trigger(b.FRAG_PARSING_INIT_SEGMENT,{frag:I,id:r,tracks:E.tracks})}let k=E.initPTS,C=E.timescale;oe(k)&&(this.initPTS[d.cc]={baseTime:k,timescale:C},a.trigger(b.INIT_PTS_FOUND,{frag:d,id:r,initPTS:k,timescale:C}))}if(g&&S&&d.sn!=="initSegment"){let k=S.fragments[d.sn-1-S.startSN],C=d.sn===S.startSN,I=!k||d.cc>k.cc;if(n.independent!==!1){let{startPTS:O,endPTS:x,startDTS:$,endDTS:G}=g;if(c)c.elementaryStreams[g.type]={startPTS:O,endPTS:x,startDTS:$,endDTS:G};else if(g.firstKeyFrame&&g.independent&&l.id===1&&!I&&(this.couldBacktrack=!0),g.dropped&&g.independent){let K=this.getMainFwdBufferInfo(),Q=(K?K.end:this.getLoadPosition())+this.config.maxBufferHole,ae=g.firstKeyFramePTS?g.firstKeyFramePTS:O;if(!C&&Q<ae-this.config.maxBufferHole&&!I){this.backtrack(d);return}else I&&(d.gap=!0);d.setElementaryStreamInfo(g.type,d.start,x,d.start,G,!0)}else C&&O>Rn&&(d.gap=!0);d.setElementaryStreamInfo(g.type,O,x,$,G),this.backtrackFragment&&(this.backtrackFragment=d),this.bufferFragmentData(g,d,c,l,C||I)}else if(C||I)d.gap=!0;else{this.backtrack(d);return}}if(T){let{startPTS:k,endPTS:C,startDTS:I,endDTS:O}=T;c&&(c.elementaryStreams[Pe.AUDIO]={startPTS:k,endPTS:C,startDTS:I,endDTS:O}),d.setElementaryStreamInfo(Pe.AUDIO,k,C,I,O),this.bufferFragmentData(T,d,c,l)}if(S&&y!=null&&(t=y.samples)!=null&&t.length){let k={id:r,frag:d,details:S,samples:y.samples};a.trigger(b.FRAG_PARSING_METADATA,k)}if(S&&p){let k={id:r,frag:d,details:S,samples:p.samples};a.trigger(b.FRAG_PARSING_USERDATA,k)}}_bufferInitSegment(e,t,r,a){if(this.state!==z.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;let{audio:n,video:l,audiovideo:u}=t;if(n){let d=e.audioCodec,c=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(d&&(d.indexOf("mp4a.40.5")!==-1?d="mp4a.40.2":d="mp4a.40.5"),n.metadata.channelCount!==1&&c.indexOf("firefox")===-1&&(d="mp4a.40.5")),d&&d.indexOf("mp4a.40.5")!==-1&&c.indexOf("android")!==-1&&n.container!=="audio/mpeg"&&(d="mp4a.40.2",this.log(`Android: force audio codec to ${d}`)),e.audioCodec&&e.audioCodec!==d&&this.log(`Swapping manifest audio codec "${e.audioCodec}" for "${d}"`),n.levelCodec=d,n.id="main",this.log(`Init audio buffer, container:${n.container}, codecs[selected/level/parsed]=[${d||""}/${e.audioCodec||""}/${n.codec}]`)}l&&(l.levelCodec=e.videoCodec,l.id="main",this.log(`Init video buffer, container:${l.container}, codecs[level/parsed]=[${e.videoCodec||""}/${l.codec}]`)),u&&this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),this.hls.trigger(b.BUFFER_CODECS,t),Object.keys(t).forEach(d=>{let c=t[d].initSegment;c!=null&&c.byteLength&&this.hls.trigger(b.BUFFER_APPENDING,{type:d,data:c,frag:r,part:null,chunkMeta:a,parent:r.type})}),this.tickImmediate()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,Ee.MAIN)}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=z.IDLE}checkFragmentChanged(){let e=this.media,t=null;if(e&&e.readyState>1&&e.seeking===!1){let r=e.currentTime;if(Ke.isBuffered(e,r)?t=this.getAppendedFrag(r):Ke.isBuffered(e,r+.1)&&(t=this.getAppendedFrag(r+.1)),t){this.backtrackFragment=null;let a=this.fragPlaying,n=t.level;(!a||t.sn!==a.sn||a.level!==n)&&(this.fragPlaying=t,this.hls.trigger(b.FRAG_CHANGED,{frag:t}),(!a||a.level!==n)&&this.hls.trigger(b.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){let e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){let e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}get currentProgramDateTime(){let e=this.media;if(e){let t=e.currentTime,r=this.currentFrag;if(r&&oe(t)&&oe(r.programDateTime)){let a=r.programDateTime+(t-r.start)*1e3;return new Date(a)}}return null}get currentLevel(){let e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){let e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}},$a=class Na{static get version(){return"1.5.8"}static isMSESupported(){return uv()}static isSupported(){return T1()}static getMediaSource(){return ni()}static get Events(){return b}static get ErrorTypes(){return Se}static get ErrorDetails(){return B}static get DefaultConfig(){return Na.defaultConfig?Na.defaultConfig:lv}static set DefaultConfig(t){Na.defaultConfig=t}constructor(t={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this.started=!1,this._emitter=new Qu,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,this.triggeringException=void 0,yE(t.debug||!1,"Hls instance");let r=this.config=v1(Na.DefaultConfig,t);this.userConfig=t,r.progressive&&y1(r);let{abrController:a,bufferController:n,capLevelController:l,errorController:u,fpsController:d}=r,c=new u(this),f=this.abrController=new a(this),g=this.bufferController=new n(this),p=this.capLevelController=new l(this),y=new d(this),E=new hS(this),S=new vS(this),T=r.contentSteeringController,k=T?new T(this):null,C=this.levelController=new E1(this,k),I=new zS(this),O=new S1(this.config),x=this.streamController=new D1(this,I,O);p.setStreamController(x),y.setStreamController(x);let $=[E,C,x];k&&$.splice(1,0,k),this.networkControllers=$;let G=[f,g,p,y,S,I];this.audioTrackController=this.createController(r.audioTrackController,$);let K=r.audioStreamController;K&&$.push(new K(this,I,O)),this.subtitleTrackController=this.createController(r.subtitleTrackController,$);let Q=r.subtitleStreamController;Q&&$.push(new Q(this,I,O)),this.createController(r.timelineController,G),O.emeController=this.emeController=this.createController(r.emeController,G),this.cmcdController=this.createController(r.cmcdController,G),this.latencyController=this.createController(yS,G),this.coreComponents=G,$.push(c);let ae=c.onErrorOut;typeof ae=="function"&&this.on(b.ERROR,ae,c)}createController(t,r){if(t){let a=new t(this);return r&&r.push(a),a}return null}on(t,r,a=this){this._emitter.on(t,r,a)}once(t,r,a=this){this._emitter.once(t,r,a)}removeAllListeners(t){this._emitter.removeAllListeners(t)}off(t,r,a=this,n){this._emitter.off(t,r,a,n)}listeners(t){return this._emitter.listeners(t)}emit(t,r,a){return this._emitter.emit(t,r,a)}trigger(t,r){if(this.config.debug)return this.emit(t,t,r);try{return this.emit(t,t,r)}catch(a){if(P.error("An internal error happened while handling event "+t+'. Error message: "'+a.message+'". Here is a stacktrace:',a),!this.triggeringException){this.triggeringException=!0;let n=t===b.ERROR;this.trigger(b.ERROR,{type:Se.OTHER_ERROR,details:B.INTERNAL_EXCEPTION,fatal:n,event:t,error:a}),this.triggeringException=!1}}return!1}listenerCount(t){return this._emitter.listenerCount(t)}destroy(){P.log("destroy"),this.trigger(b.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(r=>r.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(r=>r.destroy()),this.coreComponents.length=0;let t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null}attachMedia(t){P.log("attachMedia"),this._media=t,this.trigger(b.MEDIA_ATTACHING,{media:t})}detachMedia(){P.log("detachMedia"),this.trigger(b.MEDIA_DETACHING,void 0),this._media=null}loadSource(t){this.stopLoad();let r=this.media,a=this.url,n=this.url=Uu.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,P.log(`loadSource:${n}`),r&&a&&(a!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(r)),this.trigger(b.MANIFEST_LOADING,{url:t})}startLoad(t=-1){P.log(`startLoad(${t})`),this.started=!0,this.networkControllers.forEach(r=>{r.startLoad(t)})}stopLoad(){P.log("stopLoad"),this.started=!1,this.networkControllers.forEach(t=>{t.stopLoad()})}resumeBuffering(){this.started&&this.networkControllers.forEach(t=>{"fragmentLoader"in t&&t.startLoad(-1)})}pauseBuffering(){this.networkControllers.forEach(t=>{"fragmentLoader"in t&&t.stopLoad()})}swapAudioCodec(){P.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){P.log("recoverMediaError");let t=this._media;this.detachMedia(),t&&this.attachMedia(t)}removeLevel(t){this.levelController.removeLevel(t)}get levels(){return this.levelController.levels||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(t){P.log(`set currentLevel:${t}`),this.levelController.manualLevel=t,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(t){P.log(`set nextLevel:${t}`),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(t){P.log(`set loadLevel:${t}`),this.levelController.manualLevel=t}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(t){this.levelController.nextLoadLevel=t}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(t){P.log(`set firstLevel:${t}`),this.levelController.firstLevel=t}get startLevel(){let t=this.levelController.startLevel;return t===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:t}set startLevel(t){P.log(`set startLevel:${t}`),t!==-1&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(t){let r=!!t;r!==this.config.capLevelToPlayerSize&&(r?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=r)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){let{bwEstimator:t}=this.abrController;return t?t.getEstimate():NaN}set bandwidthEstimate(t){this.abrController.resetEstimator(t)}get ttfbEstimate(){let{bwEstimator:t}=this.abrController;return t?t.getEstimateTTFB():NaN}set autoLevelCapping(t){this._autoLevelCapping!==t&&(P.log(`set autoLevelCapping:${t}`),this._autoLevelCapping=t,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(t){ES(t)&&this._maxHdcpLevel!==t&&(this._maxHdcpLevel=t,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){let{levels:t,config:{minAutoBitrate:r}}=this;if(!t)return 0;let a=t.length;for(let n=0;n<a;n++)if(t[n].maxBitrate>=r)return n;return 0}get maxAutoLevel(){let{levels:t,autoLevelCapping:r,maxHdcpLevel:a}=this,n;if(r===-1&&t!=null&&t.length?n=t.length-1:n=r,a)for(let l=n;l--;){let u=t[l].attrs["HDCP-LEVEL"];if(u&&u<=a)return l}return n}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(t){this.abrController.nextAutoLevel=t}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}setAudioOption(t){var r;return(r=this.audioTrackController)==null?void 0:r.setAudioOption(t)}setSubtitleOption(t){var r;return(r=this.subtitleTrackController)==null||r.setSubtitleOption(t),null}get allAudioTracks(){let t=this.audioTrackController;return t?t.allAudioTracks:[]}get audioTracks(){let t=this.audioTrackController;return t?t.audioTracks:[]}get audioTrack(){let t=this.audioTrackController;return t?t.audioTrack:-1}set audioTrack(t){let r=this.audioTrackController;r&&(r.audioTrack=t)}get allSubtitleTracks(){let t=this.subtitleTrackController;return t?t.allSubtitleTracks:[]}get subtitleTracks(){let t=this.subtitleTrackController;return t?t.subtitleTracks:[]}get subtitleTrack(){let t=this.subtitleTrackController;return t?t.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(t){let r=this.subtitleTrackController;r&&(r.subtitleTrack=t)}get subtitleDisplay(){let t=this.subtitleTrackController;return t?t.subtitleDisplay:!1}set subtitleDisplay(t){let r=this.subtitleTrackController;r&&(r.subtitleDisplay=t)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(t){this.config.lowLatencyMode=t}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}};$a.defaultConfig=void 0;var li=class e{constructor(t,r,a){this.IsSucceeded=t,this.Data=r,this.Message=a}IsSucceeded;Data;Message;static Succeeded(t){return new e(!0,t,null)}static Fail(t){return new e(!1,null,t)}},Wi=class e{constructor(t,r){this.IsSucceeded=t,this.Message=r}IsSucceeded;Message;static Succeeded(){return new e(!0,null)}static Fail(t){return new e(!1,t)}};var $n=class{_videoElement;_hls;_source;_listners=new Map;constructor(t){this._videoElement=t}get duration(){return this._videoElement.duration}get currentTime(){return this._videoElement.currentTime}set currentTime(t){this._videoElement.currentTime=t}get paused(){return this._videoElement.paused}get buffered(){return this._videoElement.buffered}get repeat(){return this._videoElement.loop}set repeat(t){this._videoElement.loop=t}async Initialize(t,r){if(!$a.isSupported())return Wi.Fail("HLS is not supported");if(r&&(this._videoElement=r),this._source=t,this._hls&&this._hls.destroy(),this._hls=new $a,this._source.media.isDMS)this._hls.loadSource(t.media.contentUrl),this._hls.attachMedia(this._videoElement);else{if(!(await fetch(t.media.createUrl)).ok)return Wi.Fail("Failed to fetch DMS URL");_e.log("HLS\u30E1\u30C7\u30A3\u30A2\u30D5\u30A1\u30A4\u30EB\u3092\u751F\u6210\u3057\u307E\u3057\u305F\u3002"),this._hls.loadSource(t.media.contentUrl),this._hls.attachMedia(this._videoElement)}return Wi.Succeeded()}on(t,r){this._listners.has(t)||this._listners.set(t,[]),this._listners.get(t).push(r),this._videoElement.addEventListener(t,r)}off(t,r){this._listners.has(t)&&this._listners.set(t,this._listners.get(t).filter(a=>a!==r)),this._videoElement.removeEventListener(t,r)}play(){this._videoElement.play()}pause(){this._videoElement.pause()}listened(t,r){let a=this._listners.get(t);return a?a.filter(n=>n===r).length>0:!1}};var Gn=class{splitter(t,r=","){return t?t.split(r):[]}padding(t,r=2,a="0"){if(t<10**r){let n=t.toString(),l=n;for(let u=0;u<r-n.length;u++)l=a+l;return l}else return t.toString()}createNestedArray(t){let r=[];for(let a=0;a<t;a++)r.push([]);return r}createArray(t){let r=[];return r.length=t,r}calcVPOS(t){let r=Math.floor(t/100),a=Math.floor(r/60),n=Math.floor(r%60);return{ms:{min:a,sec:n},sec:r}}};var Ge={fps:60,duration:3e3,lineHeight:1.2,bigLines:8,mediumLines:11,smallLines:16,fix:{smal:38,big:16,medium:25},defaultColor:"#fff",defaultLayer:"base",defaultFont:"MS PGothic",opacity:1};var I1=new Gn,td=class{ctx;customAttr;duration;canvasSize;canvasWidthFlash;width;text;textForRender;originalText;color;borderColor;commentNumber;lines;selfLines;life=0;delta=0;left=0;top=0;reveal=0;touch=0;fontSize;fontName;overallSize;fontSizeString;type;alive;fixed=!1;vpos;opacity;full;textLength;maxLengthIndex;onDisposed;constructor(t){this.type=t.option.mode,this.customAttr=t.option.customAttr,this.originalText=t.text,this.text=this._formatComment(t.text,this.type),this.textForRender=this._formatRenderComment(this.text),this.textLength=Math.max(...this.text.map(r=>r.length)),this.maxLengthIndex=this.text.map(r=>r.length).indexOf(this.textLength),this.commentNumber=t.commentNumber,this.color=t.option.color,this.borderColor=t.option.borderColor,this.lines=this._getLines(t.option.commentSize,t.lines),this.selfLines=this.text.length,this.ctx=t.ctx,this.fontName=t.option.fontName,this.opacity=t.option.opacity,this.full=t.option.full,this.canvasSize=t.canvasSize,this.canvasWidthFlash=t.canvasWidthFlash,this.text.length>=this.lines&&(this.fixed=!0),this.vpos=t.option.vpos,this.duration=t.option.duration||Ge.duration,this.fontSizeString=t.option.commentSize,[this.fontSize,this.width]=this._getFont(this.text[this.maxLengthIndex],this.canvasSize,this.canvasWidthFlash,t.option.commentSize,t.fontSize,t.fixedFontSize,this.type),this.fontSizeString=t.option.commentSize,this.overallSize=this.fontSize*this.selfLines,this.alive=!0,this.onDisposed=t.onDisposed,this._set()}getProp(t){return this.customAttr.get(t)}tick(t){if(t>=this.vpos+this.duration*2){this.alive=!1;return}if(this.vpos>t+this.duration){this.alive=!1;return}this.life--,this.type==="naka"&&(this.left-=this.delta,this.reveal--,this.touch--),this.life<0&&this.kill()}kill(){this.alive=!1,this.onDisposed()}_set(){switch(this.life=0,this.left=0,this.top=0,this.delta=0,this.reveal=0,this.touch=0,this.type){case"naka":this._setNaka();break;case"shita":case"ue":this._setShitaUe()}}_setNaka(){this.life=Ge.fps*this.duration/1e3,this.left=this.canvasSize.width,this.delta=(this.canvasSize.width+this.width)/this.life,this.reveal=this.width/this.delta,this.touch=this.canvasSize.width/this.delta}_setShitaUe(){this.life=Ge.fps*this.duration/1e3,this.fixed?this.left=(this.canvasSize.width-this.width)/2:this.left=this.canvasSize.width/2}_getFont(t,r,a,n,l,u,d){let c=this._getSize(n,l),f=c;c*this.selfLines>r.height/3&&(f=this._getSize(n,u)),this.ctx.font=`${f}px "Yu Gothic"`;let g=this.ctx.measureText(t).width,p=g>this.canvasSize.width&&d!=="naka";return p&&!this.full?(f=this._modSize(c,g,this.canvasWidthFlash),this.ctx.font=`${f}px "Yu Gothic"`,g=this.ctx.measureText(t).width):p&&this.full&&(f=this._modSize(c,g,this.canvasSize.width),this.ctx.font=`${f}px "Yu Gothic"`,g=this.ctx.measureText(t).width),[f,g]}_modSize(t,r,a){return t*a/r}_getSize(t,r){switch(t){case"big":return r.big;case"small":return r.small;default:return r.medium}}_getLines(t,r){switch(t){case"big":return r.big;case"medium":return r.medium;case"small":return r.small}}_formatComment(t,r){let a=I1.splitter(t,`
`);return a=this._deleteBlank(a),a=this._deleteFirstAndLastBlank(a),a=this._sortByType(a,r),a}_formatRenderComment(t){let r=[...t];return r=this._deleteBlankLineFromEnd(t),r}_deleteBlank(t){let r=0,a=[];for(let n of t)!n?r++:r=0,r<3&&a.push(n);return a}_deleteFirstAndLastBlank(t){let r=[...t];for(let n of t)if(!n)r.shift();else break;let a=[...r].reverse();for(let n of a)if(!n)r.pop();else break;return r}_sortByType(t,r){return r==="shita"?t.reverse():t}_deleteBlankLineFromEnd(t){let r=[...t],a=[...t].reverse();for(let n of a)if(/^\s+$/.test(n)||n.length===0)r.pop();else break;return r}};var Vn=class{height;width;constructor(t){this.height=t.height,this.width=t.width}},Hn=class{ctx;canvasSize;canvasWidthFlash;lines;fonrSize;fixedFonrSize;duration;naka;shita;ue;maxlines;comments;constructor(t,r,a,n,l,u){this.ctx=t,this.canvasSize=r,this.canvasWidthFlash=r.height/3*4,this.lines=a,this.fonrSize=n,this.fixedFonrSize=l,this.duration=u,this.comments=[],this.maxlines=a.small,this.naka=new Kn(a.small,r),this.shita=[],this.ue=[]}add(t,r,a,n="naka",l="medium",u,d){if(this.comments.length>40)return;let c={mode:n,color:a.get("color")||"#fff",borderColor:a.get("bcolor")||"#000",duration:this.duration,customAttr:a,commentSize:l,vpos:d,fontName:a.get("fontName"),opacity:a.get("opacity"),full:a.get("full")},f={text:t,ctx:this.ctx,canvasSize:this.canvasSize,canvasWidthFlash:this.canvasWidthFlash,fontSize:this.fonrSize,fixedFontSize:this.fixedFonrSize,lines:this.lines,option:c,commentNumber:r,onDisposed:u.onDispased},g=new td(f);switch(g.type){case"naka":this.naka.add(g);break;case"shita":this._appendShita(g);break;case"ue":this._appendUe(g);break}}tick(t){let r=t&&t.vpos?t.vpos:0,a=t?!!t.render:!0;this.comments.length&&this.comments.forEach(n=>{a&&this._render(n),n.tick(r)}),a&&this.naka.getList().forEach(n=>{this._render(n)}),this.naka.tick(r),this._clean()}_render(t){switch(this.ctx.textBaseline="top",!0){case(t.type==="naka"||t.fixed):this.ctx.textAlign="left";break;default:this.ctx.textAlign="center";break}this.ctx.fillStyle=`${t.color}`,this.ctx.shadowColor=t.borderColor,this.ctx.shadowOffsetX=1.5,this.ctx.shadowOffsetY=1.5,this.ctx.globalAlpha=t.opacity,this.ctx.font=`bold ${t.fontSize}px "${t.fontName}"`;let a=(t.type==="shita"?-1:1)*t.fontSize;for(let n=0;n<t.textForRender.length;n++)this.ctx.fillText(t.textForRender[n],t.left,t.top+a*n)}clear(t){switch(t){case void 0:this.comments.forEach(r=>r.kill()),this.comments=[],this.naka=new Kn(this.lines.small,this.canvasSize),this.ue=[],this.shita=[];break;case"first":this.comments.length&&this.comments[0].kill();break;case"last":this.comments.length&&this.comments[this.comments.length-1].kill()}}_clean(){this.comments=this.comments.filter(t=>t.alive),this.naka.clean()}_appendShita(t){let r=this.canvasSize.height;for(let a=0;a<40;a++){switch(this.shita[a]&&this.shita[a].alive&&!t.fixed&&(r-=this.shita[a].overallSize),!0){case this.shita.length===0:case this.shita.length<=a:case!this.shita[a].alive:break;case t.fixed:break;case r-t.overallSize<0:break;default:continue}t.fixed?t.top=this.canvasSize.height-t.fontSize:r-t.overallSize<0?t.top=Math.random()*(this.canvasSize.height-t.overallSize):t.top=r-t.overallSize,this.shita[a]=t,this.comments.push(t);break}}_appendUe(t){let r=0;for(let a=0;a<40;a++){switch(this.ue[a]&&this.ue[a].alive&&!t.fixed&&(r+=this.ue[a].overallSize),!0){case this.ue.length===0:case this.ue.length<=a:case!this.ue[a].alive:case t.fixed:case r+t.overallSize>this.canvasSize.height:break;default:continue}t.fixed?t.top=0:r+t.overallSize>this.canvasSize.height?t.top=Math.random()*(this.canvasSize.height-t.overallSize):t.top=r,this.ue[a]=t,this.comments.push(t);break}}get(t,r){let a=[],n=this.naka.get(t,r);n!==void 0&&a.push(n);let l=this.comments.filter(u=>{let d=u.width/2,c=t>u.left-d&&t<u.left+d,f=r>u.top&&r<u.top+u.overallSize;return c&&f});return a.push(...l),a}},Kn=class{lastCommentStream;comments;canvasSize;allines;constructor(t,r){this.comments=[],this.lastCommentStream=[],this.allines=t,this.canvasSize=r}add(t){let r=0;for(let a=0;a<this.allines;a++){let n=this.lastCommentStream[a];switch(!0){case n===void 0:break;case t.fixed:break;case(n.reveal<0&&n.life<t.touch):break;case r+t.overallSize>this.canvasSize.height:break;default:r+=n.overallSize;continue}t.fixed?t.top=0:r+t.overallSize>this.canvasSize.height?t.top=Math.random()*(this.canvasSize.height-t.overallSize):t.top=r,this.comments.push(t),this.lastCommentStream[a]=t;break}}clean(){this.comments=this.comments.filter(t=>t.alive),this.lastCommentStream=this.lastCommentStream.filter(t=>t.alive)}tick(t){this.comments.forEach(r=>{r.tick(t)})}getList(){return this.comments}get(t,r){return this.comments.find(a=>{let n=t>a.left&&t<a.left+a.width,l=r>a.top&&r<a.top+a.overallSize;if(n&&l)return!0})}};var Ga=class{ctx;canvasSize;meta;lines;fixedLines;fonrSize;fixedFonrSize;duration;autoTickDisabled;mainLayerName;run;isPlay;layers;total;isDebug;constructor(t,r,a,n){this.isDebug=n?.debug??!1,this.checkArgs(t,r,a),this.ctx=this._getContext(t,r,a),this.canvasSize=new Vn({height:a,width:r}),this.meta=new rd,this.duration=n?n.duration?n.duration:Ge.duration:Ge.duration,this.mainLayerName=n?n.layerName?n.layerName:Ge.defaultLayer:Ge.defaultLayer,this.lines={big:n?n.bigLines?n.bigLines:Ge.bigLines:Ge.bigLines,medium:n?n.mediumLines?n.mediumLines:Ge.mediumLines:Ge.mediumLines,small:n?n.smallLines?n.smallLines:Ge.smallLines:Ge.smallLines},this.fixedLines={big:Ge.fix.big,medium:Ge.fix.medium,small:Ge.fix.smal},this.fonrSize=this._getFontSize(a,this.lines),this.fixedFonrSize=this._getFontSize(a,this.fixedLines),this.mainLayerName=n?n.layerName?n.layerName:Ge.defaultLayer:Ge.defaultLayer,this.layers=new Map,this.addLayer(this.mainLayerName),this.total=0,this.run=!0,this.isPlay=!0,this.autoTickDisabled=n&&n.autoTickDisabled?n.autoTickDisabled:!1,n?.debug&&(Qt.write(`canvasID:${t}, width:${r}px, height:${a}px`),Qt.write("\u521D\u671F\u5316\u304C\u5B8C\u4E86\u3057\u307E\u3057\u305F\u3002")),this.autoTickDisabled||(n?.debug&&Qt.write("\u66F4\u65B0\u51E6\u7406\u3092\u958B\u59CB\u3057\u307E\u3059\u3002"),this.tick())}checkArgs(t,r,a){if(!t)throw new Error(ur.__INIT__.ARGUMENTS.NOT_EXIST.ID);if(!r)throw new Error(ur.__INIT__.ARGUMENTS.NOT_EXIST.WIDTH);if(!a)throw new Error(ur.__INIT__.ARGUMENTS.NOT_EXIST.HEIGHT);if(typeof r!="number")throw new Error(ur.__INIT__.ARGUMENTS.NaN.WIDTH(r));if(typeof a!="number")throw new Error(ur.__INIT__.ARGUMENTS.NaN.HEIGHT(a))}send(t,r){let a=new Map,n=r?r.layer?r.layer:this.mainLayerName:this.mainLayerName,l=r&&r.type?r.type:"naka",u=r&&r.size?r.size:"medium",d=r&&r.color?r.color:"#fff",c=this.getBcolor(d),f=r&&r.vpos?r.vpos:0,g=r?r.fontName?r.fontName:Ge.defaultFont:Ge.defaultFont,p=r?r.opacity?r.opacity:Ge.opacity:Ge.opacity,y=r&&r.full?r.full:!1,E=r?r.onDisposed?r.onDisposed:()=>{}:()=>{};this.total++,r!==void 0&&r.customAttr!==void 0&&(a=this._getAttr(r.customAttr)),a.set("color",d),a.set("bcolor",c),a.set("fontName",g),a.set("opacity",p),a.set("full",y);let S=this.layers.get(n);if(S!==void 0)S.add(t,this.total,a,l,u,{onDispased:E},f);else throw new Error(ur.LAYER.LAYER_DOES_NOT_EXIST(n));this.isDebug&&Qt.write(`\u30B3\u30E1\u30F3\u30C8\u3092\u8FFD\u52A0\u3057\u307E\u3057\u305F\u3002(${t})`)}pause(){this.isDebug&&Qt.write("\u4E00\u6642\u505C\u6B62"),this.isPlay=!1}play(){this.isDebug&&Qt.write("\u518D\u751F"),this.isPlay=!0}clear(t){if(t){let r=this.layers.get(t);if(r!==void 0)r.clear();else throw new Error(ur.LAYER.LAYER_DOES_NOT_EXIST(t))}else this.layers.forEach(r=>{r.clear()})}dispose(){this.run=!1,this.isPlay=!1,this.layers.forEach(t=>{t.clear()}),this.ctx.clearRect(0,0,this.canvasSize.width,this.canvasSize.height),this.layers.clear(),this.isDebug&&Qt.write("\u5168\u3066\u306E\u51E6\u7406\u3092\u7D42\u4E86\u3057\u307E\u3057\u305F\u3002")}_getAttr(t){let r=new Map;for(let[a,n]of Object.entries(t))r.set(a,n);return r}_getFontSize(t,r){let a=t/r.big,n=t/r.medium,l=t/r.small;return{big:a,medium:n,small:l}}_getContext(t,r,a){let n=document.getElementById(t);if(n){n.height=a,n.width=r,n.style.width=`${r}px`,n.style.height=`${a}px`;let l=n.getContext("2d");if(l!==null)return l;throw new Error}else throw new Error(ur.__INIT__.ELEMENT.NOT_EXIST(t))}tick(t){if(this.isPlay){let r=t?!!t.render:!0,a=t&&t.vpos?t.vpos:0;r&&this.ctx.clearRect(0,0,this.canvasSize.width,this.canvasSize.height),this.layers.forEach(n=>{n.tick({vpos:a,render:r})}),this.meta.loop()}this.run&&!this.autoTickDisabled&&requestAnimationFrame(()=>{this.tick(t)})}getBcolor(t){switch(t){case"black":case"#000":case"#000000":return"#fff";default:return"#000"}}get(t,r){let a=[];return this.layers.forEach(n=>{a.push(...n.get(t,r))}),a}addLayer(t){if(this.layers.has(t))throw new Error(ur.LAYER.DUPLICATION(t));this.layers.set(t,new Hn(this.ctx,this.canvasSize,this.lines,this.fonrSize,this.fixedFonrSize,this.duration)),this.isDebug&&Qt.write(`\u30EC\u30A4\u30E4\u30FC "${t}" \u3092\u8FFD\u52A0\u3057\u307E\u3057\u305F\u3002`)}removeLayer(t){if(this.layers.has(t))throw new Error(ur.LAYER.DUPLICATION(t));this.layers.delete(t),this.isDebug&&Qt.write(`\u30EC\u30A4\u30E4\u30FC "${t}" \u3092\u524A\u9664\u3057\u307E\u3057\u305F\u3002`)}},rd=class{count;constructor(){this.count=0}loop(){this.count++}getCount(){return this.count}},Qt=class{static write(t){console.log(`[NicommentJS]${t}`)}},ur={__INIT__:{ARGUMENTS:{NOT_EXIST:{HEIGHT:'[ERR]argument "height" must be specified.',WIDTH:'[ERR]argument "width" must be specified.',ID:'[ERR]argument "id" must be specified.'},NaN:{HEIGHT:e=>`[ERR]${e} is not a number. "height" must be a number.`,WIDTH:e=>`[ERR]${e} is not a number. "width" must be a number.`}},ELEMENT:{NOT_EXIST:e=>`[ERR]Canvas Element which id is "${e}" was not found.`,NOT_A_CANVAS_ELEMENT:e=>`[ERR]Element which id is "${e}" is not a canvasHTML5 Element.`}},SEND:{},LAYER:{DUPLICATION:e=>`[ERR]The layer name ${e} already exists.`,LAYER_DOES_NOT_EXIST:e=>`[ERR]A layer name is ${e} does not exist.`}};var zn=class{constructor(t,r){this._video=t,this._commentDrawer=r,this.initialize()}_commentDrawer;_video;_comments=[];_isPlaying=!1;_isMainloopRunning=!1;_isDisposed=!1;_currentID="";get currentID(){return this._currentID}_commentAddedListener;initialize(){this._video.on("play",this.onPlay.bind(this)),this._video.on("pause",this.onPause.bind(this)),this._video.on("seeked",this.onSeek.bind(this))}load(t,r,a){this._currentID=a,this._isPlaying=!this._video.paused,this._comments=[];let n=Math.ceil(r/10)+1;for(let l=0;l<n;l++)this._comments.push([]);t.forEach(l=>{let u=Math.floor(l.vposMS/1e3/10);u+1>=n||(this._comments[u]===void 0&&(this._comments[u]=[]),this._comments[u].push(l))})}start(){this._isMainloopRunning||(this._isPlaying=!0,this._isMainloopRunning=!0,this._commentDrawer.play(),this.mainloop())}dispose(){this._isDisposed=!0,this._isPlaying=!1,this._commentDrawer.dispose(),this._video.off("play",this.onPlay),this._video.off("pause",this.onPause),this._video.off("seeked",this.onSeek)}on(t,r){switch(t){case"commentAdded":this._commentAddedListener=r;break}}mainloop(){if(this._isDisposed||!this._isPlaying)return;let t=this._video.currentTime,r=Math.floor(t/10),a=t*1e3;this._comments[r].forEach(n=>{!n.isAdded&&n.vposMS<a+500&&n.vposMS>a-500&&(n.isAdded=!0,this._commentDrawer.send(n.body,{vpos:n.vposMS,color:n.color,type:n.type}),this._commentAddedListener&&this._commentAddedListener(n))}),this._commentDrawer.tick({vpos:a,render:!0}),requestAnimationFrame(()=>{this._isDisposed||!this._isPlaying||this.mainloop()})}onPlay(){this.start()}onPause(){this._isPlaying=!1,this._isMainloopRunning=!1,this._commentDrawer.pause()}onSeek(){this._comments.forEach(t=>{t.forEach(r=>{r.isAdded=!1})})}};var id=class{_cache={};async getComments(t){if(this._cache!==void 0&&this._cache.url===t)return li.Succeeded(this._cache.comments);let r=Date.now();_e.log(`\u30B3\u30E1\u30F3\u30C8\u3092\u53D6\u5F97\u3057\u307E\u3059\u3002(${t})`);let a;try{a=await fetch(t)}catch{return _e.error("\u30CD\u30C3\u30C8\u30EF\u30FC\u30AF\u30A8\u30E9\u30FC\u306B\u3088\u308A\u30B3\u30E1\u30F3\u30C8\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002"),li.Fail("\u30B3\u30E1\u30F3\u30C8\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")}if(!a.ok){let l=await a.text();return _e.error(`\u30B3\u30E1\u30F3\u30C8\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002 ${l}`),li.Fail(`\u30B3\u30E1\u30F3\u30C8\u306E\u53D6\u5F97\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002 ${l}`)}let n=await a.json();return _e.log(`\u30B3\u30E1\u30F3\u30C8\u3092\u53D6\u5F97\u3057\u307E\u3057\u305F\u3002(${Date.now()-r}ms)`),this._cache={url:t,comments:n.comments.sort((l,u)=>l.vposMS-u.vposMS).map((l,u)=>this.getManagedComment(l,u))},li.Succeeded(this._cache.comments)}getManagedComment(t,r){let a="naka";t.mail.includes("ue")?a="ue":t.mail.includes("shita")&&(a="shita");let n="#fff";return t.mail.includes("red")?n="#ff0000":t.mail.includes("pink")?n="#ff8080":t.mail.includes("orange")?n="#ffcc00":t.mail.includes("yellow")?n="#ffff00":t.mail.includes("green")?n="#00ff00":t.mail.includes("cyan")?n="#00ffff":t.mail.includes("blue")?n="#0000ff":t.mail.includes("purple")?n="#8000ff":t.mail.includes("black")&&(n="#000"),{body:t.body,isAdded:!1,mail:t.mail,number:t.number,postedAt:t.postedAt,type:a,userID:t.userID,vposMS:t.vposMS,color:n,innnerIndex:r}}},dv=new id;var cv=()=>{let[e,t]=Oe(!1);return Qe(()=>{globalThis.addEventListener("resize",()=>{t(!1)})},[]),[e,t]};var hv=()=>{let{state:e,dispatch:t}=ke(Ae),r=tt(null),a=tt(!1),n=tt(!1),[l,u]=cv();function d(){return e.jsWatchInfo===void 0?!1:e.comments===void 0?!0:e.comments.niconicoID!==e.jsWatchInfo.video.niconicoID}return Qe(()=>{if(!d()&&l&&n.current||(u(!0),e.jsWatchInfo===void 0))return;e.commentManager!==void 0&&e.commentManager.dispose();let c=e.jsWatchInfo;if(a.current||(d()&&(n.current=!1,a.current=!0,dv.getComments(c.comment.contentUrl).then(p=>{if(a.current=!1,p.IsSucceeded&&p.Data!==null){let y=e.ngHandler.filterNG(p.Data).then(E=>{t({type:"comments",payload:{comments:E,niconicoID:c.video.niconicoID}})})}else t({type:"comments",payload:{comments:[],niconicoID:c.video.niconicoID}})})),e.video===void 0||e.comments===void 0)||e.comments.niconicoID!==e.jsWatchInfo.video.niconicoID||r.current===null)return;let f=new Ga("commentCanvas",r.current.clientWidth,r.current.clientHeight,{autoTickDisabled:!0});if(e.comments.comments.length>0){let g=new zn(e.video,f);t({type:"commentManager",payload:g}),g.load(e.comments.comments,e.video.duration,e.comments.niconicoID),e.video.paused||g.start(),n.current=!0}}),e.comments===void 0||e.comments.comments.length===0?D.createElement("div",{className:"commentWrapper"}):D.createElement("div",{className:"commentWrapper",ref:r},D.createElement("canvas",{id:"commentCanvas",className:`commentCanvas ${e.isCommentVisible?"visible":""}`}))};Object.defineProperty(Date.prototype,"Format",{enumerable:!1,configurable:!0,writable:!0,value:function(e){let t=this.getFullYear(),r=(this.getMonth()+1).toString().padStart(2,"0"),a=this.getDate().toString().padStart(2,"0"),n=this.getHours().toString().padStart(2,"0"),l=this.getMinutes().toString().padStart(2,"0"),u=this.getSeconds().toString().padStart(2,"0"),d=this.getMilliseconds().toString().padStart(3,"0"),c=d.slice(0,2);return e.replace("yyyy",t.toString()).replace("MM",r).replace("dd",a).replace("HH",n).replace("mm",l).replace("ss",u).replace("SSS",d).replace("SS",c)}});var fv=()=>{let[e,t]=D.useState(_e.messages),{state:r,dispatch:a}=ke(Ae),n=tn(l=>{if(l===null){t([]);return}t([...e,l])},[]);return Qe(()=>(_e.addEventListner("write",n),_e.addEventListner("clear",n),()=>{_e.removeEventListner("write",n),_e.removeEventListner("clear",n)}),[]),D.createElement("div",{className:`systemMessage ${r.isSystemMessageVisible?"":"hide"}`,onMouseDown:l=>l.stopPropagation()},e.map((l,u)=>D.createElement("div",{key:u,className:`message ${l.type} ${l.border?"messageBorder":""}`},D.createElement("div",{className:"time"},"[",l.time.Format("yyyy/MM/dd mm:ss:SS"),"]"),D.createElement("div",{className:"message"},l.message))))};var mv=()=>{let[e,t]=Oe(!1),[r,a]=Oe({x:0,y:0}),{state:n,dispatch:l}=ke(Ae),u=tt(null);function d(c){if(u.current===null)return;if(c.button!==2){!n.isSystemMessageVisible&&!n.contextMenu.open&&n.video!==void 0&&(n.video.paused?n.video.play():n.video.pause()),l({type:"systemMessage",payload:!1});return}let f=c.clientX,g=c.clientY;l({type:"contextMenu",payload:{open:!0,left:f,top:g}})}return D.createElement("div",{className:"videoOverflow",onMouseDown:c=>d(c),ref:u},D.createElement(fv,null))};var gv=({videoRef:e})=>{let t=tt(!1),r=tt(""),{state:a,dispatch:n}=ke(Ae);return Qe(()=>{if(a.jsWatchInfo===void 0||r.current===a.jsWatchInfo.video.niconicoID&&t.current)return;let l=!1;if(r.current!==""&&r.current!==a.jsWatchInfo.video.niconicoID&&(l=!0),t.current=!0,r.current=a.jsWatchInfo.video.niconicoID,!l&&e.current!==null){let u=new $n(e.current);_e.log("\u52D5\u753B\u306E\u8AAD\u307F\u8FBC\u307F\u3092\u958B\u59CB\u3057\u307E\u3059\u3002");let d=Date.now();u.Initialize(a.jsWatchInfo).then(c=>{c.IsSucceeded?(_e.log(`\u52D5\u753B\u3092\u8AAD\u307F\u8FBC\u307F\u307E\u3057\u305F\u3002(${Date.now()-d}ms, ${a.jsWatchInfo.media.contentUrl})`),u.on("pause",()=>{n({type:"isPlaying",payload:!1})}),u.on("play",()=>{n({type:"isPlaying",payload:!0})}),n({type:"video",payload:u})):_e.error(c.Message??"\u52D5\u753B\u306E\u8AAD\u307F\u8FBC\u307F\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")})}else{let u=a.video;if(u===void 0||e.current===null)return;_e.log("\u52D5\u753B\u306E\u8AAD\u307F\u8FBC\u307F\u3092\u958B\u59CB\u3057\u307E\u3059\u3002");let d=Date.now();u.Initialize(a.jsWatchInfo,e.current).then(c=>{c.IsSucceeded?_e.log(`\u52D5\u753B\u3092\u8AAD\u307F\u8FBC\u307F\u307E\u3057\u305F\u3002(${Date.now()-d}ms, ${a.jsWatchInfo.media.contentUrl})`):_e.error(c.Message??"\u52D5\u753B\u306E\u8AAD\u307F\u8FBC\u307F\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002")})}}),D.createElement("div",{className:"videoWrapper"},D.createElement("video",{ref:e,id:"player",className:"videoElm",poster:a.jsWatchInfo?.thumbnail.contentUrl}),D.createElement(hv,null),D.createElement(mv,null))};var pv=({title:e})=>D.createElement("div",{className:"title"},e);var vv=({userID:e,userName:t})=>{let[r,a]=D.useState("https://secure-dcdn.cdn.nimg.jp/nicoaccount/usericon/defaults/blank.jpg");return Qe(()=>{let n=Number.parseInt(e),u=`https://secure-dcdn.cdn.nimg.jp/nicoaccount/usericon/${Math.floor(n/1e4)}/${n}.jpg`,d=new AbortController;return fetch(u,{signal:d.signal}).then(c=>{c.ok&&a(u)}),()=>{d.abort()}},[e]),D.createElement("div",{className:"ownerWrapper"},D.createElement("a",{href:`https://nicovideo.jp/user/${e}`},D.createElement("img",{src:r,className:"ownerIcon"})),D.createElement("a",{href:`https://nicovideo.jp/user/${e}/video`,className:"ownerName"},t))};var yv=({tags:e})=>D.createElement("div",{className:"tagWrapper"},e.map((t,r)=>{let a=t.isNicodicExists?"nicodic exist":"nicodic",n=t.isNicodicExists?"fa-solid fa-book fa-sm":"fa-solid fa-circle-question fa-sm";return D.createElement("div",{key:r,className:"tag"},D.createElement("a",{className:"tagName",href:`https://nicovideo.jp/tag/${t.name}`},t.name),D.createElement("a",{href:`https://dic.nicovideo.jp/a/${t.name}`,className:a},D.createElement("i",{className:n})))}));var Ev=({description:e})=>{let[t,r]=Oe(!1);return t||(e=e.replace(/<.+?>/g,"")),D.createElement("div",{className:"descriptionWrapper"},D.createElement("div",{className:`description ${t?"":"collapsed"}`,onClick:()=>r(!0),dangerouslySetInnerHTML:{__html:e}}),D.createElement("span",{className:`expandButton ${t?"":"collapsed"}`,onClick:()=>r(!t)},t?"\u25B2\u9589\u3058\u308B":"\u25BC\u7D9A\u304D\u3092\u8AAD\u3080"))};var Sv=({uploadedAt:e,count:t,niconicoID:r})=>{let a=`${e.getFullYear()}/${(e.getMonth()+1).toString().padStart(2,"0")}/${e.getDate().toString().padStart(2,"0")} ${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`,n;t.view>1e4?n=`${Math.floor(t.view/1e3)/10}\u4E07`:n=t.view.toString();let l;t.comment>1e4?l=`${Math.floor(t.comment/1e3)/10}\u4E07`:l=t.comment.toString();let u;t.mylist>1e4?u=`${Math.floor(t.mylist/1e3)/10}\u4E07`:u=t.mylist.toString();let d;return t.like>1e4?d=`${Math.floor(t.like/1e3)/10}\u4E07`:d=t.like.toString(),D.createElement("div",{className:"majorInfoWrapper"},D.createElement("div",{className:"uploadedAt"},D.createElement("span",null,"\u6295\u7A3F\u65E5: ",a)),D.createElement("div",{className:"counts"},D.createElement("span",null,D.createElement("i",{className:"icon fa-solid fa-play"}),n),D.createElement("span",null,D.createElement("i",{className:"icon fa-solid fa-message"})," ",l),D.createElement("span",null,D.createElement("i",{className:"icon fa-solid fa-folder"}),u),D.createElement("span",null,D.createElement("i",{className:"icon like fa-solid fa-heart"})," ",d),D.createElement("a",{href:`https://nico.ms/${r}`},D.createElement("i",{className:"icon fa-solid fa-globe"}),"\u30CB\u30B3\u30CB\u30B3\u52D5\u753B")))};var Tv=()=>{let{state:e,dispatch:t}=ke(Ae),r=e.jsWatchInfo;return r===void 0?D.createElement("div",{className:"videoInfoWrapper"}):D.createElement("div",{className:"videoInfoWrapper"},D.createElement("div",{className:"titleAndOwner"},D.createElement(pv,{title:r.video.title}),D.createElement(vv,{userID:r.video.owner.id,userName:r.video.owner.name})),D.createElement(Sv,{uploadedAt:new Date(r.video.uploadedAt),count:r.video.count,niconicoID:r.video.niconicoID}),D.createElement(yv,{tags:r.video.tags}),D.createElement(Ev,{description:r.video.description}))};var ad=({percentage:e,className:t})=>D.createElement("div",{className:"slider"},D.createElement("div",{className:`sliderInner ${t}`,style:{transform:`scaleX(${e})`}}));var bv=({percentage:e})=>D.createElement("div",{className:"sliderHandle",style:{transform:`translateX(${e*100}%)`}},D.createElement("div",{className:"sliderHandleInner"}));var Lv=()=>{let{state:e,dispatch:t}=ke(Ae),[r,a]=Oe(0),[n,l]=Oe(0),u=D.useRef(null);Qe(()=>{if(e.video===void 0||e.jsWatchInfo===void 0)return;let c=e.video,f=e.jsWatchInfo.video.duration,g=()=>{let p=c.currentTime;if(c.buffered.length===0)return;let y=c.buffered.end(c.buffered.length-1);a(p/f),l(y/f)};return c.on("timeupdate",g),c.on("progress",g),()=>{c.off("timeupdate",g),c.off("progress",g)}});function d(c){if(u.current===null||e.video===void 0)return;let g=(c.clientX-u.current.getBoundingClientRect().left)/u.current.clientWidth,p=e.video.duration*g;e.video.currentTime=p}return D.createElement("div",{className:"sliderWrapper",ref:u,onClick:d},D.createElement(ad,{percentage:n,className:"buffer"}),D.createElement(ad,{percentage:r,className:"time"}),D.createElement(bv,{percentage:r}))};var kv=()=>{let{state:e,dispatch:t}=ke(Ae);function r(){e.isPlaying?e.video?.pause():e.video?.play()}return D.createElement("div",{className:"playControler"},D.createElement("div",{className:"playButton",onClick:()=>r()},D.createElement("i",{className:`fa-solid fa-lg ${e.isPlaying?"fa-pause":"fa-play"}`})))};var Av=()=>{let{state:e,dispatch:t}=ke(Ae),[r,a]=Oe("00:00"),n=tt(null),l=rn(()=>{if(e.video===void 0)return"00:00";let d=e.video.duration;if(isNaN(d))return"00:00";if(d>3600){let c=String(Math.floor(d/3600)).padStart(2,"0"),f=String(Math.floor(d%3600/60)).padStart(2,"0"),g=String(Math.floor(d%60)).padStart(2,"0");return`${c}:${f}:${g}`}else{let c=String(Math.floor(d/60)).padStart(2,"0"),f=String(Math.floor(d%60)).padStart(2,"0");return`${c}:${f}`}},[e.video?.duration]);Qe(()=>{if(e.video===void 0)return;let d=e.video,c=()=>{if(d===void 0)return;let f=d.currentTime;if(d.duration>3600){let g=String(Math.floor(f/3600)).padStart(2,"0"),p=String(Math.floor(f%3600/60)).padStart(2,"0"),y=String(Math.floor(f%60)).padStart(2,"0");a(`${g}:${p}:${y}`)}else{let g=String(Math.floor(f/60)).padStart(2,"0"),p=String(Math.floor(f%60)).padStart(2,"0");a(`${g}:${p}`)}};return d.on("timeupdate",c),()=>{d.off("timeupdate",c)}},[e.video]);function u(d){if(e.video===void 0)return;let c=e.video,f=c.currentTime,g=10;d?c.currentTime=f+g:c.currentTime=f-g}return D.createElement("div",{className:"timeControler"},D.createElement("p",{onClick:()=>u(!1)},D.createElement("i",{className:"fa-solid fa-arrow-rotate-left fa-lg"})),D.createElement("p",{className:"time"},r," / ",l),D.createElement("p",{onClick:()=>u(!0)},D.createElement("i",{className:"fa-solid fa-arrow-rotate-right fa-lg"})))};var wv=()=>{let{state:e,dispatch:t}=ke(Ae),[r,a]=Oe(e.video?.repeat??!1);function n(){t({type:"isCommentVisible",payload:!e.isCommentVisible})}function l(){e.video!==void 0&&(e.video.repeat=!e.video.repeat,a(e.video.repeat))}return D.createElement("div",{className:"generalControler"},D.createElement("p",{className:`repeat ${r?"enable":""}`,onClick:l},D.createElement("i",{className:"fa-solid fa-repeat fa-lg"})),D.createElement("p",{className:`commentVisibility ${e.isCommentVisible?"visible":""}`,onClick:n},D.createElement("i",{className:"fa-solid fa-message fa-lg"})))};var Rv=()=>D.createElement("div",{className:"controler"},D.createElement(Lv,null),D.createElement("div",{className:"panel"},D.createElement(kv,null),D.createElement(Av,null),D.createElement(wv,null)));function Dv(e,t){let{state:r,dispatch:a}=t;r.video!==void 0&&(console.log(e.key),e.key===" "||e.key==="k"?(e.preventDefault(),r.video.paused?r.video.play():r.video.pause()):e.key==="c"?(e.preventDefault(),a({type:"isCommentVisible",payload:!r.isCommentVisible})):e.key==="ArrowRight"||e.key==="l"?(e.preventDefault(),r.video.currentTime+10<r.video.duration?r.video.currentTime+=10:r.video.currentTime=r.video.duration):e.key==="ArrowLeft"||e.key==="j"?(e.preventDefault(),r.video.currentTime-10>0?r.video.currentTime-=10:r.video.currentTime=0):e.key==="Home"&&(e.preventDefault(),r.video.currentTime=0))}var Iv=()=>{let e=tt(null),{state:t,dispatch:r}=ke(Ae);return D.createElement("div",{className:"leftContent",tabIndex:-1,onKeyDown:a=>Dv(a,{state:t,dispatch:r})},D.createElement(gv,{videoRef:e}),D.createElement(Rv,null),D.createElement(Tv,null))};function fR(){console.log(!1);let e=document.querySelector("#watchApp"),r=new sn().getData();e!==null&&r!==null&&qo(e).render(D.createElement(C1,{jsWatchInfo:r}))}var C1=({jsWatchInfo:e})=>{let[t,r]=an(Om,{...Nm,jsWatchInfo:e,ngHandler:new ln(new on(e.comment.commentNGAPIBaseUrl))});return D.createElement(Ae.Provider,{value:{state:t,dispatch:r}},t.contextMenu.open?D.createElement(Km,null):void 0,D.createElement("div",{className:"watchWrapper"},D.createElement(Iv,null),D.createElement("div",{className:"rightContent"},D.createElement(Gm,null),D.createElement(zm,null),D.createElement(Hm,{videos:e.playlistVideos,baseURL:e.api.baseUrl}))))};export{fR as main};
/*! Bundled license information:

react/cjs/react.production.min.js:
  (**
   * @license React
   * react.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
/*! Bundled license information:

scheduler/cjs/scheduler.production.min.js:
  (**
   * @license React
   * scheduler.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
/*! Bundled license information:

react-dom/cjs/react-dom.production.min.js:
  (**
   * @license React
   * react-dom.production.min.js
   *
   * Copyright (c) Facebook, Inc. and its affiliates.
   *
   * This source code is licensed under the MIT license found in the
   * LICENSE file in the root directory of this source tree.
   *)
*/
