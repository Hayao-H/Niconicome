var u=class{constructor(t,e,n){this.IsSucceeded=t,this.Data=e,this.Message=n}static Succeeded(t){return new u(!0,t,null)}static Fail(t){return new u(!1,null,t)}};var f=class{Get(t){let e;try{e=document.querySelector(t)}catch(n){return u.Fail(`\u8981\u7D20\u3092\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002(\u8A73\u7D30\uFF1A${n.message})`)}return e==null?u.Fail("\u6307\u5B9A\u3055\u308C\u305F\u8981\u7D20\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002"):u.Succeeded(e)}GetAll(t){let e;try{e=document.querySelectorAll(t)}catch(n){return u.Fail(`\u8981\u7D20\u3092\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002(\u8A73\u7D30\uFF1A${n.message})`)}return u.Succeeded(e)}};var H=class{constructor(t){this._elmHandler=t}GetComputedStyle(t){let e=this._elmHandler.Get(t);if(!e.IsSucceeded||e.Data===null)return u.Fail(e.Message??"");try{let n=window.getComputedStyle(e.Data);return u.Succeeded(n)}catch{return u.Fail("\u30B9\u30BF\u30A4\u30EB\u3092\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}}};var g=class{constructor(t){this._elmHandler=t}getSelected(){let t=this._elmHandler.Get("#InputBox");if(!t.IsSucceeded||t.Data===null)return"";let e=t.Data;return!(e instanceof HTMLInputElement)||!this.IsValidIndex(e.value,e.selectionStart)||!this.IsValidIndex(e.value,e.selectionEnd,!0)?"":e.value.substring(e.selectionStart,e.selectionEnd)}IsValidIndex(t,e,n=!1){return!(e===null||n&&e>t.length||!n&&e>t.length-1)}};var r=class{};r.VideoListRow=".VideoListRow",r.VideoListRowClassName="VideoListRow",r.VideoListBodyClassName="VideoListBody",r.DropTargetClassName="DropTarget";var S=class{constructor(t,e){this._sourceNiconicoID=null;this._sourceID=null;this._lastOverElement=null;this._elmHandler=t,this._dotnetHelper=e}initialize(t){let e=this._elmHandler.GetAll(r.VideoListRow);!e.IsSucceeded||e.Data===null||e.Data.forEach(n=>{if(n instanceof HTMLElement){let s=n.dataset.niconicoid,i=n.dataset.playlistid;if(s===void 0||i===void 0)return;let o=`${s}-${i}`;if(t.includes(o))return;t.push(o),n.addEventListener("dragstart",l=>{if(!(l.target instanceof HTMLElement))return;let a=this.GetParentByClassName(l.target,r.VideoListRowClassName);a!==null&&(this._sourceNiconicoID=a.dataset.niconicoid??null,this._sourceID=a.id)}),n.addEventListener("dragover",l=>{if(l.preventDefault(),!(l.target instanceof HTMLElement))return;let a=this.GetParentByClassName(l.target,r.VideoListRowClassName);a!==null&&(a.classList.contains(r.DropTargetClassName)||a.classList.add(r.DropTargetClassName),this._lastOverElement=a)}),n.addEventListener("dragleave",l=>{if(l.preventDefault(),!(l.target instanceof HTMLElement))return;let a=this.GetParentByClassName(l.target,r.VideoListRowClassName);a!==null&&a.classList.contains(r.DropTargetClassName)&&a.classList.remove(r.DropTargetClassName)}),n.addEventListener("drop",async l=>{if(l.preventDefault(),this._sourceNiconicoID===null)return;let a=this._elmHandler.Get(`#${this._sourceID}`);if(!a.IsSucceeded||a.Data===null||!(l.target instanceof HTMLElement))return;let d=l.target.parentNode,c=l.target;for(;d!==null;){if(!(d instanceof HTMLElement))return;if(!d.classList.contains(r.VideoListBodyClassName)){c=d,d=d.parentNode;continue}d.insertBefore(a.Data,c),await this._dotnetHelper.invokeMethodAsync("MoveVideo",this._sourceNiconicoID,c.dataset.niconicoid),d=null}this._lastOverElement!==null&&this._lastOverElement.classList.contains(r.DropTargetClassName)&&this._lastOverElement.classList.remove(r.DropTargetClassName)})}})}GetParentByClassName(t,e){let n=t;for(;n!==null;){if(!(n instanceof HTMLElement))return null;if(!n.classList.contains(e)){n=n.parentNode;continue}return n}return null}};var p=class{};p.PageContent=".PageContent",p.VideoListHeader="#VideoListHeader",p.Separator=".Separator";var y=class{constructor(t,e,n){this._isResizing=!1;this._elmHandler=t,this._styleHandler=e,this._dotnetHelper=n,this._columnIDs={0:"CheckBoxColumn",1:"ThumbnailColumn",2:"TitleColumn",3:"UploadedDateTimeColumn",4:"IsDownloadedColumn",5:"ViewCountColumn",6:"CommentCountColumn",7:"MylistCountColumn",8:"LikeCountColumn",9:"MessageColumn"},this._separatorIDs={0:"#CheckBoxColumnSeparator",1:"#ThumbnailColumnSeparator",2:"#TitleColumnSeparator",3:"#UploadedDateTimeColumnSeparator",4:"#IsDownloadedColumnSeparator",5:"#ViewCountColumnSeparator",6:"#CommentCountColumnSeparator",7:"#MylistCountColumnSeparator",8:"#LikeCountColumnSeparator"}}async initialize(){for(let n in this._separatorIDs){let s=this._elmHandler.Get(this._separatorIDs[n]);if(!s.IsSucceeded||s.Data===null)continue;let i=s.Data;if(!(i instanceof HTMLElement))continue;let o=i.dataset.index;o!=null&&i.addEventListener("mousedown",l=>this.OnMouseDown(o))}await this.setWidth();let t=this._elmHandler.Get(p.PageContent);if(!t.IsSucceeded||t.Data===null||!(t.Data instanceof HTMLElement))return;t.Data.addEventListener("mouseup",n=>this.OnMouseUp());let e=this._elmHandler.Get(p.VideoListHeader);!e.IsSucceeded||e.Data===null||!(e.Data instanceof HTMLElement)||e.Data.addEventListener("mousemove",n=>this.OnMouseMove(n))}async setWidth(){let t=0;for(let e in this._columnIDs){let n=null;if(e in this._separatorIDs){let i=this._elmHandler.Get(this._separatorIDs[e]);if(!i.IsSucceeded||i.Data===null||(n=i.Data,!(n instanceof HTMLElement)))continue}let s=this._styleHandler.GetComputedStyle(`#${this._columnIDs[e]}`);if(s.IsSucceeded&&s.Data!==null){let i=s.Data,o=this._elmHandler.GetAll(`.${this._columnIDs[e]}`);if(!o.IsSucceeded||o.Data===null)continue;if(i.display==="none"){n!==null&&(n.style.display="none"),o.Data.forEach(l=>{l instanceof HTMLElement&&(l.style.display="none")});continue}else{let l=await this._dotnetHelper.invokeMethodAsync("GetWidth",this._columnIDs[e]),a=l>0,d=a?l:Number(i.width.match(/\d+/));if(t+=d,n!==null&&(n.style.left=`${t}px`),a){let c=this._elmHandler.Get(`#${this._columnIDs[e]}`);c.IsSucceeded&&c.Data!==null&&c.Data instanceof HTMLElement&&(c.Data.style.width=`${d}px`)}o.Data.forEach(c=>{c instanceof HTMLElement&&(c.style.width=a?`${d}px`:i.width)})}}}}OnMouseDown(t){this._isResizing=!0,this._resizingIndex=t}OnMouseUp(){this._isResizing=!1,this._resizingIndex=null}async OnMouseMove(t){if(!this._isResizing||this._resizingIndex===null)return;let e=Number(this._resizingIndex)+1,n=this._columnIDs[this._resizingIndex],s=this._columnIDs[`${e}`],i=this._elmHandler.Get(`#${n}`),o=this._elmHandler.Get(`#${s}`),l=this._elmHandler.Get(p.VideoListHeader),a=this._elmHandler.GetAll(`.${n}`),d=this._elmHandler.GetAll(`.${s}`),c=this._elmHandler.Get(this._separatorIDs[this._resizingIndex]);if(!i.IsSucceeded||i.Data===null||!a.IsSucceeded||a.Data===null||!c.IsSucceeded||c.Data===null||!l.IsSucceeded||l.Data===null||!o.IsSucceeded||o.Data===null||!d.IsSucceeded||d.Data===null||!(i.Data instanceof HTMLElement)||!(o.Data instanceof HTMLElement))return;let _=i.Data.getBoundingClientRect(),L=l.Data.getBoundingClientRect(),h=t.clientX-_.left,R=h-i.Data.offsetWidth,E=o.Data.offsetWidth-R;if(i.Data.style.width=`${h}px`,o.Data.style.width=`${E}px`,a.Data.forEach(D=>{D instanceof HTMLElement&&(D.style.width=`${h}px`)}),d.Data.forEach(D=>{D instanceof HTMLElement&&(D.style.width=`${E}px`)}),await this._dotnetHelper.invokeMethodAsync("SetWidth",`${h}`,n),await this._dotnetHelper.invokeMethodAsync("SetWidth",`${E}`,s),!(l.Data instanceof HTMLElement)||!(c.Data instanceof HTMLElement))return;let C=_.left-L.left+h-10;c.Data.style.left=`${C}px`}};async function K(m,t){let e=new f,n=new H(e),s=new y(e,n,m),i=new S(e,m);t&&await s.initialize(),i.initialize(v)}async function Q(m){let t=new f,e=new H(t);await new y(t,e,m).setWidth()}function Y(){let m=new f;return new g(m).getSelected()}var v=[];export{Y as getSelectedIOfInput,K as initialize,Q as setWidth};
