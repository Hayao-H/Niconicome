var m=class o{constructor(e,t,n){this.IsSucceeded=e,this.Data=t,this.Message=n}IsSucceeded;Data;Message;static Succeeded(e){return new o(!0,e,null)}static Fail(e){return new o(!1,null,e)}};var p=class{Get(e){let t;try{t=document.querySelector(e)}catch(n){return m.Fail(`\u8981\u7D20\u3092\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002(\u8A73\u7D30\uFF1A${n.message})`)}return t==null?m.Fail("\u6307\u5B9A\u3055\u308C\u305F\u8981\u7D20\u304C\u898B\u3064\u304B\u308A\u307E\u305B\u3093\u3002"):m.Succeeded(t)}GetAll(e){let t;try{t=document.querySelectorAll(e)}catch(n){return m.Fail(`\u8981\u7D20\u3092\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002(\u8A73\u7D30\uFF1A${n.message})`)}return m.Succeeded(t)}};var H=class{constructor(e){this._elmHandler=e}_elmHandler;GetComputedStyle(e){let t=this._elmHandler.Get(e);if(!t.IsSucceeded||t.Data===null)return m.Fail(t.Message??"");try{let n=window.getComputedStyle(t.Data);return m.Succeeded(n)}catch{return m.Fail("\u30B9\u30BF\u30A4\u30EB\u3092\u53D6\u5F97\u3067\u304D\u307E\u305B\u3093\u3067\u3057\u305F\u3002")}}};var g=class{constructor(e){this._elmHandler=e}_elmHandler;getSelected(){let e=this._elmHandler.Get("#InputBox");if(!e.IsSucceeded||e.Data===null)return"";let t=e.Data;return!(t instanceof HTMLInputElement)||!this.IsValidIndex(t.value,t.selectionStart)||!this.IsValidIndex(t.value,t.selectionEnd,!0)?"":t.value.substring(t.selectionStart,t.selectionEnd)}IsValidIndex(e,t,n=!1){return!(t===null||n&&t>e.length||!n&&t>e.length-1)}};var E=class{constructor(e){this._dotnet=e}_dotnet;Initialize(){window.addEventListener("dragover",e=>e.preventDefault()),window.addEventListener("drop",e=>{if(e.preventDefault(),e.dataTransfer===null)return;let t=[];if(e.dataTransfer.types.forEach(a=>{if(a==="text/plain"){let l=e.dataTransfer.getData("text/plain");if(l==="")return;t.push(l)}}),e.dataTransfer.types.includes("Files"))for(let a=0;a<e.dataTransfer.files.length;a++){let l=e.dataTransfer.files.item(a);l!==null&&l.name!==""&&(l.name.endsWith(".url")||t.push(l.name))}let n=t.map(a=>a.match(/(sm|so|nm)?[0-9]+/)?.[0]??"").filter(a=>a!==""),s=[...new Set(n)];if(s.length===0)return;let i=s.join(" ");this._dotnet.invokeMethodAsync("OnDrop",i)})}};var u=class{static VideoListRow=".VideoListRow";static VideoListRowClassName="VideoListRow";static VideoListBodyClassName="VideoListBody";static DropTargetClassName="DropTarget"};var S=class{constructor(e,t){this._elmHandler=e,this._dotnetHelper=t}_elmHandler;_dotnetHelper;_sourceNiconicoID=null;_sourceID=null;_lastOverElement=null;initialize(e){let t=this._elmHandler.GetAll(u.VideoListRow);!t.IsSucceeded||t.Data===null||t.Data.forEach(n=>{if(n instanceof HTMLElement){let s=n.dataset.niconicoid,i=n.dataset.playlistid;if(s===void 0||i===void 0)return;let a=`${s}-${i}`;if(e.includes(a))return;e.push(a),n.addEventListener("dragstart",l=>{if(!(l.target instanceof HTMLElement))return;let r=this.GetParentByClassName(l.target,u.VideoListRowClassName);r!==null&&(this._sourceNiconicoID=r.dataset.niconicoid??null,this._sourceID=r.id)}),n.addEventListener("dragover",l=>{if(l.preventDefault(),!(l.target instanceof HTMLElement))return;let r=this.GetParentByClassName(l.target,u.VideoListRowClassName);r!==null&&(r.classList.contains(u.DropTargetClassName)||r.classList.add(u.DropTargetClassName),this._lastOverElement=r)}),n.addEventListener("dragleave",l=>{if(l.preventDefault(),!(l.target instanceof HTMLElement))return;let r=this.GetParentByClassName(l.target,u.VideoListRowClassName);r!==null&&r.classList.contains(u.DropTargetClassName)&&r.classList.remove(u.DropTargetClassName)}),n.addEventListener("drop",async l=>{if(l.preventDefault(),this._sourceNiconicoID===null)return;let r=this._elmHandler.Get(`#${this._sourceID}`);if(!r.IsSucceeded||r.Data===null||!(l.target instanceof HTMLElement))return;let d=l.target.parentNode,c=l.target;for(;d!==null;){if(!(d instanceof HTMLElement))return;if(!d.classList.contains(u.VideoListBodyClassName)){c=d,d=d.parentNode;continue}d.insertBefore(r.Data,c),await this._dotnetHelper.invokeMethodAsync("MoveVideo",this._sourceNiconicoID,c.dataset.niconicoid),d=null}this._lastOverElement!==null&&this._lastOverElement.classList.contains(u.DropTargetClassName)&&this._lastOverElement.classList.remove(u.DropTargetClassName)})}})}GetParentByClassName(e,t){let n=e;for(;n!==null;){if(!(n instanceof HTMLElement))return null;if(!n.classList.contains(t)){n=n.parentNode;continue}return n}return null}};var f=class{static PageContent=".PageContent";static VideoListHeader="#VideoListHeader";static Separator=".Separator"};var y=class{constructor(e,t,n){this._elmHandler=e,this._styleHandler=t,this._dotnetHelper=n,this._columnIDs={0:"CheckBoxColumn",1:"ThumbnailColumn",2:"TitleColumn",3:"UploadedDateTimeColumn",4:"IsDownloadedColumn",5:"ViewCountColumn",6:"CommentCountColumn",7:"MylistCountColumn",8:"LikeCountColumn",9:"MessageColumn"},this._separatorIDs={0:"#CheckBoxColumnSeparator",1:"#ThumbnailColumnSeparator",2:"#TitleColumnSeparator",3:"#UploadedDateTimeColumnSeparator",4:"#IsDownloadedColumnSeparator",5:"#ViewCountColumnSeparator",6:"#CommentCountColumnSeparator",7:"#MylistCountColumnSeparator",8:"#LikeCountColumnSeparator"}}_elmHandler;_styleHandler;_columnIDs;_separatorIDs;_dotnetHelper;_isResizing=!1;_resizingIndex;async initialize(){for(let n in this._separatorIDs){let s=this._elmHandler.Get(this._separatorIDs[n]);if(!s.IsSucceeded||s.Data===null)continue;let i=s.Data;if(!(i instanceof HTMLElement))continue;let a=i.dataset.index;a!=null&&i.addEventListener("mousedown",l=>this.OnMouseDown(a))}await this.setWidth();let e=this._elmHandler.Get(f.PageContent);if(!e.IsSucceeded||e.Data===null||!(e.Data instanceof HTMLElement))return;e.Data.addEventListener("mouseup",n=>this.OnMouseUp());let t=this._elmHandler.Get(f.VideoListHeader);!t.IsSucceeded||t.Data===null||!(t.Data instanceof HTMLElement)||t.Data.addEventListener("mousemove",n=>this.OnMouseMove(n))}async setWidth(){let e=0;for(let t in this._columnIDs){let n=null;if(t in this._separatorIDs){let i=this._elmHandler.Get(this._separatorIDs[t]);if(!i.IsSucceeded||i.Data===null||(n=i.Data,!(n instanceof HTMLElement)))continue}let s=this._styleHandler.GetComputedStyle(`#${this._columnIDs[t]}`);if(s.IsSucceeded&&s.Data!==null){let i=s.Data,a=this._elmHandler.GetAll(`.${this._columnIDs[t]}`);if(!a.IsSucceeded||a.Data===null)continue;if(i.display==="none"){n!==null&&(n.style.display="none"),a.Data.forEach(l=>{l instanceof HTMLElement&&(l.style.display="none")});continue}else{let l=await this._dotnetHelper.invokeMethodAsync("GetWidth",this._columnIDs[t]),r=l>0,d=r?l:Number(i.width.match(/\d+/));if(e+=d,n!==null&&(n.style.left=`${e}px`),r){let c=this._elmHandler.Get(`#${this._columnIDs[t]}`);c.IsSucceeded&&c.Data!==null&&c.Data instanceof HTMLElement&&(c.Data.style.width=`${d}px`)}a.Data.forEach(c=>{c instanceof HTMLElement&&(c.style.width=r?`${d}px`:i.width)})}}}}OnMouseDown(e){this._isResizing=!0,this._resizingIndex=e}OnMouseUp(){this._isResizing=!1,this._resizingIndex=null}async OnMouseMove(e){if(!this._isResizing||this._resizingIndex===null)return;let t=Number(this._resizingIndex)+1,n=this._columnIDs[this._resizingIndex],s=this._columnIDs[`${t}`],i=this._elmHandler.Get(`#${n}`),a=this._elmHandler.Get(`#${s}`),l=this._elmHandler.Get(f.VideoListHeader),r=this._elmHandler.GetAll(`.${n}`),d=this._elmHandler.GetAll(`.${s}`),c=this._elmHandler.Get(this._separatorIDs[this._resizingIndex]);if(!i.IsSucceeded||i.Data===null||!r.IsSucceeded||r.Data===null||!c.IsSucceeded||c.Data===null||!l.IsSucceeded||l.Data===null||!a.IsSucceeded||a.Data===null||!d.IsSucceeded||d.Data===null||!(i.Data instanceof HTMLElement)||!(a.Data instanceof HTMLElement))return;let I=i.Data.getBoundingClientRect(),R=l.Data.getBoundingClientRect(),h=e.clientX-I.left,v=h-i.Data.offsetWidth,_=a.Data.offsetWidth-v;if(i.Data.style.width=`${h}px`,a.Data.style.width=`${_}px`,r.Data.forEach(D=>{D instanceof HTMLElement&&(D.style.width=`${h}px`)}),d.Data.forEach(D=>{D instanceof HTMLElement&&(D.style.width=`${_}px`)}),await this._dotnetHelper.invokeMethodAsync("SetWidth",`${h}`,n),await this._dotnetHelper.invokeMethodAsync("SetWidth",`${_}`,s),!(l.Data instanceof HTMLElement)||!(c.Data instanceof HTMLElement))return;let L=I.left-R.left+h-10;c.Data.style.left=`${L}px`}};async function ee(o,e){let t=new p,n=new H(t),s=new y(t,n,o),i=new S(t,o),a=new E(o);e&&(await s.initialize(),a.Initialize()),i.initialize(C)}async function te(o){let e=new p,t=new H(e);await new y(e,t,o).setWidth()}function ne(){let o=new p;return new g(o).getSelected()}var C=[];export{ne as getSelectedIOfInput,ee as initialize,te as setWidth};
